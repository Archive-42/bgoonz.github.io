(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[1],{526:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(2),a=n(49),o=function(){function e(){this._eventSource=new a.a}var t=e.prototype;return t.add_onEditHappened=function(e){this._eventSource.addHandler("OnEditHappenedEvent",e)},t.remove_onEditHappened=function(e){this._eventSource.removeHandler("OnEditHappenedEvent",e)},t.raiseEditHappenedEvent=function(){this._eventSource.raiseEvent("OnEditHappenedEvent")},e}();Object(i.a)(o,"EditNotificationEventSource",null,[]);var s=n(1),l=(n(9),n(54),n(85)),c=n(97),u=n(39),d=n(26),p=n(8),h=n(3);function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var m=function(){function e(e,t,n,i,a,o,s){void 0===s&&(s=0),this._editHappenedInTimeWindow=!1,this._notificationTask=null,this._editDocumentTelemetryReportingTask=null,this._userEverEdited=!1,this._taskManager=t,this._notificationIntervalInMs=e,this._hostPostmessengerTask=n,this._editNotificationEventSource=i,this._userActivityHostNotificationManager=a,this._editNotificationPostMessageIsEnabled=o,this._editDocumentUserActionReportingIntervalInMs=0,this._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport=!1;try{s>0&&(this._editDocumentUserActionReportingIntervalInMs=s,this._editDocumentUserActionReportingIntervalInMs<3e5&&(this._editDocumentUserActionReportingIntervalInMs=3e5),this._taskManager&&!this._editDocumentTelemetryReportingTask&&(this._editDocumentTelemetryReportingTask=new u.a(3,2,this._editDocumentUserActionReportingIntervalInMs,Object(r.d)(this,this.reportEditDocumentUserActionTelemetryIfNecessary,"reportEditDocumentUserActionTelemetryIfNecessary")),this._taskManager.addTask(this._editDocumentTelemetryReportingTask)))}catch(e){h.ULS.sendTraceTag(51246176,383,50,"Hit an exception while trying to queue up the EditDocument user action reporting interval: "+e)}}var t,n,i,a=e.prototype;return a.editHappened=function(){this.userEverEdited?this._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport=!0:(this._userEverEdited=!0,l.Health.instance.addQosPillar("Save"),l.Health.instance.addQosPillar("Authoring"),c.c(p.a.editDocument)),this._editHappenedInTimeWindow=!0,this._userActivityHostNotificationManager&&this._userActivityHostNotificationManager.activityHappened(),this._editNotificationEventSource&&this._editNotificationEventSource.raiseEditHappenedEvent(),s.AFrameworkApplication.dataPlumber&&s.AFrameworkApplication.dataPlumber.markAsRealEditSession(),this._editNotificationPostMessageIsEnabled&&(this._notificationTask||(this.sendPostMessageIfNecessary(null),this._notificationTask=new u.a(3,2,this._notificationIntervalInMs,Object(r.d)(this,this.sendPostMessageIfNecessary,"sendPostMessageIfNecessary"),113),this._taskManager.addTask(this._notificationTask)))},a.sendPostMessageIfNecessary=function(e){var t=this;this._editHappenedInTimeWindow&&(this._hostPostmessengerTask.CWR((function(e){return t._hostPostmessengerTask.get_result().sendMessage(d.a.editNotification,null)})),h.ULS.sendTraceTag(38086292,209,50,"EditNotificationManager: sending post message to the host."),this._editHappenedInTimeWindow=!1)},a.reportEditDocumentUserActionTelemetryIfNecessary=function(e){try{this._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport&&(c.c(p.a.editDocument),this._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport=!1)}catch(e){this._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport=!1,h.ULS.sendTraceTag(51246177,383,50,"Hit an exception while trying to send the EditDocument user action: "+e)}},t=e,(n=[{key:"userEverEdited",get:function(){return this._userEverEdited}}])&&g(t.prototype,n),i&&g(t,i),e}();Object(i.a)(m,"EditNotificationManager",null,[227]);var f=n(4);function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var S=function(){function e(e,t,n,i,r){this._notificationTask=null,this._handlerTask=null,this._activityHappenedInTimeWindow=!1,this._userWasEverActive=!1,this._handlerRegistered=!1,this._taskManager=t,this._notificationIntervalInMs=e,this._hostPostmessengerTask=n,this._mouseInputManager=i,this._onBeforeShutdownSubscriber=r,this.registerHandlerTask(null)}var t,n,i,a=e.prototype;return a.registerHandlerTask=function(e){var t=this,n=document.getElementById(s.AFrameworkApplication.applicationOuterContainerId);!this._handlerRegistered&&this._mouseInputManager&&n&&(this._mouseInputManager.registerHandler(f.EventNames.mouseOver,n,Object(r.d)(this,this.mouseActivityHandler,"mouseActivityHandler"),null),this._handlerRegistered=!0),this._onBeforeShutdownSubscriber((function(e,n){t.dispose()}))},a.mouseActivityHandler=function(e){return this._handlerRegistered&&(this._mouseInputManager.unregisterHandler(f.EventNames.mouseOver,document.getElementById(s.AFrameworkApplication.applicationOuterContainerId),Object(r.d)(this,this.mouseActivityHandler,"mouseActivityHandler")),this._handlerRegistered=!1),this.activityHappened(),!1},a.activityHappened=function(){this._userWasEverActive=!0,this._activityHappenedInTimeWindow=!0,this._handlerTask||(this._handlerTask=new u.a(3,2,this._notificationIntervalInMs,Object(r.d)(this,this.registerHandlerTask,"registerHandlerTask"),112),this._taskManager.addTask(this._handlerTask)),this._notificationTask||(this.sendPostMessageIfNecessary(null),this._notificationTask=new u.a(3,2,this._notificationIntervalInMs,Object(r.d)(this,this.sendPostMessageIfNecessary,"sendPostMessageIfNecessary"),111),this._taskManager.addTask(this._notificationTask))},a.sendPostMessageIfNecessary=function(e){var t=this;this._activityHappenedInTimeWindow&&(this._hostPostmessengerTask.CWR((function(e){return t._hostPostmessengerTask.get_result().sendMessage(d.a.userActivity,null)})),h.ULS.sendTraceTag(38405446,209,50,"UserActivityHostNotificationManager: sending post message to the host."),this._activityHappenedInTimeWindow=!1)},a.dispose=function(){this._handlerRegistered&&(this._mouseInputManager.unregisterHandler(f.EventNames.mouseOver,document.getElementById(s.AFrameworkApplication.applicationOuterContainerId),Object(r.d)(this,this.mouseActivityHandler,"mouseActivityHandler")),this._handlerRegistered=!1)},t=e,(n=[{key:"userWasEverActive",get:function(){return this._userWasEverActive}}])&&v(t.prototype,n),i&&v(t,i),e}();Object(i.a)(S,"UserActivityHostNotificationManager",null,[224,4]);var _=n(73),y=n(68),b=n(60),A=n(170),C=function(e){var t=new A.a;return e.execute(Object(r.d)(t,t.setResult,"setResult")),t.get_task()};function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var w=function(){function e(){this._container=null}var t,n,i,a=e.prototype;return a.init=function(){s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(Object(r.d)(this,this.onFullAppSettingsReady,"onFullAppSettingsReady"))},a.onFullAppSettingsReady=function(){var t=this;e.editNotificationIsEnabled&&e.editNotificationInterval>0&&(this._container.register(o,"Common.App.HostNotification.EditNotificationEventSource").singleInstance(),this._container.register(S,"Common.App.HostNotification.UserActivityHostNotificationManager").as("Common.Interface.IUserActivityHostNotificationManager").singleInstance().usingFactory((function(){return new S(6e4,b.a.instance,C(t._container.resolveFuture("Postmessage.IHostPostmessenger")),_.a.instance,s.AFrameworkApplication.subscribeToBeforeAppShutDown)})),this._container.register(m,"Common.App.HostNotification.EditNotificationManager").as("Common.Interface.IEditNotificationManager").singleInstance().usingFactory((function(){return new m(e.editNotificationInterval,b.a.instance,C(t._container.resolveFuture("Postmessage.IHostPostmessenger")),t._container.resolve("Common.App.HostNotification.EditNotificationEventSource"),t._container.tryResolve("Common.Interface.IUserActivityHostNotificationManager"),e.editNotificationPostMessageIsEnabled,e.editDocumentUserActionTelemetryReportingIntervalInMilliseconds)})),this._container.resolve("Common.Interface.IEditNotificationManager"),h.ULS.shipAssertTag(38086291,209,e.editNotificationInterval>0,"EditNotification Interval is less than or equal to 0."))},a.configure=function(e){this._container=e},a.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,i=[{key:"editNotificationInterval",get:function(){return s.AFrameworkApplication.appSettingsManager?parseInt(s.AFrameworkApplication.appSettingsManager.appSettings.EditNotificationTimeIntervalMs||"300000"):3e5}},{key:"editDocumentUserActionTelemetryReportingIntervalInMilliseconds",get:function(){return s.AFrameworkApplication.appSettingsManager?parseInt(s.AFrameworkApplication.appSettingsManager.appSettings.EditDocumentUserActionTelemetryReportingIntervalInMilliseconds||"0"):0}},{key:"editNotificationIsEnabled",get:function(){return!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("EditNotificationIsEnabled")}},{key:"editNotificationPostMessageIsEnabled",get:function(){return!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("EditNotificationPostMessageIsEnabled")}}],(n=[{key:"name",get:function(){return"Common.App.EditNotification"}}])&&T(t.prototype,n),i&&T(t,i),e}();Object(i.a)(w,"CommonHostNotificationPackage",null,[14,15]);var I,k=n(19);!function(e){e[e.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler",e[e.cloudPolicySettings=1]="cloudPolicySettings"}(I||(I={})),Object(i.b)("ApplicationFeatureHelperRequestType",I);var F=function(){this.message=null,this.httpStatusCode=0};Object(i.a)(F,"HttpRequstToPromiseRejectData",null,[]);n(129),n(185);var E=n(174);function O(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var D=function(){function e(e,t){this._appSettingsManager=e,this._clientRequestManager=t}var t=e.prototype;return t.createHttpResponsePromise=function(e,t,n,i,r,a,o,s){var c=this;void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null);var u=I[n],d=u+"RequestFailure";return l.Health.instance.recordKpiUsage(d,0,"jpittsdirects",null),new Promise((function(p,g){h.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",u);var m=null!=o?o:c._appSettingsManager.getIntAppSetting("ApplicationFeatureHelperRequestQueueTimeout",15e3),f=null!=s?s:c._appSettingsManager.getIntAppSetting("ApplicationFeatureHelperRequestSentTimeout",3e4);c._clientRequestManager.addRequestWithHeaderForwarding(e,1,null,c.getHeaders(n,i),a,!1,1,(function(e){h.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",u);try{if(null==e||void 0===e.data||null===e.data||void 0===e.data.responseData||null===e.data.responseData){l.Health.instance.recordKpiFailure(d,"Invalid RequestSucceededEventArgs",!1,!0,null);var n=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",u);return void g(c.getRejectData(n,e))}if(e.data.httpStatus!==E.a.OK_200){l.Health.instance.recordKpiFailure(d,"HttpStatusCode_"+e.data.httpStatus.toString(),!1,!0,null);var i=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",e.data.httpStatus,u);return void g(c.getRejectData(i,e))}null!=r&&void 0!==e.data.responseHeaders&&null!==e.data.responseHeaders&&r(e.data.responseHeaders);var a=t(e.data.responseData);if(!a){l.Health.instance.recordKpiFailure(d,"Parse Failure",!1,!0,null);var o=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",u);return void g(c.getRejectData(o,e))}h.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",u),p(a)}catch(t){l.Health.instance.recordKpiFailure(d,"Unexpected Failure",!1,!0,null);var s=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",t,u);g(c.getRejectData(s,e))}}),(function(e){h.ULS.sendTraceTag(50622691,3004,10,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} failed.",u);var t="";if(!e.data)return l.Health.instance.recordKpiFailure(d,"Invalid RequestFailedEventArgs",!1,!0,null),t=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",u),void g(c.getRejectData(t,e));l.Health.instance.recordKpiFailure(d,"HttpStatusCode_"+e.data.httpStatus.toString(),!1,!0,null),t=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",e.data.httpStatus,e.data.responseData||"No Data",u),g(c.getRejectData(t,e))}),null,void 0,void 0,m,f)}))},t.getRejectData=function(e,t){var n=new F;return n.message=e,t&&t.data?n.httpStatusCode=t.data.httpStatus:n.httpStatusCode=-1,n},t.getHeaders=function(e,t){var n={};if(n["x-UserDataSignature"]=this._appSettingsManager.getStringAppSetting("UserDataSignature"),n["x-LicensingIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingIsEnabled").toString(),n["x-CacheIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingRedisIsEnabled").toString(),n["x-OcpsIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("OcpsIsEnabled").toString(),n["x-LicensingAADIdIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingAadIdIsEnabled").toString(),e||(n["x-LicensingEduIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingEduIsEnabled").toString(),n["x-LicenseCheckOnTenantEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingForSafeLinksIsEnabled").toString()),t)for(var i,r=O(t.get_keys());!(i=r()).done;){var a=i.value;n[a]=t.get_item(a)}return n},e}();Object(i.a)(D,"HttpRequestToPromiseUtility",null,[]);var M=function(e,t,n){this.featureName=null,this.isEnabled=!1,this.tierName=0,this.featureName=e,this.isEnabled=t,this.tierName=n};Object(i.a)(M,"FeatureStateChangeArgs",null,[]);var L=n(33),R=n(158),U=n(10),H=n(76),B=n(122),x=n(21),N=n(394),j=n(205),W=n(196),V=n(186);function q(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return G(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var K=function(){function e(e,t,n,i,r){void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=null),this._stopWatchBuiler=null,this._licensingStopWatch=null,this._requestTime=null,this._responseTime=null,this.featuresPromise=null,this._httpRequestToPromise=new D(e,t),this._appSettingsManager=e,this._licensingMaxRetryAttempts=e.getIntAppSetting("LicensingMaxRetryAttempts",0),this._isO365ConsumerHost=e.getBooleanAppSetting("IsO365ConsumerHost"),this._isO365CommercialHost=e.getBooleanAppSetting("IsO365CommercialHost"),this._isFreemiumUpsellSettingEnabled=e.getBooleanAppSetting("PremiumUpsellIsEnabled"),this._cloudPolicySettingsHelper=n,this._userPrivacySettingsHelper=i,this._actionManager=r,this._licensingIsEnabled=e.getBooleanAppSetting("LicensingIsEnabled"),this._ocpsIsEnabled=e.getBooleanAppSetting("OcpsIsEnabled")&&this._isO365CommercialHost,this._userPrivacySettingsEnabled=e.getBooleanAppSetting("ShowPrivacyDialog")&&!!i,this._isAnonymousUser=e.getBooleanAppSetting("IsAnonymousUser"),this.falseBooleanPromise=new Promise((function(e,t){e(!1)})),this.trueBooleanPromise=new Promise((function(e,t){e(!0)})),this.featureStateChangeCallbacks=new j.a(V.a.get_ordinalIgnoreCase()),this._licensedControlledFeatureSet=this.getLicensedControlledFeatures(),this.isO365Host()&&!this._isAnonymousUser?(void 0!==s.AFrameworkApplication.activeFrame&&null!==s.AFrameworkApplication.activeFrame&&(this._stopWatchBuiler=s.AFrameworkApplication.activeFrame.theStopwatchBuilder,void 0!==this._stopWatchBuiler&&null!==this._stopWatchBuiler&&(this._licensingStopWatch=this._stopWatchBuiler.makeStopwatch("WebServiceCall","ApplicationFeatureHelperService"))),this.featuresPromise=this.tryInitializeLicensing()):this.featuresPromise=new Promise((function(e){e({})})),this.featuresPromise.catch((function(e){h.ULS.sendTraceTag(42513088,3004,10,JSON.stringify(e))}))}var t=e.prototype;return t.getLicensedControlledFeatures=function(){for(var e=this._appSettingsManager.containsAppSetting("AllLicensedFeatures")?this._appSettingsManager.getListAppSetting("AllLicensedFeatures"):new Array(0),t=new W.a(V.a.get_ordinal()),n=0;n<e.length;n++)t.add(e[n]);return t},t.isO365Host=function(){return this._isO365CommercialHost||this._isO365ConsumerHost},t.tryInitializeLicensing=function(e,t){var n=this;void 0===e&&(e=0),void 0===t&&(t=!1),h.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",t);var i=this.createExtendedPropertiesMap();i&&(i.set("retryAttempt",e.toString()),i.set("forceRefresh",t.toString()),i.set("isO365ConsumerHost",this._isO365ConsumerHost.toString()),i.set("isO365CommercialHost",this._isO365CommercialHost.toString()),i.set("isFreemiumUpsellEnabled",this._isFreemiumUpsellSettingEnabled.toString())),l.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",i),l.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",1,"waclicensing",i),void 0!==this._licensingStopWatch&&null!==this._licensingStopWatch&&this._licensingStopWatch.start();var a=null;return t&&(a=new j.a(V.a.get_ordinalIgnoreCase())).set_item("x-LicensingForceRefresh","true"),this._requestTime=new Date,(this._licensingIsEnabled?this._httpRequestToPromise.createHttpResponsePromise(this.getEndpointUrl("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(r.d)(this,this.parseApplicationFeatureHelperResponse,"parseApplicationFeatureHelperResponse"),0,a,Object(r.d)(this,this.processApplicationFeatureHelperResponseHeaders,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then((function(e){var t=Object.assign(new N.a,{durationMs:n.stopAndGetDurationInMsFromLicensingStopwatch()});return t.extendedProperties=i,t.extendedProperties&&e&&(t.extendedProperties.set("featureCount",H.c(e).toString()),t.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in e).toString()),t.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in e).toString()),n._responseTime&&t.extendedProperties.set("fromCache",(n._responseTime<n._requestTime).toString())),l.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",t),e}),(function(t){var r=Object.assign(new N.a,{durationMs:n.stopAndGetDurationInMsFromLicensingStopwatch()}),a=Object(k.a)(F,t);return a?(r.extendedProperties=i,r.extendedProperties&&r.extendedProperties.set("status",a.httpStatusCode.toString()),l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","RequestFailed",!1,!0,r),408===a.httpStatusCode&&++e<=n._licensingMaxRetryAttempts?n.tryInitializeLicensing(e):new Promise((function(e,t){t(a)}))):(h.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,r),new Promise((function(e,n){n(t)})))}))},t.parseApplicationFeatureHelperResponse=function(e){var t=L.a(e);return t?(h.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),h.ULS.sendTraceTag(50938594,3004,50,"{0}",t)):h.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set. Response was {0}",e),t.Features},t.getEndpointUrl=function(t){var n=String.format("{0}{1}",this._appSettingsManager.getStringAppSetting("WebServiceBase"),t);if(this._appSettingsManager.containsAppSetting("ApplicationFeatureHelperHttpCachingEnabled")&&this._appSettingsManager.getBooleanAppSetting("ApplicationFeatureHelperHttpCachingEnabled")){var i=e.getLocalStorageCacheKey(this._appSettingsManager);if(i&&i.length>0){var r=new R.QueryStringBuilder(n);r.addParam("ckey",i),n=r.toString()}}return n},t.isFeatureEnabled=function(e,t){var n=this;if(!this._ocpsIsEnabled&&!this._userPrivacySettingsEnabled&&!this._licensingIsEnabled)return this.trueBooleanPromise;if(h.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",e),"ConnectedServices"===e){var i=this._ocpsIsEnabled?this._cloudPolicySettingsHelper.getBooleanPolicySetting("ControllerConnectedServicesEnabled"):this.trueBooleanPromise,r=this._userPrivacySettingsEnabled?this._userPrivacySettingsHelper.getSettings().then((function(e){return 2!==e.controllerServicesStateRoaming}),(function(e){return t})):this.trueBooleanPromise;return i.then((function(e){return e?r:n.falseBooleanPromise}))}var a=null;a=this._ocpsIsEnabled?this._cloudPolicySettingsHelper.isFeatureEnabled(e):this.trueBooleanPromise;var o=null;o=this._licensingIsEnabled?this.isFeatureAllowedByUserLicense(e,t):this.trueBooleanPromise;var s=null;return s=this._userPrivacySettingsEnabled?this._userPrivacySettingsHelper.isFeatureEnabled(e):this.trueBooleanPromise,a.then((function(e){return e?s.then((function(e){return e?o:n.falseBooleanPromise})):n.falseBooleanPromise})).then((function(e){return e}),(function(e){return t}))},t.getFeatureTier=function(e,t){var n=this;return this._licensingIsEnabled?(h.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",e),this.featuresPromise.then((function(i){return e in i?n.parseTierName(i[e],t):t}),(function(e){return t}))):new Promise((function(e,t){e(2)}))},t.isFreemiumUpsellEnabled=function(){return this._isFreemiumUpsellSettingEnabled&&this._isO365ConsumerHost&&!this._isAnonymousUser},t.launchUpsellExperience=function(e){h.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",e));var t=this.createExtendedPropertiesMap();t&&t.set("experienceId",e),l.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",t);var n=x.a.instance.tryResolve("Common.IInProductMessagingUIManager");if(n){var i=Object(r.d)(this,this.handleDimeTaskComplete,"handleDimeTaskComplete");n.launchDimeExperience(e,i)}else{var a;h.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this._actionManager.processActionWithData(p.a.freemiumUpsellEligible,2,((a={}).experience=e,a))}},t.registerFeatureStateChangeCallback=function(e,t){if(!this._licensingIsEnabled)return null;if(!e||!t)return h.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),null;var n=B.a.create().toString();return this.featureStateChangeCallbacks.containsKey(e)||this.featureStateChangeCallbacks.set_item(e,new j.a(V.a.get_ordinalIgnoreCase())),this.featureStateChangeCallbacks.get_item(e).add(n,t),h.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",n,e)),n},t.removeFeatureStateChangeCallback=function(e,t){return!!this._licensingIsEnabled&&(e&&this.featureStateChangeCallbacks.containsKey(e)?t&&B.a.isValid(t)?this.featureStateChangeCallbacks.get_item(e).containsKey(t)?(h.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",t,e)),this.featureStateChangeCallbacks.get_item(e).remove(t)):(h.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",t,e)),!1):(h.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",t,e)),!1):(h.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",e)),!1))},t.parseTierName=function(e,t){switch(e.toLowerCase()){case"unknown":return 0;case"basic":return 1;case"premium":return 2;default:return t}},t.handleDimeTaskComplete=function(){var e=this;h.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete"),this.featuresPromise.then((function(t){e.refreshLicensingAndNotifyUpdatedFeatures(t)})).catch((function(t){e.refreshLicensingAndNotifyUpdatedFeatures({})}))},t.refreshLicensingAndNotifyUpdatedFeatures=function(e){var t=this;h.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");var n=this.tryInitializeLicensing(0,!0);n.then((function(i){t.featuresPromise=n,H.c(i)>H.c(e)?l.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(var r,a=q(t.featureStateChangeCallbacks.get_keys());!(r=a()).done;){var o=r.value;if(o in i){var s=t.parseTierName(i[o],0);if(o in e)t.parseTierName(e[o],0)!==s&&t.notifyFeatureStateChanged(o,!0,s);else t.notifyFeatureStateChanged(o,!0,s)}else o in e&&t.notifyFeatureStateChanged(o,!1,t.parseTierName(e[o],0))}})).catch((function(e){l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null),h.ULS.sendTraceTag(594051086,3004,10,JSON.stringify(e))}))},t.notifyFeatureStateChanged=function(e,t,n){h.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",e,t,n);for(var i,r=new M(e,t,n),a=q(this.featureStateChangeCallbacks.get_item(e));!(i=a()).done;){var o=i.value;try{o.get_value()(r)}catch(t){h.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",e,o.get_key(),t.message))}}},t.isFeatureAllowedByUserLicense=function(e,t){return this._licensingIsEnabled?this._licensedControlledFeatureSet.contains(e)?this.featuresPromise.then((function(t){return e in t}),(function(e){return t})):(h.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",e),this.trueBooleanPromise):this.trueBooleanPromise},t.processApplicationFeatureHelperResponseHeaders=function(e){try{e&&"Date"in e&&(this._responseTime=new Date(e.Date),h.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this._responseTime.toString()))}catch(e){h.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",e)}},t.createExtendedPropertiesMap=function(){try{return new Map}catch(e){return null}},t.stopAndGetDurationInMsFromLicensingStopwatch=function(){if(void 0!==this._licensingStopWatch&&null!==this._licensingStopWatch){var e=this._licensingStopWatch.ageInMilliseconds;return this._licensingStopWatch.stop(),e}return null},e.getLocalStorageCacheKey=function(e){try{if(U.a.supportsWindowAtob){var t=e.getStringAppSetting("UserDataSignature").split(".");if(t.length>1){var n=window.self.atob(t[1]),i=JSON.parse(n).LocalStorageKey;if(null!=i&&i.length>0)return i}}}catch(e){h.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",e.toString())}return null},e}();Object(i.a)(K,"ApplicationFeatureHelper",null,[204]);var z=n(11),J=function(e,t){this.PolicySettings=null,this.ExpirationTime=0,this.PolicySettings=e.PolicySettings;var n=new Date;n.setMinutes(n.getMinutes()+t),this.ExpirationTime=n.getTime()};function X(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(J,"CloudPolicySettingsCacheData",null,[]);var Q=function(){function e(){this._localStorageNotWorking=!1}var t,n,i,r=e.prototype;return r.getItem=function(t){try{if(e.isValidKey(t)&&this.localStorage)return this.localStorage.getItem(t)}catch(e){h.ULS.sendTraceTag(593512200,306,15,"LocalStorageWrapper Exception: {0} ",e.message)}return null},r.setItem=function(t,n){try{e.isValidKey(t)&&this.localStorage&&this.localStorage.setItem(t,n)}catch(e){h.ULS.sendTraceTag(593512199,306,15,"LocalStorageWrapper Exception: {0} ",e.message)}},r.removeItem=function(t){try{e.isValidKey(t)&&this.localStorage&&this.localStorage.removeItem(t)}catch(e){h.ULS.sendTraceTag(593512198,306,15,"LocalStorageWrapper Exception: {0} ",e.message)}},e.isValidKey=function(e){return!(null==e||e.length<=0)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}],(n=[{key:"localStorage",get:function(){var e=null;if(!this._localStorageNotWorking)try{localStorage&&(e=localStorage)}catch(e){this._localStorageNotWorking=!0}return e}}])&&X(t.prototype,n),i&&X(t,i),e}();Q._instance=null,Object(i.a)(Q,"LocalStorageWrapper",null,[155]);var Z=n(134),Y=n(130),$=function(){function e(){}return e.sideCarIsAvailable=function(){return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SideCarIsEnabled")?e.scriptResourceWithAction&&e.isDownloaded?new Promise((function(e){e(!0)})):new Promise((function(t,n){e.scriptResourceWithAction=Y.a.create(s.AFrameworkApplication.appSettingsManager.getStringAppSetting("SideCarUrl")),Z.a.enqueueResourceWithoutEnabling(e.scriptResourceWithAction),e.scriptResourceWithAction.add_loadFinished((function(i,r){e.isDownloaded=r.succeeded,r.succeeded?t(r.succeeded):n(r.succeeded)}))})):new Promise((function(e){e(!1)}))},e}();$.isDownloaded=!1,$.scriptResourceWithAction=null,Object(i.a)($,"SideCarLoader",null,[]);var ee=function(){this.PolicySettings=null,this.ControllerConnectedServicesFeatureNames=null};Object(i.a)(ee,"CloudPolicySettingsData",null,[]);var te=n(63);function ne(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ie(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var re=function(){function e(e,t){this._checkInInterval=0,this.cloudPolicySettingsPromise=null,this._httpRequestToPromise=new D(e,t),this._appSettingsManager=e;var n=e.getStringAppSetting("HostAuthType");this._ocpsIsEnabled=e.getBooleanAppSetting("OcpsIsEnabled")&&e.getBooleanAppSetting("IsO365CommercialHost")&&!(null==n)&&"aad"===n.toLowerCase(),this._ocpsPolicyDefaults=L.b(e.getStringAppSetting("OcpsDefaultSettings")||"{}"),this._localStorageCacheKey=this.getLocalStorageCacheKey();var i=this._appSettingsManager.containsAppSetting("ServicesControlsMicrosoftControllerServicesList")&&this._appSettingsManager.getListAppSetting("ServicesControlsMicrosoftControllerServicesList")||new Array(0);this._controllerConnectedServicesSet=new W.a(V.a.get_ordinal());for(var a=0;a<i.length;a++)this._controllerConnectedServicesSet.add(i[a]);var o=this._ocpsIsEnabled&&!e.getBooleanAppSetting("IsAnonymousUser")&&e.getBooleanAppSetting("SideCarIsEnabled");this.cloudPolicySettingsPromise=o?this.tryInitializeWithSideCar():this.tryInitialize(this._ocpsIsEnabled,this.getEndpointUrl("/afhs/CloudPolicySettings.ashx"),Object(r.d)(this,this.parseCloudPolicySettingsResponse,"parseCloudPolicySettingsResponse")),this.cloudPolicySettingsPromise.then((function(e){return null})).catch((function(e){h.ULS.sendTraceTag(50622685,3004,10,JSON.stringify(e))}))}var t=e.prototype;return t.getBooleanPolicySetting=function(e,t){if(void 0===t&&(t=!0),!this._ocpsIsEnabled){var n=this;return new Promise((function(t,i){t(n.getOcpsBooleanPolicyDefault(e))}))}var i=this,r=this,a=this.cloudPolicySettingsPromise.then((function(n){try{var r=null,a="unknown".toLowerCase();if(n.PolicySettings&&a in n.PolicySettings&&(r=n.PolicySettings[a]),r){if(e in r&&void 0!==r[e]&&null!==r[e])return new Promise((function(t,n){t("0"!==r[e])}));var o=e.toLowerCase();return o in r&&void 0!==r[o]&&null!==r[o]?new Promise((function(e,t){e("0"!==r[o])})):(h.ULS.sendTraceTag(51512667,3004,50,"Policy"+e+" not found, using default"),new Promise((function(t,n){t(i.getOcpsBooleanPolicyDefault(e))})))}return new Promise((function(t,n){t(i.getOcpsBooleanPolicyDefault(e))}))}catch(n){return h.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+e+" policy value. Error Message: {0}",n.message),i.handleError(n.toString(),t,i.getOcpsBooleanPolicyDefault(e))}}),(function(n){return r.handleError(n,t,r.getOcpsBooleanPolicyDefault(e))}));return a.then((function(t){return h.ULS.sendTraceTag(50651667,3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",e,t),null})),a},t.isFeatureEnabled=function(e,t){void 0===t&&(t=!0);var n=new Promise((function(e,t){e(!0)})),i="";return this._controllerConnectedServicesSet.contains(e)&&(i="ControllerConnectedServicesEnabled",n=this.getBooleanPolicySetting(i,t)),n.then((function(t){return h.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",e,t,i),null})),n},t.handleError=function(e,t,n){return new Promise(t?function(e,t){e(n)}:function(t,n){n(e)})},t.tryInitialize=function(e,t,n){var i=this;if(!e)return Promise.resolve(new ee);var a=!1,o=null;l.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);var s=this.createAndStartStopwatch("GetCloudPolicySettings");return new Promise((function(e,o){if(void 0!==i._localStorageCacheKey&&null!==i._localStorageCacheKey&&i._localStorageCacheKey.length>0){var s=i.tryGetCloudPolicySettingsDataFromCache();if(null!=s)return a=!0,void e(s)}i._httpRequestToPromise.createHttpResponsePromise(t,n,1,null,Object(r.d)(i,i.processCloudPolicySettingsResponseHeaders,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],i._appSettingsManager.getIntAppSetting("CloudPolicySettingsRequestQueueTimeout",15e3),i._appSettingsManager.getIntAppSetting("CloudPolicySettingsRequestSentTimeout",3e4)).then((function(t){return h.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS"),i.trySetCloudPolicySettingsDataIntoCache(t),e(t),t}),(function(e){return o(e),null}))})).then((function(e){o=i.stopAndGetDurationInMsFromStopwatch(Object(z.a)((function(){return s}),(function(e){return s=e})));var t=i.createMap();t&&t.set("FromCache",a.toString());var n=Object.assign(new N.a,{durationMs:o,extendedProperties:t});return l.Health.instance.recordKpiSuccess("GetCloudPolicySettings",n),e}))},t.tryInitializeWithSideCar=function(){return $.sideCarIsAvailable().then((function(e){return h.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar"),sidecar.cloudPolicy.GetCloudPolicySettingsData()}))},t.getEndpointUrl=function(e){return String.format("{0}{1}",this._appSettingsManager.getStringAppSetting("WebServiceBase"),e)},t.parseCloudPolicySettingsResponse=function(e){var t=null;return L.d(e,Object(z.a)((function(){return t}),(function(e){return t=e}))),h.ULS.sendTraceTag(50622687,3004,t?50:10,"ParseCloudPolicySettingsResponse: fetched CloudPolicySettingsData from {0}",e),t},t.processCloudPolicySettingsResponseHeaders=function(e){try{if(null==e)return;if("CheckIn-Interval"in e){var t=parseInt(e["CheckIn-Interval"]);null!=t&&t>0&&(this._checkInInterval=t)}}catch(e){h.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",e)}},t.getOcpsBooleanPolicyDefault=function(e){return!(e in this._ocpsPolicyDefaults)||"0"!==this._ocpsPolicyDefaults[e]},t.tryGetCloudPolicySettingsDataFromCache=function(){try{var e=Q.instance.getItem(this._localStorageCacheKey);if(null==e)return h.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),null;h.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",e);var t=JSON.parse(e);if(null==t)return h.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===t.ExpirationTime||null===t.ExpirationTime)return h.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),null;if(new Date(t.ExpirationTime).getTime()<Date.now())return h.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),null;var n=new ee;n.PolicySettings=t.PolicySettings,n.ControllerConnectedServicesFeatureNames=new te.a;this._appSettingsManager.containsAppSetting("ServicesControlsMicrosoftControllerServicesList")?this._appSettingsManager.getListAppSetting("ServicesControlsMicrosoftControllerServicesList"):new Array(0);for(var i,r=ne(this._controllerConnectedServicesSet);!(i=r()).done;){var a=i.value;n.ControllerConnectedServicesFeatureNames.add(a)}return h.ULS.sendTraceTag(51662941,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved"),n}catch(e){return h.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",e.toString()),null}},t.trySetCloudPolicySettingsDataIntoCache=function(e){try{if(null==e||void 0===e.PolicySettings||null===e.PolicySettings)h.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(this._checkInInterval<=0)h.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");else{var t=new J(e,this._checkInInterval),n=JSON.stringify(t);h.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",n),Q.instance.setItem(this._localStorageCacheKey,n),h.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(e){h.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",e.toString())}},t.getLocalStorageCacheKey=function(){var e=K.getLocalStorageCacheKey(this._appSettingsManager);return e&&e.length>0?"OCPS"+e:null},t.createMap=function(){try{return new Map}catch(e){return null}},t.createAndStartStopwatch=function(e){var t=x.a.instance.tryResolve("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");return null!=t?t.makeAndStartStopwatch("WebServiceCall",e):null},t.stopAndGetDurationInMsFromStopwatch=function(e){if(void 0!==e.val&&null!==e.val){var t=e.val.ageInMilliseconds;return e.val.stop(),e.val=null,t}return null},e}();function ae(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(re,"CloudPolicySettingsHelper",null,[202]);var oe=function(){function e(){this.controllerServicesStateRoaming=0,this.userContentStateRoaming=0,this.downloadContentStateRoaming=0,this.controllerServicesTimeRoaming="",this.userContentTimeRoaming="",this.downloadContentTimeRoaming="",this.userPrivacySettingsRoamedNoticeShown=2,this._src=2}var t,n,i,r=e.prototype;return r.clone=function(){var t=new e;return t.controllerServicesStateRoaming=this.controllerServicesStateRoaming,t.userContentStateRoaming=this.userContentStateRoaming,t.downloadContentStateRoaming=this.downloadContentStateRoaming,t.controllerServicesTimeRoaming=this.controllerServicesTimeRoaming,t.userContentTimeRoaming=this.userContentTimeRoaming,t.downloadContentTimeRoaming=this.downloadContentTimeRoaming,t.userPrivacySettingsRoamedNoticeShown=this.userPrivacySettingsRoamedNoticeShown,t._src=this.src,t},r.serialize=function(t){void 0===t&&(t=null);var n={};return t&&!t.contains(e.officePrivacyControllerConnectedServicesKey)||(n[e.officePrivacyControllerConnectedServicesKey]=this.controllerServicesStateRoaming),t&&!t.contains(e.officePrivacyControllerConnectedServicesTimeKey)||(n[e.officePrivacyControllerConnectedServicesTimeKey]=this.controllerServicesTimeRoaming),t&&!t.contains(e.officePrivacyRoamedNoticeShownKey)||(n[e.officePrivacyRoamedNoticeShownKey]=this.userPrivacySettingsRoamedNoticeShown),JSON.stringify(n)},e.create=function(t,n){void 0===n&&(n=null);var i=new e;return i._src=t,null!=n&&(e.officePrivacyControllerConnectedServicesKey in n&&(i.controllerServicesStateRoaming=n[e.officePrivacyControllerConnectedServicesKey]),e.officePrivacyControllerConnectedServicesTimeKey in n&&(i.controllerServicesTimeRoaming=n[e.officePrivacyControllerConnectedServicesTimeKey]),e.officePrivacyRoamedNoticeShownKey in n&&(i.userPrivacySettingsRoamedNoticeShown=n[e.officePrivacyRoamedNoticeShownKey])),i},e.deserialize=function(t,n){try{var i=JSON.parse(t);if(null!=i)return e.create(n,i);throw h.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",t),Error.argument("settingsData")}catch(e){throw h.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",e.toString()),e}},t=e,(n=[{key:"src",get:function(){return this._src}}])&&ae(t.prototype,n),i&&ae(t,i),e}();oe.officePrivacyControllerConnectedServicesKey="CCS",oe.officePrivacyControllerConnectedServicesTimeKey="CCSTime",oe.officePrivacyRoamedNoticeShownKey="OfficePrivacyRoamedNoticeShown",Object(i.a)(oe,"UserPrivacySettings",null,[]);var se=n(79),le=function(){function e(e,t){if(null==e||null==t)throw Error.argumentNull("appSettingsManager/clientRequestManager");this._appSettingsManager=e,this._clientRequestManager=t,this._settings=null,this._settingsPromise=null}var t=e.prototype;return t.getEndpointUrl=function(e){var t=this._appSettingsManager.appSettings.RoamingServiceHandlerWebServiceBase||"",n=String.format("{0}RoamingServiceHandler.ashx?action=",t),i=new Sys.StringBuilder(n);return i.append(e),i.append("&"),i.append(s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),i.toString()},t.executeRequest=function(e,t,n,i){return void 0===i&&(i=null),this._clientRequestManager.addRequestWithTaskAndStopWatch(e,t,i,null,!1,2,null,n,"33",!1,null,6e4)},t.saveSettings=function(e){var t=this;return new Promise((function(n,i){try{if(void 0===t._settings||null===t._settings||null==e)return h.ULS.sendTraceTag(51258443,3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),void i("Can't determine setting changes to save");var r=t._settings.controllerServicesStateRoaming!==e.controllerServicesStateRoaming;if(2===t._settings.src&&r)return t.saveSettingsToQueryParam(e),void n(!0);var a=t.serializeSettingUpdates(e);if(null==a||!a.length)return h.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),void i("No changes to save");if(1===t._settings.src)return void n(t.trySaveSettingsToCookie(a));if(!t._settings.src){h.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",a);var o=t.executeRequest(t.getEndpointUrl("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",a);o.CW((function(e){if(o.get_isCanceled()||o.get_isFaulted())return h.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),void n(!1);var t=o.get_result();void 0!==t.args&&null!==t.args&&void 0!==t.args.data&&null!==t.args.data&&t.args.data.httpStatus===E.a.OK_200?(h.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),n(!0)):(h.ULS.sendTraceTag(51258446,3004,10,"SaveUserPrivacySettings: Roaming Request Failed"),n(!1))}))}}catch(e){h.ULS.sendTraceTag(50860930,3004,10,"SaveUserPrivacySettings: Exception = {0}",e.toString()),n(!1)}}))},t.serializeSettingUpdates=function(e){if(void 0===this._settings||null===this._settings||null==e)throw Error.invalidOperation("User Privacy settings have not been initialized");var t=new te.a;return e.src?1===e.src&&this._settings.controllerServicesStateRoaming!==e.controllerServicesStateRoaming&&t.add(oe.officePrivacyControllerConnectedServicesKey):(this._settings.controllerServicesStateRoaming!==e.controllerServicesStateRoaming&&(t.add(oe.officePrivacyControllerConnectedServicesKey),t.add(oe.officePrivacyControllerConnectedServicesTimeKey)),this._settings.userPrivacySettingsRoamedNoticeShown!==e.userPrivacySettingsRoamedNoticeShown&&t.add(oe.officePrivacyRoamedNoticeShownKey)),t.get_count()?e.serialize(t):(h.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),null)},t.getSettings=function(){if(!this._settingsPromise){var e=this;this._settingsPromise=new Promise((function(t,n){try{if(e._settings)return void t(e._settings.clone());e.tryGetSettingsFromRoaming().then((function(n){return e._settings=n,t(e._settings.clone()),null}),(function(n){return e.tryGetSettingsFromCookie().then((function(n){return e._settings=n,t(e._settings.clone()),null}),(function(n){return e.tryGetSettingsFromQueryParams().then((function(n){return e._settings=n,t(e._settings.clone()),null}),(function(n){return h.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)"),e._settings=new oe,t(e._settings.clone()),null})),null})),null}))}catch(n){h.ULS.sendTraceTag(50860932,3004,10,"UserPrivacySettings GetSettings: Exception = {0}",n.toString()),e._settings=new oe,t(e._settings.clone())}}))}return this._settingsPromise},t.tryGetSettingsFromRoaming=function(){var t=this;return new Promise((function(n,i){try{var r=-1!==window.location.href.indexOf("&wd_pn=2");if(!t._appSettingsManager.getBooleanAppSetting("PrivacyDialogShouldCheckRoaming")&&!r)return h.ULS.sendTraceTag(50860933,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),void i("Roaming should not be used");var a=t.executeRequest(t.getEndpointUrl("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");a.CW((function(t){try{if(!a.get_isCanceled()&&!a.get_isFaulted()){var r=a.get_result();if(r&&r.args&&r.args.data)if(r.args.data.httpStatus!==E.a.OK_200)h.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",r.args.data.httpStatus);else{if(r.args.data.responseData)return n(e.parse(r.args.data.responseData,0)),void h.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",r.args.data.responseData);h.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else h.ULS.sendTraceTag(50860935,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");return void i("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}h.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure")}catch(e){return h.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",e.toString()),void i("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}}))}catch(e){return h.ULS.sendTraceTag(50860939,3004,10,"TryGetSettingsFromRoaming Exception = {0}",e.toString()),void i("UserPrivacySettings TryGetSettingsFromRoaming Exception")}}))},t.tryGetSettingsFromCookie=function(){var t=this;return new Promise((function(n,i){try{var r=se.a.get("WacUPToggleState"),a=null;if(null!=r&&r.length>0&&(a=decodeURIComponent(r)),null!=a&&a.length>0){var o=e.parse(a,1);return h.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",o.toString()),void n(o)}var s=oe.create(1),l=new te.a;l.add(oe.officePrivacyControllerConnectedServicesKey);var c=s.serialize(l);return t.trySaveSettingsToCookie(c)?(h.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",c),void n(s)):(h.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",c),void i("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}catch(e){h.ULS.sendTraceTag(50860941,3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",e.toString()),i("UserPrivacySettings TryGetSettingsFromCookie Eception")}}))},t.tryGetSettingsFromQueryParams=function(){return new Promise((function(e,t){try{var n=-1!==window.location.href.indexOf("&wdccsoff=1"),i=oe.create(2);return n?(i.controllerServicesStateRoaming=2,s.AFrameworkApplication.disableControllerServicesViaQueryParam(),h.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",i.toString())):(i.controllerServicesStateRoaming=1,h.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",i.toString())),void e(i)}catch(t){h.ULS.sendTraceTag(50967431,3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",t.toString());var r=oe.create(2);r.controllerServicesStateRoaming=1,e(r)}}))},t.saveSettingsToQueryParam=function(e){return h.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam"),2===e.controllerServicesStateRoaming?s.AFrameworkApplication.disableControllerServicesViaQueryParam():s.AFrameworkApplication.enableControllerServicesViaQueryParam(),h.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",e),!0},t.trySaveSettingsToCookie=function(e){try{h.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",e);var t=this._appSettingsManager.getStringAppSetting("PrivacyCookieDomain")||"";if(!t||!t.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");return h.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",e),se.a.setWithAllTheThings("WacUPToggleState",e,se.a.maxComplianceAllowedRetentionInDays,"/",t)}catch(e){return h.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",e.toString()),!1}},t.isFeatureEnabled=function(e){var t=this;return this.getSettings().then((function(n){for(var i=t._appSettingsManager.containsAppSetting("ServicesControlsMicrosoftControllerServicesList")?t._appSettingsManager.getListAppSetting("ServicesControlsMicrosoftControllerServicesList"):new Array(0),r=new W.a(V.a.get_ordinal()),a=0;a<i.length;a++)r.add(i[a]);return!r.contains(e)||2!==n.controllerServicesStateRoaming}),(function(t){return h.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",e),!0}))},e.parse=function(e,t){try{return h.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",e,t),oe.deserialize(e,t)}catch(e){throw h.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",e.toString()),e}},e}();function ce(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(le,"UserPrivacySettingsHelper",null,[203]);var ue=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.configure=function(e){var t=this;this._container=e,this._container.register(202,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").singleInstance().usingFactory((function(){return new re(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager)})),this._container.register(203,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").singleInstance().usingFactory((function(){return new le(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager)})),this._container.register(204,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").singleInstance().usingFactory((function(){return new K(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager,t._container.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),t._container.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),s.AFrameworkApplication.theActionManager)}))},r.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){var t=e._container.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("LicensingIsEnabled")&&(t.isFeatureEnabled("LicensingTestFeature",!1).then((function(e){return h.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",e,s.AFrameworkApplication.appSettingsManager.getStringAppSetting("IsAnonymousUser")),null})),t.getFeatureTier("LicensingTestFeature",0).then((function(e){return h.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",e,s.AFrameworkApplication.appSettingsManager.getStringAppSetting("IsAnonymousUser")),null}))),e.temporarySideCarVerifier()}))},r.dispose=function(){},r.temporarySideCarVerifier=function(){try{s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SideCarIsEnabled")&&$.sideCarIsAvailable().then((function(e){return h.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",e),e}))}catch(e){return}},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}}])&&ce(t.prototype,n),i&&ce(t,i),e}();Object(i.a)(ue,"ApplicationFeatureHelperPackage",null,[14,15]);var de=n(35),pe=n(220),he=n(45),ge=function(){function e(e,t){this._environmentString=null,this._actionManager=e,this._appSettingsManager=t}var t=e.prototype;return t.registerActions=function(){this._environmentString=this._appSettingsManager.getStringAppSetting("StatusBarEnvironmentNameToUse"),this._environmentString&&""!==this._environmentString&&this._actionManager.addActionWithFlags(p.a.queryEnvironmentName,de.a.frame,Object(r.d)(this,this.updateEnvironmentName,"updateEnvironmentName"),96)},t.updateEnvironmentName=function(e,t,n,i,r){if(1===n)return 32;var a=r;return a[pe.a.Value]=this._environmentString,a[he.a.labelText]=this._environmentString,a[pe.a.Visible]=!0,32},e}();function me(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ge,"DisplayEnvironmentName",null,[]);var fe=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.configure=function(e){this._container=e,this._container.register(ge,"Common.App.DisplayEnvironmentName.DisplayEnvironmentName").singleInstance().usingFactory((function(){return new ge(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.appSettingsManager)}))},r.init=function(){this._container.resolve("Common.App.DisplayEnvironmentName.DisplayEnvironmentName").registerActions()},r.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.DisplayEnvironmentName"}}])&&me(t.prototype,n),i&&me(t,i),e}();Object(i.a)(fe,"DisplayEnvironmentNamePackage",null,[14,15]);var ve=function(){this.x=0,this.y=0};function Se(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ve,"HammerPoint",null,[]);var _e=function(){function e(e,t,n,i,r){this._initialPinchScale=1,this._initialDocumentScale=1,this._lastRelativeScale=1,this._unscaledAbsolutePinchStartX=0,this._unscaledAbsoluteLeftPageMargin=0,this._unscaledAbsolutePinchStartY=0,this._containerBounds=null,this._nextUiUpdateTime=null,this._promoteLayerPinchToZoomIsEnabled=!1,this._finalizeWithInitialPinchScaleIsEnabled=!1,this._adjustPinchStartXWithPageMarginIsEnabled=!1,this._futureZoomManager=e,this._scrollContainer=t,this._scrollable=n,this._actionManager=i,r&&(this._promoteLayerPinchToZoomIsEnabled=r.getBooleanAppSetting("PromoteLayerPinchToZoomIsEnabled"),this._finalizeWithInitialPinchScaleIsEnabled=r.getBooleanAppSetting("FinalizeWithInitialPinchScaleIsEnabled"),this._adjustPinchStartXWithPageMarginIsEnabled=r.getBooleanAppSetting("AdjustPinchStartXWithPageMarginIsEnabled"))}var t,n,i,r=e.prototype;return r.isGesturePossible=function(e){return!!this._futureZoomManager.instance},r.onGestureStart=function(e){this._actionManager&&this._actionManager.processAction(p.a.startPinchToZoom,2);var t=this.getZoomManager();if(this._promoteLayerPinchToZoomIsEnabled&&t.raisePinchStartEvent(),this._initialDocumentScale=t.currentZoom,this._initialPinchScale=e.gestureData.scale,this._lastRelativeScale=1,this._nextUiUpdateTime=this.calculateNextUiControlUpdateTime(),this._containerBounds=this._scrollContainer.getBounds(),!this._containerBounds)return h.ULS.sendTraceTag(42821145,353,15,"Unexpected null bounds"),!1;var n=this.getPinchCenterRelativeToContainer(e);return this._adjustPinchStartXWithPageMarginIsEnabled?this.setOrUpdatePinchStartX(this._scrollContainer.scrollWidth,this._containerBounds.width,n,this._initialDocumentScale,t):this._unscaledAbsolutePinchStartX=this._scrollContainer.scrollWidth>this._containerBounds.width?this.calculateAbsolutePinchStartPos(this._scrollable.scrollLeft,n.x,this._initialDocumentScale):null,this._unscaledAbsolutePinchStartY=this._scrollContainer.scrollHeight>this._containerBounds.height?this.calculateAbsolutePinchStartPos(this._scrollable.scrollTop,n.y,this._initialDocumentScale):null,!0},r.resetPinchStartX=function(){this._unscaledAbsolutePinchStartX=null,this._unscaledAbsoluteLeftPageMargin=0},r.setOrUpdatePinchStartX=function(e,t,n,i,r){if(e>t)if(this._unscaledAbsolutePinchStartX){var a=r.leftPageMargin;if(a!==this._unscaledAbsoluteLeftPageMargin){var o=this._unscaledAbsoluteLeftPageMargin-a;this._unscaledAbsolutePinchStartX=this._unscaledAbsolutePinchStartX-o,this._unscaledAbsoluteLeftPageMargin=a}}else this._unscaledAbsolutePinchStartX=this.calculateAbsolutePinchStartPos(this._scrollable.scrollLeft,n.x,i),this._unscaledAbsoluteLeftPageMargin=r.leftPageMargin;else this.resetPinchStartX()},r.onGestureEvent=function(e){var t=this.getPinchCenterRelativeToContainer(e);if(!t)return h.ULS.sendTraceTag(42821147,353,15,"Unexpected null pinch center"),!1;var n=this.setFilteredRelativeScale(e.gestureData.scale/this._initialPinchScale)*this._initialDocumentScale;return this.updateScrollLeft(t,n),this.updateScrollTop(t,n),!0},r.updateScrollLeft=function(e,t){var n=this._scrollContainer.scrollWidth,i=this._containerBounds.width;this._adjustPinchStartXWithPageMarginIsEnabled?this.setOrUpdatePinchStartX(n,i,e,t,this.getZoomManager()):!this._unscaledAbsolutePinchStartX&&n>i&&(this._unscaledAbsolutePinchStartX=this.calculateAbsolutePinchStartPos(this._scrollable.scrollLeft,e.x,t));var r=this.calculateScrollPosition(e.x,this._unscaledAbsolutePinchStartX,n,i,t);r&&(this._scrollable.scrollLeft=r)},r.updateScrollTop=function(e,t){var n=this._scrollContainer.scrollHeight,i=this._containerBounds.height;!this._unscaledAbsolutePinchStartY&&n>i&&(this._unscaledAbsolutePinchStartY=this.calculateAbsolutePinchStartPos(this._scrollable.scrollTop,e.y,t));var r=this.calculateScrollPosition(e.y,this._unscaledAbsolutePinchStartY,n,i,t);r&&(this._scrollable.scrollTop=r)},r.calculateScrollPosition=function(e,t,n,i,r){if(n<=i||!t||!i)return null;var a=t*r-e,o=n-i;return Math.max(0,Math.min(a,o))},r.calculateAbsolutePinchStartPos=function(e,t,n){return(e+t)/n},r.onGestureEnd=function(e){var t=e.gestureData.scale;this._finalizeWithInitialPinchScaleIsEnabled&&(t/=this._initialPinchScale),this.finalizeRelativeScale(t),this._promoteLayerPinchToZoomIsEnabled&&this.getZoomManager().raisePinchEndEvent(),this._actionManager&&this._actionManager.processAction(p.a.endPinchToZoom,2),this._adjustPinchStartXWithPageMarginIsEnabled&&this.resetPinchStartX()},r.onGestureCancel=function(e){var t=e.gestureData.scale;this._finalizeWithInitialPinchScaleIsEnabled&&(t/=this._initialPinchScale),this.finalizeRelativeScale(t,!0),this._promoteLayerPinchToZoomIsEnabled&&this.getZoomManager().raisePinchEndEvent(),this._actionManager&&this._actionManager.processAction(p.a.endPinchToZoom,2),this._adjustPinchStartXWithPageMarginIsEnabled&&this.resetPinchStartX()},r.getZoomManager=function(){return this._futureZoomManager.instance},r.setFilteredRelativeScale=function(e){var t=this.getZoomManager(),n=new Date>=this._nextUiUpdateTime;return n&&(this._nextUiUpdateTime=this.calculateNextUiControlUpdateTime()),Math.abs(e-this._lastRelativeScale)>=.01*e&&t.setZoomDuringResize(e*this._initialDocumentScale,n),t.currentZoom/this._initialDocumentScale},r.finalizeRelativeScale=function(e,t){void 0===t&&(t=!1);var n=e*this._initialDocumentScale;this.getZoomManager().setZoom(n,!1);var i={};i.initialScale=this._initialDocumentScale,i.finalScale=n,i.cancelled=t,h.ULS.sendTraceTag(42821150,353,50,"Pinch zoom ended: {0}",i)},r.getPinchCenterRelativeToContainer=function(e){var t=e.gestureData.center;return t?Object.assign(new ve,{x:t.x-this._containerBounds.x,y:t.y-this._containerBounds.y}):null},r.calculateNextUiControlUpdateTime=function(){var e=(new Date).getTime();return new Date(e+1e3)},t=e,(n=[{key:"scrollContainer",get:function(){return this._scrollContainer}},{key:"scrollable",get:function(){return this._scrollable}}])&&Se(t.prototype,n),i&&Se(t,i),e}();function ye(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(_e,"PinchZoomAdapter",null,[150]);var be=function(){function e(e){this._element=e}var t,n,i;return e.prototype.getBounds=function(){return Sys.UI.DomElement.getBounds(this._element)},t=e,(n=[{key:"scrollWidth",get:function(){return this._element.scrollWidth}},{key:"scrollHeight",get:function(){return this._element.scrollHeight}}])&&ye(t.prototype,n),i&&ye(t,i),e}();function Ae(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ce(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}Object(i.a)(be,"ScrollContainerElement",null,[148]);var Te=function(){function e(e,t,n,i,r,a){this._gestureInputManager=null,this._stopwatchForRegister=null,this._container=e,this._stopwatchBuilder=t,this._isMultiTouchGestureEnabled=n,this._isPinchZoomEnabled=i,this._isPinchZoomOnlyPointerEventsEnabled=r,this._hammerJsPerformanceTimersIsEnabled=a,this._containerElements=new te.a}var t=e.prototype;return t.register=function(e,t){var n=this;this._isMultiTouchGestureEnabled&&this._container.resolveFuture("Common.IGestureInputManager").execute((function(i){if(n.startRegisterTimer(),n._gestureInputManager=i,n._containerElements.add(e),n._isPinchZoomEnabled){if(n._isPinchZoomOnlyPointerEventsEnabled&&i.getGestureBrowserEvents())return void n.stopRegisterTimer();var r=n._container.resolveFuture("Common.IZoomManager"),a=(n._container.resolve("Common.IAppSettingsManager"),new be(e)),o=s.AFrameworkApplication.theActionManager,l=s.AFrameworkApplication.appSettingsManager,c=new _e(r,a,t,o,l);i.registerGestureAdapter(0,e,c)}n.stopRegisterTimer()}))},t.unregister=function(){if(this._gestureInputManager&&this._containerElements){if(this._isPinchZoomEnabled){for(var e,t=Ae(this._containerElements);!(e=t()).done;){var n=e.value;this._gestureInputManager.unregisterGestureAdapter(0,n)}this._containerElements.clear()}this._gestureInputManager=null}},t.startRegisterTimer=function(){this._hammerJsPerformanceTimersIsEnabled&&(this._stopwatchBuilder?this._stopwatchForRegister=this._stopwatchBuilder.makeAndStartStopwatch("Task","Register"):h.ULS.sendTraceTag(590387076,310,10,"_stopwatchBuilder is null"))},t.stopRegisterTimer=function(){this._hammerJsPerformanceTimersIsEnabled&&(this._stopwatchForRegister?this._stopwatchForRegister.stop():h.ULS.sendTraceTag(590387077,310,10,"_stopwatchForRegister is null"))},e}();function we(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Te,"GestureInputRegistrar",null,[115]);var Ie=function(){function e(){this._container=null,this._isInitialized=!1}var t,n,i,r=e.prototype;return r.init=function(){this._isInitialized||(this._container.resolve("Common.IGestureInputRegistrar"),this._isInitialized=!0)},r.dispose=function(){},r.configure=function(e){this._container=e,e.register(115,"Common.IGestureInputRegistrar").singleInstance().usingFactory((function(){return new Te(e,s.AFrameworkApplication.activeFrame.theStopwatchBuilder,s.AFrameworkApplication.isMultiTouchGestureEnabled(),s.AFrameworkApplication.isPinchToZoomEnabled(),!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PinchZoomOnlyPointerEventsIsEnabled"),!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("HammerJsPerformanceTimersIsEnabled"))}))},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.GestureInput"}}])&&we(t.prototype,n),i&&we(t,i),e}();Object(i.a)(Ie,"GestureInputPackage",null,[14,15]);var ke=n(240),Fe=n(112),Ee=n(17),Oe=function(){this.gestureAdapter=null,this.recognizer=null};function Pe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Oe,"GestureAdapterInfo",null,[]);var De=function(){function e(){this._dependenciesTask=null}var t,n,i;return e.prototype.loadDependenciesAsync=function(){if(!this._dependenciesTask){var t=s.AFrameworkApplication.scriptUrlFromName(String.format("{0}",e._hammerJSName),5),n=Y.a.create(t,null,null);Z.a.enqueueResourceWithoutEnabling(n),this._dependenciesTask=n.loadFinishedTask}return this._dependenciesTask},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}],(n=null)&&Pe(t.prototype,n),i&&Pe(t,i),e}();De._hammerJSName="hammer.min.js",De._instance=null,Object(i.a)(De,"HammerJsDependencyLoader",null,[156]);var Me,Le=function(e,t,n){if(void 0===n&&(n=null),null==t)throw h.ULS.sendTraceTag(42256258,310,10,"manager cannot be null"),Error.argumentNull("manager can not be null");var i=null;switch(e){case f.EventNames.pinch:i=new Hammer.Pinch(n);break;case f.EventNames.pan:i=new Hammer.Pan(n)}return i&&(i.manager=t),i};!function(e){e[e.none=-1]="none",e[e.pinch=0]="pinch",e[e.pan=1]="pan",e[e.swipe=2]="swipe"}(Me||(Me={})),Object(i.b)("GestureEvent",Me);var Re=n(41);function Ue(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var He=function(e){var t,n,i,r,a;function o(t,n,i,r,a,o,s,l,c){var u;return(u=e.call(this,t,i,r,o)||this)._clientPoint=n,u._shiftKey=s,u._ctrlKey=l,u._isPointerEvent=c,u._gestureData=a,u}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,o.create=function(e,t,n,i,r,a){var s;if(n.rawEvent)if(a){var l=n.rawEvent;s=new Sys.UI.Point(l.clientX,l.clientY)}else s=Re.EventHandlerArgs.getClientPointFromTouchEvent(n);else s=new Sys.UI.Point(n.clientX,n.clientY);return new o(e,s,t,n,i,r,n.shiftKey,n.ctrlKey,a)},i=o,(r=[{key:"shiftKey",get:function(){return this._shiftKey}},{key:"ctrlKey",get:function(){return this._ctrlKey}},{key:"clientPoint",get:function(){return this._clientPoint}},{key:"gestureData",get:function(){return this._gestureData}},{key:"isPointerEvent",get:function(){return this._isPointerEvent}}])&&Ue(i.prototype,r),a&&Ue(i,a),o}(Re.EventHandlerArgs);Object(i.a)(He,"GestureEventArgs",Re.EventHandlerArgs,[]);var Be=function(){this.pointers=null,this.changedPointers=null,this.pointerType=null,this.srcEvent=null,this.overallVelocityX=0,this.overallVelocityY=0,this.overallVelocity=0,this.distance=0,this.angle=0,this.scale=0,this.rotation=0,this.maxPointers=0,this.target=null,this.center=null,this.additionalEvent=null,this.isFirst=!1,this.isFinal=!1,this.eventType=0,this.deltaX=0,this.deltaY=0,this.timeStamp=0,this.deltaTime=0,this.offsetDirection=null};Object(i.a)(Be,"GestureManagerData",null,[]);var xe=function(){};xe.STATE_POSSIBLE=1,xe.STATE_BEGAN=2,xe.STATE_CHANGED=4,xe.STATE_ENDED=8,xe.STATE_RECOGNIZED=8,xe.STATE_CANCELLED=16,xe.STATE_FAILED=32,Object(i.a)(xe,"HammerConstants",null,[]);var Ne=n(48),je=n(114),We=n(13),Ve=n(93);function qe(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ge(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var ze=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this)._inputDataName=ke.a.gestureAdapterCache,i._pointerEventsEnabled=!!window.PointerEvent,i._touchEventsEnabled=window.hasOwnProperty("ontouchstart"),i._onGestureEvent=null,i._gestureEvents=null,i._handled=!1,i._pointerEventsCache=new Fe.a,i._pointerTargetCache=new Fe.a,i._gestureRegions=new te.a,i._currentGestureTarget=null,i._usePointerCaptureIsEnabled=!1,i._clearCacheOnPrimaryPointerIsEnabled=!1,i._resetHandledBeforeInputHandlerIsEnabled=!1,i._logCoalescedEventsIsEnabled=!1,i._checkExistenceOfGetCoalescedEventsIsEnabled=!1,i._checkIfHammerExistsAfterDownloadIsEnabled=!1,i._hammerJsPerformanceTimersIsEnabled=!1,i._cancelDragFromGestureInputManagerIsEnabled=!1,i._maxCoalescedEvents=-1,i._stopwatchForRegisterGestureAdapterAfterLoad=null,i.session=null,i.handlers=null,i.element=null,i.curRecognizer=null,i._eventHandlerManager=Ne.EventHandlerManager.instance,i._pointerEventsEnabled?(h.ULS.sendTraceTag(593893141,310,50,"Using pointer events"),i._onGestureEvent=Object(r.d)(Ke(i),i.onPointerEvent,"onPointerEvent"),i._gestureEvents=f.EventNames.get_gesturePointerEvents()):i._touchEventsEnabled?(h.ULS.sendTraceTag(593893140,310,50,"Using touch events"),i._onGestureEvent=Object(r.d)(Ke(i),i.onTouchEvent,"onTouchEvent"),i._gestureEvents=f.EventNames.get_touchEvents()):(h.ULS.sendTraceTag(593893139,310,50,"Using mouse events"),i._onGestureEvent=Object(r.d)(Ke(i),i.onMouseEvent,"onMouseEvent"),i._gestureEvents=f.EventNames.get_gestureMouseEvents()),i._stopwatchBuilder=n,i._dragInputManager=t,s.AFrameworkApplication.appSettingsManager&&(i._usePointerCaptureIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UsePointerCaptureIsEnabled"),i._clearCacheOnPrimaryPointerIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ClearCacheOnPrimaryPointerIsEnabled"),i._resetHandledBeforeInputHandlerIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ResetHandledBeforeInputHandlerIsEnabled"),i._logCoalescedEventsIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("LogCoalescedEventsIsEnabled"),i._checkExistenceOfGetCoalescedEventsIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CheckExistenceOfGetCoalescedEventsIsEnabled"),i._checkIfHammerExistsAfterDownloadIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CheckIfHammerExistsAfterDownloadIsEnabled"),i._hammerJsPerformanceTimersIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("HammerJsPerformanceTimersIsEnabled"),i._cancelDragFromGestureInputManagerIsEnabled=i._usePointerCaptureIsEnabled&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CancelDragFromGestureInputManagerIsEnabled")&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UseGestureInputManagerPointerCacheIsEnabled")),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=i.prototype;return a.getGestureBrowserEvents=function(){return this._pointerEventsEnabled?0:this._touchEventsEnabled?1:2},a.initializeForElement=function(t){e.prototype.initializeForElement.call(this,t),this._eventHandlerManager.initializeListForElement(this._gestureEvents,t,0,this._onGestureEvent)},a.deinitializeForElement=function(t){e.prototype.deinitializeForElement.call(this,t),this._eventHandlerManager.deinitializeListForElement(t,this._gestureEvents)},a.registerGestureAdapter=function(e,t,n,i,r){var a=this;void 0===i&&(i=null),void 0===r&&(r=null),s.AFrameworkApplication.isMultiTouchGestureEnabled()?De.instance.loadDependenciesAsync().CW((function(o){if(a.startRegisterGestureAdapterAfterLoadTimer(),o.get_isFaulted()||o.get_isCanceled())return h.ULS.sendTraceTag(591192778,310,10,"Hammer did not download correctly: {0}",o.get_status()),void a.stopRegisterGestureAdapterAfterLoadTimer();if(h.ULS.sendTraceTag(591192779,310,50,"Hammer download status: {0}",o.get_status()),a._checkIfHammerExistsAfterDownloadIsEnabled){var s=window.Hammer;if("undefined"==typeof s)return h.ULS.sendTraceTag(590901389,310,10,"Hammer does not exist"),void a.stopRegisterGestureAdapterAfterLoadTimer();if("undefined"==typeof s.inputHandler)return h.ULS.sendTraceTag(590901390,310,10,"Hammer.inputHandler does not exist"),void a.stopRegisterGestureAdapterAfterLoadTimer()}if(!t)throw a.stopRegisterGestureAdapterAfterLoadTimer(),Error.argumentNull("source element can not be null");var l=je.a(t,a._inputDataName);null==l&&(l=new Fe.a,je.b(t,a._inputDataName,l),a.registerGestureRegion(t));var c=null;if(l.containsKey(Me[e])||(c=Object.assign(new Oe,{recognizer:Le(Me[e],a,r),gestureAdapter:n}),l.add(Me[e],c)),null!=i)for(var u=0;u<i.length;u++)if(l.containsKey(Me[i[u]])){var d=l.get_item(Me[i[u]]);c.recognizer.recognizeWith(d.recognizer)}else 0;a.stopRegisterGestureAdapterAfterLoadTimer()})):h.ULS.sendTraceTag(42256219,310,10,"Multi Touch is not enabled either from common BRS or from your app BRS")},a.startRegisterGestureAdapterAfterLoadTimer=function(){this._hammerJsPerformanceTimersIsEnabled&&(this._stopwatchBuilder?this._stopwatchForRegisterGestureAdapterAfterLoad=this._stopwatchBuilder.makeAndStartStopwatch("Task","RegisterGestureAdapterAfterLoad"):h.ULS.sendTraceTag(590387074,310,10,"_stopwatchBuilder is null"))},a.stopRegisterGestureAdapterAfterLoadTimer=function(){this._hammerJsPerformanceTimersIsEnabled&&(this._stopwatchForRegisterGestureAdapterAfterLoad?this._stopwatchForRegisterGestureAdapterAfterLoad.stop():h.ULS.sendTraceTag(590387075,310,10,"_stopwatchForRegisterGestureAdapterAfterLoad is null"))},a.unregisterGestureAdapter=function(e,t){h.ULS.sendTraceTag(42256223,310,t?100:10,"source element {0} ",t.id);var n=je.a(t,this._inputDataName);null!=n&&(n.remove(Me[e]),n.get_count()||this.unregisterGestureRegion(t))},a.registerGestureRegion=function(e){this._gestureRegions.add(e),this._eventHandlerManager.initializeListForElement(this._gestureEvents,e,0,this._onGestureEvent)},a.unregisterGestureRegion=function(e){this._gestureRegions.remove(e),this._eventHandlerManager.deinitializeListForElement(e,this._gestureEvents)},a.recognize=function(e){for(var t=new Array(e.pointers.length),n=0;n<e.pointers.length;n++)t[n]=e.pointers[n].target;var i=null;for(this._currentGestureTarget=this.getLowestCommonAncestor(t);void 0!==this._currentGestureTarget&&null!==this._currentGestureTarget&&null==(i=je.a(this._currentGestureTarget,this._inputDataName));this._currentGestureTarget=this._currentGestureTarget.parentNode);if(null!=i){this.curRecognizer&&this.curRecognizer.state===xe.STATE_RECOGNIZED&&(this.curRecognizer=null);for(var r,a=qe(i.get_keys());!(r=a()).done;){var o=r.value,s=i.get_item(o);null!=s&&void 0!==s.recognizer&&null!==s.recognizer&&(void 0===this.curRecognizer||null===this.curRecognizer||s.recognizer===this.curRecognizer||s.recognizer.canRecognizeWith(this.curRecognizer))&&s.recognizer.recognize(e);var l=s.recognizer.state;this.curRecognizer||xe.STATE_BEGAN!==l&&xe.STATE_CHANGED!==l&&xe.STATE_ENDED!==l||(this.curRecognizer=s.recognizer)}}},a.emit=function(e,t){if("hammer.input"!==e){this._handled=!1;var n=null,i=He.create(e,this._currentGestureTarget,t.srcEvent,t,3,this._pointerEventsEnabled),r=je.a(this._currentGestureTarget,this._inputDataName),a=-1;if(this.isPinchEvent(e))a=0;else if(this.isPanEvent(e))a=1;else{if(!this.isSwipeEvent(e))return void h.ULS.sendTraceTag(42256256,310,15,"Event can not be recognized by current manager");a=2}if(r.tryGetValue(Me[a],Object(z.a)((function(){return n}),(function(e){return n=e}))),null!=n){var o=n.gestureAdapter;o.isGesturePossible(i)?e.endsWith("start")?this._handled=o.onGestureStart(i):e.endsWith("end")?(o.onGestureEnd(i),this._handled=!0):e.endsWith("cancel")?(o.onGestureCancel(i),this._handled=!0):e.endsWith("move")&&(this._handled=o.onGestureEvent(i)):h.ULS.sendTraceTag(42256257,310,50,"App rejected to perform gesture now : {0}",e)}}},a.get=function(e){return Object(k.a)(Hammer.Recognizer,e)},a.getLowestCommonAncestor=function(e){if(e.length<1)return null;if(1===e.length)return e[0];for(var t=e[0],n=!0,i=1;i<e.length;i++){if(!e[i])return null;if(t!==e[i]){n=!1;break}}if(n)return t;for(var r,a=this.getAncestryList(e[0]),o=0,s=qe(e);!(r=s()).done;){var l=r.value,c=this.getAncestryList(l);if(a.get_item(a.get_count()-1)!==c.get_item(c.get_count()-1))return null;for(var u=a.get_count()-2,d=c.get_count()-2;u>=o&&d>=0;u--,d--)if(a.get_item(u)!==c.get_item(d)){o=u+1;break}}return a.get_item(o)},a.getAncestryList=function(e){for(var t=new te.a;null!=e;e=e.parentNode)t.add(e);return t},a.getInputType=function(e){switch(e){case f.EventNames.touchStart:case f.EventNames.browserPointerDown:return 1;case f.EventNames.touchMove:case f.EventNames.browserPointerMove:return 2;case f.EventNames.touchEnd:case f.EventNames.browserPointerUp:return 4;case f.EventNames.touchCancel:case f.EventNames.browserPointerCancel:return 8}return 0},a.onTouchEvent=function(e,t,n){var i=this.getInputType(e),r=this.getInputDataFromTouchEvents(n,i);return Hammer.inputHandler(this,i,r),this._handled&&n.preventDefault(),this._handled},a.handlingMultiTouchPointerGesture=function(){return this._pointerEventsCache.get_count()>1},a.cancelPendingPointerEvents=function(){if(h.ULS.sendTraceTag(594055960,310,50,"CancelPendingPointerEvents"),this._usePointerCaptureIsEnabled)for(var e,t=qe(this._pointerEventsCache);!(e=t()).done;){var n=e.value;this.removePointerFromCaches(n.get_key())}else this._pointerEventsCache=new Fe.a;this.session=null},a.addOrReplacePointerInCaches=function(e,t,n){if(h.ULS.sendTraceTag(594055959,310,50,"AddOrReplacePointerInCaches: pointerId: {0}",e),!this._pointerTargetCache.containsKey(e)){try{t.setPointerCapture(e)}catch(e){h.ULS.sendTraceTag(594055958,310,10,"Exception: {0}",e)}this._pointerTargetCache.add(e,t)}this._pointerEventsCache.set_item(e,n),this._cancelDragFromGestureInputManagerIsEnabled&&this._pointerEventsCache.get_count()>1&&this._dragInputManager&&!this._dragInputManager.cancelDragForMultiTouchPointerGesture&&(this._dragInputManager.cancelDragForMultiTouchPointerGesture=!0)},a.removePointerFromCaches=function(e){if(h.ULS.sendTraceTag(594055957,310,50,"RemovePointerFromCaches: pointerId: {0}",e),this._pointerTargetCache.containsKey(e)){try{this._pointerTargetCache.get_item(e).releasePointerCapture(e)}catch(e){h.ULS.sendTraceTag(594055956,310,10,"Exception: {0}",e)}this._pointerTargetCache.remove(e)}else h.ULS.sendTraceTag(594055955,310,10,"RemovePointerFromCaches: pointerId should be in cache: {0}",e);this._pointerEventsCache.remove(e),this._cancelDragFromGestureInputManagerIsEnabled&&this._pointerEventsCache.get_count()<=1&&this._dragInputManager&&this._dragInputManager.cancelDragForMultiTouchPointerGesture&&(this._dragInputManager.cancelDragForMultiTouchPointerGesture=!1)},a.onPointerEvent=function(e,t,n){var i=n.rawEvent.pointerType.toString(),r=n.rawEvent.pointerId.toString();if("touch"!==i)return!1;var a=this.getInputType(e);if(1!==a&&!this._pointerEventsCache.containsKey(r))return!1;if((this._clearCacheOnPrimaryPointerIsEnabled&&1===a&&n.rawEvent.isPrimary&&this._pointerEventsCache.get_count()&&(h.ULS.sendTraceTag(593839564,310,10,"Pointer cache should be empty"),this.cancelPendingPointerEvents()),this._usePointerCaptureIsEnabled?this.addOrReplacePointerInCaches(r,t,n):this._pointerEventsCache.set_item(r,n),this._logCoalescedEventsIsEnabled&&2===a)&&(!this._checkExistenceOfGetCoalescedEventsIsEnabled||this._checkExistenceOfGetCoalescedEventsIsEnabled&&"function"==typeof n.rawEvent.getCoalescedEvents)){var o=n.rawEvent.getCoalescedEvents();o&&this.handlingMultiTouchPointerGesture()&&(this._maxCoalescedEvents=Math.max(this._maxCoalescedEvents,o.length))}this._resetHandledBeforeInputHandlerIsEnabled&&(this._handled=!1);var s=this.getInputDataFromPointerEvents(this._pointerEventsCache,n,i);return Hammer.inputHandler(this,a,s),4!==a&&8!==a||(this._usePointerCaptureIsEnabled?this.removePointerFromCaches(r):this._pointerEventsCache.remove(r),this._pointerEventsCache.get_count()||(this.session=null,this._logCoalescedEventsIsEnabled&&-1!==this._maxCoalescedEvents&&(h.ULS.sendTraceTag(593597138,310,50,"Max number of coalesced events: {0}",this._maxCoalescedEvents),this._maxCoalescedEvents=-1))),this._handled&&n.preventDefault(),this._handled},a.onMouseEvent=function(e,t,n){return!1},a.getInputDataFromTouchEvents=function(e,t){var n=new Be,i=e.rawEvent,r=i.touches,a=i.changedTouches;n.pointers=Array.clone(r);var o=r.length>0?r:a;return n.pointers=Array.clone(o),n.changedPointers=Array.clone(a),n.srcEvent=e,n.pointerType="touch",n},a.getInputDataFromPointerEvents=function(e,t,n){var i=new Be;e.get_keys();return i.pointers=Ve.toArray(e.get_values()),i.changedPointers=[t],i.pointerType=n,i.srcEvent=t,i},a.isPinchEvent=function(e){return We.a.startsWith(e,f.EventNames.pinch)},a.isPanEvent=function(e){return We.a.startsWith(e,f.EventNames.pan)},a.isSwipeEvent=function(e){return We.a.startsWith(e,f.EventNames.swipe)},i}(Ee.a);Object(i.a)(ze,"GestureInputManager",Ee.a,[137,138]);var Je=n(182);function Xe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Qe=function(){function e(){this._container=null,this._isInitialized=!1}var t,n,i,r=e.prototype;return r.configure=function(e){e.register(ze,"Common.App.GestureManager.GestureInputManager").as("Common.IGestureInputManager").singleInstance().usingFactory((function(){return new ze(Je.a.instance,s.AFrameworkApplication.activeFrame.theStopwatchBuilder)})),this._container=e},r.init=function(){this._isInitialized||(this._container.resolve("Common.App.GestureManager.GestureInputManager"),this._isInitialized=!0)},r.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.GestureInputManager"}}])&&Xe(t.prototype,n),i&&Xe(t,i),e}();Object(i.a)(Qe,"GestureInputManagerPackage",null,[14,15]);var Ze=function(e,t,n,i,r,a){this.IsSafeLinksEnabled=null,this.WebAffinitizedUrl=null,this.PolicyCookie=null,this.PolicyCookieTTL=0,this.WasServiceDown=!1,this.AffinitizedUrl=null,this.IsSafeLinksEnabled=e,this.WebAffinitizedUrl=t,this.PolicyCookie=n,this.PolicyCookieTTL=i,this.WasServiceDown=r,this.AffinitizedUrl=a};Object(i.a)(Ze,"SafeLinksData",null,[]);var Ye=function(e,t){this.targetUrl=e,this.stopwatch=t};Object(i.a)(Ye,"SafeLinksGetUrlReputationRequestData",null,[]);var $e,et,tt=n(16),nt=function(){function e(t,n,i,r){this._appSettingsManager=t,this._clientRequestManager=n,this._getUrlReputationHandlerUrl=i,e._stopwatchBuilder=r}var t=e.prototype;return t.tryNavigate=function(t,n,i){try{var a=null;e._stopwatchBuilder&&(a=e._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","SafeLinksGetUrlReputation"));var o=new Ye(n,a),s={};s.AffinitizedUrl=t,s.TargetUrl=n,s.PolicyCookie=i;var l=L.c(s);return this._clientRequestManager.addRequest(this._getUrlReputationHandlerUrl,2,l,null,!1,2,Object(r.d)(this,this.onGetUrlReputationSuccessCallback,"onGetUrlReputationSuccessCallback"),Object(r.d)(this,this.onGetUrlReputationFailureCallback,"onGetUrlReputationFailureCallback"),o,void 0,void 0,3e3,3e3,"36"),!0}catch(e){h.ULS.sendTraceTag(588788033,378,10,e.message)}return!1},t.onGetUrlReputationSuccessCallback=function(e){var t="OnGetUrlReputationSuccessCallback: ",n=10,i=e.data.state;try{var r=L.b(e.data.responseData).reputationResults[0],a=r.navigateUrl.length,o=i.targetUrl.length,s=r.navigateUrl===i.targetUrl;r.navigateUrl&&r.navigateUrl.length>0&&(i.targetUrl=r.navigateUrl),t+=String.format("HttpStatus {0}, verdict {1}, clickedUrlLength = {2} navigateUrlLength {3}, navigateUrlSameAsClickedUrl {4}",e.data.httpStatus,r.verdict,o.toString(),a.toString(),s.toString()),n=50}catch(e){t+=String.format("Exception {0}",e.message)}this.handleGetUrlReputationCompletion(i,t,n)},t.onGetUrlReputationFailureCallback=function(e){var t="OnGetUrlReputationFailureCallback: ",n=e.data.state;try{t+=String.format("HttpStatus {0}",e.data.httpStatus)}catch(e){t+=String.format("Exception {0}",e.message)}this.handleGetUrlReputationCompletion(n,t,10)},t.handleGetUrlReputationCompletion=function(e,t,n){e.stopwatch&&(e.stopwatch.stop(),e.stopwatch=null),h.ULS.sendTraceTag(588788034,378,n,t),tt.a.safelyOpenWindow(e.targetUrl,void 0,"noopener,noreferrer",void 0,"SafeLinksNav")},e}();function it(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}nt._stopwatchBuilder=null,Object(i.a)(nt,"SafeLinksNavigationHelper",null,[]),function(e){e[e.enabledByPolicy=0]="enabledByPolicy",e[e.disabledByPolicy=1]="disabledByPolicy",e[e.disabled_GetPolicyFailure=2]="disabled_GetPolicyFailure",e[e.disabled_PendingGetPolicyRequest=3]="disabled_PendingGetPolicyRequest"}($e||($e={})),Object(i.b)("SafeLinksNavigationState",$e),function(e){e[e.waiting=0]="waiting",e[e.executing=1]="executing",e[e.succeeded=2]="succeeded",e[e.failed=3]="failed",e[e.notFound=4]="notFound",e[e.preConditionFailed=5]="preConditionFailed",e[e.socketConnectionError=6]="socketConnectionError",e[e.timeOut=7]="timeOut",e[e.offlineMode=8]="offlineMode",e[e.serverError=9]="serverError",e[e.cancelled=10]="cancelled",e[e.clientError=11]="clientError",e[e.serverAuthenticationError=12]="serverAuthenticationError",e[e.expiredWithoutSending=13]="expiredWithoutSending",e[e.accessTokenExpired=14]="accessTokenExpired"}(et||(et={})),Object(i.b)("RequestStatus",et);var rt=function(){function e(t,n,i,r,a,o){var s=this;if(void 0===r&&(r=!1),void 0===a&&(a=null),void 0===o&&(o=null),this._getPolicyOnBootRetries=0,this._getPolicyOnLinkClickRetries=0,this._getPolicyRequestPending=!1,this.isGetPolicyBootRequest=!1,this._pendingUrlToFollow=null,this._isUserLicensedForSafeLinks=!0,this._sessionCacheSafeLinksData=null,h.ULS.sendTraceTag(26019598,378,100,"Initializing SafeLinksManager."),this._appSettingsManager=t,this._clientRequestManager=n,this._appName=i,e._stopwatchBuilder=o,this._webServiceBaseUrl=r?this._appSettingsManager.getStringAppSetting("SafeLinksHandlerWebServiceBase"):this._appSettingsManager.getStringAppSetting("WebServiceBase"),this._userId=this._appSettingsManager.getStringAppSetting("SafeLinksHashedUserId"),this.workloadId=this._appSettingsManager.getStringAppSetting("SafeLinksWorkloadIdHeaderValue"),this._maxGetPolicyBootRetries=this._appSettingsManager.getIntAppSetting("SafeLinksMaxGetPolicyBootRetries",2),this._maxGetPolicyOnLinkClickRetries=this._appSettingsManager.getIntAppSetting("SafeLinksMaxGetPolicyOnLinkClickRetries",1),this._isEnabledForUser=this.isSafeLinksEnabledForUser(),this._isEnabledForBrowser=this.isSafeLinksEnabledForBrowser(),h.ULS.sendTraceTag(26019599,378,50,"SafeLinksManager _isEnabledForUser={0}, _isEnabledForBrowser={1}",this._isEnabledForUser,this._isEnabledForBrowser),this._isEnabledForUser&&this._isEnabledForBrowser){var c=this.getCachedData(),u=c?c.IsSafeLinksEnabled.toLowerCase():"",d=this.isPolicyCookieExpired();h.ULS.sendTraceTag(36231312,378,50,"Cached values for IsSafeLinksEnabled: {0}, IsPolicyCookieExpired: {1}.",u,d);var p=!c||"unknown"===u||c.WasServiceDown||d,g=this.createMap();g&&(g.set("shouldGetSafeLinksDataFromServer",p.toString()),g.set("isSafeLinksEnabledCacheValue",u.toString())),l.Health.instance.recordKpiUsage("SafeLinksGetPolicy1",0,"jpittsdirects",g),!!this._appSettingsManager.containsAppSetting("LicensingForSafeLinksIsEnabled")&&this._appSettingsManager.getBooleanAppSetting("LicensingForSafeLinksIsEnabled")&&a?(this._isUserLicensedForSafeLinks=!1,a.execute((function(e){e.isFeatureEnabled("MsoUrlreputation",!0).then((function(e){return s._isUserLicensedForSafeLinks=e,s._isUserLicensedForSafeLinks&&p&&s.getSafeLinksDataFromServerAsync(!0),null}))}))):p&&this.getSafeLinksDataFromServerAsync(!0)}}var t,n,i,a=e.prototype;return a.tryNavigate=function(e){if(!e)return h.ULS.sendTraceTag(593367827,378,10,"SafeLinksManager.TryNavigate: Null/Empty targetUrl"),!1;var t=this.isHyperLinkTypeSupportedBySafeLinks(e);if(h.ULS.sendTraceTag(594830615,378,50,"SafeLinksManager.TryNavigate: isSupportedHyperLinkType={0},_isEnabledForUser={1},_isEnabledForBrowser={2},_isUserLicensedForSafeLinks={3}",t,this._isEnabledForUser,this._isEnabledForBrowser,this._isUserLicensedForSafeLinks),!(t&&this._isEnabledForUser&&this._isEnabledForBrowser&&this._isUserLicensedForSafeLinks))return!1;l.Health.instance.recordKpiUsage("SafeLinksNavigations",0,"jpittsdirects",null);var n=0,i=this.shouldTryUsingSafeLinksService(Object(z.a)((function(){return n}),(function(e){return n=e})));return h.ULS.sendTraceTag(595079385,378,50,"ShouldTryUsingSafeLinksService returned NavigationState={0}",$e[n]),i?(h.ULS.sendTraceTag(26019601,378,50,"Using safelinks to navigate hyperlink"),this.shouldUseNavigationHelper()?!this.isPolicyCookieExpired()&&this.navigationHelper.tryNavigate(this.getAffinitizedUrlFromCache(),e,this.getPolicyCookieFromCache()):this.isPolicyCookieExpired()?(this._pendingUrlToFollow=e,h.ULS.sendTraceTag(24462627,378,50,"Refreshing the cache as policy cookie expired."),this.isGetPolicyBootRequest=!1,this.getSafeLinksDataFromServerAsync(),!0):(this.tryNavigateInternal(e),!0)):(l.Health.instance.recordKpiFailure("SafeLinksNavigations",$e[n],1===n,!0,null),!1)},a.isHyperLinkTypeSupportedBySafeLinks=function(e){e=e.toLowerCase();var t=this._appSettingsManager.getListAppSetting("SafeLinksUnsupportedProtocols");if(t)for(var n=0;n<t.length;n++)if(e.startsWith(t[n]))return!1;return!0},a.getSafeLinksDataFromServerAsync=function(e){void 0===e&&(e=!1);var t=this.createMap();t&&t.set("isOnBootRequest",e.toString()),l.Health.instance.recordKpiUsage("SafeLinksGetPolicySuccessfulRequest",1,"jpittsdirects",t),l.Health.instance.recordKpiUsage("SafeLinksGetPolicyFailedRequest",0,"jpittsdirects",t);var n=this.createAndStartStopwatch("SafeLinksGetPolicy");this._clientRequestManager.addRequest(this.getPolicyHandlerUrl,1,null,null,!0,2,Object(r.d)(this,this.getSafeLinksDataFromServer_OnSuccessCallback,"getSafeLinksDataFromServer_OnSuccessCallback"),Object(r.d)(this,this.getSafeLinksDataFromServer_OnFailureCallback,"getSafeLinksDataFromServer_OnFailureCallback"),n,void 0,void 0,void 0,void 0,"23"),this.isGetPolicyBootRequest=e,this._getPolicyRequestPending=!0,e?this._getPolicyOnBootRetries++:this._getPolicyOnLinkClickRetries++},a.getSafeLinksDataFromServer_OnSuccessCallback=function(t){var n=E.a.notAcceptable_406,i="";try{this.isGetPolicyBootRequest=!1,this._getPolicyRequestPending=!1;var r=t.data.state,a=this.stopAndGetDurationInMsFromStopwatch(Object(z.a)((function(){return r}),(function(e){return r=e}))),o=Object.assign(new N.a,{durationMs:a});if(l.Health.instance.recordKpiSuccess("SafeLinksGetPolicySuccessfulRequest",o),h.ULS.sendTraceTag(594830614,378,50,"GetSafeLinksDataFromServer_OnSuccessCallback: HttpStatus {0}, data length {1}, Duration {2}",t.data.httpStatus,t.data.responseData.length,a),t.data.httpStatus!==E.a.OK_200)return void(i="Unexpected httpStatus: "+t.data.httpStatus.toString());var s=null;try{s=L.b(t.data.responseData)}catch(e){return void(i="Exception:"+e.toString()+" deserializing response")}if(!s)return void(i="Error when serializing response into SafeLinksData. SafeLinksData is null.");var c=s.IsSafeLinksEnabled;if(null==c||c.length<=0)return void(i="Invalid isSafeLinksEnabledString");h.ULS.sendTraceTag(594830613,378,50,"Retrieved isSafeLinksEnabledString {0}",c);var u=e.parseSafeLinksEnabledForUser(c);if(void 0===s.WebAffinitizedUrl||null===s.WebAffinitizedUrl||s.WebAffinitizedUrl.length<=0)return void(i="Invalid WebAffinitizedUrl");if(void 0===s.PolicyCookie||null===s.PolicyCookie||s.PolicyCookie.length<=0)return void(i="Invalid PolicyCookie");if(void 0===s.PolicyCookieTTL||null===s.PolicyCookieTTL)return void(i="Invalid PolicyCookieTTL");var d=s.WebAffinitizedUrl,p=s.PolicyCookie,g=s.AffinitizedUrl,m=new Date,f=s.PolicyCookieTTL>5?s.PolicyCookieTTL-5:0;m.setMinutes(m.getMinutes()+f);var v=m.getTime(),S=new Ze(c,d,p,v,!1,g);this.setCachedData(S),n=t.data.httpStatus,this._pendingUrlToFollow&&(u?(this.tryNavigateInternal(this._pendingUrlToFollow),this._getPolicyOnBootRetries=0,this._getPolicyOnLinkClickRetries=0):(h.ULS.sendTraceTag(26019602,378,50,"SafeLinks is disabled by admin; Navigating without SafeLinks"),l.Health.instance.recordKpiFailure("SafeLinksNavigations","disabledByPolicy",!0,!0,null),tt.a.followHyperlinkWithNoReferrer(this._pendingUrlToFollow)),this._pendingUrlToFollow=null)}catch(e){i="GetSafeLinksDataFromServer_OnSuccessCallback: Exception:  "+e.toString()}finally{n!==E.a.OK_200&&this.handleGetPolicyRequestError(n,i)}},a.getSafeLinksDataFromServer_OnFailureCallback=function(e){this._getPolicyRequestPending=!1;var t=500,n="";try{var i=e.data.state,r=this.stopAndGetDurationInMsFromStopwatch(Object(z.a)((function(){return i}),(function(e){return i=e}))),a=Object.assign(new N.a,{durationMs:r});t=e.data.httpStatus,l.Health.instance.recordKpiFailure("SafeLinksGetPolicyFailedRequest","HttpStatusCode_"+t.toString(),!1,!0,a),n="Request Failed, Status="+et[e.data.status]+" Duration: "+r}catch(e){n="GetSafeLinksDataFromServer_OnFailureCallback Exception: "+e.toString()}finally{this.handleGetPolicyRequestError(t,n)}},a.handleGetPolicyRequestError=function(e,t){void 0===t&&(t="");try{if(h.ULS.sendTraceTag(594830612,378,10,"HandleGetPolicyRequestError: HttpStatus {0}, Error {1}",e,t),this._getPolicyOnBootRetries<this._maxGetPolicyBootRetries&&this._getPolicyOnLinkClickRetries<this._maxGetPolicyOnLinkClickRetries)this.getSafeLinksDataFromServerAsync(this.isGetPolicyBootRequest);else{this.isGetPolicyBootRequest=!1,h.ULS.sendTraceTag(24462656,378,10,"Exhausted all retries for SafeLinks GetPolicy call. OnBootRetries: {0}, OnClickRetries: {1}, HttpStatus: {2}, Error: {3}",this._getPolicyOnBootRetries,this._getPolicyOnLinkClickRetries,e,t);var n=null,i=this.createMap();i&&(i.set("HttpStatus",e.toString()),n=Object.assign(new N.a,{extendedProperties:i})),l.Health.instance.recordKpiFailure("SafeLinksGetPolicy1","GetPolicyRequestError",!1,!0,n);var r=new Ze("false","","",0,!0,"");this.setCachedData(r),this._pendingUrlToFollow&&(h.ULS.sendTraceTag(26019603,378,50,"Error occurred during at-click GetPolicy call, NavigationState = {0}","disabled_GetPolicyFailure"),l.Health.instance.recordKpiFailure("SafeLinksNavigations","disabled_GetPolicyFailure",!1,!0,null),tt.a.followHyperlinkWithNoReferrer(this._pendingUrlToFollow),this._pendingUrlToFollow=null)}}catch(e){h.ULS.sendTraceTag(594830611,378,10,"HandleGetPolicyRequestError: Exception {0}",e.toString())}},a.tryNavigateInternal=function(e){var t=this.getPolicyCookieFromCache(),n=this.getWebAffinitizedUrlFromCache(),i={};i.Url=e,i.SafeLinksCookie=t,i.CorrelationId=B.a.create().toString(),i.WorkloadId=this.workloadId,i.UserAgentInfo=U.a.browserNameForlogging+"|"+this.appName,h.ULS.sendTraceTag(23900187,378,50,"Validating hyperlink with request correlation: {0}",i.CorrelationId),tt.a.postToWindow(tt.a.windowTargetToString(4),n,i)},a.isSafeLinksEnabledForUser=function(){var t=this._appSettingsManager.getStringAppSetting("IsSafeLinksEnabledForUser");return!!t&&e.parseSafeLinksEnabledForUser(t)},a.isSafeLinksEnabledForBrowser=function(){var e=this._appSettingsManager.getListAppSetting("SafeLinksDisabledBrowsers");if(U.a.isElectron){if(this._appSettingsManager.containsAppSetting("SafeLinksForTeamsIsEnabled")&&this._appSettingsManager.getBooleanAppSetting("SafeLinksForTeamsIsEnabled"))return!0;if(Array.contains(e,"Electron"))return!1}else if(Array.contains(e,U.a.browserNameForlogging))return!1;return"officecomhwa"!==(this._appSettingsManager.getStringAppSetting(s.AFrameworkApplication.uiHostSettingName)||"").toLowerCase()},a.shouldUseNavigationHelper=function(){return!(-1===window.location.href.indexOf("&wd_slnh=1"))||U.a.isElectron},a.shouldTryUsingSafeLinksService=function(t){t.val=0;var n=this.getCachedData(),i=n?n.IsSafeLinksEnabled:"";if(""!==i)return n.WasServiceDown?(h.ULS.sendTraceTag(51663971,378,50,"Failed to retrieve policy data"),t.val=2,!1):"false"===i.toLowerCase()?(h.ULS.sendTraceTag(51664e3,378,50,"SafeLinks disabled for the user"),t.val=1,!1):e.parseSafeLinksEnabledForUser(i);if(this._getPolicyRequestPending)return t.val=3,h.ULS.sendTraceTag(595079384,378,50,"Currently getting SafeLinks policy"),!1;if(this._getPolicyOnBootRetries>=this._maxGetPolicyBootRetries||this._getPolicyOnLinkClickRetries>=this._maxGetPolicyOnLinkClickRetries)return t.val=2,h.ULS.sendTraceTag(51664001,378,50,"Exhausted all retries- Failure in GetPolicy for SafeLinks ({0}/{1} boot, {2}/{3} onClick)",this._getPolicyOnBootRetries,this._maxGetPolicyBootRetries,this._getPolicyOnLinkClickRetries,this._maxGetPolicyOnLinkClickRetries),!1;var r=this._getPolicyOnBootRetries+this._getPolicyOnLinkClickRetries;return h.ULS.sendTraceTag(23900182,378,10,"Inconsistent SafeLinks state: SafeLinks cache data is null with no on boot request pending, and {0} retries left over. Perhaps LocalStorage is inaccessable.",this._maxGetPolicyBootRetries+this._maxGetPolicyOnLinkClickRetries-r),!0},a.getPolicyCookieFromCache=function(){var e=this.getCachedData();return e?e.PolicyCookie:""},a.getWebAffinitizedUrlFromCache=function(){var e=this.getCachedData();return e?e.WebAffinitizedUrl:""},a.getAffinitizedUrlFromCache=function(){var e=this.getCachedData();return e?e.AffinitizedUrl:""},a.getExpirationTimeFromCache=function(){var e=new Date;try{var t=this.getCachedData(),n=t?t.PolicyCookieTTL:0;e.setTime(n)}catch(e){h.ULS.sendTraceTag(24462658,378,10,"Exception occured while fetching expiration time from cache: {0}",e)}return e},a.isPolicyCookieExpired=function(){var e=this.getExpirationTimeFromCache();return!!e&&e.getTime()<Date.now()},a.getCachedData=function(){if(!this._sessionCacheSafeLinksData){var e=Q.instance.getItem(this.userId);if(!e||""===e)return null;this._sessionCacheSafeLinksData=JSON.parse(e)}return this._sessionCacheSafeLinksData},a.setCachedData=function(e){if(null==e)throw Error.argumentNull("safeLinksData");if(void 0===e.IsSafeLinksEnabled||null===e.IsSafeLinksEnabled||e.IsSafeLinksEnabled.length<=0)throw Error.argumentNull("safeLinksData.IsSafeLinksEnabled");this._sessionCacheSafeLinksData=e,e.WasServiceDown||this.writeValuesToLocalStorage(e)},a.writeValuesToLocalStorage=function(e){var t=JSON.stringify(e);Q.instance.setItem(this.userId,t)},a.createAndStartStopwatch=function(t){return void 0!==e._stopwatchBuilder&&null!==e._stopwatchBuilder?e._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall",t):null},a.stopAndGetDurationInMsFromStopwatch=function(e){if(void 0!==e.val&&null!==e.val){var t=e.val.ageInMilliseconds;return e.val.stop(),e.val=null,t}return null},a.createMap=function(){try{return new Map}catch(e){return null}},e.parseSafeLinksEnabledForUser=function(e){return"false"!==e.toLowerCase()},t=e,(n=[{key:"appName",get:function(){return this._appName}},{key:"webServiceBaseUrl",get:function(){return this._webServiceBaseUrl}},{key:"userId",get:function(){return this._userId}},{key:"getPolicyHandlerUrl",get:function(){var e=this.webServiceBaseUrl?this.webServiceBaseUrl+"/":"",t=new R.QueryStringBuilder("SafeLinksHandler.ashx");return t.addParam("app",this.appName),this._appSettingsManager.getBooleanAppSetting("SafeLinksUseDebugHeader")&&t.addParam("action","debug"),String.format("{0}{1}&{2}",e,t.toString(),s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion)}},{key:"getUrlReputationHandlerUrl",get:function(){var e=this.webServiceBaseUrl?this.webServiceBaseUrl+"/":"",t=new R.QueryStringBuilder("SafeLinksHandler.ashx");return t.addParam("app",this.appName),this._appSettingsManager.getBooleanAppSetting("SafeLinksUseDebugHeader")&&t.addParam("action","debug"),t.addParam("slrt","GetUrlReputation"),String.format("{0}{1}&{2}",e,t.toString(),s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion)}},{key:"navigationHelper",get:function(){return e._safeLinksNavigationHelper||(e._safeLinksNavigationHelper=new nt(this._appSettingsManager,this._clientRequestManager,this.getUrlReputationHandlerUrl,e._stopwatchBuilder)),e._safeLinksNavigationHelper}}])&&it(t.prototype,n),i&&it(t,i),e}();rt._stopwatchBuilder=null,rt._safeLinksNavigationHelper=null,Object(i.a)(rt,"SafeLinksManager",null,[141]);function at(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ot=function(){function e(){this._container=null}var t,n,i,a=e.prototype;return a.configure=function(e){this._container=e},a.init=function(){s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(Object(r.d)(this,this.onFullAppSettingsReady,"onFullAppSettingsReady"))},a.dispose=function(){},a.onFullAppSettingsReady=function(){var e=this;s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WACSafeLinksIsEnabled")&&(this._container.register(rt,"Common.App.SafeLinks.SafeLinksManager").as("Common.App.SafeLinks.ISafeLinksManager").singleInstance().usingFactory((function(){return new rt(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager,String.format("{0}-{1}",function(e){switch(e){case 3:return"Word";case 1:return"Excel";case 2:return"PowerPoint";case 4:return"OneNote";case 5:return"Visio";default:return"Unknown"}}(s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType),function(e){switch(e){case 1:return"Edit";case 2:return"View";case 3:return"InstantView";default:return"Unknown"}}(s.AFrameworkApplication.activeFrame.applicationInstance.officeAppMode)),!1,e._container.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),s.AFrameworkApplication.activeFrame.theStopwatchBuilder)})),this._container.tryResolve("Common.App.SafeLinks.ISafeLinksManager"))},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.SafeLinks"}}])&&at(t.prototype,n),i&&at(t,i),e}();Object(i.a)(ot,"SafeLinksPackage",null,[14,15]);var st=n(40),lt=n(255);function ct(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ut=function(e){var t,n;function i(t){return e.call(this,t)||this}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r,a,o,s=i.prototype;return s.createElement=function(){var e=document.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",this.resourceUrl),e},s.createHighPriorityResourceElement=function(){return null},s.reloadReference=function(){this.element.setAttribute("href",""),this.element.setAttribute("href",this.resourceUrl)},r=i,(a=[{key:"couldGenerateLayout",get:function(){return!1}}])&&ct(r.prototype,a),o&&ct(r,o),i}(lt.a);Object(i.a)(ut,"CssResource",lt.a,[]);var dt=n(109),pt=function(){function e(){this._firstRunExperienceDependenciesTask=null,this._premiumMessagingDependenciesTask=null}var t=e.prototype;return t.loadFirstRunExperienceDependenciesAsync=function(){return this._firstRunExperienceDependenciesTask||(h.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this._firstRunExperienceDependenciesTask=dt.Task.WAA(e.loadJavaScriptAsync("inproductmessaging.js"),e.loadCssAsync("inproductmessaging.css")),this._firstRunExperienceDependenciesTask.CWo((function(e){h.ULS.sendTraceTag(21030599,324,10,"{0}",We.a.getExceptionMessage(e.get_exception()))}),5)),this._firstRunExperienceDependenciesTask},t.loadFreemiumDependenciesAsync=function(){if(!this._premiumMessagingDependenciesTask)try{h.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage");var t=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("DimeUrl");this._premiumMessagingDependenciesTask=dt.Task.WAA(e.enqueDownload(Y.a.create(t,null,null))),this._premiumMessagingDependenciesTask.CWo((function(e){h.ULS.sendTraceTag(39978391,324,10,"{0}",We.a.getExceptionMessage(e.get_exception()))}),5)}catch(e){h.ULS.sendTraceTag(594874951,324,10,"{0}",We.a.getExceptionMessage(e))}return this._premiumMessagingDependenciesTask},e.loadJavaScriptAsync=function(t){var n=e.getUrl(t),i=Y.a.create(n,null,null);return e.enqueDownload(i)},e.loadCssAsync=function(t){var n=e.getUrl(t),i=new ut(n);return e.enqueDownload(i)},e.getUrl=function(e){return st.a.commonScripts(String.format("ipm/{0}",e))},e.enqueDownload=function(e){return Z.a.enqueueResourceWithoutEnabling(e),e.loadFinishedTask},e}();Object(i.a)(pt,"DependencyDownloader",null,[136]);var ht=function(){};function gt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ht.overlayDiv="inProductMessagingOverlayDiv",ht.welcomeVideoKey="WelcomeVideoKey",ht.suggestedVideo1Key="SuggestedVideo1Key",ht.suggestedVideo2Key="SuggestedVideo2Key",ht.welcomeVideoTranscript="WelcomeVideoTranscript",ht.suggestedVideo1Transcript="SuggestedVideo1Transcript",ht.suggestedVideo2Transcript="SuggestedVideo2Transcript",ht.mainDivLogo="MainDivLogo",ht.playButtonImage="PlayButtonImage",ht.replayButtonImage="ReplayButtonImage",ht.welcomeVideoImage="WelcomeVideoImage",ht.welcomeVideoTitle="WelcomeVideoTitle",ht.suggestedVideo1Image="SuggestedVideo1Image",ht.suggestedVideo1Title="SuggestedVideo1Title",ht.suggestedVideo2Image="SuggestedVideo2Image",ht.suggestedVideo2Title="SuggestedVideo2Title",ht.landingPageTitle="LandingPageUpperMessageTitle",ht.appThemeActiveColor="AppThemeActiveColor",ht.appThemePrimaryColor="AppThemePrimaryColor",ht.appThemeSecondaryBackgroundColor="AppThemeSecondaryBackgroundColor",ht.appThemeSecondaryHoverColor="AppThemeSecondaryHoverColor",Object(i.a)(ht,"Constants",null,[]);var mt=function(){function e(){this._autoPlay=!0,this._modernPlayerSupported=!0,this._showLandingPage=!0,this.playIcon=null,this.replayIcon=null,this.mutePlayer=!1,this.locale=null,this.uiResources={}}var t,n,i,r=e.prototype;return r.addMainDivLogo=function(e){this.addUIResource(ht.mainDivLogo,e)},r.addLandingPageTitle=function(e){this.addUIResource(ht.landingPageTitle,e)},r.addAppThemeColors=function(e,t,n,i){this.addUIResource(ht.appThemeActiveColor,e),this.addUIResource(ht.appThemePrimaryColor,t),this.addUIResource(ht.appThemeSecondaryBackgroundColor,n),this.addUIResource(ht.appThemeSecondaryHoverColor,i)},r.addWelcomeVideo=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this.addUIResource(ht.welcomeVideoKey,e),this.addUIResource(ht.welcomeVideoTranscript,t),this.addUIResource(ht.welcomeVideoImage,n),this.addUIResource(ht.welcomeVideoTitle,i)},r.addSuggestedVideo1=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this.addUIResource(ht.suggestedVideo1Key,e),this.addUIResource(ht.suggestedVideo1Transcript,t),this.addUIResource(ht.suggestedVideo1Image,n),this.addUIResource(ht.suggestedVideo1Title,i)},r.addSuggestedVideo2=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this.addUIResource(ht.suggestedVideo2Key,e),this.addUIResource(ht.suggestedVideo2Transcript,t),this.addUIResource(ht.suggestedVideo2Image,n),this.addUIResource(ht.suggestedVideo2Title,i)},r.addPlayReplayIcons=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.playIcon=e,this.replayIcon=t},r.setPlayReplayIcons=function(){this.addUIResource(ht.playButtonImage,this.playIcon),this.addUIResource(ht.replayButtonImage,this.replayIcon)},r.addUIResource=function(e,t){t&&(this.uiResources[e]=t)},t=e,(n=[{key:"autoPlay",get:function(){return this._autoPlay},set:function(e){this._autoPlay=e}},{key:"modernPlayerSupported",get:function(){return this._modernPlayerSupported},set:function(e){this._modernPlayerSupported=e}},{key:"showLandingPage",get:function(){return this._showLandingPage},set:function(e){this._showLandingPage=e,e&&this.setPlayReplayIcons()}}])&&gt(t.prototype,n),i&&gt(t,i),e}();Object(i.a)(mt,"FirstRunExperienceUISettings",null,[135]);var ft=function(){this.remindMeLater=!1,this.completed=!1};Object(i.a)(ft,"FirstRunExperienceViewData",null,[132]);var vt=n(61),St=function(){function e(e,t,n){this._actionManager=e,this._activeFrame=t,this._inProductMessagingUIManager=n}var t=e.prototype;return t.registerActions=function(){this._actionManager.addActionWithFlags(p.a.firstRunExperienceShowUI,de.a.frame,Object(r.d)(this,this.firstRunExperienceHandler,"firstRunExperienceHandler"),64),this._actionManager.addAction(p.a.firstRunExperienceFocusForward,de.a.frame,Object(r.d)(this,this.inProductMessagingTabHandler,"inProductMessagingTabHandler")),this._actionManager.addAction(p.a.firstRunExperienceFocusBackward,de.a.frame,Object(r.d)(this,this.inProductMessagingShiftTabHandler,"inProductMessagingShiftTabHandler")),this._actionManager.addAction(p.a.dimeLaunch,de.a.frame,Object(r.d)(this,this.dimeLaunchHandler,"dimeLaunchHandler")),this._actionManager.addAction(p.a.reportFreemiumUpsellDialogDisplayed,de.a.frame,vt.ActionManager.doNothingButReportHandler),this._actionManager.addAction(p.a.reportFreemiumUpsellDialogClicked,de.a.frame,vt.ActionManager.doNothingButReportHandler),this._actionManager.addAction(p.a.reportFreemiumUpsellDialogDismissed,de.a.frame,vt.ActionManager.doNothingButReportHandler),this._activeFrame&&this._activeFrame.updateCommandUI()},t.firstRunExperienceHandler=function(e,t,n,i,r){return 2===n&&this._inProductMessagingUIManager.launchInProductMessagingControl(r),32},t.dimeLaunchHandler=function(e,t,n,i,r){return 2===n&&this._inProductMessagingUIManager.launchFreemiumUpsellDialog(r),32},t.inProductMessagingTabHandler=function(e,t,n,i,r){return 2===n?this._inProductMessagingUIManager.moveForwardOnTab():32},t.inProductMessagingShiftTabHandler=function(e,t,n,i,r){return 2===n?this._inProductMessagingUIManager.moveBackwardOnShiftTab():32},e}();Object(i.a)(St,"InProductMessagingActor",null,[]);var _t=function(){this.instance=null,this.launchConfig=null,this.taskCompleteAction=null,this.resolveAction=null,this.rejectAction=null};Object(i.a)(_t,"DimeExperienceUISettings",null,[]);var yt=n(44),bt=n(302),At=function(){function e(e,t,n,i,r){this.freemiumDependenciesLoaded=!1,this.dimeInstance=null,this._actionManager=e,this._uiWrapper=t,this._resourceDownloadManager=n,this._appType=i,this._appMode=r}var t=e.prototype;return t.initializeGoPremiumButton=function(e){if(yt.apiExtensionExists("getHeaderApi")){var t=e.isFreemiumUpsellEnabled();t&&e.isFeatureEnabled("MsoPremiumBadge",!0).then((function(n){return appChrome.getHeaderApi().then((function(e){return e.updatePremiumStatus(n,t),null})),e.registerFeatureStateChangeCallback("MsoPremiumBadge",(function(e){appChrome.getHeaderApi().then((function(n){return n.updatePremiumStatus(e.isEnabled,t),null}))})),null}))}else h.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")},t.launchInProductMessagingControl=function(e){var t=this;this._resourceDownloadManager.loadFirstRunExperienceDependenciesAsync().CW((function(n){t._uiWrapper.showUI(e)}))},t.launchFreemiumUpsellDialog=function(e){var t=e,n="gopremium",i=function(){};t?(t.experience&&""!==Object(k.a)(String,t.experience)&&(n=Object(k.a)(String,t.experience)),t.onTaskComplete&&(i=t.onTaskComplete)):h.ULS.sendTraceTag(51675402,324,50,"Experience not given, using default experience"),this.launchDimeExperience(n,i)},t.launchDimeExperience=function(e,t){var n=this;if(this.freemiumDependenciesLoaded&&this.dimeInstance){var i={};i.experience=e||"gopremium",i.campaignId=bt.b(this._appType,this._appMode,Object(k.a)(String,i.experience),!0),this._actionManager.processAction(p.a.reportFreemiumUpsellDialogDisplayed,2),h.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+i.experience);try{var r=Object.assign(new _t,{instance:this.dimeInstance,launchConfig:i,taskCompleteAction:t||function(){},resolveAction:function(e){h.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+e.status)},rejectAction:function(e){h.ULS.sendTraceTag(51675406,324,10,"Dime launch error"),n.freemiumDependenciesLoaded=!1,n.dimeInstance=null}});this._uiWrapper.showFreemiumUI(r)}catch(e){var a;h.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+e.message),this.freemiumDependenciesLoaded=!1,this.dimeInstance=null,this._actionManager.processActionWithData(p.a.freemiumUpsellEligible,2,((a={}).experience=i.experience,a))}}else{var o;h.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),this._actionManager.processActionWithData(p.a.freemiumUpsellEligible,2,((o={}).experience=e,o))}},t.loadFreemiumUpsellDialogDependencies=function(){var e=this;this._resourceDownloadManager.loadFreemiumDependenciesAsync().CWo((function(t){try{var n=We.a.toLower(s.AFrameworkApplication.uiCulture),i=bt.c(e._appType);if(!i)return void h.ULS.sendTraceTag(51675409,324,15,"App not supported");var r={};r.partnerId=i,r.language=n,r.sessionId=s.AFrameworkApplication.userSessionId,r.authHint=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("UserPrincipalName"),e.dimeInstance=new Dime(r),e.freemiumDependenciesLoaded=!0,h.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}catch(e){h.ULS.sendTraceTag(51675410,324,10,"FreemiumUpsellDialogDependencies failed: "+e.message)}}),3)},t.moveForwardOnTab=function(){return this._uiWrapper.moveForwardOnTab()},t.moveBackwardOnShiftTab=function(){return this._uiWrapper.moveBackwardOnShiftTab()},e}();Object(i.a)(At,"InProductMessagingUIManager",null,[129]);var Ct=function(){function e(){this._traceCategory=0,this._levelMap=new Array(5),this._levelMap[0]=10,this._levelMap[1]=15,this._levelMap[2]=50,this._levelMap[3]=100,this._levelMap[4]=200}var t=e.prototype;return t.Init=function(e){this._traceCategory=e},t.SendTrace=function(e,t){h.ULS.sendTraceTag(34182235,this._traceCategory,this._levelMap[e],"{0}",t)},e}();Object(i.a)(Ct,"DefaultNetworkingManager",null,[149]);var Tt=n(31),wt=n(78),It=n(24);function kt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ft=function(){function e(e){this._isFreOverlayVisible=!1,this._focusManager=e}var t,n,i,a=e.prototype;return a.showUI=function(e){var t=e;t&&(InProductMessaging.Networking.NetworkingMgr=new Ct,InProductMessaging.Networking.NetworkingMgr.Init(387),this._isFreOverlayVisible=!0,InProductMessaging.Init(t.showLandingPage,t.modernPlayerSupported,t.autoPlay,t.mutePlayer,t.locale,Object(r.d)(this,this.onDismissFirstRunExperience,"onDismissFirstRunExperience"),t.uiResources),this.setFocusScope(ht.overlayDiv,!0))},a.showFreemiumUI=function(e){var t=this,n=e;if(!(n&&n.instance&&n.launchConfig))throw Error.argument("DimeExperienceUISettings");var i=document.getElementById("wacDimeContainer");i||((i=document.createElement("div")).id="wacDimeContainer",document.body.appendChild(i)),this.setFocusScope("wacDimeContainer",!1),n.launchConfig.parentElementId="wacDimeContainer",n.instance.launch(n.launchConfig,n.taskCompleteAction).then((function(e){t.removeFocus(),document.body.removeChild(i),n.resolveAction(e)})).catch((function(e){t.removeFocus(),document.body.removeChild(i),n.rejectAction(e)}))},a.setFocusScope=function(e,t){if(this._focusManager&&e){var n=document.getElementById(e);this.initializeFocusLoop("InProductMessagingFocusId",n,!1);var i=this._focusManager.getRegion("InProductMessagingFocusId");if(i){var r=this._focusManager.currentScope;r&&"InProductMessagingFocusId"===r.name||this._focusManager.pushScope("InProductMessagingFocusId",!1),t&&this.rebindTabNavigationHandlers(i.scope)}}},a.initializeFocusLoop=function(e,t,n){void 0===n&&(n=!0);var i=this._focusManager.getScope(e);i.parent=Tt.AFrame.appFocusId;var r=new wt.DOMFocusListing((function(){return t}));r.rememberFirstElement=n,r.addValidTag(3),r.addValidTag(2),r.addValidTag(4);var a=this._focusManager.buildRegionWithDelegate((function(){return t}),i,r);a.rememberFocusStealers(),a.looped=!0,a.contained=!0},a.rebindTabNavigationHandlers=function(e){e.unBindAction(It.FocusManager.instance()._tabInput),e.unBindAction(It.FocusManager.instance()._tabShiftInput),e.bindAction(It.FocusManager.instance()._tabInput,p.a.firstRunExperienceFocusForward),e.bindAction(It.FocusManager.instance()._tabShiftInput,p.a.firstRunExperienceFocusBackward)},a.removeFocus=function(){this._focusManager&&(this._focusManager.popScope("InProductMessagingFocusId"),this._focusManager.removeScope("InProductMessagingFocusId"))},a.onDismissFirstRunExperience=function(e,t){this._isFreOverlayVisible=!1,this.removeFocus();var n=Object.assign(new ft,{completed:e,remindMeLater:t});s.AFrameworkApplication.theActionManager.processActionWithData(p.a.firstRunExperienceCompleted,2,n)},a.onDismissFreemiumDialog=function(e){this._isFreOverlayVisible=!1,this.removeFocus(),e?s.AFrameworkApplication.theActionManager.processAction(p.a.reportFreemiumUpsellDialogClicked,2):s.AFrameworkApplication.theActionManager.processAction(p.a.reportFreemiumUpsellDialogDismissed,2)},a.moveForwardOnTab=function(){var e=document.activeElement,t=this._focusManager.getCurrentRegion();return e&&t&&t.listing&&e===t.listing.lastElement?(t.listing.trySetCurrentElement(e),t.moveForward()?32:8):4},a.moveBackwardOnShiftTab=function(){var e=document.activeElement,t=this._focusManager.getCurrentRegion();return e&&t&&t.listing&&e===t.listing.firstElement?(t.listing.trySetCurrentElement(e),t.moveBackward()?32:8):4},t=e,(n=[{key:"isFreOverlayVisible",get:function(){return this._isFreOverlayVisible}}])&&kt(t.prototype,n),i&&kt(t,i),e}();Object(i.a)(Ft,"InProductMessagingUIWrapper",null,[128]);var Et=n(67);function Ot(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Pt=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.configure=function(e){e.register(pt,"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").singleInstance().usingFactory((function(){return new pt})),e.register(Ft,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").singleInstance().usingFactory((function(){return new Ft(It.FocusManager.instance())})),e.register(At,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").singleInstance().usingFactory((function(){return new At(s.AFrameworkApplication.theActionManager,e.resolve("Common.IInProductMessagingUIWrapper"),e.resolve("Common.App.InProductMessaging.IDependencyDownloader"),s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType,s.AFrameworkApplication.activeFrame.applicationInstance.officeAppMode)})),e.register(St,"Common.App.InProductMessaging.InProductMessagingActor").singleInstance().usingFactory((function(){return new St(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.activeFrame,e.resolve("Common.IInProductMessagingUIManager"))})),e.register(mt,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").singleInstance().usingFactory((function(){return new mt})),e.register(ft,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").singleInstance().usingFactory((function(){return new ft})),this._container=e},r.init=function(){var e=this;this._container.resolve("Common.App.InProductMessaging.InProductMessagingActor").registerActions(),s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){s.AFrameworkApplication.activeFrame.applicationInstance.isReactSharedHeaderUxEnabled&&Et.a.get_instance().executeWhen(15,(function(){e._container.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute((function(t){e._container.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").initializeGoPremiumButton(t)}))})),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("FreemiumUpsellShowDialogIsEnabled")&&bt.a()&&!U.a.isInternetExplorer&&1!==s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType&&e._container.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute((function(t){t.isFeatureEnabled("MsoPremiumBadge",!0).then((function(n){return!n&&t.isFreemiumUpsellEnabled()&&e._container.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").loadFreemiumUpsellDialogDependencies(),null}))}))}))},r.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.InProductMessaging"}}])&&Ot(t.prototype,n),i&&Ot(t,i),e}();Object(i.a)(Pt,"InProductMessagingPackage",null,[14,15]);var Dt=n(27),Mt=function(){function e(e){this._allowedDomainEndings=e}return e.prototype.isDomainAllowed=function(e){if(!this._allowedDomainEndings)return!0;var t=Dt.a.getHost(e);if(!t)return!1;t=t.toLowerCase();for(var n=0;n<this._allowedDomainEndings.length;n++)if(t.endsWith(this._allowedDomainEndings[n]))return!0;return!1},e}();function Lt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Mt,"DomainAllowListManager",null,[]);var Rt=function(){function e(e,t){this.customText=null,this._timings=e,this.url=t}var t,n,i,r=e.prototype;return r.toUsageData=function(){var e={},t=this.timings;return e.a=this.usageReadyUrl,e.b=this.round(t.navigationStart),e.c=this.round(t.unloadEventStart),e.d=this.round(t.unloadEventEnd),e.e=this.round(t.redirectStart),e.f=this.round(t.redirectEnd),e.g=this.round(t.fetchStart),e.h=this.round(t.domainLookupStart),e.i=this.round(t.domainLookupEnd),e.j=this.round(t.connectStart),e.k=this.round(t.connectEnd),e.l=void 0!==t.secureConnectionStart&&null!==t.secureConnectionStart?this.round(t.secureConnectionStart):0,e.m=this.round(t.requestStart),e.n=this.round(t.responseStart),e.o=this.round(t.responseEnd),e.q=this.round(t.domInteractive),e.r=this.round(t.domContentLoadedEventStart),e.s=this.round(t.domContentLoadedEventEnd),e.t=this.round(t.domComplete),e.u=this.round(t.loadEventStart),e.v=this.round(t.loadEventEnd),e.w=this.customText,e},r.round=function(e){return Math.round(1e3*e)/1e3},t=e,(n=[{key:"usageReadyUrl",get:function(){return Dt.a.removeAllUrlParameters(this.url)}},{key:"timings",get:function(){return this._timings}}])&&Lt(t.prototype,n),i&&Lt(t,i),e}();Object(i.a)(Rt,"PerformanceTimingEntry",null,[]);var Ut=function(e,t){var n={},i=function(e,t){null!=t&&(n[e]=t)},r=null;switch(e){case 0:var a=t;r="ResourceTiming",i("Url",a.a),i("InitiatorType",a.b),i("RedirectStart",null==a.c?null:a.c.toString()),i("RedirectEnd",null==a.d?null:a.d.toString()),i("FetchStart",null==a.e?null:a.e.toString()),i("DomainLookupStart",null==a.f?null:a.f.toString()),i("DomainLookupEnd",null==a.g?null:a.g.toString()),i("ConnectStart",null==a.h?null:a.h.toString()),i("ConnectEnd",null==a.i?null:a.i.toString()),i("SecureConnectionStart",null==a.j?null:a.j.toString()),i("RequestStart",null==a.k?null:a.k.toString()),i("ResponseStart",null==a.l?null:a.l.toString()),i("ResponseEnd",null==a.m?null:a.m.toString()),i("CustomText",a.n),i("DecodedBodySize",null==a.o?null:a.o.toString()),i("EncodedBodySize",null==a.p?null:a.p.toString()),i("TransferSize",null==a.q?null:a.q.toString());break;case 1:var o=t;r="PerformanceTiming",i("Url",o.a),i("NavigationStart",null==o.b?null:o.b.toString()),i("UnloadEventStart",null==o.c?null:o.c.toString()),i("UnloadEventEnd",null==o.d?null:o.d.toString()),i("RedirectStart",null==o.e?null:o.e.toString()),i("RedirectEnd",null==o.f?null:o.f.toString()),i("FetchStart",null==o.g?null:o.g.toString()),i("DomainLookupStart",null==o.h?null:o.h.toString()),i("DomainLookupEnd",null==o.i?null:o.i.toString()),i("ConnectStart",null==o.j?null:o.j.toString()),i("ConnectEnd",null==o.k?null:o.k.toString()),i("SecureConnectionStart",null==o.l?null:o.l.toString()),i("RequestStart",null==o.m?null:o.m.toString()),i("ResponseStart",null==o.n?null:o.n.toString()),i("ResponseEnd",null==o.o?null:o.o.toString()),i("DomLoading",null==o.p?null:o.p.toString()),i("DomInteractive",null==o.q?null:o.q.toString()),i("DomContentLoadedEventStart",null==o.r?null:o.r.toString()),i("DomContentLoadedEventEnd",null==o.s?null:o.s.toString()),i("DomComplete",null==o.t?null:o.t.toString()),i("LoadEventStart",null==o.u?null:o.u.toString()),i("LoadEventEnd",null==o.v?null:o.v.toString()),i("CustomText",o.w)}return n.Table=r,Sys.Serialization.JavaScriptSerializer.serialize(n)},Ht=n(30),Bt=n(113),xt=n(70);function Nt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var jt=function(){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),this._pageLoadPerfRecorder=e,this.usageLogger=this,this._getCurrentUrlDelegate=t||function(){return window.location.href},this._domainAllowListManager=new Mt(n)}var t,n,i,r=e.prototype;return r.run=function(){if(e.browserSupportsPerformanceTiming(window.performance))try{var t=this._getCurrentUrlDelegate();if(!e._transportRegEx.exec(t))return;if(!this._domainAllowListManager.isDomainAllowed(t))return;var n=new Rt(window.performance.timing,t);xt.a.instance.recordBrowserFetchStart(n.timings.fetchStart),xt.a.instance.recordBrowserNavigationStart(n.timings.navigationStart),xt.a.instance.measureMarks(Ht.a.frameConnect,"connectStart","requestStart"),xt.a.instance.measureMarks(Ht.a.frameRequest,"requestStart","responseStart"),xt.a.instance.measureMarks(Ht.a.frameResponse,"responseStart","responseEnd"),this.usageLogger.logData(1,n.toUsageData()),this._pageLoadPerfRecorder.addMetric(Ht.a.frameFetchStart,n.timings.fetchStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameDomainLookupStart,n.timings.domainLookupStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameDomainLookupEnd,n.timings.domainLookupEnd),this._pageLoadPerfRecorder.addMetric(Ht.a.frameConnectStart,n.timings.connectStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameSecureConnectionStart,n.timings.secureConnectionStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameConnectEnd,n.timings.connectEnd),this._pageLoadPerfRecorder.addMetric(Ht.a.frameRequestStart,n.timings.requestStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameResponseStart,n.timings.responseStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameDownloadDuration,n.timings.responseEnd-n.timings.responseStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameRequestStartToFirstByteDuration,n.timings.responseStart-n.timings.requestStart);var i=0,r=0,a=0;this.tryNavigationSize(t,Object(z.a)((function(){return i}),(function(e){return i=e})),Object(z.a)((function(){return r}),(function(e){return r=e})),Object(z.a)((function(){return a}),(function(e){return a=e})))&&(this._pageLoadPerfRecorder.addMetric(Ht.a.frameTransferSize,i),this._pageLoadPerfRecorder.addMetric(Ht.a.frameDecodedSize,a),this._pageLoadPerfRecorder.addMetric(Ht.a.frameEncodedSize,r)),this._pageLoadPerfRecorder.addMetric(Ht.a.frameNavigationStart,n.timings.navigationStart)}catch(e){h.ULS.sendTraceTag(4551814,306,10,"Exception caught in PerformanceTimingLogger.Run: {0}",e)}},r.tryNavigationSize=function(e,t,n,i){if(t.val=-1,n.val=-1,i.val=-1,void 0===window.performance.getEntriesByName||null===window.performance.getEntriesByName)return!1;var r=window.performance.getEntriesByName(e,"navigation");if(null==r||1!==r.length)return!1;var a=r[0],o=a.transferSize;void 0!==t.val&&null!==t.val&&(t.val=o);var s=a.decodedBodySize;null!=s&&(i.val=s);var l=a.encodedBodySize;return null!=l&&(n.val=l),!0},r.logData=function(e,t,n){void 0===n&&(n=!1),h.ULS.sendTraceTag(4551815,306,50,Ut(e,t))},e.browserSupportsPerformanceTiming=function(e){return!(null==e||void 0===e.timing||null===e.timing)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e(Bt.a.instance,null,s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PerfTimingLoggerFilterDomainsIsEnabled")?s.AFrameworkApplication.appSettingsManager.getListAppSetting("ResourceLoggerDomainAllowList"):null))}}],(n=null)&&Nt(t.prototype,n),i&&Nt(t,i),e}();function Wt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}jt._instance=null,jt._transportRegEx=new RegExp("^https?://.*","i"),Object(i.a)(jt,"PerformanceTimingLogger",null,[127]);var Vt=function(){function e(e,t){this.customText=null,this._timings=e,this.behavior=t,this.url=this.timings.name}var t,n,i,r=e.prototype;return r.toUsageData=function(){var t={},n=this.timings;return t.a=this.usageReadyUrl,t.b=n.initiatorType,t.c=this.round(n.redirectStart),t.d=this.round(n.redirectEnd),t.e=this.round(n.fetchStart),t.f=this.round(n.domainLookupStart),t.g=this.round(n.domainLookupEnd),t.h=this.round(n.connectStart),t.i=this.round(n.connectEnd),t.j=void 0!==n.secureConnectionStart&&null!==n.secureConnectionStart?this.round(n.secureConnectionStart):0,t.k=this.round(n.requestStart),t.l=this.round(n.responseStart),t.m=this.round(n.responseEnd),t.o=this.round(e.getRawField(n,"decodedBodySize")),t.p=this.round(e.getRawField(n,"encodedBodySize")),t.q=this.round(e.getRawField(n,"transferSize")),t.n=this.customText,t},r.round=function(e){return Math.round(1e3*e)/1e3},e.getRawField=function(e,t){return e[t]},t=e,(n=[{key:"usageReadyUrl",get:function(){return 2===this.behavior?this.url:Dt.a.removeAllUrlParameters(this.url)}},{key:"timings",get:function(){return this._timings}}])&&Wt(t.prototype,n),i&&Wt(t,i),e}();Object(i.a)(Vt,"ResourceTimingEntry",null,[151]);var qt=function(){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n=100),this._appMonitoredStaticResources=e,this._staticResourceHostAllowList=t,this._aggregatedStaticResourceMetrics={},this._cacheThresholdInMs=n}var t=e.prototype;return t.tryAggregateResourceTiming=function(e){var t=e.name.toLowerCase(),n=Dt.a.getPageName(t);if(this.resourceTimingShouldBeAggregated(n,t)){if(n in this._aggregatedStaticResourceMetrics)return h.ULS.sendTraceTag(51652509,306,50,"AppStaticResourceManager: file downloaded multiple times {0}",n),!1;var i={};return i.fetchstart=e.fetchStart,i.responseend=e.responseEnd,i.iscached=this.isTimingCached(e),i.encodedsize=Vt.getRawField(e,"encodedBodySize"),i.decodedsize=Vt.getRawField(e,"decodedBodySize"),this._aggregatedStaticResourceMetrics[n]=i,!0}return!1},t.resourceTimingShouldBeAggregated=function(e,t){if(this._appMonitoredStaticResources)return Array.contains(this._appMonitoredStaticResources,e);if(this._staticResourceHostAllowList)for(var n=Dt.a.getHostname(t),i=0;i<this._staticResourceHostAllowList.length;i++)if(this._staticResourceHostAllowList[i]&&n.endsWith(this._staticResourceHostAllowList[i]))return!0;return!1},t.isTimingCached=function(e){try{var t=Vt.getRawField(e,"transferSize");return t?!t:(h.ULS.sendTraceTag(51652510,306,50,"AppStaticResourceManager: No transfersize found, basing cache status from duration"),e.responseEnd-e.fetchStart<this._cacheThresholdInMs)}catch(e){h.ULS.sendTraceTag(51652511,306,50,"AppStaticResourceManager: Error attempting to get cache value of resource [error: {0}]",e.message)}return!1},t.getAggregatedResourceMetrics=function(){return this._aggregatedStaticResourceMetrics},t.recordStaticResourcesMetricsInKpi=function(){if(H.g(this._aggregatedStaticResourceMetrics))h.ULS.sendTraceTag(575931855,306,15,"Aggregated Static Resource Metric Dictionary is null or empty");else{var e=s.AFrameworkApplication.flightId?s.AFrameworkApplication.flightId.split(";"):new Array(0),t=Object.assign(new N.a,{extendedProperties:new Map});t.extendedProperties.set("Flights",L.c(e)),this.logKpiForEachResource(t,this._aggregatedStaticResourceMetrics,l.Health.instance)}},t.logKpiForEachResource=function(e,t,n){for(var i in t){var r={key:i,value:t[i]},a=!0;try{var o=Object(k.a)(Object,r.value);if(!o){a=!1;continue}e.extendedProperties.set("ResourceName",r.key),e.extendedProperties.set("FetchStart",o.fetchstart?o.fetchstart.toString():""),e.extendedProperties.set("ResponseEnd",o.responseend?o.responseend.toString():""),e.extendedProperties.set("IsCached",o.iscached?o.iscached.toString():"false"),e.extendedProperties.set("EncodedSize",o.encodedsize?o.encodedsize.toString():""),e.extendedProperties.set("DecodedSize",o.decodedsize?o.decodedsize.toString():"")}catch(e){a=!1,h.ULS.sendTraceTag(575931856,306,10,"AppStaticResourceManager: Error attempting to log KPI [error: {0}]",e.message)}a&&(n.recordKpiUsageForAlertableKpi("StaticResourceDownloadLatency","wacbootmonitoring",null),n.recordKpiSuccess("StaticResourceDownloadLatency",e))}},e}();Object(i.a)(qt,"AppStaticResourceManager",null,[]);var Gt=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).entries=t,n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(Sys.EventArgs);function Kt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Gt,"EntriesAvailableEventArgs",Sys.EventArgs,[]);var zt=function(){function e(e,t,n,i,r){void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=100),this._isTaskSet=!1,this._task=null,this._currentEntryIndex=0,this._eventSource=new a.a,this._appStaticResourceManager=null,this._isActive=!1,this._timerInterval=0,this._taskManager=e,this._defaultBehavior=0,this.usageLogger=this,this._domainAllowListManager=new Mt(n),this._performance=t,i&&(this._appStaticResourceManager=new qt(null,i,r))}var t,n,i,r=e.prototype;return r.add_entriesAvailable=function(t){this._eventSource.addHandler(e.entriesAvailableEventKey,t)},r.remove_entriesAvailable=function(t){this._eventSource.removeHandler(e.entriesAvailableEventKey,t)},r.configure=function(e,t){var n=this.timerInterval!==e;this._timerInterval=e,this.isActive&&this._taskManager&&n&&(this.deleteTask(),this.addTask()),this._defaultBehavior=t},r.activate=function(){this.isActive||this.browserSupportsPerformanceTimeline&&(this.addTask(),this._isActive=!0)},r.deactivate=function(e){this.isActive&&(this.deleteTask(),e&&this.flush(),this._isActive=!1)},r.flush=function(){if(this.isActive&&this.browserSupportsPerformanceTimeline)try{var t=window.performance.getEntriesByType("resource");t.length-this._currentEntryIndex>0&&h.ULS.sendTraceTag(19506833,306,100,"ResourceTimingLogger.Flush: Start executing command. Number of new entries to flash: {0}",t.length-this._currentEntryIndex);var n=!(void 0===window.performance.clearResourceTimings||null===window.performance.clearResourceTimings);n&&(window.performance.clearResourceTimings(),this._currentEntryIndex=0);for(var i=[],r=this._currentEntryIndex;r<t.length;r++)this._domainAllowListManager.isDomainAllowed(t[r].name)&&(this._appStaticResourceManager&&this._appStaticResourceManager.tryAggregateResourceTiming(t[r]),i.push(new Vt(t[r],this.defaultBehavior)));n||(this._currentEntryIndex=t.length),this._eventSource.raiseEvent(e.entriesAvailableEventKey,new Gt(i));for(var a=0;a<i.length;a++)i[a].behavior&&2!==i[a].behavior||this.usageLogger.logData(0,i[a].toUsageData());i.length>0&&h.ULS.sendTraceTag(19506834,306,100,"ResourceTimingLogger.Flush: Successfully ended. Number of new logged entries: {0}",i.length)}catch(e){h.ULS.sendTraceTag(4310803,306,10,"Exception caught in ResourceTimingLogger.Flush: {0}",e)}},r.logData=function(e,t,n){void 0===n&&(n=!1),h.ULS.sendTraceTag(4310804,306,50,Ut(e,t))},r.getAppResourceTimingMetrics=function(){return this._appStaticResourceManager.getAggregatedResourceMetrics()},r.recordAppResourceTimingMetricsToKpi=function(){this._appStaticResourceManager.recordStaticResourcesMetricsInKpi()},r.addTask=function(){var e=this;this._taskManager&&this.timerInterval>0&&(this._task=new u.a(3,2,1e3*this.timerInterval,(function(){e.flush()}),5),this._taskManager.addTask(this._task),this._isTaskSet=!0)},r.deleteTask=function(){this._isTaskSet&&(this._taskManager.deleteTask(this._task),this._task=null,this._isTaskSet=!1)},t=e,(n=[{key:"browserSupportsPerformanceTimeline",get:function(){try{return!(void 0===this._performance||null===this._performance||void 0===this._performance.getEntriesByType||null===this._performance.getEntriesByType)}catch(e){return h.ULS.sendTraceTag(50873240,306,10,"Exception caught in ResourceTimingLogger.BrowserSupportsPerformanceTimeline: {0}",e),!1}}},{key:"defaultBehavior",get:function(){return this._defaultBehavior}},{key:"isActive",get:function(){return this._isActive}},{key:"timerInterval",get:function(){return this._timerInterval}}])&&Kt(t.prototype,n),i&&Kt(t,i),e}();function Jt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}zt.entriesAvailableEventKey="EntriesAvailable",Object(i.a)(zt,"ResourceTimingLogger",null,[114,127]);var Xt=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){this._container.resolve("Common.NetworkTiming.IResourceTimingLogger"),jt.instance.run()},r.dispose=function(){},r.configure=function(e){this._container=e;var t=null;if(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ResourceLoggerFilterDomainsIsEnabled"))try{t=s.AFrameworkApplication.appSettingsManager.getListAppSetting("ResourceLoggerDomainAllowList")}catch(e){h.ULS.sendTraceTag(51652512,306,50,"ResourceTimingPackage - failed to get logger domain allowlist")}var n=[];n.push(Dt.a.getHostname(st.a.staticContentHost).toLowerCase()),n.push(Dt.a.getHostname(st.a.sharedStaticContentHost).toLowerCase());var i=s.AFrameworkApplication.appSettingsManager.getIntAppSetting("AppStaticResourceMonitorCacheThresholdInMs",100);e.register(114,"Common.NetworkTiming.IResourceTimingLogger").singleInstance().usingFactory((function(){return new zt(s.AFrameworkApplication.theTaskManager,window.performance,t,n,i)}))},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.ResourceTiming"}}])&&Jt(t.prototype,n),i&&Jt(t,i),e}();Object(i.a)(Xt,"ResourceTimingPackage",null,[14,15]);var Qt,Zt=function(){function e(){this._activeEventReceivers={}}var t=e.prototype;return t.activateEventReceiver=function(e){this._activeEventReceivers[e.id.toString()]=e},t.notifyAndDeactivateActiveEventReceivers=function(e){var t=this._activeEventReceivers;for(var n in t){({key:n,value:t[n]}).value.notify(e,!1)}this._activeEventReceivers={}},t.queryForResult=function(e,t){return t&&this.activateEventReceiver(t),this.onResultRequested(e,t)},t.emitDeferredResultToWaitingReceivers=function(e){this.notifyAndDeactivateActiveEventReceivers(e)},t.emitAvailableResultToReceiver=function(e,t){e.notify(t,!0)},e}();function Yt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Zt,"AEventEmitter",null,[126]),function(e){e[e.notStarted=0]="notStarted",e[e.waiting=1]="waiting",e[e.shouldRetry=2]="shouldRetry",e[e.complete=3]="complete"}(Qt||(Qt={})),Object(i.b)("EventResultState",Qt);var $t=function(){function e(){this._state=0}var t,n,i;return t=e,(n=[{key:"state",get:function(){return this._state},set:function(e){var t;h.ULS.sendTraceTag(5849616,202,50,"Changing event result state. {0}",((t={}).OldState=Qt[this._state],t.NewState=Qt[e],t),"ResultType",this.getResultLogString()),this._state=e}}])&&Yt(t.prototype,n),i&&Yt(t,i),e}();function en(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)($t,"AEventResult",null,[174]);var tn=function(e){var t,n,i,r,a;function o(){var t;return(t=e.call(this)||this)._personalFileStorageUrl=null,t._storageServiceDisplayName=null,t.state=0,t._instantiatingPersonalStorage=!1,t._invalidResponse=!1,t}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,o.prototype.getResultLogString=function(){return"GetMoreInfo Result"},i=o,(r=[{key:"personalFileStorageUrl",get:function(){return this._personalFileStorageUrl}},{key:"storageServiceDisplayName",get:function(){return this._storageServiceDisplayName}},{key:"instantiatingPersonalStorage",get:function(){return this._instantiatingPersonalStorage}},{key:"invalidResponse",get:function(){return this._invalidResponse}}])&&en(i.prototype,r),a&&en(i,a),o}($t);Object(i.a)(tn,"GetMoreInfoResult",$t,[175,174]);var nn=n(53),rn=n(428),an=n(424),on=n(101);function sn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ln=function(){function e(e,t,n,i,r,a,o,s){this._actionManager=e,this._clientRequestManager=t,this._appFrame=n,this._appType=i,this._taskManager=r,this._getCurrentTime=a,this._handlerUrlPrefix=o,this._supportsGetMoreInfoForPersonalStorage=s}var t,n,i,a=e.prototype;return a.registerCommonActions=function(){this.newAndOpenActionManager.addAction(p.a.openUrlInNewTab,de.a.frame,Object(r.d)(this,this.openUrlInNewTab,"openUrlInNewTab")),this.newAndOpenActionManager.addAction(p.a.openDocumentUrl,de.a.frame,Object(r.d)(this,this.openDocumentUrl,"openDocumentUrl")),s.AFrameworkApplication.documentLoadedTime?this.logNewAndOpenPerfStats():this.newAndOpenActionManager.addActionWithFlags(p.a.documentLoaded,de.a.frame,Object(r.d)(this,this.documentLoaded,"documentLoaded"),96)},a.openUrlInNewTab=function(e,t,n,i,r){var a=r;if(r&&a.MenuItemId){var o;h.ULS.sendTraceTag(5849678,202,50,"Opening new tab {0}",((o={}).Id=a.SourceControlId,o.AppType=an.a[this.newAndOpenOfficeAppType],o));var s=a.MenuItemId.toString();tt.a.safelyOpenWindow(s,"_blank",void 0,void 0,"NewAndOpenCommonHelpers:OpenUrlInNewTab")}return 32},a.openDocumentUrl=function(e,t,n,i,r){var a=r;if(r&&a.MenuItemId){var o=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WacInTabOpenMRUIsEnabledForUiHost"),l=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UiHostSupportsDocRebootFeatures");if(h.ULS.sendTraceTag(592237459,202,50,"[InTabOpenMRUIsEnabledForUiEmbed: {0}][UiEmbedSupportsDocReboot: {1}]",o,l),o&&l){var c;h.ULS.sendTraceTag(592237458,202,50,"Opening new tab {0}",((c={}).Id=a.SourceControlId,c.AppType=an.a[this.newAndOpenOfficeAppType],c));var u=a.MenuItemId.toString(),p={};p[nn.a.rebootMode]="1",p[nn.a.documentUrl]=u,p[nn.a.reason]=rn.a.open,h.ULS.sendTraceTag(592237460,202,50,"Send PostMessage to the Ui host to reboot a document"),s.AFrameworkApplication.get_hostPostmessengerFuture().execute((function(e){e.sendMessage(d.a.documentRefresh,p)}))}else this.openUrlInNewTab(e,t,n,i,r)}return 32},a.documentLoaded=function(e,t,n,i,r){return this.logNewAndOpenPerfStats(),32},a.logRequest=function(e,t,n){if(void 0===n&&(n=""),t&&t.invokedTime){var i,r=et[t.status],a=t.invokedTime.getTime(),o=this.getCurrentTime()-a;h.ULS.sendTraceTag(5849679,202,50,"Making request to the WAC server {0}",((i={}).Caller=e,i.RequestStatus=r,i.ElapsedMs=o,i.StartTime=a,i.Notes=n,i))}else{var s;h.ULS.sendTraceTag(5849680,202,50,"Attempted to make a request to the WAC server with null request item {0}",((s={}).Caller=e,s))}},a.logNewAndOpenPerfStats=function(){var e=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("QPGVCI"),t=Dt.a.getParameterValue(document.URL,"wdNewAndOpenCt",e);if(t){var n=parseInt(t),i=Dt.a.getParameterValue(document.URL,"wdPreviousSession",e),r=Dt.a.getParameterValue(document.URL,"wdPreviousCorrelation",e),a=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("NAOPLP");if(s.AFrameworkApplication.documentLoadedTime){var o,l,c=s.AFrameworkApplication.documentLoadedTime.getTime();if(!n||n>c)h.ULS.sendTraceTag(5849682,202,15,"NewAndOpenCommonHelpers.LogNewAndOpenPerfStats: Invalid timestamp {0}",((o={}).ClickTimestamp=n,o.DocumentLoadedTime=c,o.SessionId=i,o.Correlation=r,o));else h.ULS.sendTraceTag(5849683,202,a?15:50,"NewAndOpenCommonHelpers.LogNewAndOpenPerfStats: Click-to-load perf {0}",((l={}).ClickToLoadTime=c-n,l.ClickTimestamp=n,l.SessionId=i,l.Correlation=r,l))}else{var u;h.ULS.sendTraceTag(5849681,202,a?15:50,"NewAndOpenCommonHelpers.LogNewAndOpenPerfStats: Not logging because document loaded time has not been set {0}",((u={}).ClickTimestamp=n,u.SessionId=i,u.Correlation=r,u))}}},e.getAnInstanceWithResolvedDependencies=function(){return new e(new on.a((function(){return s.AFrameworkApplication.theActionManager})),new on.a((function(){return s.AFrameworkApplication.theClientRequestManager})),new on.a((function(){return s.AFrameworkApplication.activeFrame})),new on.a((function(){return s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType})),new on.a((function(){return s.AFrameworkApplication.theTaskManager})),(function(){return(new Date).getTime()}),new on.a((function(){return s.AFrameworkApplication.activeFrame.applicationInstance.newAndOpenHandlerUrlPrefix})),new on.a((function(){return s.AFrameworkApplication.supportsGetMoreInfoForPersonalStorage})))},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getAnInstanceWithResolvedDependencies())}}],(n=[{key:"newAndOpenActionManager",get:function(){return this._actionManager.value}},{key:"newAndOpenClientRequestManager",get:function(){return this._clientRequestManager.value}},{key:"newAndOpenAppFrame",get:function(){return this._appFrame.value}},{key:"newAndOpenOfficeAppType",get:function(){return this._appType.value}},{key:"newAndOpenTaskManager",get:function(){return this._taskManager.value}},{key:"getCurrentTime",get:function(){return this._getCurrentTime}},{key:"newAndOpenHandlerUrlPrefix",get:function(){return this._handlerUrlPrefix.value}},{key:"supportsGetMoreInfoForPersonalStorage",get:function(){return this._supportsGetMoreInfoForPersonalStorage.value}}])&&sn(t.prototype,n),i&&sn(t,i),e}();function cn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ln._instance=null,Object(i.a)(ln,"NewAndOpenCommonHelpers",null,[125]);var un=function(){function e(e,t,n){this._task=null,this._serverRetryIntervalsInMsIntList=null,this._retryIndex=0,this._serverRetryIntervalsInMsString=e,this._taskManager=t,this._descriptionString=n}var t,n,i,r=e.prototype;return r.advanceRetryIndex=function(){this._retryIndex=this.retryIndex+1},r.resetRetryState=function(e){this._task&&(this._taskManager.deleteTask(this._task),this._task=null),e&&(this._retryIndex=0)},r.startNextRetryTask=function(e){var t,n=this.timeUntilNextRetryInMs,i=n>=0;i?(this.advanceRetryIndex(),this.resetRetryState(!1),this._task=new u.a(4,1,n,e,107),this._taskManager.addTask(this._task)):(this.resetRetryState(!0),h.ULS.sendTraceTag(5849676,202,50,"Retries exhausted {0}",((t={}).Action=this._descriptionString,t)));return i},t=e,(n=[{key:"retryIndex",get:function(){return this._retryIndex}},{key:"timeUntilNextRetryInMs",get:function(){return this.retryIndex>=this.serverRetryIntervalsInMsIntList.length?-1:this.serverRetryIntervalsInMsIntList[this.retryIndex]}},{key:"serverRetryIntervalsInMsIntList",get:function(){if(!this._serverRetryIntervalsInMsIntList){var e=(this._serverRetryIntervalsInMsString.value||"0").split(",");this._serverRetryIntervalsInMsIntList=[];for(var t=0;t<e.length;t++){var n,i=parseInt(e[t]);isNaN(i)?h.ULS.sendTraceTag(5849677,202,15,"Retry interval list contains non-number element {0}",((n={}).Action=this._descriptionString,n.Entry=e[t],n)):Array.add(this._serverRetryIntervalsInMsIntList,i)}}return this._serverRetryIntervalsInMsIntList}}])&&cn(t.prototype,n),i&&cn(t,i),e}();function dn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(un,"RetryHelper",null,[]);var pn=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this)._newAndOpenCommonHelpers=t,i._retryHelper=new un(n,i.moreInfoNewAndOpenCommonHelpers.newAndOpenTaskManager,"GetMoreInfo"),i._result=new tn,i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r,a,o,l=i.prototype;return l.makeGetMoreInfoRequestOpenDocumentTrigger=function(){this.makeGetMoreInfoRequestInternal("Document opened")},l.createMakeGetMoreInfoRequestRetryTask=function(e){var t=this;return function(n){t.makeGetMoreInfoRequestInternal(e,!0)}},l.onResultRequested=function(e,t){var n,i;(void 0===t&&(t=null),h.ULS.sendTraceTag(5849617,202,50,"Attempting to get GetMoreInfo properties {0}",((n={}).Trigger=e,n)),3===this._result.state)?(t&&this.emitAvailableResultToReceiver(t,this._result),h.ULS.sendTraceTag(5849619,202,50,"GetMoreInfo already populated. {0}",((i={}).Trigger=e,i))):this.makeGetMoreInfoRequestInternal(e);return this._result},l.makeGetMoreInfoRequestInternal=function(e,t){var n;if(void 0===t&&(t=!1),this._retryHelper.resetRetryState(!t),1!==this._result.state){h.ULS.sendTraceTag(5849621,202,50,"Making GetMoreInfo request {0}",((n={}).Trigger=e,n.RetryIndex=this._retryHelper.retryIndex,n)),this._result.state=1;var r=String.format("{0}GetMoreInfoHandler.ashx?{1}",this.moreInfoNewAndOpenCommonHelpers.newAndOpenHandlerUrlPrefix,s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion);this.moreInfoNewAndOpenCommonHelpers.newAndOpenClientRequestManager.addRequestWithHeaderForwarding(r,1,null,null,[i._personalFileStorageUrlHeaderName,i._storageServiceDisplayNameHeaderName],!1,4,this.createGetMoreInfoFromServerSuccessCallback(e),this.createGetMoreInfoFromServerFailureCallback(e),null)}else{var a;h.ULS.sendTraceTag(5849620,202,50,"Not starting new request, because one is already in progress {0}",((a={}).Trigger=e,a.RetryIndex=this._retryHelper.retryIndex,a))}},l.createGetMoreInfoFromServerSuccessCallback=function(e){var t=this;return function(e){var n=!1,r=!1,a=!1,o=null;if(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("GetMoreInfoDataFromResponseBody"))if(e.data.responseData)if(L.d(e.data.responseData,Object(z.a)((function(){return o}),(function(e){return o=e})))){var l=o;l?(a=!0,t._result._storageServiceDisplayName=l.StorageServiceDisplayName,t._result._personalFileStorageUrl=i.isValidStorageHostUrl(l.PersonalFileStorageUrl)?l.PersonalFileStorageUrl:"",n=""===t._result.personalFileStorageUrl&&""!==t._result.storageServiceDisplayName):h.ULS.sendTraceTag(25298113,202,15,"Response body could not be casted into a GetMoreInfoResponseData type. Will fallback to reading the data from the headers")}else h.ULS.sendTraceTag(25298112,202,15,"Failed to deserialize GetMoreInfo response body. Will fallback to reading the data from the headers");else h.ULS.sendTraceTag(25298083,202,15,"Could not find GetMoreInfo data on the response body. Will fallback to reading the data from the headers");if(!a){var c=e.data.responseHeaders;if(c){t._result._storageServiceDisplayName=(c[i._storageServiceDisplayNameHeaderName]||"").toString();var u=(c[i._personalFileStorageUrlHeaderName]||"").toString();t._result._personalFileStorageUrl=i.isValidStorageHostUrl(u)?u:"",n=""===u&&""!==t._result.storageServiceDisplayName}else h.ULS.sendTraceTag(5849622,202,50,"Null response headers received."),r=!0}var d=String.format("Success at RetryIndex: {0}, InvalidResponse: {1}, InstantiatingPersonalStorage: {2}, InfoFoundInResponseBody: {3}",t._retryHelper.retryIndex,r,n,a);t.moreInfoNewAndOpenCommonHelpers.logRequest("GetMoreInfoActor.CreateGetMoreInfoFromServerSuccessCallback",e.data,d),t.setAndEmitResultState(3,n,r)}},l.createGetMoreInfoFromServerFailureCallback=function(e){var t=this;return function(n){t.moreInfoNewAndOpenCommonHelpers.logRequest("GetMoreInfoActor.CreateGetMoreInfoFromServerFailureCallback",n.data,"Failure"),t.setAndEmitResultState(2),t._retryHelper.startNextRetryTask(t.createMakeGetMoreInfoRequestRetryTask(e))}},l.setAndEmitResultState=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),this._result.state=e,this._result._instantiatingPersonalStorage=t,this._result._invalidResponse=n,this.emitDeferredResultToWaitingReceivers(this._result)},i.getAnInstanceWithResolvedDependencies=function(){return new i(new on.a((function(){return ln.instance})),new on.a((function(){return s.AFrameworkApplication.getMoreInfoRetryIntervalsInMs})))},i.isValidStorageHostUrl=function(e){return e?!!We.a.toLower(e).startsWith("https://")||(h.ULS.sendTraceTag(5849625,202,10,"StorageUrl has invalid scheme."),!1):(h.ULS.sendTraceTag(5849624,202,50,"Attempted to check an empty url for validity as a StorageHostUrl."),!1)},r=i,o=[{key:"instance",get:function(){return i._instance||(i._instance=i.getAnInstanceWithResolvedDependencies())}}],(a=[{key:"moreInfoNewAndOpenCommonHelpers",get:function(){return this._newAndOpenCommonHelpers.value}}])&&dn(r.prototype,a),o&&dn(r,o),i}(Zt);function hn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}pn._personalFileStorageUrlHeaderName="PersonalFileStorageUrl",pn._storageServiceDisplayNameHeaderName="StorageServiceDisplayName",pn._instance=null,Object(i.a)(pn,"GetMoreInfoActor",Zt,[]);var gn=function(){function e(e,t,n,i,r){this._inactivityCheckInterval=6e4,this.inactiveActionId="inactive",this.activeActionId="active",this._isActive=!0,this._taskManager=e,this._getLatestActivityTime=t,this._getCurrentTime=n,this._timeUntilInactiveInMs=i,this._eventSource=new a.a,r&&this.startInactiveLoop(),this._lastActivityTime=this.getLatestActivityTime()}var t,n,i,o=e.prototype;return o.addBackFromInactiveAction=function(e){this._eventSource.addHandler(this.activeActionId,e)},o.addOnInactiveAction=function(e){this._eventSource.addHandler(this.inactiveActionId,e)},o.startInactiveLoop=function(){var e=new u.a(4,2,this._inactivityCheckInterval,Object(r.d)(this,this.inactiveLoop,"inactiveLoop"),108);this.inactivityTaskManager.addTask(e)},o.inactiveLoop=function(e){var t,n=this.getLatestActivityTime(),i=this.getCurrentTime()-n;i>this.timeUntilInactiveInMs&&this._isActive&&(h.ULS.sendTraceTag(5849626,202,50,"User went inactive {0}",((t={}).TimeSinceLastActive=i,t)),this._isActive=!1,this._eventSource.raiseEvent(this.inactiveActionId));n-this._lastActivityTime>this.timeUntilInactiveInMs&&(this._isActive=!0,this._eventSource.raiseEvent(this.activeActionId)),this._lastActivityTime=n},e.getAnInstanceWithResolvedDependencies=function(){return new e(new on.a((function(){return b.a.instance})),(function(){return s.AFrameworkApplication.latestActivityTime.getTime()}),(function(){return(new Date).getTime()}),new on.a((function(){return s.AFrameworkApplication.timeUntilInactiveInMs})),!0)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getAnInstanceWithResolvedDependencies())}}],(n=[{key:"inactivityTaskManager",get:function(){return this._taskManager.value}},{key:"getLatestActivityTime",get:function(){return this._getLatestActivityTime}},{key:"getCurrentTime",get:function(){return this._getCurrentTime}},{key:"timeUntilInactiveInMs",get:function(){return this._timeUntilInactiveInMs.value}}])&&hn(t.prototype,n),i&&hn(t,i),e}();gn._instance=null,Object(i.a)(gn,"InactivityManager",null,[]);var mn=function(e){if(!e)return null;var t;try{t=L.b(e)}catch(e){t=null,h.ULS.sendTraceTag(578352835,202,10,"MruActor.TryDeserializeMruV2Response: SecureDeserialize Exception: {0}",e)}return t},fn=function(e,t){var n=null,i=e.service_info;i?n=i.friendly_service_name:h.ULS.sendTraceTag(578352836,202,15,"empty friendly service name");var r=e.display_path;if(!r)return n;for(var a=0;a<r.length;a++){var o=r[a];o&&(n?n+=String.format("{0}{1}",t?" \xab ":" \u200f\xbb ",o):n=o)}return n};function vn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Sn=function(e){var t,n,i,r,a;function o(){var t;return(t=e.call(this)||this)._mruEntries=null,t._mruPlaces=null,t._timestampOfLastUpdate=0,t.state=0,t._invalidResponse=!1,t}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,o.prototype.getResultLogString=function(){return"MruActor Result"},i=o,(r=[{key:"mruEntries",get:function(){return this._mruEntries}},{key:"mruPlaces",get:function(){return this._mruPlaces}},{key:"timestampOfLastUpdate",get:function(){return this._timestampOfLastUpdate}},{key:"invalidResponse",get:function(){return this._invalidResponse}}])&&vn(i.prototype,r),a&&vn(i,a),o}($t);Object(i.a)(Sn,"MruResult",$t,[173,174]);var _n=function(){this.documentUrl=null,this.folderName=null,this.documentName=null,this.documentExt=null,this.app=null,this.mruItemId=null};Object(i.a)(_n,"WriteOptions",null,[]);var yn=n(197);function bn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var An=function(e){var t,n;function i(t,n,i,r,a,o,s,l,c){var u;return(u=e.call(this)||this).renameMruEntryAction="RenameMruEntry",u.updateMruEntryAction="UpdateMruEntry",u._newAndOpenCommonHelpers=t,u._localeName=n,u._readRetryHelper=new un(i,u.openMenuNewAndOpenCommonHelpers.newAndOpenTaskManager,"Read"),u._writeRetryHelper=new un(r,u.openMenuNewAndOpenCommonHelpers.newAndOpenTaskManager,"Write"),u._readPlacesFromMru=a,u._writeFileIdInHeader=o,u._writeHeaders={},u._mruResult=new Sn,u._writeToMruV2=s,u._getClientUrl=l,u._mruItemId="",u._docPropertiesProvider=c,u}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a,o,c,u=i.prototype;return u.registerWriteMruActions=function(){this.openMenuNewAndOpenCommonHelpers.newAndOpenActionManager.addAction(p.a.renameMostRecentlyUsedFileEntry,de.a.frame,Object(r.d)(this,this.renameMruEntry,"renameMruEntry"))},u.renameMruEntry=function(e,t,n,r,a){var o;if(this._writeToMruV2.value)return this.writeToMruV2Internal("Rename");var s,l,c,u=a;return u?u.newDocumentDAVUrl?u.newFileName?u.currentDocumentDAVUrl?(this.writeHeaders[i.currentDocumentDAVUrlHeaderName]=this.writeHeaders[i.currentDocumentDAVUrlHeaderName]||We.a.urlKeyValueEncode(u.currentDocumentDAVUrl),this.writeHeaders[i.newDocumentDAVUrlHeaderName]=We.a.urlKeyValueEncode(u.newDocumentDAVUrl),this.writeHeaders[i.newFileNameHeaderName]=We.a.urlKeyValueEncode(u.newFileName),h.ULS.sendTraceTag(5849669,202,50,"Starting rename of MRU entry {0}",((o={}).Trigger="Rename",o)),this.writeToMruInternal("Rename",this.renameMruEntryAction)):(h.ULS.sendTraceTag(5849668,202,15,"Failure to rename MRU entry {0}",((c={}).Error="Null CurrentDocumentDAVUrl",c)),8):(h.ULS.sendTraceTag(5849667,202,15,"Failure to rename MRU entry {0}",((l={}).Error="Null NewFileName",l)),8):(h.ULS.sendTraceTag(5849666,202,15,"Failure to rename MRU entry {0}",((s={}).Error="Null NewDocumentDAVUrl",s)),8):32},u.makeUpdateMruRequestOpenTrigger=function(){this.makeUpdateMruRequestInternal("File Opened")},u.makeUpdateMruRequestInactivityTrigger=function(){this.makeUpdateMruRequestInternal("Inactivity")},u.makeUpdateMruRequestBackFromInactivityTrigger=function(){this.makeUpdateMruRequestInternal("Back from Inactivity")},u.makeUpdateMruRequestInternal=function(e){var t;h.ULS.sendTraceTag(5849670,202,50,"Starting update of MRU entry {0}",((t={}).Trigger=e,t)),this._writeToMruV2.value?this.writeToMruV2Internal(e):this.writeToMruInternal(e,this.updateMruEntryAction)},u.getFileExtension=function(e){var t=We.a.getFileExtension(e);return t&&t.startsWith(".")&&(t=t.substring(1,t.length)),t},u.getAppName=function(){switch(this.openMenuNewAndOpenCommonHelpers.newAndOpenOfficeAppType){case 3:return"Word";case 1:return"Excel";case 2:return"PowerPoint";case 5:return"Visio";case 4:return"OneNote";default:return"Unknown"}},u.getV2WriteBody=function(){var e=this._getClientUrl();if(!e)return null;var t=new _n;t.documentUrl=encodeURI(e),t.mruItemId=this._mruItemId,t.app=this.getAppName();var n=this._docPropertiesProvider();if(n){t.folderName=n.breadcrumbFolderName;var i=n.breadcrumbDocName;t.documentName=We.a.getFileNameWithoutExtension(i),t.documentExt=this.getFileExtension(i)}return JSON.stringify(t)},u.writeToMruV2Internal=function(e,t){if(void 0===t&&(t=!1),4===this.openMenuNewAndOpenCommonHelpers.newAndOpenOfficeAppType&&!s.AFrameworkApplication.documentIsFolder)return 2;var n=this.createMap();n&&(n.set("Trigger",e),n.set("IsRetry",t?"true":"false"),n.set("MruIdSent",this._mruItemId?"true":"false")),l.Health.instance.recordKpiUsage("WriteMru",0,"smartfio",n);var i=this.getV2WriteBody();if(!i)return l.Health.instance.recordKpiFailure("WriteMru","MissingDocumentUrl",!1,!1,null),2;this._writeRetryHelper.resetRetryState(!t);var a=String.format("{0}MruV2ServiceHandler.ashx?rs={1}",this.openMenuNewAndOpenCommonHelpers.newAndOpenHandlerUrlPrefix,this.localeName);return this._writeFileIdInHeader?this.writeHeaders["X-FileId"]=s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion:a+=String.format("&{0}",s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),s.AFrameworkApplication.sessionStartInfoSettings&&(this.writeHeaders["X-Office-AudienceGroup"]=Object(k.a)(String,s.AFrameworkApplication.sessionStartInfoSettings.AudienceGroup)||""),this.openMenuNewAndOpenCommonHelpers.newAndOpenClientRequestManager.addRequest(a,2,i,this.writeHeaders,!0,4,Object(r.d)(this,this.writeMruV2EntryOnServerSuccessCallback,"writeMruV2EntryOnServerSuccessCallback"),Object(r.d)(this,this.createWriteMruV2EntryOnServerFailureCallback,"createWriteMruV2EntryOnServerFailureCallback"),null,void 0,void 0,void 0,void 0,"4")},u.writeToMruInternal=function(e,t,n){var a,o;if(void 0===n&&(n=!1),4===this.openMenuNewAndOpenCommonHelpers.newAndOpenOfficeAppType&&!s.AFrameworkApplication.documentIsFolder)return 2;this.writeHeaders[i.newDocumentDAVUrlHeaderName]&&this.writeHeaders[i.currentDocumentDAVUrlHeaderName]!==this.writeHeaders[i.newDocumentDAVUrlHeaderName]?o=this.renameMruEntryAction:(o=this.updateMruEntryAction,delete this.writeHeaders[i.newDocumentDAVUrlHeaderName]),h.ULS.sendTraceTag(5849673,202,50,"Writing to MRU {0}",((a={}).Trigger=e,a.IntendedActionType=t,a.ActualActionType=o,a)),this._writeRetryHelper.resetRetryState(!n);var l=String.format(this.openMenuNewAndOpenCommonHelpers.newAndOpenHandlerUrlPrefix+"MruServiceHandler.ashx?action={0}&app={1}&lc={2}",o,this.openMenuNewAndOpenCommonHelpers.newAndOpenOfficeAppType,this.localeName);return this._writeFileIdInHeader?this.writeHeaders["X-FileId"]=s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion:l+=String.format("&{0}",s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),this.openMenuNewAndOpenCommonHelpers.newAndOpenClientRequestManager.addRequest(l,2,null,this.writeHeaders,!0,4,Object(r.d)(this,this.writeMruEntryOnServerSuccessCallback,"writeMruEntryOnServerSuccessCallback"),this.createWriteMruEntryOnServerFailureCallback(t),null,void 0,void 0,void 0,void 0,"4")},u.writeMruV2EntryOnServerSuccessCallback=function(e){this.handleMruV2WriteSuccess(e.data)},u.writeMruEntryOnServerSuccessCallback=function(e){this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.WriteMruEntryOnServerSuccessCallback",e.data,"Success"),this._writeRetryHelper.resetRetryState(!0);var t=(e.data.request.get_headers()[i.newDocumentDAVUrlHeaderName]||"").toString();""!==t&&(this.writeHeaders[i.currentDocumentDAVUrlHeaderName]=t)},u.handleMruV2WriteSuccess=function(e){this._writeRetryHelper.resetRetryState(!0);var t=mn(e.responseData);t&&t.diagnostics_data&&(this._mruItemId=t.diagnostics_data.mru_id);var n=+e.completedTime-+e.invokedTime,i=this.createMap();i&&i.set("RequestDuration",n.toString()),l.Health.instance.recordKpiSuccess("WriteMru",Object.assign(new N.a,{extendedProperties:i}))},u.createWriteMruV2EntryOnServerFailureCallback=function(e){if(e.data.httpStatus!==E.a.created_201){var t=e.data.httpStatus===E.a.preconditionFailed_412,n=this.createMap();n&&(n.set("StatusCode",e.data.httpStatus.toString()),t||this.addDiagnosticDataToKpi(e.data,n)),l.Health.instance.recordKpiFailure("WriteMru",String.format("RequestFailed_{0}",e.data.httpStatus),t,!1,Object.assign(new N.a,{extendedProperties:n})),e.data.httpStatus!==E.a.forbidden_403&&this._writeRetryHelper.startNextRetryTask(this.createV2WriteRetryTask())}else this.handleMruV2WriteSuccess(e.data)},u.createV2WriteRetryTask=function(){var e=this;return function(t){e.writeToMruV2Internal("Retry",!0)}},u.createWriteMruEntryOnServerFailureCallback=function(e){var t=this;return function(n){t.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.WriteMruEntryOnServerFailureCallback",n.data,"Failure"),n.data.httpStatus!==E.a.forbidden_403&&t._writeRetryHelper.startNextRetryTask(t.createWriteRetryTask(e))}},u.createWriteRetryTask=function(e){var t=this;return function(n){t.writeToMruInternal("Retry",e,!0)}},u.getMruFromServerTask=function(e){this.makeGetMruRequestInternal("Polling")},u.getMruFromServerRetryTask=function(e){this.makeGetMruRequestInternal("Retry",!0)},u.makeGetMruRequestOpenTrigger=function(){this.makeGetMruRequestInternal("Open")},u.makeGetMruRequestActivityTrigger=function(){this.makeGetMruRequestInternal("Activity")},u.makeGetMruRequestInternal=function(e,t){var n;void 0===t&&(t=!1),h.ULS.sendTraceTag(5849674,202,50,"Making GetMru request {0}",((n={}).Trigger=e,n));var i=this.createMap();i&&i.set("Trigger",e),l.Health.instance.recordKpiUsage("GetMru",0,"smartfio",i),this._readRetryHelper.resetRetryState(!t),this.createGetMruServerRequest(Object(r.d)(this,this.getMruV2FromServerSuccessCallback,"getMruV2FromServerSuccessCallback"),Object(r.d)(this,this.getMruFromServerFailureCallback,"getMruFromServerFailureCallback"))},u.addDiagnosticDataToKpi=function(e,t){if(e&&e.responseHeaders){var n=e.responseHeaders["X-CorrelationId"];n&&t.set("ServerCorrelationId",n)}},u.createMap=function(){try{return new Map}catch(e){return null}},u.logGetMruKpiSuccess=function(e){if(e){var t=+e.completedTime-+e.invokedTime,n=this.createMap();n&&n.set("RequestDuration",t.toString()),l.Health.instance.recordKpiSuccess("GetMru",Object.assign(new N.a,{extendedProperties:n}))}},u.getMruV2FromServerSuccessCallback=function(e){var t="",n=null,i=null,r=mn(e.data.responseData);if(r&&(n=r.places?r.places.items:[],(i=function(e){if(!e)return[];if(!e.documents)return h.ULS.sendTraceTag(578352838,202,15,"missing documents object"),[];if(!e.documents.items)return h.ULS.sendTraceTag(578352839,202,15,"missing items object"),[];for(var t,n,i=e.documents.items,r=new te.a,a=0;a<i.length;a++){var o=i[a],l=o.web_url;if(!l){if(h.ULS.sendTraceTag(578320064,202,15,"Empty web_url"),!o.url){h.ULS.sendTraceTag(578140248,202,15,"Empty url");continue}l=String.format("{0}?web=1",o.url)}var c={};c.DocumentUrl=l,c.MruId=o.mru_id,c.FileName=(n=void 0,(n=(t=o).title)?(t.extension&&(n=String.format("{0}.{1}",n,t.extension)),n):(h.ULS.sendTraceTag(578352837,202,15,"empty file title"),"")),c.IsPinned=o.is_pinned,c.Path=fn(o,s.AFrameworkApplication.isRtl),r.add(c)}return r.toArray()}(r))&&(t=L.c(i))),s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactFileMenuUxEnabled&&yt.appChromeAlreadyLoaded()&&appChrome.api.dispatch(appChrome.actions.setFileMenuMRUJson(t,!0)),this._readRetryHelper.resetRetryState(!0),i||n)this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.GetMruV2FromServerSuccessCallback",e.data,"Success"),this.updateMruResultState(3,i,n),this.logGetMruKpiSuccess(e.data);else{this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.GetMruV2FromServerSuccessCallback",e.data,"Failure: Invalid JSON");var a=this.createMap();a&&this.addDiagnosticDataToKpi(e.data,a),l.Health.instance.recordKpiFailure("GetMru","JsonParseFailed",!1,!1,Object.assign(new N.a,{extendedProperties:a})),this.updateMruResultState(3,null,null,!0)}this.emitDeferredResultToWaitingReceivers(this._mruResult)},u.getMruFromServerFailureCallback=function(e){var t=e.data.httpStatus===E.a.preconditionFailed_412,n=this.createMap();n&&(n.set("StatusCode",e.data.httpStatus.toString()),t||this.addDiagnosticDataToKpi(e.data,n)),l.Health.instance.recordKpiFailure("GetMru",String.format("RequestFailed_{0}",e.data.httpStatus),t,!1,Object.assign(new N.a,{extendedProperties:n})),this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.GetMruFromServerFailureCallback",e.data,"Failure"),this.updateMruResultState(2),this._readRetryHelper.startNextRetryTask(Object(r.d)(this,this.getMruFromServerRetryTask,"getMruFromServerRetryTask"))||this._readRetryHelper.resetRetryState(!0),this.emitDeferredResultToWaitingReceivers(this._mruResult),s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactFileMenuUxEnabled&&yt.appChromeAlreadyLoaded()&&appChrome.api.dispatch(appChrome.actions.setFileMenuMRUJson("",!1))},u.updateMruResultState=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=!1),3===this._mruResult.state&&3!==e||(this._mruResult._mruEntries=t,this._mruResult._mruPlaces=n,this._mruResult.state=e,this._mruResult._invalidResponse=i,this._mruResult._timestampOfLastUpdate=this.openMenuNewAndOpenCommonHelpers.getCurrentTime())},u.onResultRequested=function(e,t){var n;return h.ULS.sendTraceTag(6029918,202,50,"MRU result requested {0}",((n={}).Trigger=e,n.ResultState=this._mruResult.state,n)),t&&3===this._mruResult.state&&this.emitAvailableResultToReceiver(t,this._mruResult),this._mruResult},u.createGetMruServerRequest=function(e,t){var n;this.updateMruResultState(1);var i={};n=String.format(this.openMenuNewAndOpenCommonHelpers.newAndOpenHandlerUrlPrefix+"MruV2ServiceHandler.ashx?show={0}&apps={1}&rs={2}",10,this.getAppName(),this.localeName),this._readPlacesFromMru.value||(n+="&entity=docs"),s.AFrameworkApplication.sessionStartInfoSettings&&(i["X-Office-AudienceGroup"]=Object(k.a)(String,s.AFrameworkApplication.sessionStartInfoSettings.AudienceGroup)||""),this._writeFileIdInHeader?i["X-FileId"]=s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion:n+=String.format("&{0}",s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),this.openMenuNewAndOpenCommonHelpers.newAndOpenClientRequestManager.addRequest(n,1,null,i,!0,4,e,t,null)},u.tryDeserializeJson=function(e){var t;try{t=L.b(e)}catch(e){t=null,h.ULS.sendTraceTag(5849675,202,10,"MruActor.TryDeserializeJson: Exception thrown from JsonSerializer.SecureDeserialize Exception: {0}",e)}return t},i.getAnInstanceWithResolvedDependencies=function(){return new i(new on.a((function(){return ln.instance})),new on.a((function(){return yn.a.getCultureInfo(s.AFrameworkApplication.lcid).name})),new on.a((function(){return s.AFrameworkApplication.appSettingsManager.getStringAppSetting("MruServerReadRetryIntervalsInMs")})),new on.a((function(){return s.AFrameworkApplication.appSettingsManager.getStringAppSetting("MruServerWriteRetryIntervalsInMs")})),new on.a((function(){return s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled})),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("MruWriteFileIdInHeader"),new on.a((function(){return s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WriteToMruV2",!1)})),(function(){return s.AFrameworkApplication.activeFrame.applicationInstance.clientUrl}),(function(){return s.AFrameworkApplication.docPropertiesProvider}))},a=i,c=[{key:"instance",get:function(){return i._instance||(i._instance=i.getAnInstanceWithResolvedDependencies())}}],(o=[{key:"writeHeaders",get:function(){return this._writeHeaders}},{key:"openMenuNewAndOpenCommonHelpers",get:function(){return this._newAndOpenCommonHelpers.value}},{key:"localeName",get:function(){return this._localeName.value}}])&&bn(a.prototype,o),c&&bn(a,c),i}(Zt);function Cn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}An.currentDocumentDAVUrlHeaderName="CurrentDocumentDAVUrl",An.newDocumentDAVUrlHeaderName="NewDocumentDAVUrl",An.newFileNameHeaderName="NewFileName",An._instance=null,Object(i.a)(An,"MruActor",Zt,[]);var Tn=function(){function e(){this._container=null,this._readFromMruTask=null}var t,n,i,a=e.prototype;return a.configure=function(e){this._container=e,e.register(125,"Common.INewAndOpenCommonHelpers").singleInstance().usingFactory((function(){return ln.instance})),e.register(126,"Common.IEventEmitter<Common.IGetMoreInfoResult>").singleInstance().usingFactory((function(){return pn.instance})),e.register(126,"Common.IEventEmitter<Common.IMruResult>").singleInstance().usingFactory((function(){return An.instance}))},a.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){e.initOnFullAppSettingsReady()}))},a.initOnFullAppSettingsReady=function(){this._container.resolve("Common.INewAndOpenCommonHelpers"),this._container.resolve("Common.IEventEmitter<Common.IGetMoreInfoResult>"),this._container.resolve("Common.IEventEmitter<Common.IMruResult>");var e=!1;if(ln.instance.registerCommonActions(),s.AFrameworkApplication.newDocumentDestinationHost&&(e=!0),s.AFrameworkApplication.readFromMruIsEnabled&&(An.instance.makeGetMruRequestOpenTrigger(),s.AFrameworkApplication.mruPollingIntervalInMs>0&&this.addGetMruFromServerTask(),this.setupReadFromMruInactivityActions(),e=!0),s.AFrameworkApplication.supportsGetMoreInfoForPersonalStorage&&e&&pn.instance.makeGetMoreInfoRequestOpenDocumentTrigger(),s.AFrameworkApplication.updateMruIsEnabled){var t=An.instance;t.registerWriteMruActions(),t.makeUpdateMruRequestOpenTrigger(),this.setupWriteToMruInactivityActions()}},a.setupReadFromMruInactivityActions=function(){gn.instance.addBackFromInactiveAction(Object(r.d)(An.instance,An.instance.makeGetMruRequestActivityTrigger,"makeGetMruRequestActivityTrigger")),gn.instance.addBackFromInactiveAction(Object(r.d)(this,this.addGetMruFromServerTask,"addGetMruFromServerTask")),gn.instance.addOnInactiveAction(Object(r.d)(this,this.deleteGetMruFromServerTask,"deleteGetMruFromServerTask"))},a.setupWriteToMruInactivityActions=function(){gn.instance.addOnInactiveAction(Object(r.d)(An.instance,An.instance.makeUpdateMruRequestInactivityTrigger,"makeUpdateMruRequestInactivityTrigger")),gn.instance.addBackFromInactiveAction(Object(r.d)(An.instance,An.instance.makeUpdateMruRequestBackFromInactivityTrigger,"makeUpdateMruRequestBackFromInactivityTrigger"))},a.deleteGetMruFromServerTask=function(){b.a.instance.deleteTask(this.mruReadTask)},a.addGetMruFromServerTask=function(){b.a.instance.addTask(this.mruReadTask)},a.dispose=function(){},t=e,(n=[{key:"name",get:function(){return"Common.App.NewAndOpen.Core"}},{key:"mruReadTask",get:function(){return this._readFromMruTask||(this._readFromMruTask=new u.a(4,2,s.AFrameworkApplication.mruPollingIntervalInMs,Object(r.d)(An.instance,An.instance.getMruFromServerTask,"getMruFromServerTask"),109))}}])&&Cn(t.prototype,n),i&&Cn(t,i),e}();Object(i.a)(Tn,"CorePackageManager",null,[14,15,4]);var wn=function(){};Object(i.a)(wn,"ShellRenderData",null,[]);var In=function(e){if(!e)return"{NULL}";var t=e.length;if(t<=600)return e;var n=t-195;return e.substring(0,400)+"[...]"+e.substring(n,t)};function kn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Fn=function(){function e(t,n,i){this._o365ShellJsLoaded=!1,this._o365ShellCssLoaded=!1,this._shellDataJsonStr=null,this._shellDataObject=null,this._switcherDomElement=null,this._shellServiceInfoStringAsyncTcs=new A.a,this._clientRequestManager=t,this._officeAppType=i,this._webServiceBase=n.appSettings[e.webServiceBaseSettingName]||""}var t,n,i,a=e.prototype;return a.requestShellServiceInfo=function(){this._switcherDomElement=document.getElementById(e.switcherContainerId);var t={};t[e.handlerQuerySigatureHeaderName]=s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion,t["Content-Type"]="application/json; charset=utf-8",h.ULS.sendTraceTag(6612806,215,50,"Client is sending a request to get the code for the O365 switcher");var n=Dt.a.addOrReplaceParameterValue(this._webServiceBase+e.shellServiceProxyName,e.officeAppTypeParameterName,s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType.toString());this.clientRequestManager.addRequest(n,1,"",t,!0,2,Object(r.d)(this,this.onSuccessCallback,"onSuccessCallback"),Object(r.d)(this,this.onFailureCallback,"onFailureCallback"),null,void 0,void 0,void 0,void 0,"20")},a.logNavBarData=function(e){try{var t={};t.FlightName=e.FlightName,t.SessionID=e.SessionID,h.ULS.sendTraceTag(594883776,215,50,L.c(t))}catch(e){h.ULS.sendTraceTag(594883747,215,10,"Unable to log NavBarData")}},a.onSuccessCallback=function(e){var t,n=this;if(!(t=e.data.responseData)||!t.length)return this.showFailureMessage(),void h.ULS.sendTraceTag(6362369,215,10,"Response from O365ShellServiceProxy is null.");try{var i,r=L.a(t);if(s.AFrameworkApplication.activeFrame.applicationInstance.isReactSharedHeaderUxEnabled?(this._shellDataJsonStr=r.NavBarDataJson,h.ULS.sendTraceTag(41551899,215,50,"Skipping call to TryLoadResources for React Shared Header.")):this.tryLoadResources(r)&&(this._shellDataJsonStr=r.NavBarDataJson),!this._shellDataJsonStr)return h.ULS.sendTraceTag(9000737,215,15,"ShellData is null"),void this._shellServiceInfoStringAsyncTcs.setCanceled();if(!L.d(r.NavBarDataJson,Object(z.a)((function(){return n._shellDataObject}),(function(e){return n._shellDataObject=e}))))return h.ULS.sendTraceTag(7660113,215,10,"Failed to deserialize : {0}",((i={}).ShellData=In(this._shellDataJsonStr),i)),void this._shellServiceInfoStringAsyncTcs.setCanceled();this.logNavBarData(this._shellDataObject),this._shellServiceInfoStringAsyncTcs.setResult(this._shellDataObject)}catch(e){this.showFailureMessage(),h.ULS.sendTraceTag(6362370,215,10,"Unable to parse the response from O365ShellServiceProxy."),this._shellServiceInfoStringAsyncTcs.setCanceled()}},a.onFailureCallback=function(e){this._switcherDomElement&&this.showFailureMessage(),this._shellServiceInfoStringAsyncTcs.setCanceled(),h.ULS.sendTraceTag(7608091,215,10,"Call to O365ShellServiceProxy failed.")},a.tryLoadResources=function(e){if(!e.JsUrl||!e.JsUrl.length)return this.showFailureMessage(),h.ULS.sendTraceTag(6387854,215,10,"Empty or null JS URL."),!1;var t=Y.a.create(e.JsUrl);if(t.add_loadFinished(Object(r.d)(this,this.o365ShellJs_LoadFinished,"o365ShellJs_LoadFinished")),Z.a.enqueueResourceWithoutEnabling(t),!e.CssUrl||!e.CssUrl.length)return this.showFailureMessage(),h.ULS.sendTraceTag(6387855,215,10,"Empty or null CSS URL."),!1;var n=new ut(e.CssUrl);return n.add_loadFinished(Object(r.d)(this,this.o365ShellCss_LoadFinished,"o365ShellCss_LoadFinished")),Z.a.enqueueResourceWithoutEnabling(n),!0},a.o365ShellCss_LoadFinished=function(e,t){t.succeeded?(this._o365ShellCssLoaded=!0,this.renderO365ShellIfReady()):(h.ULS.sendTraceTag(7608092,215,10,"CSS failed to load"),this.showFailureMessage())},a.o365ShellJs_LoadFinished=function(e,t){t.succeeded?(this._o365ShellJsLoaded=!0,this.renderO365ShellIfReady()):(h.ULS.sendTraceTag(7608093,215,10,"JS failed to load"),this.showFailureMessage())},a.renderO365ShellIfReady=function(){if(this._o365ShellCssLoaded&&this._o365ShellJsLoaded){if(!this._switcherDomElement)return void h.ULS.shipAssertTag(7608280,215,!1);Sys.UI.DomElement.removeCssClass(this._switcherDomElement,e.loadingCssClass);var t=document.createElement("div");t.id=e.shellContainerId,this._switcherDomElement.appendChild(t),this.renderO365ShellInternal()}},a.renderO365ShellInternal=function(){var t=window.self.O365Shell;if(!t)return this.showFailureMessage(),void h.ULS.shipAssertTag(6613128,215,!1);if(!t.SetData)return this.showFailureMessage(),void h.ULS.shipAssertTag(6613129,215,!1);if(!this._shellDataJsonStr)return this.showFailureMessage(),void h.ULS.shipAssertTag(6613130,215,!1);if(this._shellDataObject){t.SetData(this._shellDataObject);var n=Object.assign(new wn,{launcher:e.shellContainerId,switcher:e.switcherContainerId});if(!t.RenderAsync)return this.showFailureMessage(),void h.ULS.shipAssertTag(6613131,215,!1);t.RenderAsync(n,Object(r.d)(this,this.onSwitcherRendered,"onSwitcherRendered"))}else this.showFailureMessage()},a.onSwitcherRendered=function(){if(this._switcherDomElement){var e=this._switcherDomElement.getElementsByTagName("a");e&&e.length>0&&e[0]&&"none"!==this._switcherDomElement.style.display&&e[0].focus(),s.AFrameworkApplication.theActionManager.processAction(p.a.o365SwitcherReady,2),h.ULS.sendTraceTag(6612807,215,50,"O365 switcher tiles added to the DOM.")}else h.ULS.sendTraceTag(41551900,215,15,"Switcher DOM element is null. Cannot append shell container.")},a.showFailureMessage=function(){this._switcherDomElement&&!Sys.UI.DomElement.containsCssClass(this._switcherDomElement,e.errorCssClass)&&(Sys.UI.DomElement.removeCssClass(this._switcherDomElement,e.loadingCssClass),Sys.UI.DomElement.addCssClass(this._switcherDomElement,e.errorCssClass),h.ULS.sendTraceTag(7129104,215,10,"Failed to display O365 Shell Switcher."))},e.getAnInstanceWithResolvedDependecies=function(){return new e(new on.a((function(){return s.AFrameworkApplication.theClientRequestManager})),s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getAnInstanceWithResolvedDependecies())}}],(n=[{key:"shellServiceDataAsync",get:function(){return this._shellServiceInfoStringAsyncTcs.get_task()}},{key:"clientRequestManager",get:function(){return this._clientRequestManager.value}}])&&kn(t.prototype,n),i&&kn(t,i),e}();function En(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Fn.handlerQuerySigatureHeaderName="X-qs",Fn.officeAppTypeParameterName="at",Fn.shellServiceProxyName="O365ShellServiceProxy.ashx",Fn._instance=null,Fn.switcherContainerId="sw_bar",Fn.loadingCssClass="SwitcherLoading",Fn.errorCssClass="SwitcherError",Fn.shellContainerId="ShellContainer",Fn.webServiceBaseSettingName="ShellWebServiceBase",Object(i.a)(Fn,"O365ShellActor",null,[124]);var On=function(){function e(){this._container=null}var t,n,i,a=e.prototype;return a.configure=function(e){this._container=e,this._container.register(Fn,"Common.App.O365Shell.O365ShellActor").as("Common.App.O365Shell.IO365ShellActor").singleInstance().usingFactory((function(){return new Fn(new on.a((function(){return s.AFrameworkApplication.theClientRequestManager})),s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType)}))},a.init=function(){s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(Object(r.d)(this,this.onFullAppSettingsReady,"onFullAppSettingsReady"))},a.onFullAppSettingsReady=function(){s.AFrameworkApplication.useO365ShellService&&(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("AppSwitcherMitigationIsEnabled")&&!s.AFrameworkApplication.activeFrame.applicationInstance.isReactSharedHeaderUxEnabled||this._container.resolve("Common.App.O365Shell.O365ShellActor").requestShellServiceInfo())},a.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.O365Shell"}}])&&En(t.prototype,n),i&&En(t,i),e}();Object(i.a)(On,"PackageManager",null,[14,15]);var Pn=n(58);var Dn=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).buttonsOption=0,t.setButtonText(1,CommonUIStrings.l_DialogClose),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r=i.prototype;return r.displayError=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_OneDriveContactError,null)},r.displayWarning=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_OneDriveContactError,null,!0)},i}(Pn.StandardDialog);Object(i.a)(Dn,"ErrorDialog",Pn.StandardDialog,[164]);var Mn=function(){function e(){}return e.prototype.getApiEndpoint=function(){h.ULS.sendTraceTag(24134234,352,50,"Returning endpoint for ODC");var e=new A.a;return e.setResult("api.onedrive.com"),e.get_task()},e}();Object(i.a)(Mn,"OneDriveConsumerEndpointHelper",null,[113]);var Ln=n(43);function Rn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Un=function(){function e(e,t,n,i){this.onFilePickerClosedCallback=null,this._onApiReadyCallback=null,this._setup=!1,this._settingUp=!1,this._oneDriveApiScript=null,this._appSettingsManager=e,this._appEnvironment=t,this._limitedEdit=n,this._errorDialogFactory=i}var t,n,i,a=e.prototype;return a.getOneDriveApi=function(){return this._oneDriveApiScript||(this._oneDriveApiScript=this.oneDriveApiUrl?Y.a.create(this.oneDriveApiUrl,null,null,null,!1):null),this._oneDriveApiScript},a.setup=function(e){var t=this;if(this._onApiReadyCallback=e,this._setup||this._settingUp)this._setup&&this._onApiReadyCallback&&this._onApiReadyCallback(!0);else{var n=this.getOneDriveApi();if(!n)return h.ULS.sendTraceTag(20509837,352,15,"Failure with OneDrive API download as the onedrive url received is empty."),void this._onApiReadyCallback(!1);this._settingUp=!0,n.loadFinishedTask.CW((function(e){t.onOneDriveApiScriptLoaded(e)})),Z.a.enqueueResourceWithoutEnabling(n)}},a.onJsDownloadFail=function(e){h.ULS.sendTraceTag(20509838,352,15,"Failure during OneDrive API download: {0}",e.get_exception()?e.get_exception().toString():"No error detail.")},a.onOneDriveApiScriptLoaded=function(e){if(this._settingUp=!1,e.get_isFaulted())return this.onJsDownloadFail(e),void this._onApiReadyCallback(!1);try{this._setup=!0,h.ULS.sendTraceTag(17909022,352,50,"Initializing OneDrive API"),this.initializeApi(),h.ULS.sendTraceTag(17909023,352,50,"OneDrive API is initialized."),this._onApiReadyCallback(!0)}catch(e){h.ULS.sendTraceTag(20555412,352,10,"Failed during OneDrive API init: {0}",e.toString()),this._onApiReadyCallback(!1)}},a.startPicker=function(e){this.onFilePickerClosedCallback=e,this._limitedEdit?h.ULS.sendTraceTag(23881878,216,50,"In limited edit mode, will not show Picker."):(h.ULS.sendTraceTag(23881877,216,50,"Not in limited edit mode, will show file picker."),this.setup(Object(r.d)(this,this.onApiReady,"onApiReady")))},a.onApiReady=function(e){e?this.launchFilePicker():this.showErrorDialog()},a.showErrorDialog=function(){this._errorDialogFactory().displayError(Ln.a.oneDriveFilePickerNotJSON)},a.onSuccess=function(e){h.ULS.sendTraceTag(17909057,352,50,"Success Callback called. Calling callback function."),this.onFilePickerClosedCallback&&this.onFilePickerClosedCallback(!0,e)},a.dispose=function(){this._oneDriveApiScript&&this._oneDriveApiScript.dispose()},t=e,(n=[{key:"appEnvironment",get:function(){return this._appEnvironment}},{key:"appSettingsManager",get:function(){return this._appSettingsManager}}])&&Rn(t.prototype,n),i&&Rn(t,i),e}();function Hn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Un,"AOneDriveFilePickerApiManager",null,[147,4]);var Bn=function(e){var t,n;function i(t,n,i,r,a,o){var s;return(s=e.call(this,n,i,r,o)||this)._options=null,s._signOutResponse=t,s._showRequireSignInDialog=a,s}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a,o,s,l=i.prototype;return l.start=function(e,t){this._options=e,this.startPicker(t)},l.initializeApi=function(){var e,t,n=1===this.appEnvironment||2===this.appEnvironment?((e={}).client_id=this.appSettingsManager.appSettings.UploadToSkyDriveClientId,e):((t={}).client_id=this.appSettingsManager.appSettings.UploadToSkyDriveClientId,t.env="INT",t);WL.init(n)},l.startPicker=function(e){this.onFilePickerClosedCallback=e,!this._limitedEdit&&this._signOutResponse.isAuthenticated?(h.ULS.sendTraceTag(17909025,352,50,"User is signed in. We will show file picker."),this.setup(Object(r.d)(this,this.onApiReady,"onApiReady"))):(h.ULS.sendTraceTag(17909026,352,50,"User is not signed in. show need to sign in dialog."),this._showRequireSignInDialog())},l.launchFilePicker=function(){try{h.ULS.sendTraceTag(17909027,352,50,"Launching file dialogue"),WL.fileDialog(this._options).then(Object(r.d)(this,this.onSuccess,"onSuccess"),Object(r.d)(this,this.onFailure,"onFailure"))}catch(e){h.ULS.sendTraceTag(17909056,352,10,"OneDrive API Failure. [Exception:{0}] [Stack:{1}]",e,e.stack),this.showErrorDialog()}},l.onFailure=function(e){var t=e;if(e&&t.error){if("user_canceled"===t.error.code)return void h.ULS.sendTraceTag(17909058,352,50,"User canceled.");h.ULS.sendTraceTag(17909059,352,50,"File Dialog returned with error code:{0}, and error message: {1}",t.error.code,t.error.message)}else h.ULS.sendTraceTag(17909060,352,50,"File Dialog returned with no response");this.onFilePickerClosedCallback&&this.onFilePickerClosedCallback(!1,e),this.showErrorDialog()},a=i,(o=[{key:"oneDriveApiUrl",get:function(){return this.appSettingsManager.getStringAppSetting("OneDriveApiUrl")}}])&&Hn(a.prototype,o),s&&Hn(a,s),i}(Un);function xn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Bn,"OneDriveFilePickerApiManagerV5",Un,[]);var Nn=function(e){var t,n;function i(t,n,i,a,o){var s;return(s=e.call(this,t,n,i,a)||this)._oneDriveApiEndpoint=null,s._hostDivElement=null,s._endpointHelper=o,s.options={},s.options.clientId=s.appSettingsManager.getStringAppSetting("OneDriveApiV7ClientId"),s.options.cancel=Object(r.d)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(s),s.toggleHostDivVisibility,"toggleHostDivVisibility"),s}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a,o,s,l=i.prototype;return l.start=function(e,t){var n=this;this._hostDivElement=t;var i=this._endpointHelper.getApiEndpoint();i.CWo((function(t){h.ULS.sendTraceTag(24134241,352,50,"Fetch endpoint task completed, attempting to start OneDrive picker"),n._oneDriveApiEndpoint=i.get_result(),n.startPicker((function(t,i){n.toggleHostDivVisibility(),e(t,i)}))}),3),i.CWo((function(e){h.ULS.sendTraceTag(24134242,352,15,i.get_exception().message),n.toggleHostDivVisibility()}),5)},l.initializeApi=function(){var e=this;this.options.success=function(t){var n={};n.data=t,e.onSuccess(n)},this.options.error=function(t){var n={};n.error=t,e.onFailure(n)},this.options.advanced={},this.options.advanced.linkType="share",this.options.advanced.endpointHint=this._oneDriveApiEndpoint,this.options.advanced.iframeParentDiv=this._hostDivElement},l.launchFilePicker=function(){try{h.ULS.sendTraceTag(22090007,352,50,"Launching OneDrive file picker dialog"),this.toggleHostDivVisibility(),OneDrive.open(this.options)}catch(e){h.ULS.sendTraceTag(22090008,352,10,"Opening OneDrive file picker threw an exception: {0}",e.message),this.showErrorDialog()}},l.onFailure=function(e){this.onFilePickerClosedCallback&&this.onFilePickerClosedCallback(!1,e),this.showErrorDialog()},l.toggleHostDivVisibility=function(){this._hostDivElement.style.visibility="hidden"===this._hostDivElement.style.visibility?"":"hidden"},a=i,(o=[{key:"oneDriveApiUrl",get:function(){return this.appSettingsManager.getStringAppSetting("OneDriveApiV72Url")}}])&&xn(a.prototype,o),s&&xn(a,s),i}(Un);function jn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Nn,"OneDriveFilePickerApiManagerV7",Un,[]);var Wn=function(e){var t,n;function i(t,n,i,r){var a;return(a=e.call(this,t,n,i,r)||this).options={},a.options.advanced={},a.options.action="query",a.options.clientId=a.appSettingsManager.getStringAppSetting("OneDriveApiV72ClientId"),a.options.advanced.trapFocus=!0,a}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a,o,s,l=i.prototype;return l.start=function(e,t,n,i){this.options.advanced.iframeParentDiv=n,this.options.advanced.endpointHint=i,this.options.cancel=t,this.startPicker(e)},l.startPicker=function(e){this.onFilePickerClosedCallback=e,this._limitedEdit?h.ULS.sendTraceTag(24391838,216,50,"In limited edit mode, will not show Picker."):(h.ULS.sendTraceTag(24391837,216,50,"Not in limited edit mode, will show file picker."),this.setup(Object(r.d)(this,this.onApiReady,"onApiReady")))},l.initializeApi=function(){var e=this;this.options.success=function(t){var n={};n.data=t,e.onSuccess(n)},this.options.error=function(t){var n={};n.error=t,e.onFailure(n)}},l.launchFilePicker=function(){try{h.ULS.sendTraceTag(23881879,216,50,"Launching OneDrive file picker dialog"),OneDrive.save(this.options)}catch(e){h.ULS.sendTraceTag(23881880,216,10,"Opening OneDrive file picker fail. Exception: {0}, Callstack: {1}.",e.message,e.stack),this.showErrorDialog()}},l.onJsDownloadFail=function(e){h.ULS.sendTraceTag(25180160,216,15,"Failure during OneDrive API download: {0}",e.get_exception()?e.get_exception().toString():"No error detail."),Z.a.removeReferenceForRetryDownload(this.oneDriveApiUrl),this._oneDriveApiScript=null},l.showErrorDialog=function(){this._errorDialogFactory().displayWarning(Ln.a.saveAsToOneDriveFailed_FilePicker)},l.onFailure=function(e){this.onFilePickerClosedCallback&&this.onFilePickerClosedCallback(!1,e)},a=i,(o=[{key:"oneDriveApiUrl",get:function(){return this.appSettingsManager.getStringAppSetting("OneDriveApiV72Url")}}])&&jn(a.prototype,o),s&&jn(a,s),i}(Un);Object(i.a)(Wn,"OneDriveFilePickerApiManagerV72",Un,[]);var Vn=function(e){this.key=null,this.value=null,this.olsSessionId=null,this.olsSessionId=e};function qn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Vn,"IExtraData",null,[]);var Gn=function(e){var t,n,i,r,a;function o(t,n,i,r){var a;return(a=e.call(this,t,n,i,r)||this).options.advanced.filter=t.getStringAppSetting("OneDriveApiV72Filter")||"folder,photo",a.options.advanced.linkType="download",a.options.multiSelect=s.AFrameworkApplication.appSupportsMultiInsertOnlinePictureFromHost,t.getBooleanAppSetting("OneDriveApiV72CommandModeEnabled")&&(a.options.commandMode=t.getStringAppSetting("OneDriveApiV72CommandMode")||"none"),t.getBooleanAppSetting("OneDriveApiV72QosExtraDataEnabled")&&(a.options.qosExtradata=new Vn(s.AFrameworkApplication.userSessionId)),a}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,o.prototype.launchFilePicker=function(){try{var e=this.options.qosExtradata?this.options.qosExtradata.olsSessionId:"";h.ULS.sendTraceTag(26071182,352,50,"Launching OneDrive file picker dialog with filter: {0}, commandMode: {1}, QosExtraData: {2} officeSessionId: {3}",this.options.advanced.filter,this.options.commandMode,e,s.AFrameworkApplication.userSessionId),OneDrive.open(this.options)}catch(e){h.ULS.sendTraceTag(26071183,352,10,"Opening OneDrive file picker fail. Exception: {0}, Callstack: {1}.",e.message,e.stack),this.showErrorDialog()}},i=o,(r=[{key:"oneDriveApiUrl",get:function(){return this.appSettingsManager.getStringAppSetting("OneDriveApiV72Url")}}])&&qn(i.prototype,r),a&&qn(i,a),o}(Wn);Object(i.a)(Gn,"OneDriveFilePickerApiOpenManagerV72",Wn,[]);var Kn=function(){function e(e){this._tcs=null,this._clientRequestManager=e,this._retriesRemaining=3}var t=e.prototype;return t.getApiEndpoint=function(){return this._tcs=new A.a,h.ULS.sendTraceTag(24134235,352,50,"Sending initial request for OneDrive for Business Endpoint"),this.sendGetMoreInfoRequest(),this._tcs.get_task()},t.sendGetMoreInfoRequest=function(e){void 0===e&&(e=null);var t=String.format("GetMoreInfoHandler.ashx?{0}",s.AFrameworkApplication.currentFileBaseDocQuerySignatureWithoutVersion);this._clientRequestManager.addRequestWithHeaderForwarding(t,1,null,e,["PersonalFileStorageUrl","X-NewKey"],!1,2,Object(r.d)(this,this.getMoreInfoSucceeded,"getMoreInfoSucceeded"),Object(r.d)(this,this.getMoreInfoFailed,"getMoreInfoFailed"),null,void 0,void 0,void 0,void 0,"21")},t.getMoreInfoFailed=function(e){if(e.data.httpStatus===E.a.preconditionFailed_412&&"X-NewKey"in e.data.responseHeaders){h.ULS.sendTraceTag(24134236,352,50,"GetMoreInfo request failed due to bad canary. Updating with new canary and resending");var t={};t["X-Key"]=e.data.responseHeaders["X-NewKey"],this.sendGetMoreInfoRequest(t)}else this._retriesRemaining>0?(h.ULS.sendTraceTag(24134237,352,50,"GetMoreInfo request failed, attmepting again. {0} retries remaining",this._retriesRemaining),this._retriesRemaining--,this.sendGetMoreInfoRequest()):(h.ULS.sendTraceTag(24134238,352,50,"GetMoreInfo request failed, and no more retries remaining. Faulting task"),this._tcs.SX(Error.create("GetMoreInfo request failed and no more retries remain")))},t.getMoreInfoSucceeded=function(e){"PersonalFileStorageUrl"in e.data.responseHeaders&&""!==e.data.responseHeaders.PersonalFileStorageUrl?(h.ULS.sendTraceTag(24134239,352,50,"Successfully received an ODB endpoint"),this._tcs.setResult(e.data.responseHeaders.PersonalFileStorageUrl)):(h.ULS.sendTraceTag(24134240,352,50,"GetMoreInfo request was successful but didn't return an ODB endpoint"),this._tcs.SX(Error.create("GetMoreInfo request succeeded but did not have ODB endpoint")))},e}();Object(i.a)(Kn,"OneDriveForBusinessEndpointHelper",null,[113]);var zn=n(219);function Jn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Xn=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){},r.dispose=function(){},r.configure=function(e){var t=this;this._container=e,this._container.register(Bn,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV5").as("Common.App.OneDriveFilePickerApi.IOneDriveFilePickerApiManager").singleInstance().usingFactory((function(){return new Bn(zn.a.instance,s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,s.AFrameworkApplication.limitedEdit,s.AFrameworkApplication.showRequiresSignInDialog,(function(){return new Dn}))})),s.AFrameworkApplication.isSkyDrive?this._container.register(113,"Common.App.OneDriveFilePickerApi.IOneDriveApiEndpointHelper").singleInstance().usingFactory((function(){return new Mn})):this._container.register(113,"Common.App.OneDriveFilePickerApi.IOneDriveApiEndpointHelper").singleInstance().usingFactory((function(){return new Kn(s.AFrameworkApplication.theClientRequestManager)})),this._container.register(Nn,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV7").singleInstance().usingFactory((function(){return new Nn(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,s.AFrameworkApplication.limitedEdit,(function(){return new Dn}),t._container.resolve("Common.App.OneDriveFilePickerApi.IOneDriveApiEndpointHelper"))})),this._container.register(Wn,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV72").singleInstance().usingFactory((function(){return new Wn(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,s.AFrameworkApplication.limitedEdit,(function(){return new Dn}))})),this._container.register(Gn,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiOpenManagerV72").singleInstance().usingFactory((function(){return new Gn(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,s.AFrameworkApplication.limitedEdit,(function(){return new Dn}))}))},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.OneDriveFilePickerApi"}}])&&Jn(t.prototype,n),i&&Jn(t,i),e}();Object(i.a)(Xn,"PackageManager",null,[14,15]);var Qn=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).buttonsOption=0,t.setButtonText(1,CommonUIStrings.l_DialogClose),t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.displayError=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_ErrorSavingToOneDrive,null)},i}(Pn.StandardDialog);Object(i.a)(Qn,"ErrorDialog",Pn.StandardDialog,[170]);var Zn=function(){};Zn.default=0,Object(i.a)(Zn,"SaveToCloudErrorCodes",null,[]);var Yn=function(){function e(e,t,n,i,r,a){this._options=null,this._signInFactory=e,this._signOutResponse=t,this._uploadToCloudManager=n,this._appSettingsManager=i,this._appEnvironment=r,this._errorDialogFactory=a}var t=e.prototype;return t.start=function(e){this._options=e,this._signOutResponse.isAuthenticated?(h.ULS.sendTraceTag(6590559,216,50,"User is signed in. We will show file picker."),this.callFilePicker()):(h.ULS.sendTraceTag(6590560,216,50,"User is not signed in. We will show sign in dialog."),this.showSignInDialog())},t.showSignInDialog=function(){this._signInFactory.create().displayDialog()},t.showErrorDialog=function(){this._errorDialogFactory().displayError(Zn.default)},t.callFilePicker=function(){try{var e,t;h.ULS.sendTraceTag(6590561,216,50,"Initializing OneDrive API");var n,i=((e={}).client_id=this._appSettingsManager.appSettings.UploadToSkyDriveClientId,e.env="INT",e);if(1===this._appEnvironment||2===this._appEnvironment)(n={}).client_id=this._appSettingsManager.appSettings.UploadToSkyDriveClientId,i=n;var a=((t={}).mode="save",t.lightbox="grey",t);WL.init(i),h.ULS.sendTraceTag(6590562,216,50,"OneDrive API is initialized. Launching file dialogue"),WL.fileDialog(a).then(Object(r.d)(this,this.onSuccess,"onSuccess"),Object(r.d)(this,this.onFailure,"onFailure"))}catch(e){h.ULS.sendTraceTag(6590563,216,10,"OneDrive API Failure. [Exception:{0}] [Stack:{1}]",e,e.stack),this.showErrorDialog()}},t.onSuccess=function(e){h.ULS.sendTraceTag(6590592,216,50,"Success Callback called. Calling UploadToCloudManger to start upload."),e&&e.data&&e.data.folders&&this._uploadToCloudManager.startUpload(e.data.folders[0].id,e.data.folders[0].urls.viewInBrowser,null,this._options)},t.onFailure=function(e){if(e&&e.error){if("user_canceled"===e.error.code)return void h.ULS.sendTraceTag(6590593,216,50,"User cancelled upload to their OneDrive.");h.ULS.sendTraceTag(6590594,216,50,"File Dialog returned with error code:{0}, and error message: {1}",e.error.code,e.error.message)}else h.ULS.sendTraceTag(6590595,216,50,"File Dialog returned with no response");this.showErrorDialog()},e}();Object(i.a)(Yn,"SaveToCloudManager",null,[169]);var $n=n(237),ei=n(253),ti=function(){function e(e,t,n,i){this._responseTimeToSaveToOneDriveAction=null,this._saveToCloudManager=e,this._appSettingsManager=n,this._oneDriveFilePickerApiManager=t,this._loadApiTaskCompletionSource=new A.a,this._stopwatchBuilder=i}var t=e.prototype;return t.isUIEnabled=function(){return this._appSettingsManager.getBooleanAppSetting("SaveToCloudStorageUIIsEnabled")},t.getActionId=function(){return p.a.saveToCloudStorage},t.callDownloadQueueActionsForOneDriveApi=function(){Z.a.registerDispatchHandler(Object(r.d)(this,this.saveToCloudActionDispatcher,"saveToCloudActionDispatcher")),Z.a.enqueueActions([new ei.a(p.a.saveToCloudStorage,de.a.frame,0)],this._oneDriveFilePickerApiManager.getOneDriveApi())},t.registerActions=function(){var e=this,t=this._oneDriveFilePickerApiManager.getOneDriveApi();t?(t.add_loadFinished((function(t,n){e._loadApiTaskCompletionSource.setResult(!0)})),this.callDownloadQueueActionsForOneDriveApi()):h.ULS.sendTraceTag(6590596,216,15,"Failure with OneDrive API download as the onedrive url received is empty ")},t.recordExecuteTrace=function(){h.ULS.sendTraceTag(6590597,216,50,"User clicked on SaveToOneDrive button")},t.saveToCloudActionDispatcher=function(e,t,n,i,r){var a=this;if(t.contextId!==de.a.frame||e!==this.getActionId())return 2;if(!this.isUIEnabled())return 8;if(1===n)return $n.SessionStatusManager.instance.hasEmergencyViewModeBeenDeployed?8:32;if(2===n){this.recordExecuteTrace();var o=r;return o&&o.FileDownloadUrl&&h.ULS.sendTraceTag(50708835,216,50,"SaveToCloudStorageActor FileDownloadUrl is there"),this._stopwatchBuilder&&(this._responseTimeToSaveToOneDriveAction=this._stopwatchBuilder.makeAndStartStopwatch("DialogShown","SaveToOneDriveReponseTime")),this._loadApiTaskCompletionSource.get_task().CW((function(e){a._responseTimeToSaveToOneDriveAction&&(a._responseTimeToSaveToOneDriveAction.stop(),a._responseTimeToSaveToOneDriveAction=null),a._saveToCloudManager.start(o)})),32}return 8},e}();Object(i.a)(ti,"SaveToCloudStorageActor",null,[168]);var ni=function(e){var t,n;function i(t,n,i){var r;return(r=e.call(this)||this)._actionManager=t,r._signOutResponse=n,r._aframeApplication=i,r._hideOnButtonClick=!1,r.buttonsOption=1,r.setDefaultButton(1),r.setButtonText(1,CommonUIStrings.l_SignIn),r.setButtonText(0,CommonUIStrings.l_SignInToSaveDialogCancelButton),r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=i.prototype;return a.displayDialog=function(){this._signOutResponse.add_authenticationRestored(Object(r.d)(this,this.onSignIn,"onSignIn")),this.messageBox(CommonUIStrings.l_SignInToSaveDialogTitle,CommonUIStrings.l_SaveToCloudSignInDialog,0,Object(r.d)(this,this.inputHandler,"inputHandler"))},a.inputHandler=function(e,t){if(!e)return h.ULS.sendTraceTag(6590598,216,50,"User dismissed SignIn Dialog."),void this.hide();this.performSignIn()},a.checkApp=function(){var e="2";if(this._aframeApplication)switch(this._aframeApplication.officeAppType){case 3:e="0";break;case 2:e="3";break;case 1:e="1"}return e},a.hide=function(){this._signOutResponse.remove_authenticationRestored(Object(r.d)(this,this.onSignIn,"onSignIn")),e.prototype.hide.call(this)},a.performSignIn=function(){var e=new R.QueryStringBuilder("Signin.aspx");e.addParam("prompt","1"),e.addParam("cbcxt",this.checkApp()),s.AFrameworkApplication.addCommonUrlParameters(e),tt.a.safelyOpenWindow(e.toString(),"LoginWindow",void 0,void 0,"SignInDialog")},a.onSignIn=function(e,t){this.isShowing&&this.hide(),h.ULS.sendTraceTag(7143885,216,50,"User signed in successfully. Calling Savetocloudstorage action handler"),this._actionManager.processAction(p.a.saveToCloudStorage,2)},i}(Pn.StandardDialog);Object(i.a)(ni,"SignInDialog",Pn.StandardDialog,[187]);var ii=function(){function e(e,t,n){this._actionManager=e,this._signOutResponse=t,this._aframeApplication=n}return e.prototype.create=function(){return new ni(this._actionManager,this._signOutResponse,this._aframeApplication)},e}();Object(i.a)(ii,"SignInDialogFactory",null,[167]);var ri=function(){function e(e,t,n,i,r,a,o){this._webServiceBase=e,this._fileName=t,this._fileNewName=n,this._folderId=i,this._querySig=r,this._handlerName=a,this._options=o}return e.prototype.execute=function(e,t){if(!s.AFrameworkApplication.isShuttingDown&&s.AFrameworkApplication.theClientRequestManager){var n={"Content-Type":"application/json; charset=utf-8"},i=this._webServiceBase+this._handlerName;i=Dt.a.addOrReplaceParameterValue(i,"fo",We.a.urlKeyValueEncode(this._folderId)),i=Dt.a.addOrReplaceParameterValue(i,"fn",We.a.urlKeyValueEncode(this._fileName)),i=Dt.a.addOrReplaceParameterValue(i,"qs",We.a.urlKeyValueEncode(this._querySig)),i=Dt.a.addOrReplaceParameterValue(i,"n",We.a.urlKeyValueEncode((new Date).getTime().toString())),this._options&&this._options.FileDownloadUrl&&(i=Dt.a.addOrReplaceParameterValue(i,"furl",We.a.urlKeyValueEncode(this._options.FileDownloadUrl))),this._fileNewName&&(i=Dt.a.addOrReplaceParameterValue(i,"fnn",We.a.urlKeyValueEncode(this._fileNewName))),s.AFrameworkApplication.theClientRequestManager.addRequest(i,1,"",n,!1,2,e,t,null)}},e}();Object(i.a)(ri,"SkyDriveUploadCaller",null,[185]);var ai=function(){function e(e){this._appSettingsManager=e,this._webServiceUrl=e.appSettings.SkyDriveUploadWebServiceBase,this._fileName=e.appSettings.FileName,this._handlerName=e.getStringAppSetting("SkyDriveUploadHandler")||"skydriveuploadhandler.ashx"}return e.prototype.create=function(e,t,n){return new ri(this._webServiceUrl,this._fileName,t,e,s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion,this._handlerName,n)},e}();Object(i.a)(ai,"SkydriveUploadCallerFactory",null,[166]);var oi=function(){function e(e,t,n,i,r){this._caller=null,this._progressDialog=null,this._folderUrl=null,this._failedCanary=!1,this._uploadTimeStopwatch=null,this._options=null,this._uploadCallerFactory=e,this._progressDialogFactory=t,this._errorDialogFactory=n,this._activeFrame=i,this._stopwatchBuilder=r}var t=e.prototype;return t.showWaitUI=function(){this._activeFrame&&1===this._activeFrame.state||(this._progressDialog=this._progressDialogFactory(),this._progressDialog.message=CommonUIStrings.l_CommentProgressTooltip,this._progressDialog.buttonsOption=5,this._progressDialog.hasCloseGlyph=!1,this._progressDialog.showProgressDialog(CommonUIStrings.l_DefaultDialogTitle,null,null))},t.dismissWaitUI=function(){this._progressDialog&&(this._progressDialog.close(),this._progressDialog=null)},t.showErrorUI=function(){1!==s.AFrameworkApplication.activeFrame.state&&this._errorDialogFactory().displayError(Zn.default)},t.redirectToFolder=function(){h.ULS.sendTraceTag(6590599,216,50,"Redirecting to OneDrive Folder."),tt.a.safelyOpenWindow(this._folderUrl,tt.a.windowTargetToString(3),void 0,void 0,"UploadToCloudManager.RedirectToFolder")},t.redirectToEditUrl=function(e){var t=!1,n=!1;if(s.AFrameworkApplication.appSettingsManager&&(t=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SaveACopyIsEnabledForUiHost"),n=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UiHostSupportsDocRebootFeatures")),h.ULS.sendTraceTag(6654163,216,50,"Redirecting to edit url {0}. IsEnabledForUiHost {1}",e,t),t&&n){h.ULS.sendTraceTag(594929733,216,50,"UploadToCloudManager.RedirectToEditUrl: Sending DocumentRefresh post message.");var i={};i[nn.a.rebootMode]="1",i[nn.a.documentUrl]=e,s.AFrameworkApplication.get_hostPostmessengerFuture().execute((function(e){e.sendMessage(d.a.documentRefresh,i)}))}else tt.a.safelyOpenWindow(e,tt.a.windowTargetToString(3),void 0,void 0,"UploadToCloudManager.RedirectToEditUrl")},t.startUpload=function(e,t,n,i){void 0===n&&(n=null),void 0===i&&(i=null),h.ULS.sendTraceTag(7143886,216,50,"Starting to upload file"),this._stopwatchBuilder&&(this._uploadTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("DialogShown","SaveToOneDriveUploadTime")),this.showWaitUI(),this._folderUrl=t,this._caller=this._uploadCallerFactory.create(e,n,i),this._options=i,this.executeUpload()},t.executeUpload=function(){h.ULS.sendTraceTag(6590600,216,50,"Calling SkydriveUploadHandler."),this._caller.execute(Object(r.d)(this,this.onSaveToCloudUploadFinished,"onSaveToCloudUploadFinished"),Object(r.d)(this,this.onSaveToCloudUploadFailed,"onSaveToCloudUploadFailed"))},t.onSaveToCloudUploadFinished=function(e){if(this.dismissWaitUI(),this._failedCanary=!1,!e||!e.data||!e.data.responseData)return h.ULS.sendTraceTag(6590601,216,10,"UploadToCloudManager upload failure. Response data is null"),void this.showErrorUI();var t,n;if(!L.d(e.data.responseData,Object(z.a)((function(){return t}),(function(e){return t=e}))))return h.ULS.sendTraceTag(7660114,216,10,"Failed to deserialize : {0}",((n={}).ResponseData=In(e.data.responseData),n)),void this.showErrorUI();var i=t;if(i.StatusCode!==E.a.OK_200&&i.StatusCode!==E.a.created_201)return h.ULS.sendTraceTag(6590602,216,10,"UploadToCloudManager upload failure. Response data is not JSON."),void this.showErrorUI();h.ULS.sendTraceTag(6590603,216,50,"UploadToCloudManager upload success.");try{i.NewDocumentUrl&&""!==i.NewDocumentUrl?this.redirectToEditUrl(i.NewDocumentUrl):this.redirectToFolder()}catch(e){h.ULS.sendTraceTag(37025728,216,15,"Redirect failed with exception: {0}",e.toString())}this.perfWatchStop()},t.onSaveToCloudUploadFailed=function(e){5!==e.data.status&&12!==e.data.status||this._failedCanary?(h.ULS.sendTraceTag(6590605,216,10,"UploadToCloudManager HTTP failure with code: {0}",e.data.status),this.dismissWaitUI(),this.showErrorUI(),this.perfWatchStop()):(h.ULS.sendTraceTag(6590604,216,10,"UploadToCloudManager failure. Retrying."),this._failedCanary=!0,this.executeUpload())},t.perfWatchStop=function(){this._uploadTimeStopwatch&&(this._uploadTimeStopwatch.stop(),this._uploadTimeStopwatch=null)},e}();Object(i.a)(oi,"UploadToCloudManager",null,[165]);var si=n(239);function li(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ci=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SaveToCloudStorageUIIsEnabled")&&this._container.resolve("Common.App.SaveToCloudStorage.SaveToCloudStorageActor").registerActions()},r.dispose=function(){},r.configure=function(e){this._container=e,this._container.register(ii,"Common.App.SaveToCloudStorage.SignInDialogFactory").as("Common.App.SaveToCloudStorage.ISignInDialogFactory").usingFactory((function(){return new ii(s.AFrameworkApplication.theActionManager,zn.a.instance,s.AFrameworkApplication.activeFrame.applicationInstance)})).singleInstance(),this._container.register(ai,"Common.App.SaveToCloudStorage.SkydriveUploadCallerFactory").as("Common.App.SaveToCloudStorage.ISkydriveUploadCallerFactory").usingFactory((function(){return new ai(s.AFrameworkApplication.appSettingsManager)})).singleInstance(),this._container.register(ti,"Common.App.SaveToCloudStorage.SaveToCloudStorageActor").usingFactory((function(){return new ti(e.resolve("Common.App.SaveToCloudStorage.SaveToCloudManager"),e.resolve("Common.App.OneDriveFilePickerApi.IOneDriveFilePickerApiManager"),s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.activeFrame.theStopwatchBuilder)})).singleInstance(),this._container.register(oi,"Common.App.SaveToCloudStorage.UploadToCloudManager").usingFactory((function(){return new oi(e.resolve("Common.App.SaveToCloudStorage.SkydriveUploadCallerFactory"),(function(){return(new si.a).create()}),(function(){return new Qn}),s.AFrameworkApplication.activeFrame,s.AFrameworkApplication.activeFrame.theStopwatchBuilder)})).singleInstance(),this._container.register(Yn,"Common.App.SaveToCloudStorage.SaveToCloudManager").usingFactory((function(){return new Yn(e.resolve("Common.App.SaveToCloudStorage.SignInDialogFactory"),zn.a.instance,e.resolve("Common.App.SaveToCloudStorage.UploadToCloudManager"),s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,(function(){return new Qn}))})).singleInstance()},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.SaveToCloudStorage"}}])&&li(t.prototype,n),i&&li(t,i),e}();Object(i.a)(ci,"PackageManager",null,[14,15]);var ui=n(108),di=function(){function e(e){this._eventSource=new a.a,this._appFrame=e}var t=e.prototype;return t.add_onSessionExpired=function(t){this._eventSource.addHandler(e.sessionExpiredEventKey,t)},t.remove_onSessionExpired=function(t){this._eventSource.removeHandler(e.sessionExpiredEventKey,t)},t.add_onSessionExpiring=function(t){this._eventSource.addHandler(e.sessionExpiringEventKey,t)},t.remove_onSessionExpiring=function(t){this._eventSource.removeHandler(e.sessionExpiringEventKey,t)},t.add_onTokenRefreshed=function(t){this._eventSource.addHandler(e.tokenRefreshedEventKey,t)},t.remove_onTokenRefreshed=function(t){this._eventSource.removeHandler(e.tokenRefreshedEventKey,t)},t.showDialogOnKickout=function(t){this._eventSource.raiseEvent(e.sessionExpiredEventKey)},t.showDialogOnExpiring=function(t){this._eventSource.raiseEvent(e.sessionExpiringEventKey)},t.hasSessionExpired=function(){var e=s.AFrameworkApplication.accessTokenTtl;return ui.a.instance.isSessionExpired(e)},e}();di.sessionExpiredEventKey="SE",di.sessionExpiringEventKey="SEP",di.tokenRefreshedEventKey="SER",Object(i.a)(di,"NullSessionExpirationManager",null,[111,112]);var pi=function(){function e(){var e;this._sessionExpiredDialogAlreadyDisplayed=!1,this._sessionExpiringDialogAlreadyDisplayed=!1;var t=s.AFrameworkApplication.accessTokenTtl;if(!(t<=0)){this.accessTokenTtl=t;var n=new Date;h.ULS.sendTraceTag(17581890,217,50,"Initializing SessionExpirationManager. {0}",((e={}).AccessTokenTtl=this.accessTokenTtl,e.NowGetTime=n.getTime(),e.BootTime=s.AFrameworkApplication.bootTime,e)),ui.a.instance.add_sessionExpiredDetected(Object(r.d)(this,this.onSessionExpiredDetected,"onSessionExpiredDetected")),ui.a.instance.add_sessionAboutToExpireDetected(Object(r.d)(this,this.onSessionExpiringDetected,"onSessionExpiringDetected"))}}var t=e.prototype;return t.onSessionExpiredDetected=function(e,t){ui.a.instance.remove_sessionExpiredDetected(Object(r.d)(this,this.onSessionExpiredDetected,"onSessionExpiredDetected")),h.ULS.sendTraceTag(19247381,217,50,"SessionExpiredDetected"),this.handleSessionExpired()},t.onSessionExpiringDetected=function(e,t){ui.a.instance.remove_sessionAboutToExpireDetected(Object(r.d)(this,this.onSessionExpiringDetected,"onSessionExpiringDetected")),this._sessionExpiringDialogAlreadyDisplayed||this._sessionExpiredDialogAlreadyDisplayed||(h.ULS.sendTraceTag(20492680,217,50,"SessionExpiringDetected - Showing expiring dialog."),this._sessionExpiringDialogAlreadyDisplayed=!0,this.showSessionExpiringDialog())},t.handleSessionExpired=function(){this._sessionExpiredDialogAlreadyDisplayed||(s.AFrameworkApplication.reportError(Ln.a.sessionAccessTokenExpired),this._sessionExpiredDialogAlreadyDisplayed=!0,this.showSessionExpiredDialog())},e}();Object(i.a)(pi,"ASessionExpirationManager",null,[]);var hi=n(75),gi=n(292),mi=function(){function e(e,t,n,i){this.textToDisplay="",this._accessTokenTtl=e,this._sessionRefreshCallback=n,this._sessionDisposeCallback=i,this._isExpiredDialog=t;var r=new Date(this._accessTokenTtl).format(s.AFrameworkApplication.shortTimeFormat);this._isExpiredDialog?this.textToDisplay=String.format(CommonUIStrings.l_SessionExpiredMessage):this.textToDisplay=String.format(CommonUIStrings.l_SessionExpiringMessage,r)}var t=e.prototype;return t.sessionExpirationDialogHandler=function(e){1===e?this._sessionRefreshCallback&&this._sessionRefreshCallback(this._isExpiredDialog):e||s.AFrameworkApplication.theActionManager.processActionWithData(p.a.close,2,gi.g)},t.dispose=function(){this._sessionDisposeCallback&&this._sessionDisposeCallback()},e}();mi.id="SessionExpirationDialog",Object(i.a)(mi,"SessionExpirationDialogSharedProperties",null,[]);var fi=function(){};fi.dialogHtml="<div class='WACDialogRow' id='SessionExpirationBlock'> <label id='WACSessionExpirationText' class='WACDialogLabel' >Session Expiration</label> </div>",Object(i.a)(fi,"SessionExpirationDialogHtml",null,[]);var vi=function(e){var t,n;function i(t,n,i,a){var o,l={};return(o=e.call(this,n)||this)._sessionExpirationDialogSharedProperties=new mi(t,n,i,a),o.dialogId=mi.id,s.AFrameworkApplication.canExecuteCloseAction?(o.buttonsOption=1,o.setButtonText(0,CommonUIStrings.l_DialogClose)):(o.buttonsOption=0,o.hasCloseGlyph=!1),n||1===s.AFrameworkApplication.activeFrame.mode?o.setButtonText(1,CommonUIStrings.l_SessionExpirationRefreshButton):o.setButtonText(1,CommonUIStrings.l_SessionExpiringSaveAndRefreshButton),o.dialogHtml=fi.dialogHtml,l.WACSessionExpirationText=o._sessionExpirationDialogSharedProperties.textToDisplay,o.initializeAndShow(CommonUIStrings.l_DefaultDialogTitle,Object(r.d)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o),o.sessionExpirationDialogHandler,"sessionExpirationDialogHandler"),l),o.setDescribedByForDialog(o.myId("WACSessionExpirationText")),o}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=i.prototype;return a.sessionExpirationDialogHandler=function(e,t){void 0===t&&(t=null),this._sessionExpirationDialogSharedProperties.sessionExpirationDialogHandler(e)},a.isDialogShowing=function(){return this.isShowing},a.hideDialog=function(){this.hide()},a.dispose=function(){e.prototype.dispose.call(this),this._sessionExpirationDialogSharedProperties&&this._sessionExpirationDialogSharedProperties.dispose()},i}(hi.a);Object(i.a)(vi,"LegacySessionExpirationDialog",hi.a,[184]);var Si=function(e){var t,n;function i(t,n,i,a){var o;return(o=e.call(this,n)||this)._sessionExpirationDialogSharedProperties=new mi(t,n,i,a),o.dialogId=mi.id,s.AFrameworkApplication.canExecuteCloseAction?(o.buttonsOption=1,o.setButtonText(0,CommonUIStrings.l_DialogClose)):(o.buttonsOption=0,o.hasCloseGlyph=!1),n||1===s.AFrameworkApplication.activeFrame.mode?o.setButtonText(1,CommonUIStrings.l_SessionExpirationRefreshButton):o.setButtonText(1,CommonUIStrings.l_SessionExpiringSaveAndRefreshButton),o.messageBox(CommonUIStrings.l_DefaultDialogTitle,o._sessionExpirationDialogSharedProperties.textToDisplay,0,Object(r.d)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o),o.sessionExpirationDialogHandler,"sessionExpirationDialogHandler")),o}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=i.prototype;return a.sessionExpirationDialogHandler=function(e,t){void 0===t&&(t=!1),this._sessionExpirationDialogSharedProperties.sessionExpirationDialogHandler(e)},a.isDialogShowing=function(){return this.isShowing},a.hideDialog=function(){this.hide()},a.dispose=function(){e.prototype.dispose.call(this),this._sessionExpirationDialogSharedProperties&&this._sessionExpirationDialogSharedProperties.dispose()},i}(Pn.StandardDialog);Object(i.a)(Si,"SessionExpirationDialog",Pn.StandardDialog,[184]);var _i=function(e,t,n,i){return s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ReactStandardSessionExpirationDialogIsEnabled")?new Si(e,t,n,i):new vi(e,t,n,i)},yi=n(102);var bi=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this)._showDialogOnKickout=!0,n._showDialogOnExpiring=!0,n._sessionExpirationDialog=null,n._eventSource=new a.a,n._appFrame=t,n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var o=i.prototype;return o.add_onSessionExpired=function(e){this._eventSource.addHandler(i.sessionExpiredEventKey,e)},o.remove_onSessionExpired=function(e){this._eventSource.removeHandler(i.sessionExpiredEventKey,e)},o.add_onSessionExpiring=function(e){this._eventSource.addHandler(i.sessionExpiringEventKey,e)},o.remove_onSessionExpiring=function(e){this._eventSource.removeHandler(i.sessionExpiringEventKey,e)},o.add_onTokenRefreshed=function(e){this._eventSource.addHandler(i.tokenRefreshedEventKey,e)},o.remove_onTokenRefreshed=function(e){this._eventSource.removeHandler(i.tokenRefreshedEventKey,e)},o.hasSessionExpired=function(){var e=s.AFrameworkApplication.accessTokenTtl;return ui.a.instance.isSessionExpired(e)},o.showDialogOnKickout=function(e){this._showDialogOnKickout=e},o.showDialogOnExpiring=function(e){this._showDialogOnExpiring=e},o.showSessionExpiringDialog=function(){if(!this._sessionExpirationDialog&&!yi.a.currentDialog){if(this._showDialogOnExpiring){var e=Object(r.d)(this,this.disposeCallback,"disposeCallback");this._sessionExpirationDialog=_i(this.accessTokenTtl,!1,Object(r.d)(this,this.sessionExpirationHandler,"sessionExpirationHandler"),e)}this._eventSource.raiseEvent(i.sessionExpiringEventKey)}},o.showSessionExpiredDialog=function(){if(this._sessionExpirationDialog&&(this._sessionExpirationDialog.isDialogShowing()&&this._sessionExpirationDialog.hideDialog(),this._sessionExpirationDialog=null),this._showDialogOnKickout){var e=Object(r.d)(this,this.disposeCallback,"disposeCallback");this._sessionExpirationDialog=_i(this.accessTokenTtl,!0,Object(r.d)(this,this.sessionExpirationHandler,"sessionExpirationHandler"),e)}this._eventSource.raiseEvent(i.sessionExpiredEventKey)},o.disposeCallback=function(){this._sessionExpirationDialog=null},o.sessionExpirationHandler=function(e){(e||this._appFrame.beforeRefreshDocument())&&this._appFrame.refreshDocument(null)},i}(pi);bi.sessionExpiredEventKey="SE",bi.sessionExpiringEventKey="SEP",bi.tokenRefreshedEventKey="SER",Object(i.a)(bi,"SessionExpirationManager",pi,[111,112]);var Ai=function(){};function Ci(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Ai.aborting="Aborting",Ai.activityDuration="ActivityDuration",Ai.aggregateDictionaryName="Aggregate",Ai.currentDictionaryName="Current",Ai.error="Error",Ai.errorsCount="Errors",Ai.failed="Failed",Ai.firstActivity="FirstActivity",Ai.initialized="Initialized",Ai.kickedOut="KickedOut",Ai.lastActivity="LastActivity",Ai.retryOverride="RetryOverride",Ai.requestGroups="RequestGroups",Ai.requests="Requests",Ai.responses="Responses",Ai.sessionDuration="SessionDuration",Ai.status="Status",Ai.success="Success",Ai.successful="Successful",Ai.tokens="Tokens",Object(i.a)(Ai,"SessionExpirationStrings",null,[]);var Ti=function(){function e(e){this._current={},this._aggregate={},this.logIntervalInMinutes=15,this._isStopped=!1,this._sessionStart=new Date,this._lastActivity=new Date,this._taskManager=e,this._taskItem=new u.a(2,2,60*this.logIntervalInMinutes*1e3,Object(r.d)(this,this.writeMeasures,"writeMeasures"),135,"SL",!1),this._taskManager.addTask(this._taskItem),this.initializeMeasures()}var t,n,i,a=e.prototype;return a.writeMeasures=function(e){var t;h.ULS.sendTraceTag(41964821,217,50,h.ULS.jsonSerialize(((t={}).Aggregate=this._aggregate,t.Current=this._current,t)))},a.initializeMeasures=function(){this._aggregate[Ai.requestGroups]=0,this._aggregate[Ai.requests]=0,this._aggregate[Ai.responses]=0,this._aggregate[Ai.status]=Ai.initialized,this._aggregate[Ai.firstActivity]=new Date,this._aggregate[Ai.sessionDuration]=0,this._aggregate[Ai.activityDuration]=0,this._aggregate[Ai.sessionDuration]=0,this._current[Ai.sessionDuration]=0,this._aggregate[Ai.activityDuration]=0,this._current[Ai.activityDuration]=0},a.incrementACounter=function(e,t){var n=e[t],i=n||0;i++,e[t]=i,this.setLastActivity(e)},a.setLastActivity=function(e){var t=new Date;e[Ai.activityDuration]=+t-+this._lastActivity,this._lastActivity=t,e[Ai.sessionDuration]=+this._lastActivity-+this._sessionStart,e[Ai.lastActivity]=this._lastActivity},a.setMeasure=function(e,t){this._current[e]=t,this.setLastActivity(this._current)},a.setCounter=function(e,t){this._current[e]=t,this.setLastActivity(this._current)},a.incrementCounter=function(e){this.incrementACounter(this._current,e),this.incrementACounter(this._aggregate,e)},a.flush=function(){this._isStopped||(this._aggregate[Ai.status]=this._current[Ai.status],this.writeMeasures(this._taskItem),this._taskManager.resetInterval(this._taskItem,60*this.logIntervalInMinutes*1e3))},a.resetGroup=function(){var e=this._current[Ai.status];e&&(this._aggregate[Ai.status]=e),this._current={}},a.stop=function(){h.ULS.sendTraceTag(41964822,217,100,"Stopping logger. Flushing one last time"),this.flush(),this._isStopped=!0,this._taskManager.deleteTask(this._taskItem)},t=e,(n=[{key:"aggregateMeasures",get:function(){return this._aggregate}},{key:"currentMeasures",get:function(){return this._current}}])&&Ci(t.prototype,n),i&&Ci(t,i),e}();function wi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Ti,"SessionLogger",null,[107]);var Ii=function(){function e(e,t){this._tokens=e,this._errors=t}var t,n,i;return t=e,(n=[{key:"tokens",get:function(){return this._tokens}},{key:"errors",get:function(){return this._errors}}])&&wi(t.prototype,n),i&&wi(t,i),e}();Object(i.a)(Ii,"TokenRefreshArgs",null,[144]);var ki=function(){function e(e,t,n,i){var o;void 0===n&&(n=null),void 0===i&&(i=null),this._sessionExpiredDialogAlreadyDisplayed=!1,this._sessionExpiringDialogAlreadyDisplayed=!1,this._showDialogOnKickout=!0,this._showDialogOnExpiring=!0,this._sessionExpirationDialog=null,this._eventSource=new a.a,this._refreshingTokens=!1,this._lastAttemptToRefreshFailed=!1,this._shouldAbort=!1,this._appFrame=e,this._tokenRefreshManager=t,this._isTokenRefreshWhenExpiredEnabled=s.AFrameworkApplication.isWopiTokenRefreshWhenSessionExpiredEnabled;var l=new Date;h.ULS.sendTraceTag(39408093,217,50,"Initializing SessionExpirationManagerWithRefresh. {0}",((o={}).AccessTokenTtl=s.AFrameworkApplication.accessTokenTtl,o.NowGetTime=l.getTime(),o.BootTime=s.AFrameworkApplication.bootTime,o)),this._logger=n||new Ti(b.a.instance),this._statusManager=i,ui.a.instance.add_sessionExpiredDetected(Object(r.d)(this,this.sessionExpirationManagerWithRefresh_OnSessionExpired,"sessionExpirationManagerWithRefresh_OnSessionExpired")),ui.a.instance.add_sessionAboutToExpireDetected(Object(r.d)(this,this.sessionExpirationManagerWithRefresh_OnSessionExpiring,"sessionExpirationManagerWithRefresh_OnSessionExpiring")),s.AFrameworkApplication.isWopiTokenRefreshCancelExpirationEnabled&&(ui.a.instance.cancelSessionExpiration=Object(r.d)(this,this.refreshAccessTokenWhenSessionExpired,"refreshAccessTokenWhenSessionExpired")),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("NetworkListenerForTokenRefreshIsEnabled")&&$n.SessionStatusManager.instance.add_onSessionExpiringNetworkResumed(Object(r.d)(this,this.sessionExpirationManagerWithRefresh_OnSessionExpiring,"sessionExpirationManagerWithRefresh_OnSessionExpiring"))}var t=e.prototype;return t.add_onSessionExpired=function(t){this._eventSource.addHandler(e.sessionExpiredEventKey,t)},t.remove_onSessionExpired=function(t){this._eventSource.removeHandler(e.sessionExpiredEventKey,t)},t.add_onSessionExpiring=function(t){this._eventSource.addHandler(e.sessionExpiringEventKey,t)},t.remove_onSessionExpiring=function(t){this._eventSource.removeHandler(e.sessionExpiringEventKey,t)},t.add_onTokenRefreshed=function(t){this._eventSource.addHandler(e.tokenRefreshedEventKey,t)},t.remove_onTokenRefreshed=function(t){this._eventSource.removeHandler(e.tokenRefreshedEventKey,t)},t.hasSessionExpired=function(){var e=s.AFrameworkApplication.accessTokenTtl;return ui.a.instance.isSessionExpired(e)},t.refreshAccessTokenWhenSessionExpired=function(){return this.handleTokenRefresh(!1),!ui.a.instance.isSessionExpired(s.AFrameworkApplication.accessTokenTtl)},t.sessionExpirationManagerWithRefresh_OnSessionExpired=function(e,t){ui.a.instance.isSessionExpiredDueToScheduledShutdown?this.onSessionExpiredDetected(e,t):this._isTokenRefreshWhenExpiredEnabled?(this._lastAttemptToRefreshFailed=!1,this.handleTokenRefresh(!1)):this.onSessionExpiredDetected(e,t)},t.sessionExpirationManagerWithRefresh_OnSessionExpiring=function(e,t){ui.a.instance.isSessionAboutToExpireDueToScheduledShutdown?this.onSessionExpiringDetected(e,t):this.handleTokenRefresh(!0)},t.handleTokenRefresh=function(t){var n=this;if(!this._refreshingTokens&&!this._lastAttemptToRefreshFailed){if(this._statusManager&&this._statusManager.isKickedOut)return this._shouldAbort=!0,this._logger.setMeasure(Ai.status,Ai.kickedOut),this._logger.flush(),void this._logger.stop();if(h.ULS.sendTraceTag(40420955,217,50,"HandleTokenRefresh, IsExpiring:{0}. ShouldAbort: {1}",t,this._shouldAbort),this._shouldAbort)this.showSessionExpiredDialog();else{this._logger.flush(),this._logger.resetGroup(),this._logger.incrementCounter(Ai.requestGroups),this._refreshingTokens=!0;var i=this._tokenRefreshManager.refreshTokens(t);i.CW((function(r){n._tokenRefreshManager.processTokensOrErrors(i)?(n._logger.incrementCounter(Ai.successful),n._logger.setMeasure(Ai.status,Ai.success),n._showDialogOnExpiring=!1,n._isTokenRefreshWhenExpiredEnabled&&(n._showDialogOnKickout=!1),n._lastAttemptToRefreshFailed=!1,n._eventSource.raiseEvent(e.tokenRefreshedEventKey,new Ii(i.get_result().tokens,null))):(n._logger.incrementCounter(Ai.failed),n._logger.setMeasure(Ai.status,Ai.failed),t||(n._shouldAbort=n._tokenRefreshManager.isPermanentErrors(i.get_result().errors)),n._shouldAbort&&n._logger.setMeasure(Ai.aborting,JSON.stringify(i.get_result().errors)),n._lastAttemptToRefreshFailed=!0,n._eventSource.raiseEvent(e.tokenRefreshedEventKey,new Ii(null,i.get_result().errors))),n._logger.flush(),n._refreshingTokens=!1}))}}},t.onSessionExpiredDetected=function(e,t){this._isTokenRefreshWhenExpiredEnabled||ui.a.instance.remove_sessionExpiredDetected(Object(r.d)(this,this.onSessionExpiredDetected,"onSessionExpiredDetected")),h.ULS.sendTraceTag(39408094,217,50,"SessionExpiredDetected"),this.handleSessionExpired(ui.a.instance.isSessionExpiredDueToScheduledShutdown)},t.onSessionExpiringDetected=function(e,t){this._sessionExpiringDialogAlreadyDisplayed||this._sessionExpiredDialogAlreadyDisplayed||(h.ULS.sendTraceTag(39408095,217,50,"SessionExpiringDetected - Showing expiring dialog."),this._sessionExpiringDialogAlreadyDisplayed=!0,this.showSessionExpiringDialog(ui.a.instance.isSessionAboutToExpireDueToScheduledShutdown))},t.handleSessionExpired=function(e){if(!this._sessionExpiredDialogAlreadyDisplayed){var t,n;e?(t=Ln.a.sessionExpiredDueToScheduledShutdown,n="ScheduledShutdown"):(t=Ln.a.sessionAccessTokenExpired,n="SessionAccessTokenExpired"),s.AFrameworkApplication.reportError(t);var i=Object.assign(new N.a,{extendedProperties:new Map});if(i.extendedProperties.set("ErrorCode",String.format("{0}",t)),l.Health.instance.recordQosError(n,["SessionExpired"],!0,!0,!1,!0,i),!e){var r=new Date,a=new Date(s.AFrameworkApplication.bootTime);h.ULS.sendTraceTag(51642974,217,50,"Sending data to QoS. BootTime=[{0}], Now=[{1}], Duration=[{2}]",a,r,+r-+a),+r-+a<864e5&&l.Health.instance.recordQosError("SessionAccessTokenExpiredInLessThanOneDay",["SessionExpired"],!0,!0,!1,!0,i),+r-+a<2592e5&&l.Health.instance.recordQosError("SessionAccessTokenExpiredInLessThanThreeDays",["SessionExpired"],!0,!0,!1,!0,i)}this._sessionExpiredDialogAlreadyDisplayed=!0,this.showSessionExpiredDialog()}},t.showDialogOnKickout=function(e){this._showDialogOnKickout=e},t.showDialogOnExpiring=function(e){this._showDialogOnExpiring=e},t.showSessionExpiringDialog=function(t){if(!this._sessionExpirationDialog&&!yi.a.currentDialog){if(t){var n=Object(r.d)(this,this.disposeCallback,"disposeCallback");this._sessionExpirationDialog=_i(s.AFrameworkApplication.scheduledShutdownTtl,!1,Object(r.d)(this,this.sessionExpirationHandler,"sessionExpirationHandler"),n)}else if(this._showDialogOnExpiring){if(this._refreshingTokens)return;var i=Object(r.d)(this,this.disposeCallback,"disposeCallback");this._sessionExpirationDialog=_i(s.AFrameworkApplication.accessTokenTtl,!1,Object(r.d)(this,this.sessionExpirationHandler,"sessionExpirationHandler"),i)}h.ULS.sendTraceTag(39408096,217,50,"Raising event: [{0}] IsScheduledShutdown: [{1}]",e.sessionExpiringEventKey,t),this._eventSource.raiseEvent(e.sessionExpiringEventKey)}},t.showSessionExpiredDialog=function(){if(this._sessionExpirationDialog&&(this._sessionExpirationDialog.isDialogShowing()&&this._sessionExpirationDialog.hideDialog(),this._sessionExpirationDialog=null),this._showDialogOnKickout){if(this._logger.stop(),this._statusManager&&this._statusManager.isKickedOut)return;var t=Object(r.d)(this,this.disposeCallback,"disposeCallback");this._sessionExpirationDialog=_i(s.AFrameworkApplication.accessTokenTtl,!0,Object(r.d)(this,this.sessionExpirationHandler,"sessionExpirationHandler"),t)}h.ULS.sendTraceTag(39408097,217,50,"Raising event {0}",e.sessionExpiredEventKey),this._eventSource.raiseEvent(e.sessionExpiredEventKey)},t.disposeCallback=function(){this._sessionExpirationDialog=null},t.sessionExpirationHandler=function(e){(e||this._appFrame.beforeRefreshDocument())&&this._appFrame.refreshDocument(null)},e}();ki.sessionExpiredEventKey="SE",ki.sessionExpiringEventKey="SEP",ki.tokenRefreshedEventKey="SER",Object(i.a)(ki,"SessionExpirationManagerWithRefresh",null,[111,112]);var Fi=function(){function e(e,t,n,i){void 0===n&&(n=null),void 0===i&&(i=null),this._useApplicationProvidedManager=!1,this._instance=null,this._frame=e,this._manager=t,this._logger=n||new Ti(b.a.instance),this._statusManager=i}return e.prototype.create=function(){if(this._useApplicationProvidedManager=s.AFrameworkApplication.isWopiTokenRefreshEnabled,!this._useApplicationProvidedManager)return new bi(this._frame);if(s.AFrameworkApplication.logUniqueFlightedSettingUsage("WOPITokenRefreshIsEnabled"),h.ULS.sendTraceTag(39408088,217,50,"App has requested custom Session Expiration Manager"),!this._instance)switch(s.AFrameworkApplication.wopiTokenExpirationPolicy){case 1:h.ULS.sendTraceTag(39408090,217,50,"Creating new NullSessionExpirationManager"),this._instance=new di(this._frame);break;case 2:h.ULS.sendTraceTag(39408091,217,50,"Creating new SessionExpirationManagerWithRefresh"),this._instance=new ki(this._frame,this._manager,this._logger,this._statusManager);break;default:h.ULS.sendTraceTag(39408092,217,50,"Creating new legacy SessionExpirationManager"),this._instance=new bi(this._frame)}return h.ULS.sendTraceTag(39408089,217,50,"Returning instance of Session Expiration Manager: {0}",Object.getType(this._instance).getName()),this._instance},e}();Object(i.a)(Fi,"SessionExpirationManagerFactory",null,[110]);var Ei=function(){};Object(i.a)(Ei,"Error",null,[]);var Oi=function(){};Object(i.a)(Oi,"NamedResult",null,[]);var Pi=function(e){var t,n;function i(){return e.apply(this,arguments)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(Oi);Object(i.a)(Pi,"ErrorInfo",Oi,[]);var Di=n(316),Mi=n(103),Li=function(){function e(e,t,n,i){var a=this;void 0===i&&(i=null),this._retryCount=0,this._task=null,this._taskId=null,this._tokens=new te.a,this._errors=new te.a,this._tcs=null,this._isTokenExpiring=!1,this._taskManager=e,this._postmessengerFuture=t,this._postmessengerFuture.execute((function(e){e.registerCallback(d.a.hostRefreshSessionInfo,Object(r.d)(a,a.onHostResponseReceived,"onHostResponseReceived"))})),this._refreshPolicy=n,this._tokenRefreshStopwatch=new Di.a("WebServiceCall","TokenRefresh"),this._logger=i||new Ti(e)}var t=e.prototype;return t.onHostResponseReceived=function(e){if(e.MessageId===d.a.hostRefreshSessionInfo){var t=new te.a,n=new te.a;this._logger.incrementCounter(Ai.responses);var i=e.Values[nn.a.sessionInfo_TokenNamesField];(!i||i.length<=0)&&(Mi.b(40122317,306,15,"Found no tokens in the dictionary"),i=e.Values),Mi.b(40122318,306,100,"The Tokens array contains {0} tokens",i.length),this._logger.setMeasure("Correlation",e.CorrelationId);for(var r=0;r<i.length;r++){this._logger.setCounter(Ai.tokens,i.length);var a=i[r],o=a;if(o&&o.Name){this._logger.incrementCounter(o.Name);var s=a;s&&s.Value?(Mi.b(39408128,306,100,"Received token with name: {0}",s.Name),t.add(s),this._tokens.add(s),this._logger.setMeasure(Ai.status,Ai.success)):(Mi.b(39408129,306,15,"Received error for token {0}. Creating error object from {1}, TaskId {2}",o.Name,JSON.stringify(a),this._taskId),n.add(a),this._errors.add(a),this._logger.setMeasure(Ai.error,JSON.stringify(a)),this._logger.setMeasure(Ai.status,Ai.failed))}}if(Mi.b(39408130,306,50,"Received new tokens response. {0} tokens and {1} errors. Correlation {2}, TaskId {3}",t.get_count(),n.get_count(),e.CorrelationId,this._taskId),n.get_count()>0&&!this.isPermanentErrors(n)){var l=this._refreshPolicy.getRetryIntervalOverride(n);l!==this._refreshPolicy.retryInterval&&(this._logger.setCounter(Ai.retryOverride,l),this._taskManager.resetInterval(this._task,l))}else this._logger.flush(),this._task&&(Mi.b(39408131,306,100,"Deleting task {0} from task manager",this._task.name),this._taskManager.deleteTask(this._task)),this._tcs&&!this._tcs.get_task().get_isCompleted()&&this._tcs.setResult(new Ii(t,n))}else Mi.b(39408099,306,15,"Unexpected message.")},t.requestTokensOnce=function(e){if(this._retryCount>=this._refreshPolicy.maxRetryAttempts)return Mi.b(39408132,306,15,"Too many attempts to refresh tokens. Aborting. TaskId {0}",this._taskId),void this.createErrorAndSetResult(this._tcs,"TOO_MANY_ATTEMPTS","We did not receive a new token from the host after the maximum allowed number of attempts");var t={};t[nn.a.sessionInfo_TokenNamesField]=this._refreshPolicy.tokens;var n=B.a.create().toString();Mi.b(39408133,306,50,"Refreshing tokens {0}. Attempt {1}. Correlation {2}. TaskId {3}.",JSON.stringify(this._refreshPolicy.tokens),this._retryCount+1,n,this._taskId),this._postmessengerFuture.execute((function(e){e.sendMessage(d.a.appRefreshSessionInfo,t,n)})),this._retryCount++,this._logger.incrementCounter(Ai.requests)},t.createErrorAndSetResult=function(e,t,n){for(var i=new te.a,r=0;r<this._refreshPolicy.tokens.length;r++){var a=Object.assign(new Pi,{Name:this._refreshPolicy.tokens[r],Errors:[Object.assign(new Ei,{Id:t,Details:n})]});i.add(a),this._errors.add(a)}this._taskManager.deleteTask(this._task),this._logger.setMeasure(Ai.errorsCount,JSON.stringify(this._errors)),this._logger.setMeasure(Ai.status,Ai.failed),e&&!e.get_task().get_isCompleted()&&e.setResult(new Ii(new te.a,this._errors))},t.refreshTokens=function(e,t){var n=this;void 0===t&&(t=null),this._tokenRefreshStopwatch.start(),this._isTokenExpiring=e,this._taskId=B.a.create().toString(),Mi.b(41755338,306,50,"RefreshTokens Start, TaskId: [{0}]. IsTokenExpiring: [{1}].",this._taskId,this._isTokenExpiring),this._retryCount=0,this._errors.clear(),this._tokens.clear();var i=new A.a;return this._tcs=i,t&&t.R((function(){var e=!!i&&!i.get_task().get_isCompleted();Mi.b(588096223,306,50,"RefreshTokens Cancelled, TaskId: [{0}]. IsTokenExpiring: [{1}]. isTaskStillRunning [{2}].",n._taskId,n._isTokenExpiring,e),e&&n.createErrorAndSetResult(i,"ABORTED_BY_CALLER","The refresh was aborted by the caller")})),this._task=new u.a(this._refreshPolicy.priority,2,this._refreshPolicy.retryInterval,Object(r.d)(this,this.requestTokensOnce,"requestTokensOnce"),98,d.a.appRefreshSessionInfo,!0),this._taskManager.addTask(this._task),this._tcs.get_task()},t.processTokensOrErrors=function(e){this._tokenRefreshStopwatch.stop();var t=this.hasErrors(e.get_result().errors);return h.ULS.sendTraceTag(41755339,217,50,"ProcessTokensOrErrors: TokenRefreshResult:{0},TaskId:{1},IsTriggerByTokenExpiring:{2},RetryCount:{3},TotalErrorCount:{4},LastErrorName:{5},LastErrorId:{6},LastErrorDetail:{7}",!t,this._taskId,this._isTokenExpiring,this._retryCount,this._errors.get_count(),e.get_result().errors.get_count()>0?e.get_result().errors.get_item(0).Name:"",e.get_result().errors.get_count()>0&&e.get_result().errors.get_item(0).Errors.length>0?e.get_result().errors.get_item(0).Errors[0].Id:"",e.get_result().errors.get_count()>0&&e.get_result().errors.get_item(0).Errors.length>0?e.get_result().errors.get_item(0).Errors[0].Details:""),!t&&this.processTokens(e.get_result().tokens)},t.isPermanentErrors=function(e){return this._refreshPolicy.isPermanentErrors(e)},t.processTokens=function(e){for(var t=0;t<e.get_count();t++){var n=e.get_item(t);if(n.Name===nn.a.accessToken){var i,r,a=(new Date).getTime();if(n.Expiry>s.AFrameworkApplication.accessTokenTtl)h.ULS.sendTraceTag(39706827,217,50,"Updating AccessToken: {0}",((i={}).AccessTokenTtl=n.Expiry,i.NowGetTime=a,i.BootTime=s.AFrameworkApplication.bootTime,i),"PreviousAccessTokenTtl",s.AFrameworkApplication.accessTokenTtl),s.AFrameworkApplication.accessToken=n.Value,s.AFrameworkApplication.accessTokenTtl=Math.floor(n.Expiry),s.AFrameworkApplication.wopiTokenLastRefreshTime=a,s.AFrameworkApplication.accessTokenServerExpirationTime=Math.floor(n.Expiry);else h.ULS.sendTraceTag(39706828,217,15,"Ignoring AccessToken because it expires sooner than the current one: {0}",((r={}).AccessTokenTtl=n.Expiry,r.NowGetTime=a,r.BootTime=s.AFrameworkApplication.bootTime,r),"PreviousAccessTokenTtl",s.AFrameworkApplication.accessTokenTtl)}}return!0},t.hasErrors=function(e){for(var t=!1,n=0;n<e.get_count();n++){t=!0;var i=e.get_item(n);h.ULS.sendTraceTag(39706829,217,15,"Received error for token {0}. Errors: {1}. TaskId: {2} ",i.Name,JSON.stringify(i.Errors),this._taskId)}return t},e}();function Ri(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ui(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ui(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Ui(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}Object(i.a)(Li,"TokenRefreshManager",null,[109]);var Hi=function(){function e(){this.retryInterval=s.AFrameworkApplication.wopiTokenRefreshRetryeInterval,this.maxRetryAttempts=s.AFrameworkApplication.wopiTokenRefreshMaxRetryAttempts,this.tokens=s.AFrameworkApplication.get_wopiTokensToRefresh(),this.expirationPolicy=s.AFrameworkApplication.wopiTokenExpirationPolicy,this.priority=s.AFrameworkApplication.wopiTokenTaskItemPriority,this._retriableErrorInterval=this.setRetryIntervalForNetworkIssue(),this._wopiTokenRefreshPermanentHostErrorList=s.AFrameworkApplication.get_wopiTokenRefreshPermanentHostErrorIdList()}var t=e.prototype;return t.isPermanentErrors=function(e){var t=JSON.stringify(e);if(this._wopiTokenRefreshPermanentHostErrorList&&this._wopiTokenRefreshPermanentHostErrorList.length>0)for(var n,i=Ri(this._wopiTokenRefreshPermanentHostErrorList);!(n=i()).done;){var r=n.value;if(r.length>0&&t.indexOf(r)>=0)return!0}return!1},t.getRetryIntervalOverride=function(e){try{if(e)for(var t,n=Ri(e);!(t=n()).done;){var i=t.value;if(i.Errors)for(var r,a=Ri(i.Errors);!(r=a()).done;){var o=r.value;if(o.Id in this._retriableErrorInterval)return Number.parseInvariant(this._retriableErrorInterval[o.Id].toString())}}}catch(e){h.ULS.sendTraceTag(41501720,217,50,"TokenRefreshPolicy:GetRetryIntervalOverride, exception:{0}",e.toString())}return this.retryInterval},t.setRetryIntervalForNetworkIssue=function(){var e={};try{if(!s.AFrameworkApplication.get_wopiTokenRefreshNetworkErrorIdList()||s.AFrameworkApplication.get_wopiTokenRefreshNetworkErrorIdList().length<=0||""===s.AFrameworkApplication.get_wopiTokenRefreshNetworkErrorIdList()[0])return e;for(var t,n=Ri(s.AFrameworkApplication.get_wopiTokenRefreshNetworkErrorIdList());!(t=n()).done;){var i=t.value;i.length>0&&(e[i]=s.AFrameworkApplication.wopiTokenRefreshRetryIntervalForClientNetworkIssue)}}catch(e){h.ULS.sendTraceTag(41755340,217,50,"TokenRefreshPolicy:SetRetryIntervalForNetworkIssue, exception:{0}",e.toString())}return e},e}();function Bi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Hi,"TokenRefreshPolicy",null,[108]);var xi=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){e.initOnFullAppSettingsReady()}))},r.initOnFullAppSettingsReady=function(){this._container.resolve("Common.ISessionExpirationManagerFactory"),this._container.resolve("Common.ISessionExpirationManager"),this._container.resolve("Common.ISessionExpirationManagerWithDialog")},r.dispose=function(){},r.configure=function(e){this._container=e,e.register(107,"Common.App.SessionExpiration.ISessionLogger").singleInstance().usingFactory((function(){return new Ti(b.a.instance)})),e.register(108,"Common.App.SessionExpiration.ITokenRefreshPolicy").singleInstance().usingFactory((function(){return new Hi})),e.register(109,"Common.App.SessionExpiration.ITokenRefreshManager").singleInstance().usingFactory((function(){return new Li(b.a.instance,s.AFrameworkApplication.get_hostPostmessengerFuture(),e.resolve("Common.App.SessionExpiration.ITokenRefreshPolicy"),e.resolve("Common.App.SessionExpiration.ISessionLogger"))})),e.register(110,"Common.ISessionExpirationManagerFactory").singleInstance().usingFactory((function(){return new Fi(s.AFrameworkApplication.activeFrame,e.resolve("Common.App.SessionExpiration.ITokenRefreshManager"),e.resolve("Common.App.SessionExpiration.ISessionLogger"),e.tryResolve("Common.ISessionStatus"))})),e.register(111,"Common.ISessionExpirationManagerWithDialog").singleInstance().usingFactory((function(){return e.resolve("Common.ISessionExpirationManagerFactory").create()})),e.register(112,"Common.ISessionExpirationManager").singleInstance().usingFactory((function(){return e.resolve("Common.ISessionExpirationManagerWithDialog")}))},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.SessionExpiration"}}])&&Bi(t.prototype,n),i&&Bi(t,i),e}();Object(i.a)(xi,"SessionExpirationPackage",null,[14,15]);function Ni(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ji=function(){function e(e,t,n){this._actionManager=e,this._isMacOfficeTrialOfferEnabled=t,this._lcid=n}var t,n,i,a=e.prototype;return a.registerActions=function(){this._actionManager.addAction(p.a.tryMacOffice,de.a.frame,Object(r.d)(this,this.onTryMacOffice,"onTryMacOffice")),this._actionManager.addAction(p.a.tryMacOfficeFromWordViewer,de.a.frame,Object(r.d)(this,this.onTryMacOfficeFromViewer,"onTryMacOfficeFromViewer")),this._actionManager.addAction(p.a.tryMacOfficeFromPowerPointViewer,de.a.frame,Object(r.d)(this,this.onTryMacOfficeFromViewer,"onTryMacOfficeFromViewer"))},a.onTryMacOffice=function(e,t,n,i,r){if(1===n)return 32;if(r){var a=r.SourceControlId;"btnjTryMacOfficeForWordEditor"===a?tt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(12),"_blank",void 0,void 0,"MacOfficeOffer.TriggerFromWordEditor"):"PptJewel.About.TryMacOffice"===a&&tt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(22),"_blank",void 0,void 0,"MacOfficeOffer.TriggerFromPPTEditor")}else this.launchMacOfficeTrialWindow();return 32},a.onTryMacOfficeFromViewer=function(e,t,n,i,r){if(1===n)return 32;switch(e){case p.a.tryMacOfficeFromWordViewer:tt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(15),"_blank",void 0,void 0,"MacOfficeOffer.TriggerFromWordViewer");break;case p.a.tryMacOfficeFromPowerPointViewer:tt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(25),"_blank",void 0,void 0,"MacOfficeOffer.TriggerFromPPTViewer")}return 32},a.launchMacOfficeTrialWindow=function(t){void 0===t&&(t=null);var n=0;t&&(n=t);var i=2===n?"https://go.microsoft.com/fwlink/?LinkId=331579":e.macOfficeTrialTarget;tt.a.safelyOpenWindow(i,"_blank",void 0,void 0,"LaunchMacTrialWindow")},t=e,i=[{key:"macOfficeTrialTarget",get:function(){return Dt.a.getFwLinkUrl("522401")}}],(n=[{key:"shouldOfferMacOfficeTrial",get:function(){return this._isMacOfficeTrialOfferEnabled&&U.a.isMac&&!U.a.isPpcMac&&!MSOJS.ClientUtils.IsO14MacPluginInstalled()}},{key:"shouldOfferMacOfficeTrialInFileMenu",get:function(){var t=this.shouldOfferMacOfficeTrial;return t||s.AFrameworkApplication.theWsaClient.setBool(e.DATAID_WACC2RBUTTONTRIMMED,1),t}},{key:"shouldOfferMacOfficeTrialInErrorDialog",get:function(){return this.shouldOfferMacOfficeTrial}}])&&Ni(t.prototype,n),i&&Ni(t,i),e}();function Wi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ji.DATAID_WACC2RBUTTONTRIMMED=9124,Object(i.a)(ji,"MacOfficeOffer",null,[171]);var Vi=function(){function e(e,t,n){this._actionManager=e,this._isOfficeTrialOfferEnabled=t,this._lcid=n}var t,n,i,a=e.prototype;return a.registerActions=function(){this._actionManager.addAction(p.a.tryOffice,de.a.frame,Object(r.d)(this,this.onTryOffice,"onTryOffice")),this._actionManager.addAction(p.a.tryOfficeThroughTellMe,de.a.frame,Object(r.d)(this,this.tryOfficeThroughTellMe,"tryOfficeThroughTellMe")),this._actionManager.addAction(p.a.tryOfficeFromWordViewer,de.a.frame,Object(r.d)(this,this.tryOfficeThroughViewer,"tryOfficeThroughViewer")),this._actionManager.addAction(p.a.tryOfficeFromPowerPointViewer,de.a.frame,Object(r.d)(this,this.tryOfficeThroughViewer,"tryOfficeThroughViewer"))},a.onTryOffice=function(e,t,n,i,r){if(2===n)if(r){var a=r.SourceControlId;"btnjTryOfficeForWordEditor"===a?tt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(11),"_blank",void 0,void 0,"OfficeTrial.TriggerFromWordEditor"):"PptJewel.About.TryOffice"===a?tt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(21),"_blank",void 0,void 0,"OfficeTrial.TriggerFromPPTViewer"):this.launchOffer()}else this.launchOffer();return 32},a.tryOfficeThroughTellMe=function(e,t,n,i,r){if(2===n)if(r){var a=r.SourceControlId;tt.a.safelyOpenWindow(Dt.a.getFwLinkUrl("862405")+this.getParameterForTellMeFeatures(a),"_blank",void 0,void 0,"TryOfficeThroughTellMe.WithSourceControlId")}else tt.a.safelyOpenWindow(Dt.a.getFwLinkUrl("522402"),"_blank",void 0,void 0,"TryOfficeThroughTellMe.Legacy");return 32},a.tryOfficeThroughViewer=function(e,t,n,i,r){if(2===n)switch(e){case p.a.tryOfficeFromWordViewer:tt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(14),"_blank",void 0,void 0,"TryOfficeThroughViewer.Word");break;case p.a.tryOfficeFromPowerPointViewer:tt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(24),"_blank",void 0,void 0,"TryOfficeThroughViewer.PPT")}return 32},a.launchOffer=function(t){void 0===t&&(t=null);var n=0;t&&(n=t),tt.a.safelyOpenWindow(e.getLinkForPlatformAndApplication(n),"_blank",void 0,void 0,"LaunchOfficeOffer")},a.getParameterForTellMeFeatures=function(e){var t=0;switch(e){case"jbtnTryOfficeThroughTellMeForWordTrackChanges":t=1;break;case"jbtnTryOfficeThroughTellMeForWordShapes":t=2;break;case"jbtnTryOfficeThroughTellMeForWordLabel":t=3;break;case"jbtnTryOfficeThroughTellMeForWordCitations":t=4;break;case"jbtnTryOfficeThroughTellMeForWordTextBox":t=5;break;case"jbtnTryOfficeThroughTellMeForWordTableOfContent":t=6;break;case"jbtnTryOfficeThroughTellMeForWordSmartArt":t=7;break;case"jbtnTryOfficeThroughTellMeForWordWordArt":t=8;break;case"jbtnTryOfficeThroughTellMeForWordMultiColumnLayout":t=9;break;case"jbtnTryOfficeThroughTellMeForWordEquation":t=10;break;case"jbtnTryOfficeThroughTellMeForPPTGroupShapes":t=16;break;case"jbtnTryOfficeThroughTellMeForPPTWordArt":t=17;break;case"jbtnTryOfficeThroughTellMeForPPTSpellCheckDict":t=18;break;case"jbtnTryOfficeThroughTellMeForPPTInsertAudio":t=19;break;case"jbtnTryOfficeThroughTellMeForPPTInsertChart":t=20;break;case"TellMe.TryOfficeThroughTellMeForXLSSpellCheck":t=26;break;case"TellMe.TryOfficeThroughTellMeForXLSMacros":t=27;break;case"TellMe.TryOfficeThroughTellMeForXLSPivotTable":t=28;break;case"TellMe.TryOfficeThroughTellMeForXLSHeaderFooter":t=29}return t?String.format("&pc={0:D}",t):""},e.getLinkForPlatformAndApplication=function(e){if(U.a.isIPad)switch(e){case 1:return Dt.a.getFwLinkUrl("393806");case 2:return Dt.a.getFwLinkUrl("393810");case 3:return Dt.a.getFwLinkUrl("393809");case 5:return Dt.a.getFwLinkUrl("393805")}else if(U.a.isAndroid)switch(e){case 1:return Dt.a.getFwLinkUrl("521979");case 3:return Dt.a.getFwLinkUrl("521980");case 5:return Dt.a.getFwLinkUrl("521978");case 2:return Dt.a.getFwLinkUrl("522490")}else{if(2===e)return Dt.a.getFwLinkUrl("517778");if(1===e)return Dt.a.getFwLinkForUpsellFeatures(30)}return Dt.a.getFwLinkUrl("522402")},t=e,(n=[{key:"offerOfficeTrialInFileMenu",get:function(){return this.shouldOfferOfficeTrial}},{key:"offerOfficeTrialInDialog",get:function(){return this.shouldOfferOfficeTrial&&MSOJS.ClientUtils.OfferOfficeInDialog()}},{key:"shouldOfferOfficeTrial",get:function(){return this._isOfficeTrialOfferEnabled&&!U.a.isMac}}])&&Wi(t.prototype,n),i&&Wi(t,i),e}();Object(i.a)(Vi,"OfficeTrialExperience",null,[122]);var qi=function(){function e(){}return e.prototype.configure=function(e){e.register(Vi,"Common.App.OpenInClient.OfficeTrialExperience").as("Common.IOfficeTrialExperience").singleInstance().usingFactory((function(){return new Vi(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.isOfficeTrialOfferEnabled,s.AFrameworkApplication.lcid)})),e.register(ji,"Common.App.OpenInClient.MacOfficeOffer").as("Common.IMacOfficeOffer").singleInstance().usingFactory((function(){return new ji(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.isMacOfficeTrialOfferEnabled,s.AFrameworkApplication.lcid)}))},e}();Object(i.a)(qi,"OpenInClientConfiguration",null,[15]);var Gi=n(25),Ki=n(20),zi=n(14),Ji=n(7),Xi=n(22);function Qi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Zi=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).commandsHeaderText=CommonUIStrings.l_AccHelpDialogCommandsHeaderText,n.shortcutHeaderText=CommonUIStrings.l_AccHelpDialogShortcutHeaderText,n._shortcutEntries=null,n._moreHelpLink=null,n._dialogTable=null,n._selectedRow=null,n.dialogBody=null,n._focusManager=t,n.dialogHtml="<div id='AccessibilityHelpDialogBody'></div>",n.dialogId="AAccessibilityHelpDialog",n.buttonsOption=6,n.setButtonText(0,CommonUIStrings.l_DialogClose),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a,o,s,l=i.prototype;return l.setDialogProperties=function(t){e.prototype.setDialogProperties.call(this,t),this.populateDialogBody()},l.showAndFocus=function(){this.showDialog(this.dialogTitle,Object(r.d)(this,this.accHelpDialogResultHandler,"accHelpDialogResultHandler")),this.rebindTabNavigationHandlers(),this.setFocus()},l.setFocus=function(){this._dialogTable?(this._selectedRow=this._dialogTable.tBodies[0].firstChild,this.setFocusOnElement(this._selectedRow)):this._btnAction&&"none"!==this._btnAction.style.display?this.setFocusOnElement(this._btnAction):this.setFocusOnElement(this._btnCancel)},l.attachDialogEvents=function(){if(this._keyInputManager.registerHandler(f.EventNames.keyDown,this.dialogBody,Object(r.d)(this,this.accHelpDialogKeydownHandler,"accHelpDialogKeydownHandler")),this._dialogTable){this._keyInputManager.registerHandler(f.EventNames.keyUp,this._dialogTable,Object(r.d)(this,this.tableOnKeyUpHandler,"tableOnKeyUpHandler"));for(var t=this._dialogTable.tBodies[0].children,n=0;n<t.length;n++)if(Ee.a.addHandler(t[n],f.EventNames.focus,Object(r.d)(this,this.rowOnFocusHandler,"rowOnFocusHandler")),Ee.a.addHandler(t[n],f.EventNames.blur,Object(r.d)(this,this.rowOnBlurHandler,"rowOnBlurHandler")),U.a.isInternetExplorerNonEdge)for(var i=t[n].children,a=0;a<i.length;a++)Ee.a.addHandler(i[a],f.EventNames.focus,Object(r.d)(this,this.cellOnFocusHandler,"cellOnFocusHandler"))}e.prototype.attachDialogEvents.call(this)},l.detachDialogEvents=function(){if(this._keyInputManager&&(this._keyInputManager.unregisterHandler(f.EventNames.keyDown,this.dialogBody,Object(r.d)(this,this.accHelpDialogKeydownHandler,"accHelpDialogKeydownHandler")),this._dialogTable&&this._keyInputManager.unregisterHandler(f.EventNames.keyUp,this._dialogTable,Object(r.d)(this,this.tableOnKeyUpHandler,"tableOnKeyUpHandler"))),this._dialogTable)for(var t=this._dialogTable.tBodies[0].children,n=0;n<t.length;n++)if(Ee.a.removeHandler(t[n],f.EventNames.focus,Object(r.d)(this,this.rowOnFocusHandler,"rowOnFocusHandler")),Ee.a.removeHandler(t[n],f.EventNames.blur,Object(r.d)(this,this.rowOnBlurHandler,"rowOnBlurHandler")),U.a.isInternetExplorerNonEdge)for(var i=t[n].children,a=0;a<i.length;a++)Ee.a.removeHandler(i[a],f.EventNames.focus,Object(r.d)(this,this.cellOnFocusHandler,"cellOnFocusHandler"));e.prototype.detachDialogEvents.call(this)},l.rebindTabNavigationHandlers=function(){this.currentFocusRegion.scope.unBindAction(this._focusManager._tabInput),this.currentFocusRegion.scope.unBindAction(this._focusManager._tabShiftInput),this.currentFocusRegion.scope.bindAction(this._focusManager._tabInput,p.a.accessibilityHelpDialogFocusForward),this.currentFocusRegion.scope.bindAction(this._focusManager._tabShiftInput,p.a.accessibilityHelpDialogFocusBackward)},l.handleTabFocus=function(e,t,n,i,r){if(!this.currentFocusRegion.listing||!this.currentFocusRegion.listing.currentElement)return 2;var a=this.currentFocusRegion.listing.currentElement;if(this._dialogTable&&(a===this._btnCancel&&e===p.a.accessibilityHelpDialogFocusForward||a===this._moreHelpLink&&e===p.a.accessibilityHelpDialogFocusBackward))this.setFocusOnElement(this._selectedRow);else if(a.id.startsWith("SelectableTableRow")){var o=null;e===p.a.accessibilityHelpDialogFocusForward?o=this._moreHelpLink:e===p.a.accessibilityHelpDialogFocusBackward&&(o=this._btnCancel),o&&this.setFocusOnElement(o)}else if(e===p.a.accessibilityHelpDialogFocusForward)this.currentFocusRegion.moveForward();else{if(e!==p.a.accessibilityHelpDialogFocusBackward)return 2;this.currentFocusRegion.moveBackward()}return 32},l.rowOnFocusHandler=function(e){e.target.setAttribute(Ji.a.ariaSelectedAttribute,Ji.a.ariaTrueValue),Sys.UI.DomElement.removeCssClass(this._selectedRow,"inactiveRowSelection"),this._selectedRow=e.target},l.rowOnBlurHandler=function(e){e.target.removeAttribute(Ji.a.ariaSelectedAttribute),Sys.UI.DomElement.addCssClass(e.target,"inactiveRowSelection")},l.cellOnFocusHandler=function(e){var t=e.target.parentNode;t&&t!==this._selectedRow&&this.setFocusOnElement(t)},l.tableOnKeyUpHandler=function(e){return e.innerEvent.keyCode===Gi.a.vK_Enter&&(e.innerEvent.stopPropagation(),!0)},l.accHelpDialogKeydownHandler=function(e){if(!e.innerEvent)return!1;var t=e.innerEvent.keyCode;if(e.eventName===f.EventNames.keyDown){var n=this.getIndexOfRow(this._selectedRow),i=-1,r=H.c(this.shortcutEntries)-1;t===Sys.UI.Key.down?i=n<r?n+1:0:t===Sys.UI.Key.up?i=n>0?n-1:r:t===Sys.UI.Key.home?i=0:t===Sys.UI.Key.end&&(i=r),-1!==i&&this.setFocusOnElement(this._dialogTable.tBodies[0].children[i])}return!0},l.accHelpDialogResultHandler=function(e,t){},l.populateDialogBody=function(){this.dialogBody=document.getElementById("AccessibilityHelpDialogBody")||this._bodyPanel,this.createSubtitle(),this.createShortcutsTable(),this.createMoreHelpLink()},l.createSubtitle=function(){if(this.dialogSubtitle){var e=document.createElement("div");e.className="WACDialogSubtitle";var t=document.createElement("span");t.innerText=this.dialogSubtitle,e.appendChild(t),this._divMessageBoxTitle.appendChild(e)}},l.createShortcutsTable=function(){if(this.shortcutEntries&&!H.f(this.shortcutEntries)){this._dialogTable=document.createElement("table"),this._dialogTable.className="SelectableDialogTable";var e=document.createElement("thead"),t=document.createElement("tr");t.setAttribute(Ji.a.ariaRoleAttribute,Ji.a.ariaRowRole),e.appendChild(t);var n=Xi.DomUtils.createElementWithInnerTextSafe(14,this.commandsHeaderText);t.appendChild(n);var i=Xi.DomUtils.createElementWithInnerTextSafe(14,this.shortcutHeaderText);t.appendChild(i),this._dialogTable.appendChild(e);var r=document.createElement("tbody"),a=0,o=this.shortcutEntries;for(var s in o){var l={key:s,value:o[s]},c=document.createElement("tr");c.tabIndex=0,c.setAttribute(Ji.a.ariaRoleAttribute,Ji.a.ariaRowRole),c.id="SelectableTableRow"+a++;var u=Xi.DomUtils.createElementWithInnerTextSafe(15,l.key);c.appendChild(u);var d=Xi.DomUtils.createElementWithInnerTextSafe(15,l.value);c.appendChild(d),r.appendChild(c)}r.style.maxHeight=this.tableMaxHeight+"px",this._dialogTable.appendChild(r),this.dialogBody.appendChild(this._dialogTable)}},l.createMoreHelpLink=function(){if(this.moreHelpLinkText&&this.moreHelpLinkUrl){var e=document.createElement("div");e.className="WACDialogLearnMoreLinkContainer",this._moreHelpLink=document.createElement("a"),this._moreHelpLink.innerText=this.moreHelpLinkText,this._moreHelpLink.href=this.moreHelpLinkUrl,this._moreHelpLink.target="_blank",this._moreHelpLink.id=this.myId("AccessibilityHelpDialogLink"),this._moreHelpLink.className=Tt.AFrame.allowBrowserClickClassname,e.appendChild(this._moreHelpLink),this._divMessageBox.insertBefore(e,this._divMessageBox.lastChild)}},l.getIndexOfRow=function(e){var t="SelectableTableRow".length;return Number.parseInvariant(e.id.substr(t))},l.addCommandShortcutToDict=function(e,t,n,i){if(void 0===i&&(i=null),e&&t&&n){var r=i?String.format(n,i):n;e[t]=r}},l.getSpecialKeyForOS=function(e,t){return U.a.isMac?t:e},a=i,(o=[{key:"dialogSubtitle",get:function(){return null}},{key:"shortcutEntries",get:function(){return this._shortcutEntries||(this._shortcutEntries=this.initializeDictionary()),this._shortcutEntries}},{key:"tableMaxHeight",get:function(){return 300}},{key:"moreHelpLinkUrl",get:function(){return"https://go.microsoft.com/fwlink/p/?LinkId=325036"}},{key:"moreHelpLinkText",get:function(){return CommonUIStrings.l_AccHelpDialogMoreHelpLinkText}},{key:"currentFocusRegion",get:function(){return this._focusManager.getCurrentRegion()}}])&&Qi(a.prototype,o),s&&Qi(a,s),i}(hi.a);function Yi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Zi,"AAccessibilityHelpDialog",hi.a,[145]);var $i=function(e){var t,n,i,r,a;function o(t){return e.call(this,t)||this}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,o.prototype.initializeDictionary=function(){var e={};return e[CommonUIStrings.l_AccHelpDialogAccHelpCommand]=CommonUIStrings.l_AccHelpDialogAccHelpShortcut,e[CommonUIStrings.l_AccHelpDialogMoveInEditingAreaCommand]=CommonUIStrings.l_AccHelpDialogMoveInEditingAreaShortcut,s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("AccessibleMovingDialogsEnabled")&&(e[CommonUIStrings.l_AccHelpDialogOpenDialogMenuCommand]=CommonUIStrings.l_AccHelpDialogOpenDialogMenuShortcut),e},i=o,(r=[{key:"dialogTitle",get:function(){return CommonUIStrings.l_AccHelpDialogAppViewerTitle}}])&&Yi(i.prototype,r),a&&Yi(i,a),o}(Zi);Object(i.a)($i,"PdfViewerAccessibilityHelpDialog",Zi,[]);var er=n(18);function tr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var nr=function(e){var t,n;function i(t,n){var i;return(i=e.call(this,n)||this)._actionManager=t,i.buttonsOption=1,i.setButtonText(1,WordViewerIntl.WordViewerStrings.L_AccessibilityMode),i.setButtonText(0,CommonUIStrings.l_DialogClose),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r,a,o,s=i.prototype;return s.populateDialogBody=function(){e.prototype.populateDialogBody.call(this);var t=document.createElement("div");t.style.maxWidth="550px";var n=Xi.DomUtils.createElementWithInnerTextSafe(12,WordViewerIntl.WordViewerStrings.L_AccHelpDialogSwitchToAccessibleMode);t.appendChild(n),this.dialogBody.appendChild(t),this._divMessageBox.setAttribute(Ji.a.ariaDescribedByAttribute,"WACDialogText")},s.accHelpDialogResultHandler=function(e,t){1===e?this._actionManager.processAction(er.a.toggleViewMode,2):e||this.hide()},s.initializeDictionary=function(){return null},r=i,(a=[{key:"dialogTitle",get:function(){return CommonUIStrings.l_AccHelpDialogAppViewerTitle}}])&&tr(r.prototype,a),o&&tr(r,o),i}(Zi);Object(i.a)(nr,"PngViewerAccessibilityHelpDialog",Zi,[]);var ir=function(){function e(e,t){this._dialog=null,this._actionManager=e,this._focusManager=t}var t=e.prototype;return t.registerActions=function(){if(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UIDiscoverabilityEnabled")&&zi.App.instance.userMayEnterAccessiblePdfMode){var e=Ki.KeyInputManager.hashKey(Gi.a.VK_A,5);this._focusManager.getScope(Tt.AFrame.documentFocusID).unBindAction(e),this._focusManager.getScope(Tt.AFrame.mainAppFocusId).bindAction(e,p.a.showAccessibilityHelpDialog),this._actionManager.addAction(p.a.showAccessibilityHelpDialog,de.a.frame,Object(r.d)(this,this.showAccessibilityHelpDialog,"showAccessibilityHelpDialog")),this._actionManager.addAction(p.a.accessibilityHelpDialogFocusForward,de.a.frame,Object(r.d)(this,this.accHelpDialogTabFocusHandler,"accHelpDialogTabFocusHandler")),this._actionManager.addAction(p.a.accessibilityHelpDialogFocusBackward,de.a.frame,Object(r.d)(this,this.accHelpDialogTabFocusHandler,"accHelpDialogTabFocusHandler"))}},t.showAccessibilityHelpDialog=function(e,t,n,i,r){return 1===n?32:(zi.App.instance.isAccessiblePdfMode?this._dialog=new $i(this._focusManager):this._dialog=new nr(this._actionManager,this._focusManager),this._dialog?(this._dialog.showAndFocus(),32):(h.ULS.sendTraceTag(21233674,334,10,"AccessibilityHelpDialog failed to initialize"),8))},t.accHelpDialogTabFocusHandler=function(e,t,n,i,r){return this._dialog?this._dialog.handleTabFocus(e,t,n,i,r):2},e}();function rr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ir,"AccessibilityHelpDialogActor",null,[]);var ar=function(){function e(e,t){this._hostPostmessenger=null,this._actionManager=e,this._hostPostmessengerFuture=t}var t,n,i,a=e.prototype;return a.registerActions=function(){this._actionManager.addActionWithFlags(p.a.close,de.a.frame,Object(r.d)(this,this.closeDocument,"closeDocument"),2176),this._actionManager.addActionWithFlags(p.a.fileProperties,de.a.frame,Object(r.d)(this,this.fileProperties,"fileProperties"),128),this._actionManager.addAction(p.a.fileSharing,de.a.frame,Object(r.d)(this,this.fileSharing,"fileSharing")),this._actionManager.addAction(p.a.moveToFolder,de.a.frame,Object(r.d)(this,this.moveToFolder,"moveToFolder")),this._actionManager.addActionWithFlags(p.a.copyAndEdit,de.a.frame,Object(r.d)(this,this.copyAndEdit,"copyAndEdit"),128),this._actionManager.addActionWithFlags(p.a.replyWithChanges,de.a.frame,Object(r.d)(this,this.replyWithChanges,"replyWithChanges"),128),this._actionManager.addActionWithFlags(p.a.showFileVersion,de.a.frame,Object(r.d)(this,this.fileVersion,"fileVersion"),128),this._actionManager.addAction(p.a.downloadACopy,de.a.frame,Object(r.d)(this,this.downloadACopy,"downloadACopy")),this._actionManager.addAction(p.a.downloadACopyDownloadButtonClick,de.a.frame,vt.ActionManager.doNothingButReportHandler),this._actionManager.addActionWithFlags(p.a.reportAbuseLink,de.a.frame,Object(r.d)(this,this.reportAbuseLink,"reportAbuseLink"),128),this._actionManager.addActionWithFlags(p.a.signIn,de.a.frame,Object(r.d)(this,this.signInInternal,"signInInternal"),128),this._actionManager.addAction(p.a.workflow,de.a.frame,Object(r.d)(this,this.workflow,"workflow")),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DocumentNameInJewelInfoMenuIsEnabled")&&this._actionManager.addActionWithFlags(p.a.queryBreadcrumbDocName,de.a.frame,Object(r.d)(this,this.queryBreadcrumbDocName,"queryBreadcrumbDocName"),96),this._actionManager.addActionWithFlags(p.a.queryCopyAndEditButton,de.a.frame,Object(r.d)(this,this.queryCopyAndEditButton,"queryCopyAndEditButton"),96),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DiagnosticsInfoInJewelAboutMenuIsEnabled")&&(this._actionManager.addActionWithFlags(p.a.queryBuildVersion,de.a.frame,Object(r.d)(this,this.queryBuildVersion,"queryBuildVersion"),2144),this._actionManager.addActionWithFlags(p.a.querySessionId,de.a.frame,Object(r.d)(this,this.querySessionId,"querySessionId"),2144)),this._actionManager.addAction(p.a.conversation,de.a.frame,Object(r.d)(this,this.conversation,"conversation")),this._hostPostmessengerFuture.execute(Object(r.d)(this,this.onHostPostmessengerCreated,"onHostPostmessengerCreated"))},a.onHostPostmessengerCreated=function(e){this._hostPostmessenger=e},a.closeDocument=function(e,t,n,i,r){var a=2===n,o=gi.h;return r&&(o=r),t&&a&&!this.beforeCloseDocument(o)?8:this.closeDocumentInternal(a,o)},a.beforeCloseDocument=function(e){return!0},a.closeDocumentInternal=function(e,t){if(s.AFrameworkApplication.activeFrame.applicationInstance.shouldCommandBeHostControlled("3033402446"))return h.ULS.sendTraceTag(41231952,306,50,"CloseDocumentInternal - Sending FileClose postMessage to give the host control of closing the page"),this.sendPostmessage(e,d.a.fileClose,!0,{});if(s.AFrameworkApplication.reportAbuseUrl&&t&&t===gi.f)return h.ULS.sendTraceTag(6070357,306,50,"CloseDocumentInternal - navigating to ReportAbuseUrl"),s.AFrameworkApplication.activeFrame.navigateToHostUrl(e,s.AFrameworkApplication.reportAbuseUrl);if(s.AFrameworkApplication.isEmbedded)return e&&h.ULS.sendTraceTag(6070358,306,50,"CloseDocumentInternal - cannot close because application is embedded"),8;if(s.AFrameworkApplication.closeWindowOnAppClose){if(!e)return 32;h.ULS.sendTraceTag(6070359,306,50,"CloseDocumentInternal - closing the window");try{return window.top.close(),32}catch(e){return h.ULS.sendTraceTag(6070360,306,10,"CloseDocumentInternal - encountered unexpected exception: {0}",e),8}}var n,i=s.AFrameworkApplication.closeUrl;if(!i)return e&&h.ULS.sendTraceTag(6070361,306,50,"CloseDocumentInternal - no closeUrl found"),8;if(t||(t=gi.h),t===gi.c||t===gi.h)return s.AFrameworkApplication.activeFrame.navigateToHostUrl(e,i);if(s.AFrameworkApplication.replyWithChangesUrl){var r;if(e&&h.ULS.sendTraceTag(6070362,306,50,"CloseDocumentInternal - Using ReplyWithChanges postmessage"),t===gi.d||t===gi.b)n=this.sendPostmessage(e,d.a.replyWithChanges,s.AFrameworkApplication.useReplyWithChangesPostMessage,((r={}).event_source=t,r));else n=2;return 32!==n?(i=t?Dt.a.addOrReplaceParameterValue(s.AFrameworkApplication.replyWithChangesUrl,gi.e,t):s.AFrameworkApplication.replyWithChangesUrl,s.AFrameworkApplication.activeFrame.navigateToHostUrl(e,i)):n}return e&&h.ULS.sendTraceTag(6070363,306,50,"CloseDocumentInternal - Using FileClose postmessage"),32!==(n=t===gi.b?this.sendPostmessage(e,d.a.fileClose,s.AFrameworkApplication.useClosePostMessage,null):2)?s.AFrameworkApplication.activeFrame.navigateToHostUrl(e,i):n},a.signInInternal=function(e,t,n,i,r){var a=r,o=this.sendPostmessage(2===n,d.a.signIn,!0,a);return 8===o&&(window.top.location=s.AFrameworkApplication.signInUrl,o=32),o},a.fileProperties=function(e,t,n,i,r){var a=this.sendPostmessage(2===n,d.a.fileProperties,s.AFrameworkApplication.useFilePropertiesPostMessage,null);return 32!==a?s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.filePropertiesUrl):a},a.fileSharing=function(e,t,n,i,r){if(1===n)return $n.SessionStatusManager.instance.hasEmergencyViewModeBeenDeployed?8:32;var a,o=r,l=B.a.create().toString(),c={};c.event_source=o,c[nn.a.shareCorrelation]=l;var u=r,p=u?u.nav:null;p&&(c[nn.a.shareNavId]=p),u&&"CopyLink"===u.SourceControlId&&(u.mode="copy");var g=u?u.mode:null;if(g&&(c[nn.a.shareMode]=g),2===n){var m={};m[nn.a.shareCorrelation]=l,g&&(m.mode=g),h.ULS.sendTraceTag(38278995,306,50,L.c(m))}var f=this.sendPostmessage(2===n,d.a.sharing,s.AFrameworkApplication.useFileSharingPostMessage,c);if(32!==f){var v;if(s.AFrameworkApplication.fileSharingUrl)return a=o?Dt.a.addOrReplaceParameterValue(s.AFrameworkApplication.fileSharingUrl,gi.e,o):s.AFrameworkApplication.fileSharingUrl,s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,a,!0);h.ULS.sendTraceTag(7985242,306,50,"Sharing PostMessage didn't succeed but there is no FileSharingURL to fallback to.",((v={}).Result=f,v))}return f},a.conversation=function(e,t,n,i,r){return this.sendPostmessage(2===n,d.a.conversation,!0,{})},a.workflow=function(e,t,n,i,r){var a,o=this.sendPostmessage(2===n,d.a.workflow,s.AFrameworkApplication.useWorkflowPostMessage,((a={}).WorkflowType=s.AFrameworkApplication.workflowTypeString,a));if(32!==o){var l;if(s.AFrameworkApplication.workflowUrl)return s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.workflowUrl,!0);h.ULS.sendTraceTag(19781538,306,50,"Workflow PostMessage didn't succeed.",((l={}).Result=o,l))}return o},a.reportAbuseLink=function(e,t,n,i,r){var a=2===n;return t&&a&&!this.beforeCloseDocument(gi.f)?8:s.AFrameworkApplication.activeFrame.navigateToHostUrl(a,s.AFrameworkApplication.reportAbuseUrl)},a.copyAndEdit=function(e,t,n,i,r){var a={};2===n&&(a=s.AFrameworkApplication.activeFrame.applicationInstance.getCopyAndEditParams());var o=this.sendPostmessage(2===n,d.a.copyAndEdit,s.AFrameworkApplication.useCopyAndEditPostMessage,a);return 32!==o?s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.copyAndEditUrl,s.AFrameworkApplication.hideHeader):o},a.downloadACopy=function(e,t,n,i,r){return 1===n?s.AFrameworkApplication.protectedFile||$n.SessionStatusManager.instance.hasEmergencyViewModeBeenDeployed?8:32:s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.downloadACopyUrl,!0)},a.replyWithChanges=function(e,t,n,i,r){var a,o=2===n;if(t&&o&&!this.beforeCloseDocument(gi.d))return 8;var l=this.sendPostmessage(o,d.a.replyWithChanges,s.AFrameworkApplication.useReplyWithChangesPostMessage,((a={}).event_source=gi.d,a));if(32!==l){var c=Dt.a.addOrReplaceParameterValue(s.AFrameworkApplication.replyWithChangesUrl,gi.e,gi.d);return s.AFrameworkApplication.activeFrame.navigateToHostUrl(o,c)}return l},a.fileVersion=function(e,t,n,i,r){var a=this.sendPostmessage(2===n,d.a.fileVersions,s.AFrameworkApplication.useFileVersionPostMessage,null);return 32!==a?s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.fileVersionUrl):a},a.queryBreadcrumbDocName=function(e,t,n,i,r){if(2===n){if(!r)return 8;var a=r,o=s.AFrameworkApplication.docPropertiesProvider.breadcrumbDocName;a.Value=We.a.getFileNameWithoutExtension(o)}return 32},a.queryBuildVersion=function(e,t,n,i,r){if(2===n){if(!r)return 8;r.Text=s.AFrameworkApplication.instance.diagnosticsBuildVersion}return 32},a.querySessionId=function(e,t,n,i,r){if(2===n){if(!r)return 8;r.Text=s.AFrameworkApplication.instance.diagnosticsSessionId}return 32},a.sendPostmessage=function(e,t,n,i){return n?e?this.hostPostmessenger.sendMessage(t,i)?32:8:32:2},a.queryCopyAndEditButton=function(e,t,n,i,r){if(2===n){if(!r)return 8;var a=r;s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsEditAndReplyFlow")&&(a.LabelText=CommonUIStrings.l_EditAndReply)}return 32},a.moveToFolder=function(e,t,n,i,r){if(1===n)return(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CalloutMoveButtonIsEnabled")||s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DTTMoveButton",!1))&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UiHostSupportsMoveToFolder")?32:8;if(2===n){var a={},o=s.AFrameworkApplication.isUIEmbedMode,l=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UiHostSupportsDocRebootFeatures"),c=(!o||o&&l)&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("MoveCrossSiteIsEnabled");a[nn.a.supportCrossSite]=c;var u=r;u&&u.MoveButtonClickedTime&&(a[nn.a.moveButtonClickTime]=u.MoveButtonClickedTime.getTime());var p=this.sendPostmessage(2===n,d.a.moveToFolder,!0,a);if(u&&u.MoveButtonClickedTime){var g=(new Date).getTime()-u.MoveButtonClickedTime.getTime();h.ULS.sendTraceTag(578897432,306,50,g.toString())}return p}return 8},t=e,(n=[{key:"hostPostmessenger",get:function(){return this._hostPostmessenger}}])&&rr(t.prototype,n),i&&rr(t,i),e}();Object(i.a)(ar,"WebAppFrameCommandUIActor",null,[]);var or=n(544),sr=n(55),lr=n(71),cr=function(e){for(var t=0;t<e.children.length;t++){var n=e.children[t];n.style.position="relative",n.style.top=(n.parentNode.offsetHeight-n.offsetHeight)/2+"px"}},ur=function(e){return(e.innerEvent.keyCode===Gi.a.vK_Enter||e.innerEvent.keyCode===Gi.a.vK_Space)&&(e.sourceElement.click(),!0)},dr=function(e,t,n,i,r,a,o){var s=document.createElement("a");s.className="ProtocolLaunchingDialogButtonAnchor",s.className+=" OICDialog",s.id=e,s.setAttribute(Ji.a.ariaRoleAttribute,Ji.a.ariaButtonRole),s.style.padding="0",s.style.margin="0",i&&pr(r,t,n,i,s);var l=document.createElement("span");return l.className="ProtocolLaunchingDialogButtonLabel",l.innerText=r,s.appendChild(l),s.tabIndex=0,a&&lr.a.instance.registerHandler(f.EventNames.click,s,a),o&&Ki.KeyInputManager.instance.registerHandler(f.EventNames.keyUp,s,o),s},pr=function(e,t,n,i,r){var a=document.createElement("img");a.alt=e,a.className=sr.getImageClassWithCluster(n,i),a.src=t,a.setAttribute(Ji.a.ariaRoleAttribute,Ji.a.ariaPresentationRole);var o=document.createElement("span");o.className="ProtocolLaunchingDialogImg32Container",o.appendChild(a);var s=document.createElement("span");s.className="ProtocolLaunchingDialogIconContainer",s.appendChild(o),r.appendChild(s)};function hr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var gr=function(){function e(){}var t,n,i;return t=e,i=[{key:"dialogHtml",get:function(){return hi.a.formatHtml(e.dialogHtmlFormat,CommonUIStrings.l_OICLaunchDialogTitle)}}],(n=null)&&hr(t.prototype,n),i&&hr(t,i),e}();gr.dialogHtmlFormat="<div class='ProtocolLaunchingDialogBody' id='PLDDlgBody'> <div class='ProtocolLaunchingDialogTitle UIFontDialogTitle OICDialog' id='ProtocolLaunchingDialogTitle'> <div class='WACDialogSectionTitle'>{0}</div> </div> <div class='OICDialogRow' id='OICDialog'> <div class='OICDialogButtons' id='Buttons'> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonLaunchRichClient'> <div id='OICLaunchRichClient' class='UIFontDialogButton WACGlyph OICDialog'></div> </div> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonReturn'> <div id='OICReturnToApp' class='UIFontDialogButton WACGlyph OICDialog'></div> </div> </div> </div> </div>",Object(i.a)(gr,"OICLaunchDialogHtml",null,[]);var mr=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this)._btnRichClient=null,n._btnReturn=null,n._disposed$4=!1,n._operation=t,n.dialogHtml=gr.dialogHtml,n.autoSize=!0,n.buttonsOption=5,n.dialogId="OICLaunchDialog",n.showDialog("",Object(r.d)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),n.oicLaunchDialogResultHandler,"oicLaunchDialogResultHandler")),n.setLabelledByForDialog("ProtocolLaunchingDialogTitle"),n.setDescribedByForDialog("ProtocolLaunchingDialogTitle"),4!==s.AFrameworkApplication.activeFrame.applicationInstance.editMode&&(document.getElementById("ProtocolLaunchingDialogTitle").innerText=CommonUIStrings.l_OICLaunchDialogTitleForView),n.setFocusOnElement(n._btnRichClient),h.ULS.sendTraceTag(22140865,211,50,"OIC launch dialog opened"),document.getElementById("WACDialogTitlePanel").className+=" OICDialog",n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=i.prototype;return a.onInnerHtmlSet=function(){this._btnRichClient=dr("BtnRichClient",this._operation.dlgImgClusterPath,this._operation.imgClusterName,this._operation.imgBtnGetRichClient,CommonUIStrings.l_OICLaunchRichClient,Object(r.d)(this,this.onRichClientButtonClick,"onRichClientButtonClick"),ur),document.getElementById("OICLaunchRichClient").appendChild(this._btnRichClient),cr(this._btnRichClient),this._btnReturn=dr("BtnReturn",this._operation.dlgImgClusterPath,this._operation.imgClusterName,this._operation.imgBtnEdit,CommonUIStrings.l_OICReturnToOnlineClient,Object(r.d)(this,this.onReturnButtonClick,"onReturnButtonClick"),ur),document.getElementById("OICReturnToApp").appendChild(this._btnReturn),cr(this._btnReturn)},a.onReturnButtonClick=function(e){return this.hide(),this._operation.restartApplication(),!0},a.onRichClientButtonClick=function(e){return h.ULS.sendTraceTag(22140866,211,50,"OIC dialog: launch rich client"),this.hide(),s.AFrameworkApplication.theActionManager.processAction(p.a.retryOpenInClient,2),!0},a.oicLaunchDialogResultHandler=function(e,t){this._operation.restartApplication()},a.dispose=function(){this._disposed$4||(this._btnRichClient&&(lr.a.instance.unregisterHandler(f.EventNames.click,this._btnRichClient,Object(r.d)(this,this.onRichClientButtonClick,"onRichClientButtonClick")),Ki.KeyInputManager.instance.unregisterHandler(f.EventNames.keyUp,this._btnRichClient,ur)),this._btnReturn&&(lr.a.instance.unregisterHandler(f.EventNames.click,this._btnReturn,Object(r.d)(this,this.onReturnButtonClick,"onReturnButtonClick")),Ki.KeyInputManager.instance.unregisterHandler(f.EventNames.keyUp,this._btnReturn,ur)),e.prototype.dispose.call(this),this._disposed$4=!0)},i}(hi.a);function fr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(mr,"OICLaunchDialog",hi.a,[]);var vr=function(){function e(){}var t,n,i;return t=e,i=[{key:"dialogHtml",get:function(){return hi.a.formatHtml(e.dialogHtmlFormat,CommonUIStrings.l_OICDialogTitle)}}],(n=null)&&fr(t.prototype,n),i&&fr(t,i),e}();vr.dialogHtmlFormat="<div class='ProtocolLaunchingDialogBody' id='PLDDlgBody'> <div class='ProtocolLaunchingDialogTitle UIFontDialogTitle OICDialog' id='ProtocolLaunchingDialogTitle'> <div class='WACDialogSectionTitle'>{0}</div> </div> <div class='ProtocolLaunchingDialogIssues OICDialog' id='ProtocolhandlerGetHelp'> <div class='UIFontDialogText OICDialog' id='Issues'> </div> <div class='ProtocolLaunchingDialogHelpButtons' id='Buttons'> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonEdit'> <div id='ProtocolHandlerDialogEditInApp' class='UIFontDialogButton WACGlyph'></div> </div> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonGiveFeedback'> <div id='ProtocolHandlerDialogGiveFeedbackInApp' class='UIFontDialogButton WACGlyph'></div> </div> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonRetryOIC'> <div id='ProtocolHandlerDialogRetryOIC' class='UIFontDialogButton WACGlyph OICDialog'></div> </div> </div> </div> </div>",Object(i.a)(vr,"ProtocolLaunchingDialogV2Html",null,[]);var Sr=n(94);var _r=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this)._btnEdit=null,n._btnGiveFeedback=null,n._disposed$4=!1,n._btnRetryOIC=null,n._operation=t,n.dialogHtml=vr.dialogHtml,n.autoSize=!0,n.buttonsOption=5,n.dialogId=i.id,n._customCssClass="OICRetryDialog",s.AFrameworkApplication.theTaskManager.hasStopped&&s.AFrameworkApplication.theTaskManager.restart(),s.AFrameworkApplication.theTaskManager.addTask(new u.a(2,1,5e3,(function(e){n.switchToBackupMode()}),101)),n.showDialog("",Object(r.d)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),n.protocolLaunchingDialogResultHandler,"protocolLaunchingDialogResultHandler")),n.setLabelledByForDialog("ProtocolLaunchingDialogTitle"),n.setDescribedByForDialog("Issues"),n.focusOnEditButton(),h.ULS.sendTraceTag(19239262,211,50,"OIC dialog launched"),document.getElementById("WACDialogTitlePanel").className+=" OICDialog",n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=i.prototype;return a.onInnerHtmlSet=function(){var e=document.getElementById("Issues");if(e){pr("",this._operation.dlgImgClusterPath,this._operation.imgClusterName,this._operation.imgBtnGetRichClient,e);var t=document.createElement("span");t.className="WACDialogSectionTitle",t.innerText=5===this._operation.openDocumentMode?CommonUIStrings.l_OICBrowserDialogTitle:CommonUIStrings.l_OICDialogSectionTitle,e.appendChild(t),cr(e),e.style.display="none"}if(s.AFrameworkApplication.activeFrame.applicationInstance.giveFeedbackOnOpenClient){var n=CommonUIStrings.l_OICDialogSectionGiveFeedback;this._btnGiveFeedback=dr("GiveFeedback",this._operation.dlgImgClusterPath,this._operation.imgClusterName,"",n,Object(r.d)(this,this.onGiveFeedbackClick,"onGiveFeedbackClick"),Object(r.d)(this,this.onGiveFeedbackKeyUp,"onGiveFeedbackKeyUp")),document.getElementById("ProtocolHandlerDialogGiveFeedbackInApp").appendChild(this._btnGiveFeedback),cr(this._btnGiveFeedback)}else document.getElementById("ButtonGiveFeedback").style.display="none";if(s.AFrameworkApplication.activeFrame.applicationInstance.editMode&&!s.AFrameworkApplication.disableEditIfAndroid){var i=null;i=2===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType?4===s.AFrameworkApplication.activeFrame.applicationInstance.editMode?CommonUIStrings.l_OICResumeEditing:CommonUIStrings.l_OICReturnToOnlineClient:4===s.AFrameworkApplication.activeFrame.applicationInstance.editMode?CommonUIStrings.l_OICResumeEditing:CommonUIStrings.l_OICContinueInBrowser,this._btnEdit=dr("Edit",this._operation.dlgImgClusterPath,this._operation.imgClusterName,"",i,Object(r.d)(this,this.onEditClick,"onEditClick"),Object(r.d)(this,this.onEditKeyUp,"onEditKeyUp")),document.getElementById("ProtocolHandlerDialogEditInApp").appendChild(this._btnEdit),cr(this._btnEdit)}else document.getElementById("ButtonEdit").style.display="none";s.AFrameworkApplication.activeFrame.applicationInstance.editMode||s.AFrameworkApplication.isOfficeTrialOfferEnabled||e&&(e.style.display="none")},a.focusOnRetryButton=function(){return!!this._btnRetryOIC&&(this.setFocusOnElement(this._btnRetryOIC),!0)},a.focusOnEditButton=function(){return!!this._btnEdit&&(this.setFocusOnElement(this._btnEdit),!0)},a.onFinishedClick=function(e){return this._operation.closeApplication(),!0},a.onEditKeyUp=function(e){return this.onBtnKeyUp(e,0)},a.onGiveFeedbackKeyUp=function(e){return this.onBtnKeyUp(e,2)},a.onRetryOICKeyUp=function(e){return this.onBtnKeyUp(e,1)},a.onBtnKeyUp=function(e,t){var n=!1;if(e.innerEvent.keyCode===Gi.a.vK_Enter||e.innerEvent.keyCode===Gi.a.vK_Space)e.sourceElement.click(),n=!0;else if(e.innerEvent.keyCode===Sys.UI.Key.down||e.innerEvent.keyCode===Sys.UI.Key.up)switch(t){case 1:n=this.focusOnEditButton();break;case 0:n=this.focusOnRetryButton()}return n},a.onEditClick=function(e){return this.hide(),4===s.AFrameworkApplication.activeFrame.applicationInstance.editMode?(h.ULS.sendTraceTag(18715411,211,50,"Restart the App and continue editing"),this._operation.restartApplication()):(h.ULS.sendTraceTag(18715412,211,50,"Switch to edit doc in browser"),this._operation.handleEditInBrowser()),!0},a.onGiveFeedbackClick=function(e){return h.ULS.sendTraceTag(37339423,211,50,"Open give feedback dialog"),this._operation.handleGiveFeedback(),!0},a.onGetRichClientClick=function(e){var t=x.a.instance.resolve("Common.IOfficeTrialExperience");var n=x.a.instance.resolve("Common.IMacOfficeOffer");return U.a.isMac?n.launchMacOfficeTrialWindow(this._operation.application):t.launchOffer(this._operation.application),!0},a.onLearnMoreClick=function(e){return Sr.Redirect.showHelp("OICFailure"),!0},a.onRetryOICClick=function(e){return h.ULS.sendTraceTag(19239263,211,50,"OIC dialog retry"),document.getElementById("WACDialogPanel").style.display="none",s.AFrameworkApplication.theActionManager.processAction(p.a.retryOpenInClient,2),!0},a.protocolLaunchingDialogResultHandler=function(e,t){this._operation.restartApplication()},a.switchToBackupMode=function(){var e=document.getElementById("ProtocolLaunchingDialogTitle");if(e){e.innerText=CommonUIStrings.l_OICDialog2ndTitle;var t=document.getElementById("Issues");t&&(t.style.display="block");var n=document.getElementById("ProtocolHandlerDialogRetryOIC");n&&!n.children.length&&(this._btnRetryOIC=dr("RetryOIC","","","",CommonUIStrings.l_OICDialogRetry,Object(r.d)(this,this.onRetryOICClick,"onRetryOICClick"),Object(r.d)(this,this.onRetryOICKeyUp,"onRetryOICKeyUp")),n.appendChild(this._btnRetryOIC),cr(this._btnRetryOIC),this._btnEdit||this.focusOnRetryButton())}},a.dispose=function(){this._disposed$4||(this._btnEdit&&(lr.a.instance.unregisterHandler(f.EventNames.click,this._btnEdit,Object(r.d)(this,this.onEditClick,"onEditClick")),Ki.KeyInputManager.instance.unregisterHandler(f.EventNames.keyUp,this._btnEdit,Object(r.d)(this,this.onEditKeyUp,"onEditKeyUp"))),this._btnGiveFeedback&&(lr.a.instance.unregisterHandler(f.EventNames.click,this._btnGiveFeedback,Object(r.d)(this,this.onGiveFeedbackClick,"onGiveFeedbackClick")),Ki.KeyInputManager.instance.unregisterHandler(f.EventNames.keyUp,this._btnGiveFeedback,Object(r.d)(this,this.onGiveFeedbackKeyUp,"onGiveFeedbackKeyUp"))),this._btnRetryOIC&&(lr.a.instance.unregisterHandler(f.EventNames.click,this._btnRetryOIC,Object(r.d)(this,this.onRetryOICClick,"onRetryOICClick")),Ki.KeyInputManager.instance.unregisterHandler(f.EventNames.keyUp,this._btnRetryOIC,Object(r.d)(this,this.onRetryOICKeyUp,"onRetryOICKeyUp"))),e.prototype.dispose.call(this),this._disposed$4=!0)},i}(hi.a);function yr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function br(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}_r.id="ProtocolLaunchingDialog",Object(i.a)(_r,"ProtocolLaunchingDialog",hi.a,[]);var Ar=function(e){var t,n;function i(t){var n;(n=e.call(this)||this)._operation=t,n.dialogId="ProtocolLaunchingDialog",s.AFrameworkApplication.theTaskManager.hasStopped&&s.AFrameworkApplication.theTaskManager.restart(),s.AFrameworkApplication.activeFrame.applicationInstance.giveFeedbackOnOpenClient&&n.addFeedbackLink(CommonUIStrings.l_OICStandardDialogSectionGiveFeedback,Object(r.d)(br(n),n.onGiveFeedbackClick,"onGiveFeedbackClick")),i.hasCloseAction?(n.buttonsOption=12,n.setButtonText(1,CommonUIStrings.l_CloseFile),n.setButtonText(2,CommonUIStrings.l_OICDialogContinueHere),n.setButtonText(3,CommonUIStrings.l_OICDialogLaunchAgain)):(n.buttonsOption=4,n.setButtonText(1,CommonUIStrings.l_OICDialogContinueHere),n.setButtonText(2,CommonUIStrings.l_OICDialogLaunchAgain));var a=5===n._operation.openDocumentMode?CommonUIStrings.l_OICBrowserDialogTitle:CommonUIStrings.l_OICStandardDialogSectionTitle;return n.messageBoxImpl(CommonUIStrings.l_OICDialog2ndTitle,a,null,null,Object(r.d)(br(n),n.protocolLaunchingDialogResultHandler,"protocolLaunchingDialogResultHandler"),null),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a,o,l,c=i.prototype;return c.onGiveFeedbackClick=function(e){h.ULS.sendTraceTag(595342858,211,50,"Open give feedback dialog"),this.onFeedbackClickHandler(e)},c.onRetryOICClick=function(){h.ULS.sendTraceTag(595342857,211,50,"OIC dialog retry"),s.AFrameworkApplication.theActionManager.processAction(p.a.retryOpenInClient,2)},c.protocolLaunchingDialogResultHandler=function(e,t){i.hasCloseAction?3===e?this.retryOICClick():2!==e&&e?1===e&&this.closeDocument():this.continueEditing():2===e?this.retryOICClick():1!==e&&e||this.continueEditing()},c.closeDocument=function(){h.ULS.sendTraceTag(577783557,211,50,"Closing the document"),s.AFrameworkApplication.theActionManager.processActionWithData(p.a.close,2,gi.a)},c.retryOICClick=function(){h.ULS.sendTraceTag(593602691,211,50,"OIC dialog retry"),window.setTimeout(Object(r.d)(this,this.onRetryOICClick,"onRetryOICClick"),0)},c.continueEditing=function(){4===s.AFrameworkApplication.activeFrame.applicationInstance.editMode?(h.ULS.sendTraceTag(593602690,211,50,"Restart the App and continue editing"),this._operation.restartApplication()):(h.ULS.sendTraceTag(593602689,211,50,"Switch to edit doc in browser"),this._operation.handleEditInBrowser())},a=i,l=[{key:"hasCloseAction",get:function(){return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICDialogThreeActions")&&32===s.AFrameworkApplication.theActionManager.processAction(p.a.close,1)}}],(o=null)&&yr(a.prototype,o),l&&yr(a,l),i}(Pn.StandardDialog);Object(i.a)(Ar,"StandardProtocolLaunchingDialog",Pn.StandardDialog,[]);var Cr=n(276),Tr=function(){};function wr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Tr,"EditDocumentInClientParams",null,[]);var Ir=function(){function e(){}var t,n,i;return e.editDocumentInClient=function(e,t,n,i,r,a,o,s,l,c,u,d){void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===l&&(l=""),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===d&&(d=!1);var p=new Tr;p.DocumentUrl=e,p.Mode=t,p.Options=n,p.Application=i,p.SilentExternalHandler=o,p.EncodeUrl=s,p.CorrelationIdForWinClient=l,p.NavigateUsingWindowOpen=c,p.DescriptiveUnattemptedEnums=u,p.NoBrowserModalDialogs=d,MSOJS.ClientUtils.EditDocumentInClient(p,r,a)},t=e,i=[{key:"isWLSIAInstalled",get:function(){try{if(new ActiveXObject("IDBHO.IDBHOCtrl"))return!0}catch(e){}return!1}},{key:"officeVersionInstalledSupportsOIC",get:function(){return MSOJS.ClientUtils.OfficeVersionInstalled()>11}}],(n=null)&&wr(t.prototype,n),i&&wr(t,i),e}();Object(i.a)(Ir,"ClientUtils",null,[]);var kr=n(382);function Fr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Er=function(){function e(e){this._clientUrl=null,this._downloadUrl=null,this._postmessengerlazy=null,this._forceClose=!1,this._officeTrialExperience=null,this._macOfficeOffer=null,this._mode=0,this.application=0,this.suppressClose=!1,this.suppressRestart=!1,this.useLaunchDialog=e&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICLaunchDialogIsEnabled"),s.AFrameworkApplication.theActionManager.getActionMetadata(p.a.retryOpenInClient)||s.AFrameworkApplication.theActionManager.addAction(p.a.retryOpenInClient,de.a.frame,Object(r.d)(this,this.retryOpenInClientAction,"retryOpenInClientAction")),this.silentExternalHandler=!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SilentExternalHandler")}var t,n,i,a=e.prototype;return a.retryOpenInClientAction=function(e,t,n,i,r){return t.contextId!==de.a.frame?2:1===n?32:this.retryOpenInClient()},a.supportsTopTargetNavigation=function(){return!(2===this.application&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsEmbeddedScenario"))},a.closeApplication=function(){this.suppressClose||this.executeCloseApplication()},a.restartApplication=function(){this.suppressRestart||this.executeRestartApplication()},a.readyForClientLaunch=function(e){return this.useLaunchDialog&&U.a.isIPad?(new mr(this),32):this.completeClientLaunch(e)},a.completeClientLaunch=function(e){var t,n=this.launchClient(e,Object(z.a)((function(){return t}),(function(e){return t=e})));return h.ULS.sendTraceTag(34198736,211,50,"OICLaunchClient,{0},{1}",32===n,t),n},a.begin=function(e,t,n,i,r,a){return this._clientUrl=e,this._downloadUrl=t,this._postmessengerlazy=a,this.application=n,this._mode=i,s.AFrameworkApplication.downloadCopyOnOpenInClient?(this.launchDownload(),32):s.AFrameworkApplication.limitedEdit&&!s.AFrameworkApplication.hostAuthenticatesUsersDuringOpenInClient?(s.AFrameworkApplication.showRequiresSignInDialog(),8):this.beforeClientLaunch(r)},a.retryOpenInClient=function(){return this.completeClientLaunch(this._forceClose)},a.sendOICPostMessage=function(){var e=new kr.a(d.a.openInClient);return e.Values["ui-language"]=s.AFrameworkApplication.lcid.toString(),e.Values[Cr.a.currentSessionParamName]=s.AFrameworkApplication.userSessionId,this._postmessengerlazy.value.send(e)?32:8},a.sendTelemetryPostMessage=function(e){var t=new kr.a(d.a.wacActionComplete);t.Values["ui-language"]=s.AFrameworkApplication.lcid.toString(),t.Values[Cr.a.currentSessionParamName]=s.AFrameworkApplication.userSessionId,t.Values[nn.a.wacAction]=e,this._postmessengerlazy.value.send(t)},a.launchClient=function(t,n){return this._forceClose=t,this.sendTelemetryPostMessage(5===this._mode?e.openInBrowserAction:e.openInDesktopAction),5===this._mode?this.launchBrowser(n):this.launchDesktop(n)},a.launchBrowser=function(e){return e.val="",this.launchProtocolDialog(),e.val+="HostEditUrl,",32},a.launchDesktop=function(e){e.val="";var t="";s.AFrameworkApplication.addSessionIdToClientUrl&&(t="|f|"+s.AFrameworkApplication.userSessionId);var n,i=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsAssignmentMode")&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UseWindowOpenForOpenInClientInChromeAssignmentsIsEnabled")||s.AFrameworkApplication.isUnifiedHostMode||U.a.isTeamsElectron,a=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UnattemptedEnumIsEnabled"),o=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("NoBrowserModalDialogs");if(s.AFrameworkApplication.preferPostMessageOverCommandUrlForOpenInClient){e.val+="NewOrder,";var l=8;return this._postmessengerlazy&&this._postmessengerlazy.value&&this._postmessengerlazy.value.isEnabled()&&s.AFrameworkApplication.useOpenInClientPostMessage&&(e.val+="Post,",l=this.sendOICPostMessage()),32===l?l:(h.ULS.sendTraceTag(4994821,211,50,"AOpenInclientOperation.LaunchClient: cannot send postmessage"),s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl?(h.ULS.shipAssertTag(5566816,211,!!s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl),e.val+="HostUrl,",s.AFrameworkApplication.activeFrame.navigateToHostUrl(!0,s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl)):this._clientUrl?(h.ULS.sendTraceTag(18715405,211,15,"Try to open doc in rich client, SessionId {0}",s.AFrameworkApplication.userSessionId),e.val+="DocUrl,",Ir.editDocumentInClient(this._clientUrl,this._mode,this.options,this.application,Object(r.d)(this,this.onEditInClientSuccess,"onEditInClientSuccess"),Object(r.d)(this,this.onEditInClientFailure,"onEditInClientFailure"),this.silentExternalHandler,s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICEncodeUrlIsEnabled"),t,i,a,o),32):8)}return e.val+="OldOrder,",!this._clientUrl&&s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl?(this._postmessengerlazy&&this._postmessengerlazy.value&&this._postmessengerlazy.value.isEnabled()&&s.AFrameworkApplication.useOpenInClientPostMessage?(e.val+="Post,",n=this.sendOICPostMessage()):(h.ULS.sendTraceTag(22595483,211,50,"AOpenInclientOperation.LaunchClient: cannot send postmessage"),n=8),32!==n?(h.ULS.shipAssertTag(22595484,211,!!s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl),e.val+="HostUrl,",s.AFrameworkApplication.activeFrame.navigateToHostUrl(!0,s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl)):n):(h.ULS.sendTraceTag(22595485,211,15,"Try to open doc in rich client, SessionId {0}",s.AFrameworkApplication.userSessionId),e.val+="DocUrl,",Ir.editDocumentInClient(this._clientUrl,this._mode,this.options,this.application,Object(r.d)(this,this.onEditInClientSuccess,"onEditInClientSuccess"),Object(r.d)(this,this.onEditInClientFailure,"onEditInClientFailure"),this.silentExternalHandler,s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICEncodeUrlIsEnabled"),t,i,a,o),32)},a.reportControlUsed=function(e){s.AFrameworkApplication.theWsaClient.setDw(8981,e)},a.onEditInClientSuccess=function(e){this.reportControlUsed(e),h.ULS.sendTraceTag(18715406,211,50,"Open in rich client succeed"),6===e&&MSOJS.ClientUtils.ShouldShowDialog()?this.suppressProtocolHandlerDialog||this.launchProtocolDialog():this.suppressClose||this.closeApplication()},a.onEditInClientFailure=function(e,t){if(void 0===t&&(t=0),h.ULS.sendTraceTag(18715407,211,10,"Fail to open doc in rich client. Failure Type: {0:D2}, Application: {1}",e,t),5===e)alert(CommonUIStrings.l_OICErrorPopupBlockerForSafari);else{var n=!!this._downloadUrl&&!this._forceClose,i=0;1===e&&(i=2),e>=6&&e<=13&&(i=1,1===t&&(this.suppressClose=!0)),this.theOfficeTrialExperience.offerOfficeTrialInDialog?(h.ULS.sendTraceTag(18715408,211,50,"Open OICErrorDialogWithTrial. Dialog cause: {0}",i),or.a.instance.createOICErrorDialogWithTrial(this._forceClose?Object(r.d)(this,this.oicErrorDialogHandlerCloseForced,"oicErrorDialogHandlerCloseForced"):Object(r.d)(this,this.oicErrorDialogHandlerNoCloseForced,"oicErrorDialogHandlerNoCloseForced"),n?Object(r.d)(this,this.onLaunchDownload,"onLaunchDownload"):null,this.directInvokeHandler(!1)?Object(r.d)(this,this.iHaveOfficeButtonHandler,"iHaveOfficeButtonHandler"):null,null,i,t)):(h.ULS.sendTraceTag(18715409,211,50,"Open OICErrorDialog. Dialog cause: {0}",i),or.a.instance.createOICErrorDialog(this._forceClose?Object(r.d)(this,this.oicErrorDialogHandlerCloseForced,"oicErrorDialogHandlerCloseForced"):Object(r.d)(this,this.oicErrorDialogHandlerNoCloseForced,"oicErrorDialogHandlerNoCloseForced"),n?Object(r.d)(this,this.onLaunchDownload,"onLaunchDownload"):null,null,i))}},a.launchProtocolDialog=function(){s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("StandardProtocolDialogIsEnabled")?new Ar(this):new _r(this)},a.oicErrorDialogHandlerCloseForced=function(e){this.closeApplication()},a.oicErrorDialogHandlerNoCloseForced=function(e){this.restartApplication()},a.onLaunchDownload=function(e){this.launchDownload()},a.iHaveOfficeButtonHandler=function(e){return this.directInvokeHandler(!0)},a.directInvokeHandler=function(e){var t=(U.a.isInternetExplorer10Up||U.a.isInternetExplorerEdge)&&!!s.AFrameworkApplication.directInvokeDAVUrl;return t&&e&&(tt.a.safelyOpenWindow(s.AFrameworkApplication.directInvokeDAVUrl,"_blank",void 0,void 0,"OpenInClient"),this.closeApplication()),t},t=e,(n=[{key:"openDocumentMode",get:function(){return this._mode}},{key:"options",get:function(){var e=0;return s.AFrameworkApplication.requiresCheckout&&(e|=1),s.AFrameworkApplication.openInClientEditOnly&&(e|=4),this.supportsTopTargetNavigation()&&(e|=64),e}},{key:"openInClientCommandString",get:function(){return null}},{key:"dlgImgClusterPath",get:function(){return s.AFrameworkApplication.imageClusterPath}},{key:"imgClusterName",get:function(){return s.AFrameworkApplication.imageClusterName}},{key:"imgBtnFinished",get:function(){return"ImFinished_32x32x32"}},{key:"imgBtnEdit",get:function(){return""}},{key:"imgBtnGetRichClient",get:function(){return""}},{key:"suppressProtocolHandlerDialog",get:function(){return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OneNoteMobileViewerIsEnabled")}},{key:"theOfficeTrialExperience",get:function(){return this._officeTrialExperience||(this._officeTrialExperience=x.a.instance.resolve("Common.IOfficeTrialExperience"))}},{key:"theMacOfficeOffer",get:function(){return this._macOfficeOffer||(this._macOfficeOffer=x.a.instance.resolve("Common.IMacOfficeOffer"))}}])&&Fr(t.prototype,n),i&&Fr(t,i),e}();function Or(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Er.openInDesktopAction="OpenInDesktop",Er.openInBrowserAction="OpenInBrowser",Object(i.a)(Er,"AOpenInClientOperation",null,[]);var Pr=function(e){var t,n;function i(t,n,i){var r;return void 0===i&&(i=!1),(r=e.call(this,i)||this)._imgBtnGetRichClient=t,r._imgBtnEdit=n,r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r,a,o,l=i.prototype;return l.executeCloseApplication=function(){s.AFrameworkApplication.theActionManager.processActionWithData(p.a.close,2,gi.a)},l.executeRestartApplication=function(){},l.beforeClientLaunch=function(e){return this.readyForClientLaunch(e)},l.launchDownload=function(){h.ULS.shipAssertTag(5566817,211,!!this._downloadUrl),s.AFrameworkApplication.isCloseable?s.AFrameworkApplication.activeFrame.navigateToHostUrl(!0,this._downloadUrl):tt.a.safelyOpenWindow(this._downloadUrl,void 0,void 0,void 0,"LaunchDownload")},l.handleEditInBrowser=function(){s.AFrameworkApplication.activeFrame.applicationInstance.handleEditInBrowser()},l.handleGiveFeedback=function(){s.AFrameworkApplication.activeFrame.applicationInstance.handleGiveFeedback()},r=i,(a=[{key:"imgBtnEdit",get:function(){return this._imgBtnEdit}},{key:"imgBtnGetRichClient",get:function(){return this._imgBtnGetRichClient}}])&&Or(r.prototype,a),o&&Or(r,o),i}(Er);Object(i.a)(Pr,"OpenInClientOperation",Er,[]);var Dr=n(72),Mr=n(105),Lr=n(34);var Rr=function(e){var t,n;function i(t,n,i){var r;return(r=e.call(this,t,n)||this)._shouldNavigateOuterFrameFunc=i,r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=i.prototype;return a.registerActions=function(){e.prototype.registerActions.call(this),this._actionManager.addAction(er.a.switchToEditMode,Lr.a.application,Object(r.d)(this,this.onModeSwitch,"onModeSwitch")),this._actionManager.addAction(er.a.openInClient,Lr.a.application,Object(r.d)(this,this.onEditInClient,"onEditInClient")),this._actionManager.addAction(er.a.showPdfCopyAndEditDialog,Lr.a.application,Object(r.d)(this,this.onShowPdfCopyAndEditDialog,"onShowPdfCopyAndEditDialog")),this._actionManager.addAction(p.a.openInBrowser,de.a.frame,Object(r.d)(this,this.openInBrowser,"openInBrowser")),this._actionManager.addAction(er.a.switchToUnifiedReadMode,Lr.a.application,Object(r.d)(this,this.switchToUnifiedReadMode,"switchToUnifiedReadMode")),zi.App.instance.userMayEnterAccessiblePdfMode&&(this._actionManager.addAction(er.a.toggleViewMode,Lr.a.application,Object(r.d)(this,this.onModeSwitch,"onModeSwitch")),this._actionManager.addActionWithFlags(er.a.queryAccessibleModeButtonToggledState,Lr.a.application,Object(r.d)(this,this.queryAccessibleModeButtonToggledState,"queryAccessibleModeButtonToggledState"),96))},a.switchToUnifiedReadMode=function(e,t,n,r,a){if(1===n)return 32;l.Health.instance.recordKpiUsage("SwitchToUnifiedReadMode",0,i.featureCrewAlias,null);var o=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("ClassicViewModePreferenceCookieName"),c={};c[nn.a.hostKey]=o,c[nn.a.hostValue]="false",s.AFrameworkApplication.get_hostPostmessengerFuture().execute((function(e){e.sendMessage(d.a.storeHostKeyValue,c)}));var u={unifiedRead:!0};return s.AFrameworkApplication.theActionManager.processActionWithData(er.a.switchToEditMode,2,u)},a.onModeSwitch=function(e,t,n,i,r){if(t.contextId!==Lr.a.application)return 2;var a=s.AFrameworkApplication.activeFrame;switch(h.ULS.shipAssertTag(4776161,201,!!a),e){case er.a.switchToEditMode:return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordConsumptionViewToEditRedirectIsEnabled")&&r&&Object===Object.getType(r)&&"unifiedRead"in r?a.switchIntoEditMode(n,this.hostPostmessenger,this._shouldNavigateOuterFrameFunc(),!0):a.switchIntoEditMode(n,this.hostPostmessenger,this._shouldNavigateOuterFrameFunc());case er.a.toggleViewMode:return this.toggleViewMode(n);default:return 2}},a.toggleViewMode=function(e){if(1===e)return zi.App.instance.userMayEnterAccessiblePdfMode?32:8;if(2!==e)return h.ULS.sendTraceTag(20235094,301,15,"Unexpected ActionBehavior {0} for switching view modes",e),2;var t=!zi.App.instance.isAccessiblePdfMode;zi.App.instance.setAccessiblePdfModeCookie(t),h.ULS.sendTraceTag(20451532,301,50,"User has toggled into {0} mode.",t?"accessible PDF":"PNG");var n=s.AFrameworkApplication.isEmbedded?s.AFrameworkApplication.hostEmbeddedViewUrl:window.self.location.href,i=zi.App.getUrlParametersForAccessiblePdfMode(t);return Mr.b(s.AFrameworkApplication.appSettingsManager)?Mr.f("view",i,Mr.d):(n=Dt.a.addOrReplaceParametersValue(n,i),tt.a.openWindow(1,n)),32},a.onEditInClient=function(e,t,n,i,r){var a=this;if(t.contextId!==Lr.a.application)return 2;var o=s.AFrameworkApplication.activeFrame;if(h.ULS.shipAssertTag(4776192,201,!!o),!o.clientEditDocumentUrl&&!s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl&&!s.AFrameworkApplication.useOpenInClientPostMessage)return 8;if(1===n)return 32;var l=!1;if((null!=r&&(l=r),zi.App.instance.isBroadcastMode)&&this.hostPostmessenger.sendMessage(d.a.broadcastOpenInClient,null))return 32;return new Pr("Word_32x32x32","EditInWordWebApp_32x32x32").begin(o.clientEditDocumentUrl,s.AFrameworkApplication.downloadACopyUrl,5,2,l,new on.a((function(){return a.hostPostmessenger})))},a.queryAccessibleModeButtonToggledState=function(e,t,n,i,r){return 1===n?zi.App.instance.userMayEnterAccessiblePdfMode?32:8:(h.ULS.shipAssertTag(20451533,301,!!r),r[Dr.a.On]=zi.App.instance.isAccessiblePdfMode,32)},a.onShowPdfCopyAndEditDialog=function(e,t,n,r,a){if(1===n)return zi.App.instance.isProtectedPdf?8:32;var o=new Pn.StandardDialog;return o.buttonsOption=1,o.setDefaultButton(0),o.showInformation(CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_ConversionDialogPdf,i.pdfCopyAndEditDialogHandler),32},a.openInBrowser=function(e,t,n,i,r){return 2===n&&this.sendPostmessage(!0,d.a.openInBrowser,!0,{}),32},i.pdfCopyAndEditDialogHandler=function(e,t){1===e&&s.AFrameworkApplication.theActionManager.processAction(p.a.copyAndEdit,2)},i}(ar);Rr.featureCrewAlias="wwaengidc",Object(i.a)(Rr,"AppFrameCommandUIActor",ar,[]);var Ur=n(137),Hr=n(91);function Br(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var xr=function(){function e(){}var t,n,i;return e.initialize=function(t,n,i){zi.App.instance.isBroadcastMode&&!e._initialized&&n&&(e._actionManager=t,e._messenger=n,e._theWsaClient=i,e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastInSync),e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastNavigateToPage),e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastOutOfSync),e._messenger.addAllowedFreeReceivingMessage(d.a.queryLoadingStatus),e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastLinkedNotesInfo),e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastGlobalId),e._messenger.registerCallback(d.a.broadcastNavigateToPage,e.navigateHandler),e._messenger.registerCallback(d.a.queryLoadingStatus,e.onQueryAppLoadingStatus),e._messenger.registerCallback(d.a.broadcastInSync,e.onBroadcastInSync),e._messenger.registerCallback(d.a.broadcastOutOfSync,e.onBroadcastOutOfSync),e._messenger.registerCallback(d.a.broadcastLinkedNotesInfo,e.linkedNotesInfoHandler),e._messenger.registerCallback(d.a.broadcastGlobalId,e.writeSqmBroadcastSessionID),e._actionManager.addActionWithFlags(er.a.queryPresenterPageLabel,Lr.a.application,e.onQueryPresenterPageLabel,96),window.setTimeout((function(){e._presenterPageLabelPolled||(e._presenterPageLabelPolled=!0,e.refreshStatusBar())}),10),e._initialized=!0)},e.suppressNavigateMessagesForAnimationDuration=function(){e._animationBeginTime=new Date},e.navigateHandler=function(t){if(2===zi.App.instance.status&&!(tt.a.isFieldNullOrUndefined(t,"Values")||tt.a.isFieldNullOrUndefined(t.Values,e.broadcastNavigateSequence)||tt.a.isFieldNullOrUndefined(t.Values,e.broadcastNavigatePage)||tt.a.isFieldNullOrUndefined(t.Values,e.broadcastNavigateYOffset))){var n=-1,i=-1,r=-1;try{n=t.Values[e.broadcastNavigateSequence],i=t.Values[e.broadcastNavigatePage],r=t.Values[e.broadcastNavigateYOffset]}catch(e){return void 0}if(e._waitingSequence!==n){e._waitingSequence=n;e.scrollControl.scrollToPageOffset(i,r)}}},e.sendNavigationMessage=function(t,n,i){if(2===zi.App.instance.status){var r=e.zoomControl.currentZoom,a=n.scrollTop-Hr.a.instance.getPageTopAtZoom(t,r),o=Math.round(100*a/Hr.a.instance.getPageHeightAtZoom(t,r)),s=n.scrollTop+e.scrollControl.getClientHeight(),l=Hr.a.instance.getPageFromScrollTop(s,r),c=s-Hr.a.instance.getPageTopAtZoom(l,r),u=Math.round(100*c/Hr.a.instance.getPageHeightAtZoom(l,r)),p=(new Date).getTime()-e._animationBeginTime.getTime(),h={};if(2!==i&&p>=0&&p<=e.scrollAnimationRunTime){if(!i)return;if(-999===e._waitingSequence)return;h[e.appNavigatedSource]=e._waitingSequence,e._waitingSequence=-999}else e._animationBeginTime=new Date(0),h[e.appNavigatedSource]=e.appNavigatedSourceUser;h[e.broadcastNavigatePage]=t,h[e.broadcastNavigateYOffset]=o,h[e.broadcastNavigateBottomPage]=l,h[e.broadcastNavigateBottomOffset]=u,e._messenger.sendMessage(d.a.appNavigated,h)}},e.onQueryAppLoadingStatus=function(t){e.sendAppLoadingStatus()},e.sendAppLoadingStatus=function(){var t={};t[e.appLoaded]=!zi.App.instance.status||1===zi.App.instance.status||2===zi.App.instance.status,t[e.documentLoaded]=2===zi.App.instance.status,e._messenger.sendMessage(d.a.appLoadingStatus,t)},e.onBroadcastInSync=function(t){2===zi.App.instance.status&&(e._outOfSyncEntry&&(zi.App.get_activeAppFrame().notificationBar.removeEntry(e._outOfSyncEntry),e._outOfSyncEntry=null),e._isBroadcastSynced=!0,e.refreshStatusBar())},e.refreshStatusBar=function(){zi.App.get_activeAppFrame().statusBarUser&&zi.App.get_activeAppFrame().statusBarUser.pollControl(Ur.a.presenterPageLabel),zi.App.get_activeAppFrame().ribbonUser&&zi.App.get_activeAppFrame().ribbonUser.poll()},e.onBroadcastOutOfSync=function(t){2===zi.App.instance.status&&(e._isBroadcastSynced&&(e._outOfSyncEntry=zi.App.get_activeAppFrame().notificationBar.createEntry(WordViewerIntl.WordViewerStrings.l_BroadcastOutOfSync,!1),zi.App.get_activeAppFrame().notificationBar.addEntry(e._outOfSyncEntry)),e._isBroadcastSynced=!1,e.refreshStatusBar())},e.linkedNotesInfoHandler=function(t){if(2===zi.App.instance.status&&!tt.a.isFieldNullOrUndefined(t,"Values")&&!tt.a.isFieldNullOrUndefined(t.Values,e.linkedNotesEnabled)){var n,i;try{n=t.Values[e.linkedNotesEnabled],i=t.Values[e.linkedNotesUrl]}catch(e){return void 0}0,e._isSharedNotesEnabled=n,e._sharedNotesUrl=i,zi.App.get_activeAppFrame().ribbonUser&&zi.App.get_activeAppFrame().ribbonUser.poll()}},e.writeSqmBroadcastSessionID=function(t){if(!tt.a.isFieldNullOrUndefined(t,"Values")&&!tt.a.isFieldNullOrUndefined(t.Values,e.id)){var n;try{n=t.Values[e.id]}catch(e){return void 0}e._theWsaClient.setDw(e.DATAID_GLOBALBROADCASTID,n)}},e.onQueryPresenterPageLabel=function(t,n,i,r,a){if(1===i)return 32;var o=a;return o[pe.a.Value]=e._isBroadcastSynced?WordViewerIntl.WordViewerStrings.l_SyncedWithPresenter:WordViewerIntl.WordViewerStrings.l_BroadcastOutOfSync,o[he.a.labelText]=o[pe.a.Value],e._presenterPageLabelPolled=!0,32},t=e,i=[{key:"zoomControl",get:function(){return e._zoomControl||(e._zoomControl=x.a.instance.resolve("WordViewer.Controls.IZoomControl"))}},{key:"scrollControl",get:function(){return e._scrollControl||(e._scrollControl=x.a.instance.resolve("WordViewer.Controls.IScrollControl"))}},{key:"scrollAnimationRunTime",get:function(){return e._scrollAnimationRunTime+500},set:function(t){e._scrollAnimationRunTime=t}},{key:"isBroadcastSynced",get:function(){return e._isBroadcastSynced},set:function(t){e._isBroadcastSynced=t}},{key:"isSharedNotesEnabled",get:function(){return e._isSharedNotesEnabled},set:function(t){e._isSharedNotesEnabled=t}},{key:"sharedNotesUrl",get:function(){return e._sharedNotesUrl},set:function(t){e._sharedNotesUrl=t}}],(n=null)&&Br(t.prototype,n),i&&Br(t,i),e}();function Nr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}xr.broadcastNavigateSequence="Sequence",xr.broadcastNavigatePage="Page",xr.broadcastNavigateYOffset="YOffset",xr.broadcastNavigateBottomPage="BottomPage",xr.broadcastNavigateBottomOffset="BottomOffset",xr.appNavigatedSource="Source",xr.appNavigatedSourceUser="User",xr.appLoaded="AppLoaded",xr.documentLoaded="DocumentLoaded",xr.linkedNotesEnabled="Enabled",xr.linkedNotesUrl="NotesUrl",xr.id="Id",xr.DATAID_GLOBALBROADCASTID=9975,xr._initialized=!1,xr._waitingSequence=-999,xr._animationBeginTime=new Date(0),xr._isBroadcastSynced=!0,xr._isSharedNotesEnabled=!1,xr._sharedNotesUrl=null,xr._outOfSyncEntry=null,xr._scrollAnimationRunTime=0,xr._presenterPageLabelPolled=!1,xr._theWsaClient=null,xr._actionManager=null,xr._messenger=null,xr._zoomControl=null,xr._scrollControl=null,Object(i.a)(xr,"BroadcastMessengerHelper",null,[]);var jr=function(){function e(e,t,n){this._actionManager=e,this._messenger=t,this._theWsaClient=n}var t,n,i,a=e.prototype;return a.registerActions=function(){zi.App.instance.isBroadcastMode&&(xr.initialize(this._actionManager,this._messenger,this._theWsaClient),this._actionManager.addActionWithFlags(er.a.onAppReady,Lr.a.application,Object(r.d)(this,this.onAppReady,"onAppReady"),96),this._actionManager.addActionWithFlags(er.a.syncToPresenter,Lr.a.application,Object(r.d)(this,this.onSyncToPresenter,"onSyncToPresenter"),96),this._actionManager.addActionWithFlags(er.a.openSharedNotes,Lr.a.application,Object(r.d)(this,this.onOpenSharedNotes,"onOpenSharedNotes"),96),this._actionManager.addActionWithFlags(er.a.beforeAnimateScroll,Lr.a.application,Object(r.d)(this,this.beforeAnimateScroll,"beforeAnimateScroll"),96),this._actionManager.addActionWithFlags(er.a.animateScrollStarted,Lr.a.application,Object(r.d)(this,this.animateScrollStarted,"animateScrollStarted"),96),this._actionManager.addActionWithFlags(er.a.broadcastOnScroll,Lr.a.application,Object(r.d)(this,this.broadcastOnScroll,"broadcastOnScroll"),96),xr.sendAppLoadingStatus())},a.onAppReady=function(e,t,n,i,r){return t.contextId!==Lr.a.application?2:1===n?zi.App.instance.isBroadcastMode&&xr.isBroadcastSynced?8:32:(xr.sendAppLoadingStatus(),32)},a.onSyncToPresenter=function(e,t,n,i,r){if(t.contextId!==Lr.a.application)return 2;if(1===n)return zi.App.instance.isBroadcastMode&&xr.isBroadcastSynced?8:32;if(zi.App.instance.isBroadcastMode&&this._messenger&&this._messenger.sendMessage(d.a.broadcastSyncToPresenter,null))return 32;return 8},a.onOpenSharedNotes=function(e,t,n,i,r){return t.contextId!==Lr.a.application?2:1===n?zi.App.instance.isBroadcastMode&&!xr.isSharedNotesEnabled?8:32:(tt.a.safelyOpenWindow(xr.sharedNotesUrl,void 0,void 0,void 0,"OpenSharedNotes"),32)},a.beforeAnimateScroll=function(e,t,n,i,r){return t.contextId!==Lr.a.application?2:1===n?zi.App.instance.isBroadcastMode&&xr.isBroadcastSynced?8:32:(xr.suppressNavigateMessagesForAnimationDuration(),32)},a.animateScrollStarted=function(e,t,n,i,r){return t.contextId!==Lr.a.application?2:1===n?zi.App.instance.isBroadcastMode&&xr.isBroadcastSynced?8:32:(xr.scrollAnimationRunTime=r,32)},a.broadcastOnScroll=function(e,t,n,i,r){if(t.contextId!==Lr.a.application)return 2;if(1===n)return zi.App.instance.isBroadcastMode&&xr.isBroadcastSynced?8:32;var a=r;return xr.sendNavigationMessage(a.page,a.data,a.source),32},e.getInstanceWithResolvedDependencies=function(){var t=x.a.instance.resolve("Common.App.Postmessengers.HostIntegrationMessenger");return new e(s.AFrameworkApplication.theActionManager,t,s.AFrameworkApplication.theWsaClient)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getInstanceWithResolvedDependencies())}}],(n=null)&&Nr(t.prototype,n),i&&Nr(t,i),e}();function Wr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}jr._instance=null,Object(i.a)(jr,"BroadcastActor",null,[]);var Vr=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){e.initOnFullAppSettingsReady()}))},r.initOnFullAppSettingsReady=function(){this._container.resolve("WordViewer.Actors.AccessibilityHelpDialogActor").registerActions(),this._container.resolve("WordViewer.Actors.AppFrameCommandUIActor").registerActions(),jr.instance.registerActions(),x.a.instance.resolve("Common.IOfficeTrialExperience").registerActions(),x.a.instance.resolve("Common.IMacOfficeOffer").registerActions()},r.dispose=function(){},r.configure=function(e){this._container=e,e.register(Rr,"WordViewer.Actors.AppFrameCommandUIActor").singleInstance().usingFactory((function(){return new Rr(s.AFrameworkApplication.theActionManager,e.resolveFuture("Postmessage.IHostPostmessenger"),(function(){var e=ui.a.instance;return e.isSessionExpired(s.AFrameworkApplication.accessTokenTtl)||e.isSessionAboutToExpire(s.AFrameworkApplication.accessTokenTtl,s.AFrameworkApplication.accessTokenExpirationPromptSeconds)}))})),e.register(ir,"WordViewer.Actors.AccessibilityHelpDialogActor").singleInstance().usingFactory((function(){return new ir(s.AFrameworkApplication.theActionManager,It.FocusManager.instance())})),(new qi).configure(e)},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"WordViewer.Actors"}}])&&Wr(t.prototype,n),i&&Wr(t,i),e}();Object(i.a)(Vr,"WordViewerActorsPackage",null,[14,15]);var qr=function(){};qr.dialogHtml="<div class='EmbedDialog' id='embeddialog'> <div class='EmbedPreviewPane' id='embedpreviewpane'> </div> <div class='EmbedOptionPane' id='embedoptionpane'> </div> </div>",Object(i.a)(qr,"EmbedDialogHtml",null,[]);var Gr=function(e,t,n,i){this.optionElement=e,this.imageElement=t,this.optionHolderElement=n,this.value=i};Object(i.a)(Gr,"OptionInfo",null,[]);var Kr=function(e,t,n){this.sectionElement=e,this.imageHolder=t,this.imageElement=n};Object(i.a)(Kr,"SectionInfo",null,[]);var zr=n(140);function Jr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Xr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Qr='<a target="_blank" href="{0}">{1}</a>',Zr=function(e){var t,n;function i(t,n){var i;return void 0===n&&(n=!1),(i=e.call(this,!1,!1,n)||this)._embedWidth=476,i._embedHeight=288,i._dialogWidth=798,i._previewPanelWidth=476,i._previewFrameHeight=288,i.paramToOptionInfo={},i.sectionInfoList=[],i._previewPane=null,i._optionPane=null,i._dimensionSection=null,i._optionSection=null,i._previewFrame=null,i._embedCodeTextArea=null,i._embedUrl=s.AFrameworkApplication.hostEmbeddedViewUrl,i._previewUrl=t,i._optionClickHandler=Object(r.d)(Xr(i),i.optionClickHandler,"optionClickHandler"),i._optionKeyHandler=Object(r.d)(Xr(i),i.optionKeyHandler,"optionKeyHandler"),i._arrowClickHandler=Object(r.d)(Xr(i),i.arrowClickHandler,"arrowClickHandler"),i._arrowKeyHandler=Object(r.d)(Xr(i),i.arrowKeyHandler,"arrowKeyHandler"),i._textAreafocusHandler=Object(r.d)(Xr(i),i.textAreaOnFocusHandler,"textAreaOnFocusHandler"),i._isReactDialog=n,i.dialogHtml=qr.dialogHtml,i.buttonsOption=0,i.dialogId="EmbedDialog",i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a,o,l,c=i.prototype;return c.showReactEmbedDialog=function(e){for(var t,n=((t={}).id=this.dialogId,t.bodyControls={},t.embedPreviewSectionTitle=CommonUIStrings.l_Preview,t.embedCodeSectionTitle=CommonUIStrings.l_EmbedCode,t.dimensionsSectionTitle=CommonUIStrings.l_Dimensions,t.interactionSectionTitle=CommonUIStrings.l_Interaction,t.initialPreviewUrl=Dt.a.addOrReplaceParameterValue(this._previewUrl,"wdPreview","1"),t.initialEmbedUrl=this._embedUrl,t.getEmbedCode=i.getEmbedCode,t.codeCopiedText=CommonUIStrings.l_EmbedCodeCopied,t),r=0,a=Object.keys(e);r<a.length;r++){var o=a[r];n[o]=e[o]}this.buttonsOption=1,this.setButtonText(1,CommonUIStrings.l_CopyAction),this.setButtonText(0,CommonUIStrings.l_Close),this.initializeAndShow(CommonUIStrings.l_Embed,null,n)},c.showEmbedDialog=function(){if(this._isReactDialog)this.showReactEmbedDialog({});else{this.showDialog(CommonUIStrings.l_Embed,null),this._previewPane=document.getElementById("embedpreviewpane"),this._optionPane=document.getElementById("embedoptionpane"),this._previewPane.style.width=String.format("{0}px",this._previewPanelWidth),this._previewFrame=document.createElement("iframe"),this._previewFrame.className=i._previewFrameCssClass,this._previewFrame.frameBorder="0",this._previewFrame.style.height=String.format("{0}px",this._previewFrameHeight),this._previewFrame.tabIndex=-1,this._previewPane.appendChild(this.createSectionHeader(CommonUIStrings.l_Preview,this._previewFrame,i._previewId,i._previewHeaderId,i._previewId,!0)),this._embedCodeTextArea=document.createElement("textarea"),this._embedCodeTextArea.className=i._embedCodeCssClass,Sys.UI.DomElement.addCssClass(this._embedCodeTextArea,zr.a.allowBrowserContextMenu),this._embedCodeTextArea.id=i._embedcodeTextAreaId,U.a.isIPad||(this._embedCodeTextArea.readOnly=!0),this._embedCodeTextArea.rows=4,this._embedCodeTextArea.style.fontFamily=CommonUIStrings.l_UserInterfaceFontName,this._embedCodeTextArea.style.fontSize=CommonUIStrings.l_UserInterfaceFontSize,this._embedCodeTextArea.setAttribute(Ji.a.ariaLabelledByAttribute,String.format("{0} {1}",i._embedCodeHeaderId,i._embedCodeFooterId)),this._previewPane.appendChild(this.createSectionHeader(CommonUIStrings.l_EmbedCode,this._embedCodeTextArea,i._embedCodeHeaderId)),Ee.a.addHandler(this._embedCodeTextArea,"focus",this._textAreafocusHandler);var e=document.createElement("span");e.className=i._footerCssClass,e.innerText=CommonUIStrings.l_CopyText,e.id=i._embedCodeFooterId,this._previewPane.appendChild(e),this._dimensionSection=document.createElement("div"),this._dimensionSection.className=i._dimensionSectionCssClass,this._optionPane.appendChild(this.createSectionHeader(CommonUIStrings.l_Dimensions,this._dimensionSection)),this._optionSection=document.createElement("div"),this._optionPane.appendChild(this.createCollapsibleSectionHeader(i._optionsId,CommonUIStrings.l_Interaction,this._optionSection)),this.buttonsOption=0,this.setButtonText(1,CommonUIStrings.l_Close),this.updateEmbedCode(),this.updatePreview(),U.a.isIPad||this._embedCodeTextArea.focus()}},c.dispose=function(){if(this.paramToOptionInfo){var t=this.paramToOptionInfo;for(var n in t){var i={key:n,value:t[n]}.value;this._clickManager.unregisterHandler(f.EventNames.click,i.optionElement,this._optionClickHandler),this._keyInputManager.unregisterHandler(f.EventNames.keyDown,i.optionElement,this._optionKeyHandler),this._keyInputManager.unregisterHandler(f.EventNames.keyUp,i.optionElement,this._optionKeyHandler)}this.paramToOptionInfo=null,this._optionClickHandler=null,this._optionKeyHandler=null}if(this.sectionInfoList){for(var r=0;r<this.sectionInfoList.length;++r)this._clickManager.unregisterHandler(f.EventNames.click,this.sectionInfoList[r].imageHolder,this._arrowClickHandler),this._keyInputManager.unregisterHandler(f.EventNames.keyDown,this.sectionInfoList[r].imageHolder,this._arrowKeyHandler),this._keyInputManager.unregisterHandler(f.EventNames.keyPress,this.sectionInfoList[r].imageHolder,this._arrowKeyHandler),this._keyInputManager.unregisterHandler(f.EventNames.keyUp,this.sectionInfoList[r].imageHolder,this._arrowKeyHandler);this.sectionInfoList=null,this._arrowClickHandler=null,this._keyInputManager=null}this._textAreafocusHandler&&this._embedCodeTextArea&&(Ee.a.removeHandler(this._embedCodeTextArea,"focus",this._textAreafocusHandler),this._textAreafocusHandler=null),this._previewPane=null,this._optionPane=null,this._dimensionSection=null,this._optionSection=null,this._previewFrame=null,this._embedCodeTextArea=null,e.prototype.dispose.call(this)},c.reSizeDialog=function(){e.prototype.reSizeDialog.call(this),this._divMessageBox.style.width=String.format("{0}px",this._dialogWidth),this.centerDialog()},c.updateEmbedUrl=function(e,t){var n=Dt.a.addOrReplaceParameterValue(this._embedUrl,e,t);return this._embedUrl!==n&&(this._embedUrl=n,this._previewUrl=Dt.a.addOrReplaceParameterValue(this._previewUrl,e,t),!0)},c.updateEmbedCode=function(){this._embedCodeTextArea&&(this._embedCodeTextArea.innerText=i.getEmbedCode(this._embedUrl,this._embedWidth,this._embedHeight))},c.updatePreview=function(){this._previewFrame&&this._previewFrame.contentWindow.location.replace(Dt.a.addOrReplaceParameterValue(this._previewUrl,"wdPreview","1"))},c.updateEmbedUrlAndRefresh=function(e,t){this.updateEmbedUrl(e,t)&&(this.updateEmbedCode(),this.updatePreview())},c.createSectionHeader=function(e,t,n,r,a,o){void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=!1);var s=document.createElement("div");s.className=i._sectionHeaderCssClass,r&&(s.id=r),a&&s.setAttribute(Ji.a.ariaLabelledByAttribute,a),o&&(s.tabIndex=0);var l=document.createElement("span");return l.className=i._sectionNameCssClass,l.innerText=e,n&&(l.id=n),s.appendChild(l),s.appendChild(t),s},c.createCollapsibleSectionHeader=function(e,t,n){var r=this.createSectionHeader(t,n),a=this._document.createElement("div");a.className=i._arrowHolderCssClass,a.id=i._arrowId+e,a.setAttribute(Ji.a.ariaRoleAttribute,Ji.a.ariaButtonRole),a.tabIndex=0,r.insertBefore(a,n);var o=sr.createClusteredImage(16,16,i._arrowIconName,i._arrowImageCssClass,!0,"");a.appendChild(o);var s=o.childNodes[0];s.className=sr.getImageClass(i._downArrowIconCssClass),s.title=CommonUIStrings.l_Expand,a.title=CommonUIStrings.l_Expand,n.style.visibility="hidden";var l=new Kr(n,a,s);return Array.add(this.sectionInfoList,l),this._clickManager.registerHandlerWithData(f.EventNames.click,a,this._arrowClickHandler,l),this._keyInputManager.registerHandlerWithData(f.EventNames.keyDown,a,this._arrowKeyHandler,l),this._keyInputManager.registerHandlerWithData(f.EventNames.keyPress,a,this._arrowKeyHandler,l),this._keyInputManager.registerHandlerWithData(f.EventNames.keyUp,a,this._arrowKeyHandler,l),r},c.arrowClickHandler=function(e){return this.changeArrowState(e),!0},c.arrowKeyHandler=function(e){return this.keyHandlerWithAction(e,Object(r.d)(this,this.changeArrowState,"changeArrowState"))},c.changeArrowState=function(e){var t=e.userData;"visible"===t.sectionElement.style.visibility?(t.sectionElement.style.visibility="hidden",t.imageElement.className=sr.getImageClass(i._downArrowIconCssClass),t.imageElement.title=CommonUIStrings.l_Expand,t.imageHolder.title=CommonUIStrings.l_Expand):(t.sectionElement.style.visibility="visible",t.imageElement.className=sr.getImageClass(i._upArrowIconCssClass),t.imageElement.title=CommonUIStrings.l_Collapse,t.imageHolder.title=CommonUIStrings.l_Collapse)},c.createCheckBox=function(e,t,n){var r=document.createElement("div");r.className=i._optionCssClass,r.id=e+i._optionId;var a=this._document.createElement("div");a.tabIndex=0,a.className=i._checkBoxHolderCssClass,a.id=e+i._checkId,a.setAttribute(Ji.a.ariaRoleAttribute,Ji.a.ariaCheckBoxRole),a.setAttribute(Ji.a.ariaCheckedAttribute,n?Ji.a.ariaTrueValue:Ji.a.ariaFalseValue),a.setAttribute(Ji.a.ariaLabelledByAttribute,e+i._descriptionCssClass),r.appendChild(a),r.setAttribute(Ji.a.ariaRoleAttribute,Ji.a.ariaPresentationRole);var o=sr.createClusteredImage(16,16,i._checkboxIconName,i._checkboxCssClass,!0,"");a.appendChild(o);var s=o.childNodes[0];s.id=e+i._optionImageId,s.className=sr.getImageClass(n?i._checkedIconCssClass:i._uncheckedIconCssClass);var l=new Gr(r,s,a,n?1:0);this.paramToOptionInfo[e]=l,this._clickManager.registerHandlerWithData(f.EventNames.click,r,this._optionClickHandler,e);var c=document.createElement("span");return c.className=i._descriptionCssClass,c.innerText=t,c.id=e+i._descriptionCssClass,r.appendChild(c),this._keyInputManager.registerHandlerWithData(f.EventNames.keyDown,r,this._optionKeyHandler,e),this._keyInputManager.registerHandlerWithData(f.EventNames.keyUp,r,this._optionKeyHandler,e),r},c.optionClickHandler=function(e){return this.optionHandler(e),!0},c.optionKeyHandler=function(e){return this.keyHandlerWithAction(e,Object(r.d)(this,this.optionHandler,"optionHandler"))},c.optionHandler=function(e){var t=this.paramToOptionInfo[e.userData.toString()];t.value?(t.value=0,t.imageElement.className=sr.getImageClass(i._uncheckedIconCssClass),t.optionHolderElement.setAttribute(Ji.a.ariaCheckedAttribute,Ji.a.ariaFalseValue)):(t.value=1,t.imageElement.className=sr.getImageClass(i._checkedIconCssClass),t.optionHolderElement.setAttribute(Ji.a.ariaCheckedAttribute,Ji.a.ariaTrueValue)),this.updateEmbedUrlAndRefresh(e.userData.toString(),t.value.toString())},c.textAreaOnFocusHandler=function(e){this._embedCodeTextArea.select()},i.getEmbedCode=function(e,t,n){if(!i._noFramesText){var r=String.format(Qr,We.a.htmlAttributeEncode("https://office.com"),CommonUIStrings.l_Office),a=String.format(Qr,We.a.htmlAttributeEncode("https://office.com/webapps"),CommonUIStrings.l_WebAppName);i._noFramesText=String.format(CommonUIStrings.l_NoFrames,r,a)}return String.format('<iframe src="{0}" width="{1}px" height="{2}px" frameborder="0">{3}</iframe>',We.a.htmlAttributeEncode(e),t,n,i._noFramesText)},a=i,(o=[{key:"_width$4",get:function(){return this._embedWidth},set:function(e){this._embedWidth=e}},{key:"_height",get:function(){return this._embedHeight},set:function(e){this._embedHeight=e}}])&&Jr(a.prototype,o),l&&Jr(a,l),i}(hi.a);Zr._noFramesText=null,Zr._checkedIconCssClass="CheckboxChecked_16x16x32",Zr._uncheckedIconCssClass="CheckboxUnchecked_16x16x32",Zr._upArrowIconCssClass="OutlookSearchChevronUp_16x16x32",Zr._downArrowIconCssClass="OutlookSearchChevronDown_16x16x32",Zr._checkboxIconName="CommentChecked",Zr._arrowIconName="UpArrowServer",Zr._descriptionCssClass="EmbedDescription",Zr._sectionHeaderCssClass="EmbedSectionHeader",Zr._sectionNameCssClass="EmbedSectionName UIFontBold",Zr._footerCssClass="EmbedCodeFooter",Zr._checkboxCssClass="EmbedOptionImage",Zr._previewFrameCssClass="EmbedPreviewFrame",Zr._embedCodeCssClass="EmbedCodeTextArea",Zr._optionCssClass="EmbedOption",Zr._dimensionSectionCssClass="EmbedDimensionSection",Zr._arrowImageCssClass="EmbedArrowIcon",Zr._arrowHolderCssClass="WACGlyph EmbedArrowHolder",Zr._checkBoxHolderCssClass="EmbedCheckBoxHolder",Zr._optionId="Option",Zr._optionImageId="OptionImage",Zr._embedcodeTextAreaId="EmbedCode",Zr._embedCodeHeaderId="EmbedCodeHeader",Zr._previewId="Preview",Zr._previewHeaderId="PreviewHeader",Zr._codeId="Code",Zr._dimensionId="Dim",Zr._optionsId="Options",Zr._arrowId="Arrow",Zr._checkId="Check",Zr._embedCodeFooterId="EmbedCodeFooter",Object(i.a)(Zr,"EmbedDialog",hi.a,[]);var Yr=n(425);var $r=function(e){var t,n;function i(t,n,i,r,a){var o;return(o=e.call(this,t,n,i,r)||this).inputElement=a,o}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(Gr);function ea(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ta(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object(i.a)($r,"OptionInputInfo",Gr,[]);var na=function(e){var t,n;function i(t,n){var a;return(a=e.call(this,t,i.useReactDialog)||this)._startOnOptionInfo=null,a._dimensionElements=[],a._startOnOptionClickHandler=Object(r.d)(ta(a),a.startOnOptionClickHandler,"startOnOptionClickHandler"),a._startOnOptionKeyHandler=Object(r.d)(ta(a),a.startOnOptionKeyHandler,"startOnOptionKeyHandler"),a._pageNumberChangedHandler=Object(r.d)(ta(a),a.onPageNumberChanged,"onPageNumberChanged"),a._dimensionChangedHandler=Object(r.d)(ta(a),a.onDimensionChanged,"onDimensionChanged"),a._dialogStrings=n,a}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a,o,l,c=i.prototype;return c.showEmbedDialog=function(){if(i.useReactDialog){var t,n,r,a,o,s,l=i.reactUrlTransformFunctionOnChange,c=[];c.push(((t={}).id="wdPrint",t.checkboxInitialValue=!0,t.checkboxLabel=this._dialogStrings.printOptionText,t.urlTransformFunctionOnChange=l,t),((n={}).id="wdEmbedCode",n.checkboxInitialValue=!0,n.checkboxLabel=this._dialogStrings.reembedOptionText,n.urlTransformFunctionOnChange=l,n),((a={}).id="wdStartOn",a.checkboxInitialValue=!1,a.checkboxLabel=this._dialogStrings.startOptionText,a.urlTransformFunctionOnChange=l,a.textInputProps=((r={}).title=this._dialogStrings.startPageText,r),a));var u=((s={}).dimensionsOptions=((o={}).isMultipleChoice=!1,o.defaultWidth=this._embedWidth,o.defaultHeight=this._embedHeight,o.minWidth=375,o.minHeight=250,o.widthLabel=this._dialogStrings.widthText,o.heightLabel=this._dialogStrings.heightText,o),s.interactionOptions=c,s);this.showReactEmbedDialog(u)}else if(e.prototype.showEmbedDialog.call(this),this.addDimensionControl(this._dialogStrings.widthText,"EmbedWidthInput",this._embedWidth),this.addDimensionControl(this._dialogStrings.heightText,"EmbedHeightInput",this._embedHeight),this._optionSection.appendChild(this.createCheckBox("wdPrint",this._dialogStrings.printOptionText,!0)),this._optionSection.appendChild(this.createCheckBox("wdEmbedCode",this._dialogStrings.reembedOptionText,!0)),this.addCheckBoxWithInput(this._dialogStrings.startOptionText,!1),this.centerDialog(),It.FocusManager.usable()){var d=It.FocusManager.instance(),p=[document.getElementById(Zr._embedcodeTextAreaId),document.getElementById("EmbedWidthInput"),document.getElementById("EmbedHeightInput"),document.getElementById(Zr._arrowId+Zr._optionsId),document.getElementById("wdPrint"+Zr._checkId),document.getElementById("wdEmbedCode"+Zr._checkId),document.getElementById("wdStartOn"+Zr._checkId),document.getElementById("wdStartOnText"),document.getElementById(yi.a._actionButtonId),document.getElementById(Zr._previewHeaderId)],h=new Yr.a(p);d.getCurrentRegion().listing=h,U.a.isIPad?this.setFocusOnElement(document.getElementById(yi.a._actionButtonId)):this._embedCodeTextArea.select()}},c.dispose=function(){if(i.useReactDialog)e.prototype.dispose.call(this);else{if(this._dimensionElements){for(var t=0;t<this._dimensionElements.length;++t)Ee.a.removeHandler(this._dimensionElements[t],"change",this._dimensionChangedHandler);this._dimensionChangedHandler=null,this._dimensionElements=null}this._pageNumberChangedHandler&&(Ee.a.removeHandler(this._startOnOptionInfo.inputElement,"change",this._pageNumberChangedHandler),this._pageNumberChangedHandler=null),this._startOnOptionClickHandler&&(this._clickManager.unregisterHandler(f.EventNames.click,this._startOnOptionInfo.optionElement,this._startOnOptionClickHandler),this._startOnOptionClickHandler=null),this._startOnOptionKeyHandler&&(this._keyInputManager.unregisterHandler(f.EventNames.keyDown,this._startOnOptionInfo.optionElement,this._startOnOptionKeyHandler),this._keyInputManager.unregisterHandler(f.EventNames.keyUp,this._startOnOptionInfo.optionElement,this._startOnOptionKeyHandler),this._startOnOptionKeyHandler=null),this._startOnOptionInfo=null,e.prototype.dispose.call(this)}},c.addDimensionControl=function(e,t,n){var i=document.createElement("label");i.className="EmbedInputPrefix",i.innerText=e,this._dimensionSection.appendChild(i);var r=document.createElement("input");r.className=t,r.id=t,r.value=n.toString(),r.type="text",r.setAttribute("data-lpignore","true"),i.setAttribute("for",t),this._dimensionSection.appendChild(r),Array.add(this._dimensionElements,r),Ee.a.addHandler(r,"change",this._dimensionChangedHandler),this._dimensionSection.appendChild(document.createElement("br"))},c.onDimensionChanged=function(e){"EmbedWidthInput"===e.target.id?this._embedWidth=this.ensureMinValue(e.target,375):this._embedHeight=this.ensureMinValue(e.target,250),this.updateEmbedCode()},c.ensureMinValue=function(e,t){var n=parseInt(e.value);return(isNaN(n)||n<t)&&(n=t),e.value=n.toString(),n},c.onPageNumberChanged=function(e){var t=this.ensureMinValue(e.target,1);1===this._startOnOptionInfo.value&&this.updateEmbedUrlAndRefresh("wdStartOn",t.toString())},c.addCheckBoxWithInput=function(e,t){var n=document.createElement("div");n.className=Zr._optionCssClass+" EmbedInlineOption",n.id="wdStartOn"+Zr._optionId;var i=this._document.createElement("div");i.tabIndex=0,i.className=Zr._checkBoxHolderCssClass,i.id="wdStartOn"+Zr._checkId,i.setAttribute(Ji.a.ariaRoleAttribute,Ji.a.ariaCheckBoxRole),i.setAttribute(Ji.a.ariaCheckedAttribute,t?Ji.a.ariaTrueValue:Ji.a.ariaFalseValue),i.setAttribute(Ji.a.ariaLabelledByAttribute,"wdStartOn"+Zr._descriptionCssClass),n.appendChild(i),n.setAttribute(Ji.a.ariaRoleAttribute,Ji.a.ariaPresentationRole);var r=sr.createClusteredImage(16,16,Zr._checkboxIconName,Zr._checkboxCssClass,!0,"");i.appendChild(r);var a=r.childNodes[0];a.id="wdStartOn"+Zr._optionImageId,a.className=sr.getImageClass(t?Zr._checkedIconCssClass:Zr._uncheckedIconCssClass);var o=document.createElement("span");o.className=Zr._descriptionCssClass,o.innerText=e,o.id="wdStartOn"+Zr._descriptionCssClass,n.appendChild(o),this._optionSection.appendChild(n);var s=document.createElement("input");s.className="EmbedPageNumberInput",s.id="wdStartOnText",s.type="text",s.title=this._dialogStrings.startPageText,s.setAttribute("data-lpignore","true"),this._optionSection.appendChild(s),Ee.a.addHandler(s,"change",this._pageNumberChangedHandler),this._startOnOptionInfo=new $r(n,a,i,t?1:0,s),this.updateEmbedUrlAndRefresh("wdStartOn","1"),this._clickManager.registerHandler(f.EventNames.click,n,this._startOnOptionClickHandler),this._keyInputManager.registerHandler(f.EventNames.keyDown,n,this._startOnOptionKeyHandler),this._keyInputManager.registerHandler(f.EventNames.keyUp,n,this._startOnOptionKeyHandler)},c.startOnOptionClickHandler=function(e){return this.startOnOptionHandler(e),!0},c.startOnOptionKeyHandler=function(e){return this.keyHandlerWithAction(e,Object(r.d)(this,this.startOnOptionHandler,"startOnOptionHandler"))},c.startOnOptionHandler=function(e){var t=1;this._startOnOptionInfo.value?(this._startOnOptionInfo.value=0,this._startOnOptionInfo.imageElement.className=sr.getImageClass(Zr._uncheckedIconCssClass),this._startOnOptionInfo.optionHolderElement.setAttribute(Ji.a.ariaCheckedAttribute,Ji.a.ariaFalseValue)):(this._startOnOptionInfo.value=1,this._startOnOptionInfo.imageElement.className=sr.getImageClass(Zr._checkedIconCssClass),t=this.ensureMinValue(this._startOnOptionInfo.inputElement,1),this._startOnOptionInfo.optionHolderElement.setAttribute(Ji.a.ariaCheckedAttribute,Ji.a.ariaTrueValue)),this.updateEmbedUrlAndRefresh("wdStartOn",t.toString())},i.reactUrlTransformFunctionOnChange=function(e,t,n,i){if(void 0===i&&(i=null),"wdPrint"===t||"wdEmbedCode"===t)return Dt.a.addOrReplaceParameterValue(e,t,n?"1":"0");if("wdStartOn"===t){var r="1";if(n&&i){var a=parseInt(i);!isNaN(a)&&a>=1&&(r=a.toString())}return Dt.a.addOrReplaceParameterValue(e,t,n?r:"1")}return e},a=i,l=[{key:"useReactDialog",get:function(){return s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled}}],(o=null)&&ea(a.prototype,o),l&&ea(a,l),i}(Zr);Object(i.a)(na,"WordEmbedDialog",Zr,[]);var ia=function(){function e(e,t,n,i,r){this._hostPostmessenger=null,this._actionManager=e,this._hostPostmessengerFuture=t,this._actionId=n,this._dialogStrings=i,this._app=r}var t=e.prototype;return t.registerActions=function(){this._actionManager.addAction(this._actionId,de.a.frame,Object(r.d)(this,this.showEmbedCode,"showEmbedCode")),this._hostPostmessengerFuture.execute(Object(r.d)(this,this.onHostPostmessengerCreated,"onHostPostmessengerCreated"))},t.onHostPostmessengerCreated=function(e){h.ULS.shipAssertTag(4994850,332,!!e),this._hostPostmessenger=e,s.AFrameworkApplication.isEmbedded||(this._hostPostmessenger.addAllowedReceivingMessage(d.a.canEmbed),this._hostPostmessenger.registerCallback(d.a.canEmbed,Object(r.d)(this,this.showEmbedDialog,"showEmbedDialog")))},t.showEmbedDialog=function(e){var t=e.Values.HostEmbeddedViewUrl.toString();s.AFrameworkApplication.hostEmbeddedViewUrl=t,this._app.embedPreviewUrl=t,new na(t,this._dialogStrings).showEmbedDialog()},t.showEmbedCode=function(t,n,i,r,a){if(2===i){if(!s.AFrameworkApplication.hostEmbeddedViewUrl)return s.AFrameworkApplication.theWsaClient.incrementDw(e.DATAID_WORDWAC_EMBEDWITHOUTURL,1),s.AFrameworkApplication.useFileEmbedCommandPostMessage&&this._hostPostmessenger.sendMessage(d.a.fileEmbed,null)?32:s.AFrameworkApplication.activeFrame.navigateToHostUrl(!0,s.AFrameworkApplication.fileEmbedCommandUrl);new na(this._app.embedPreviewUrl,this._dialogStrings).showEmbedDialog()}return 32},e}();function ra(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ia.DATAID_WORDWAC_EMBEDWITHOUTURL=10381,Object(i.a)(ia,"EmbedActor",null,[]);var aa=function(){function e(){}var t,n,i;return t=e,i=[{key:"dialogHtml",get:function(){return hi.a.formatHtml(e.dialogHtmlFormat,CommonUIStrings.l_EmbedCodeText)}}],(n=null)&&ra(t.prototype,n),i&&ra(t,i),e}();aa.dialogHtmlFormat="<div class='WACDialogRow' id='EmbedLabelBlock'> <label id='embedCode' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRow' id='EmbedTextAreaBlock'> <textarea id='txtEmbedCode' class='EmbedCodeTextArea' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>",Object(i.a)(aa,"ReembedDialogHtml",null,[]);var oa=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).dialogHtml=aa.dialogHtml,n.buttonsOption=0,n.dialogId="ReembedDialog",n.showDialog(CommonUIStrings.l_EmbedDialogTitle,null),n._embedCodeTextArea=document.getElementById("txtEmbedCode"),Sys.UI.DomElement.addCssClass(n._embedCodeTextArea,zr.a.allowBrowserContextMenu),U.a.isIPad||(n._embedCodeTextArea.readOnly=!0),n._embedCodeTextArea.rows=4,n._embedCodeTextArea.style.fontFamily=CommonUIStrings.l_UserInterfaceFontName,n._embedCodeTextArea.style.fontSize=CommonUIStrings.l_UserInterfaceFontSize,n._embedCodeTextArea.innerText=Zr.getEmbedCode(t,yi.a.pageWidth,yi.a.pageHeight),n._textAreafocusHandler=Object(r.d)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),n.textAreaOnFocusHandler,"textAreaOnFocusHandler"),Ee.a.addHandler(n._embedCodeTextArea,"focus",n._textAreafocusHandler),n.centerDialog(),U.a.isIPad||n._embedCodeTextArea.focus(),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=i.prototype;return a.dispose=function(){this._textAreafocusHandler&&(Ee.a.removeHandler(this._embedCodeTextArea,"focus",this._textAreafocusHandler),this._textAreafocusHandler=null),this._embedCodeTextArea=null,e.prototype.dispose.call(this)},a.textAreaOnFocusHandler=function(e){this._embedCodeTextArea.select()},i}(hi.a);Object(i.a)(oa,"ReembedDialog",hi.a,[]);var sa=function(){this.widthText=null,this.heightText=null,this.printOptionText=null,this.reembedOptionText=null,this.startOptionText=null,this.startPageText=null};Object(i.a)(sa,"WordEmbedDialogStrings",null,[]);var la=n(133);var ca=function(e){var t,n;function i(t,n){return e.call(this,t,n,er.a.showFileEmbedInfo,Object.assign(new sa,{widthText:WordViewerIntl.WordViewerStrings.l_Width,heightText:WordViewerIntl.WordViewerStrings.l_Height,printOptionText:WordViewerIntl.WordViewerStrings.l_PrintOption,reembedOptionText:WordViewerIntl.WordViewerStrings.l_ReembedOption,startOptionText:WordViewerIntl.WordViewerStrings.l_StartOnOption,startPageText:WordViewerIntl.WordViewerStrings.l_StartPage}),zi.App.instance)||this}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=i.prototype;return a.registerActions=function(){e.prototype.registerActions.call(this),this._actionManager.addAction(er.a.showReembedCode,de.a.frame,Object(r.d)(this,this.showReembedCode,"showReembedCode")),window.setTimeout((function(){i._statusBarPolled||(i._statusBarPolled=!0,zi.App.get_activeAppFrame().statusBarUser&&zi.App.get_activeAppFrame().statusBarUser.pollControl(la.a.documentInformationButton),zi.App.get_activeAppFrame().ribbonUser&&zi.App.get_activeAppFrame().ribbonUser.poll())}),10)},a.showReembedCode=function(e,t,n,r,a){var o=s.AFrameworkApplication.hostEmbeddedViewUrl,l=!s.AFrameworkApplication.hostEmbeddedViewUrl;return 1===n?l?8:32:(2===n&&(zi.App.instance.showPrint||(o=Dt.a.addOrReplaceParameterValue(o,"wdPrint","0")),1!==zi.App.initialPageNumber&&(o=Dt.a.addOrReplaceParameterValue(o,"wdStartOn",zi.App.initialPageNumber.toString())),new oa(o)),i._statusBarPolled=!0,32)},i}(ia);function ua(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ca._statusBarPolled=!1,Object(i.a)(ca,"EmbedActor",ia,[]);var da=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.configure=function(e){this._container=e,e.register(ca,"WordViewer.Embed.EmbedActor").singleInstance().usingFactory((function(){return new ca(s.AFrameworkApplication.theActionManager,e.resolveFuture("Postmessage.IHostPostmessenger"))}))},r.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){e._container.resolve("WordViewer.Embed.EmbedActor").registerActions()}))},r.dispose=function(){},t=e,(n=[{key:"name",get:function(){return"WordViewer.Embed"}}])&&ua(t.prototype,n),i&&ua(t,i),e}();Object(i.a)(da,"EmbedPackage",null,[14,15]);var pa=function(){this.LanguageRunsList=null,this.SelectionChunkIndex=0,this.SelectionCharIndex=0,this.LanguageRunsList=new te.a,this.SelectionChunkIndex=0,this.SelectionCharIndex=0};Object(i.a)(pa,"LearningToolsDocumentData",null,[]);var ha=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this)._errorDialogMessage=t,n.buttonsOption=0,n.setButtonText(1,CommonUIStrings.l_DialogClose),n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.displayError=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,this._errorDialogMessage,null,!1,!0)},i}(Pn.StandardDialog);Object(i.a)(ha,"ErrorDialog",Pn.StandardDialog,[140]);var ga=function(){};function ma(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ga,"LearningToolsExtraInfoContext",null,[139]);var fa=function(){function e(){}var t,n,i;return e.requestFullscreen=function(e){e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.requestFullscreen?e.requestFullscreen():h.ULS.sendTraceTag(7145619,210,50,"RequestFullscreen got invoked in unknown browser")},e.exitFullscreen=function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.exitFullscreen?document.exitFullscreen():h.ULS.sendTraceTag(7145620,210,50,"ExitFullscreen got invoked in unknown browser")},t=e,i=[{key:"fullscreenChangeEventName",get:function(){return document.webkitFullscreenEnabled?"webkitfullscreenchange":document.msFullscreenEnabled?"MSFullscreenChange":document.mozFullScreenEnabled?"mozfullscreenchange":document.fullscreenEnabled?"fullscreenchange":null}},{key:"fullscreenErrorEventName",get:function(){return"undefined"!=typeof document.webkitFullscreenEnabled?"webkitfullscreenerror":"undefined"!=typeof document.msFullscreenEnabled?"MSFullscreenError":"undefined"!=typeof document.mozFullScreenEnabled?"mozfullscreenerror":"undefined"!=typeof document.fullscreenEnabled?"fullscreenerror":null}},{key:"isFullScreenAvailable",get:function(){return document.webkitFullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled||document.fullscreenEnabled}},{key:"isFullScreen",get:function(){return!!(document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.fullscreenElement)}},{key:"fullScreenElement",get:function(){var e=null;return(e=document.webkitFullscreenElement)||(e=document.msFullscreenElement)||(e=document.mozFullScreenElement)||(e=document.fullscreenElement)?e:null}}],(n=null)&&ma(t.prototype,n),i&&ma(t,i),e}();Object(i.a)(fa,"FullscreenUtils",null,[]);var va=n(426),Sa=function(){function e(e,t,n,i,r,a,o,s,l,c,u,d,p,h,g,m,f,v,S){this._displayIframeStartTime=0,this._startToDisplayIFrameDuration=0,this._messageValueDictionary=null,this._container=null,this._iframe=null,this._progressDialog=null,this._errorDialog=null,this._title=e,this._msgEventHandler=t,this._clientRequestManager=n,this._webServiceBase=i,this._stopwatch=r,this._charCount=a,this._timeoutMs=o,this._textData=s,this._browserLcid=l,this._iFrameTitle=c,this._errorDialogMessage=u,this._isContentLoaded=!1,this._contentLoadedDuration=0,this._focusManager=p,this._learningToolsSessionId=B.a.create().toString(),this._learningToolsDocData=h,this._appId=f,this._staticReaderUrl=d+"?appId="+f,this._versionQueryParamEnabled=g,this._newDataFlowEnabled=m,this._useV2Api=v,this._sendDocxFile=S,this._isStorageIdReady=!1,this._browserLang=yn.a.getCultureInfo(this._browserLcid).name,this._failedCanary=!1}var t=e.prototype;return t.showLoadingDialog=function(){var e=new si.a;this._progressDialog=e.create(),this._progressDialog.buttonsOption=5,this._progressDialog.hasCloseGlyph=!1,this._progressDialog.showProgressDialog(null,null,null)},t.closeLoadingDialog=function(){this._progressDialog&&(this._progressDialog.close(),this._progressDialog=null)},t.launchErrorDialog=function(){this._errorDialog=new ha(this._errorDialogMessage),this._errorDialog.displayError(Ln.a.learningToolsLaunchFailed)},t.launch=function(e){var t=this;h.ULS.sendTraceTag(2049e4,306,50,"Learning Tools service launched"),this._stopwatch.start(),this._displayIframeStartTime=(new Date).getTime(),this.showLoadingDialog();var n,i={};i.title=this._title,i.chunks=this._textData,i.StartingChunkIndex=this._learningToolsDocData.SelectionChunkIndex,i.StartingCharIndex=this._learningToolsDocData.SelectionCharIndex;var r="",a="",o="";if(this._useV2Api){var l={};l.data=i,n=L.c(l),r="&useV2Endpoint=1",this._sendDocxFile&&(a="&sendDocxFile=1",o="&startIndex="+this._learningToolsDocData.SelectionCharIndex)}else n=L.c(i);var c=this._webServiceBase+"OneNoteS2SHandler.ashx?action="+e+"&appId="+this._appId+"&enabledConfig=WordEditorLearningToolsIsEnabled&"+s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion+r+a+o,u={"Content-Type":"application/json; charset=utf-8"};u.LearningToolsSessionId=this._learningToolsSessionId,this._clientRequestManager.addRequest(c,2,n,u,!1,2,(function(e){t.onRequestSucceeded(e)}),(function(e){t.onRequestFailed(e)}),e,void 0,void 0,void 0,this._timeoutMs);var p=this._staticReaderUrl+"&exitCallback="+d.a.exitLT+"&omkt="+this._browserLang+"&sessionId="+this._learningToolsSessionId;this._versionQueryParamEnabled&&(p+="&v=2"),this.launchIFrame(p)},t.onRequestSucceeded=function(t){var n=e.getJsonFromResponse(t.data.responseData);if(this._messageValueDictionary={},this._failedCanary=!1,this._newDataFlowEnabled)this._messageValueDictionary.readerModel=n;else{var i,r=Object(k.a)(String,n.url),a=Object(k.a)(String,n.storageId),o=Object(k.a)(String,n.version),s=Object(k.a)(String,n.processingHost);if(!r)return void Mi.b(20259850,200,10,"{0}",(i={},i.Desc="NoUrl",i));this._messageValueDictionary.storageId=a,this._messageValueDictionary.apiVersion=o,this._messageValueDictionary.processingHost=s}this.triggerPostMessageIfReady()},t.launchIFrame=function(t){s.AFrameworkApplication.isInImmersiveReaderMode=!0,this._container=document.createElement("div"),this._iframe=document.createElement("iframe"),this._container.appendChild(this._iframe),document.body.appendChild(this._container),e.setInitialElementStyle(this._container),e.setInitialElementStyle(this._iframe),this._iframe.id="ImmersiveReader-iframe",this._iframe.title=this._iFrameTitle,this._iframe.tabIndex=0,this._iframe.src=t,this._iframe.setAttribute("allowfullscreen","true"),this._iframe.setAttribute("aria-modal","true"),this.listenForPostMessage()},t.onRequestFailed=function(e){this.stopLearningToolsStopwatch(!1),h.ULS.sendTraceTag(20259852,201,10,"{0}",this.getFailureLogInfo(e)),this.closeLoadingDialog(),5!==e.data.status||this._failedCanary?this.launchErrorDialog():(this._failedCanary=!0,this.closeLearningTools(),this.launch(Object(k.a)(String,e.data.state)))},t.getFailureLogInfo=function(e){var t,n=-1;return e&&e.data&&(n=e.data.httpStatus),500===n?h.ULS.sendTraceTag(37065042,201,10,"Failed to load the immersive reader for app {0} due to a 500 internal server error response from the LT service with LearningToolsSessionId {1}",this._appId,this._learningToolsSessionId):408===n&&h.ULS.sendTraceTag(37065043,201,10,"Failed to load the immersive reader for app {0} due to a 408 request timeout from the LT service with LearningToolsSessionId {1}",this._appId,this._learningToolsSessionId),(t={}).desc="LT failure",t.status=n,t.LearningToolsSessionId=this._learningToolsSessionId,t},t.listenForPostMessage=function(){this._msgEventHandler.attachHandler(Object(r.d)(this,this.messageHandler,"messageHandler"),null)},t.triggerPostMessageIfReady=function(){var e=this;if(this._messageValueDictionary&&this._isStorageIdReady){this._focusManager.popScope("LearningToolsStaticReader"),this.stopLearningToolsStopwatch(!0),this._messageValueDictionary.launchToPostMessageSentDurationInMs=this._stopwatch.ageInMilliseconds;var t={},n="";if(this._newDataFlowEnabled)if(this._useV2Api){var i=this._messageValueDictionary.readerModel;i.launchToPostMessageSentDurationInMs=this._stopwatch.ageInMilliseconds,n="LinguisticModel",t.messageValue=i}else n="ReaderModel2",t.messageValue=this._messageValueDictionary;else n="Data",t.messageValue=this._messageValueDictionary;if(t.messageType=n,this.sendPostMessageDictionary(t),this._iframe){var r=this._focusManager.getScope("LearningTools");r.parent=Tt.AFrame.appFocusId,r.addOnFocus((function(t,n){e._iframe.focus()})),this._focusManager.pushScope("LearningTools",!1)}var a={messageType:"SetFocus"};this.sendPostMessageDictionary(a)}},t.sendPostMessageDictionary=function(e){this._iframe&&this._iframe.contentWindow&&this._iframe.contentWindow.postMessage(JSON.stringify(e),"*")},t.displayIframe=function(){var e=this;this.closeLoadingDialog();var t=this._focusManager.getScope("LearningToolsStaticReader");t.parent=Tt.AFrame.appFocusId,t.addOnFocus((function(t,n){e._iframe.focus()})),this._container.style.visibility="visible",this._iframe.style.visibility="visible",this._focusManager.pushScope("LearningToolsStaticReader",!1),h.ULS.sendTraceTag(20490001,306,50,"Learning Tools iFrame loaded"),this._startToDisplayIFrameDuration=(new Date).getTime()-this._displayIframeStartTime},t.stopLearningToolsStopwatch=function(e){var t=new va.a,n=new ga;e?(n.RequestSucceeded=!0,n.DocumentCharCount=this._charCount,n.StartToDisplayIFrameDuration=this._startToDisplayIFrameDuration):n.RequestSucceeded=!1,t.ExtraInfoContext=n,this._stopwatch.stopEx(t)},t.messageHandler=function(e){if(e.data===d.a.exitLT)return h.ULS.sendTraceTag(20490002,306,50,"Postmessage sent with param: {0}",e.data),this.closeLearningTools(),!0;if(e.data===d.a.readyForStorageLT)return this._isStorageIdReady=!0,this.displayIframe(),this.triggerPostMessageIfReady(),!0;if(e.data===d.a.requestLTFullScreen)fa.requestFullscreen(this._container);else if(e.data===d.a.exitLTFullScreen)fa.exitFullscreen();else{var t=null;try{t=JSON.parse(e.data)}catch(e){return h.ULS.sendTraceTag(21320706,306,100,"Postmessage generated exception: "+e),!1}if(t){var n=t.storageIdReceivedToContentLoadedDurationInMs;if(n)return this._isContentLoaded=!0,this._contentLoadedDuration=n,h.ULS.sendTraceTag(22905240,306,50,"contentLoadedDuration:{0}",this._contentLoadedDuration),!0}}return h.ULS.sendTraceTag(20490003,306,100,"Postmessage fired with irrelevant param"),!1},t.closeLearningTools=function(){Xi.DomUtils.removeElement(this._iframe),Xi.DomUtils.removeElement(this._container),this._msgEventHandler.detachHandler(Object(r.d)(this,this.messageHandler,"messageHandler"));var e={};e.learningToolsSessionDurationInMs=(new Date).getTime()-this._displayIframeStartTime,e.isContentLoaded=this._isContentLoaded,e.contentLoadedDuration=this._contentLoadedDuration,this._focusManager.popScope("LearningTools"),s.AFrameworkApplication.isInImmersiveReaderMode=!1,h.ULS.sendTraceTag(21320707,306,50,JSON.stringify(e))},e.setInitialElementStyle=function(e){e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.left="0",e.style.top="0",e.style.borderWidth="0",e.style.visibility="hidden",e.style.zIndex="1000",e.style.background="white"},e.getJsonFromResponse=function(e){var t,n=null,i=L.d(e,Object(z.a)((function(){return n}),(function(e){return n=e}))),r=Object(k.a)(Object,n);return r||(Mi.b(20259851,200,10,"{0}",((t={}).desc="CouldntParse",t.serialized=i,t)),null)},e}();Object(i.a)(Sa,"LearningToolsLauncher",null,[]);var _a=n(315);function ya(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ba=function(){function e(){this._msgEventHandler=null,this._clientRequestManager=null,this._webServiceBase=null,this._stopwatch=null,this._charCount=0,this._timeoutMs=0,this._browserLcid=0,this._iFrameTitle=null,this._staticUrl=null,this._focusManager=null,this._versionQueryParamIsEnabled=!1,this._newDataFlowIsEnabled=!1,this._useV2Api=!1}var t,n,i,a=e.prototype;return a.configure=function(e){},a.init=function(){s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordViewerLearningToolsIsEnabled")&&(this.registerActions(),this._msgEventHandler=_a.a.instance,this._clientRequestManager=s.AFrameworkApplication.theClientRequestManager,this._webServiceBase=s.AFrameworkApplication.appSettingsManager.appSettings.WebServiceBase,this._stopwatch=s.AFrameworkApplication.activeFrame.theStopwatchBuilder.makeStopwatch("LoadResource","ImmersiveReader"),this._timeoutMs=s.AFrameworkApplication.appSettingsManager.getIntAppSetting("LearningToolsViewerTimeoutMs",47e3),this._browserLcid=s.AFrameworkApplication.lcid,this._staticUrl=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("LearningToolsStaticUrl"),this._focusManager=It.FocusManager.instance(),this._newDataFlowIsEnabled=!0,this._iFrameTitle=WordViewerIntl.WordViewerStrings.L_ImmersiveView,this._versionQueryParamIsEnabled=!1,this._useV2Api=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("LearningToolsV2EndpointIsEnabled"))},a.dispose=function(){},a.registerActions=function(){s.AFrameworkApplication.theActionManager.addAction(er.a.launchImmersiveReader,Lr.a.application,Object(r.d)(this,this.launchImmersiveReader,"launchImmersiveReader"))},a.launchImmersiveReader=function(e,t,n,i,r){if(1===n)return 32;var a=new pa;return new Sa("",this._msgEventHandler,this._clientRequestManager,this._webServiceBase,this._stopwatch,this._charCount,this._timeoutMs,[],this._browserLcid,this._iFrameTitle,WordViewerIntl.WordViewerStrings.l_LearningToolsErrorMessage,this._staticUrl,this._focusManager,a,this._versionQueryParamIsEnabled,this._newDataFlowIsEnabled,"Word Viewer",this._useV2Api,!1).launch("learningtoolsviewer"),32},e.main=function(){s.AFrameworkApplication.disableWholeAppsForOfficeFeature||y.a.instance.registerPackage(new e,void 0,!0)},t=e,(n=[{key:"name",get:function(){return"WordViewer.LearningToolsViewerLauncher"}}])&&ya(t.prototype,n),i&&ya(t,i),e}();Object(i.a)(ba,"LearningToolsViewerLauncherPackage",null,[14,15]);var Aa=n(531);function Ca(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ta=function(){function e(){}var t,n,i,a=e.prototype;return a.configure=function(e){},a.init=function(){if(zi.App.get_activeAppFrame()){var e=Aa.a.instance;zi.App.get_activeAppFrame().workspace.setSelectionManagerDisposable(e,Object(r.d)(e,e.firstPage,"firstPage"),Object(r.d)(e,e.lastPage,"lastPage"))}},a.dispose=function(){},t=e,(n=[{key:"name",get:function(){return"WordViewer.Selection"}}])&&Ca(t.prototype,n),i&&Ca(t,i),e}();Object(i.a)(Ta,"SelectionPackage",null,[14,15]);var wa=n(528);function Ia(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ka=function(){function e(){}var t,n,i,a=e.prototype;return a.configure=function(e){},a.init=function(){s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(Object(r.d)(this,this.onFullAppSettingsReady,"onFullAppSettingsReady"))},a.onFullAppSettingsReady=function(){if(zi.App.get_activeAppFrame()&&wa.SearchManager.instance){if(Z.a.registerDispatchHandler(e.dispatcher),!zi.App.instance.isSmallView&&!s.AFrameworkApplication.isNoChrome){var t=wa.SearchManager.instance;zi.App.get_activeAppFrame().workspace.setSearchManagerDisposable(t,Object(r.d)(t,t.isSearchActive,"isSearchActive"))}zi.App.get_activeAppFrame().ribbonUser&&zi.App.get_activeAppFrame().ribbonUser.poll()}},a.dispose=function(){},e.dispatcher=function(e,t,n,i,r){return e===er.a.showSearchPane?wa.SearchManager.instance.showSearchPane(e,t,n,i,r):e===er.a.toggleSearchPane?wa.SearchManager.instance.toggleSearchPane(e,t,n,i,r):2},t=e,(n=[{key:"name",get:function(){return"WordViewer.Search"}}])&&Ia(t.prototype,n),i&&Ia(t,i),e}();Object(i.a)(ka,"SearchPackage",null,[14,15]);var Fa=n(529),Ea=n(222);function Oa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Pa=function(){function e(){this._id=0,this._request=null,this._dependency=null,this.batchedOperation=null,this.isPersistedSave=!1,this.hasClientAcceptedServerUpdate=!1,this.status=0,this.statusCode=1,this.corrrelation=null,this.httpStatusCode=0,this.requestEnqueueTime=null,this.invokedTime=null,this.invokedTimeTicks=0,this.completedTime=null,this.completedTimeTicks=0,this._responseObjects=null,this._httpHeaders=null,this.roundtripId=-1,this._createdTime=new Date,this.perfTag="Unknown",this._queryParameters=new Fe.a}var t,n,i,r=e.prototype;return r.addResponse=function(e){this.responseObjects||(this._responseObjects=[]),Array.add(this.responseObjects,e)},r.addHttpHeader=function(e,t){this.httpHeaders||(this._httpHeaders=new Fe.a),this.httpHeaders.add(e,t)},r.getDiagnosticStateForLogging=function(){var e={};this.hasClientAcceptedServerUpdate&&(e.CASU=1),e.ID=this.id,e.RID=this.roundtripId,e.S=this.status,this.corrrelation&&(e.C=this.corrrelation),e.CRT=this.createdTime.toISOString();var t=null;return s.AFrameworkApplication.theClientRequestManager&&(t=s.AFrameworkApplication.theClientRequestManager.peekAtRequestQueue(this.roundtripId)),t?(e.HSC=t.httpStatus,e.RI=1,e.ST=t.status,t.enqueueTime&&(e.ET=t.enqueueTime.toISOString()),t.invokedTime&&(e.IT=t.invokedTime.toISOString()),t.completedTime&&(e.CT=t.completedTime.toISOString())):(e.HSC=this.httpStatusCode,e.RI=0,e.ST=this.statusCode,this.requestEnqueueTime&&(e.ET=this.requestEnqueueTime.toISOString()),this.invokedTime&&(e.IT=this.invokedTime.toISOString()),this.completedTime&&(e.CT=this.completedTime.toISOString())),e},t=e,(n=[{key:"id",get:function(){return this._id},set:function(e){this._request&&(this._request.OperationId=e),this._id=e}},{key:"createdTime",get:function(){return this._createdTime}},{key:"queryParameters",get:function(){return this._queryParameters}},{key:"requestObject",get:function(){return this._request},set:function(e){e&&(e.OperationId=this.id),this._request=e}},{key:"responseObjects",get:function(){return this._responseObjects}},{key:"httpHeaders",get:function(){return this._httpHeaders}},{key:"dependency",get:function(){return this._dependency},set:function(e){this._dependency=e,e&&(this.requestObject.DependentOn=e.id)}}])&&Oa(t.prototype,n),i&&Oa(t,i),e}();Object(i.a)(Pa,"ServerOperation",null,[]);var Da=n(245);var Ma=function(e){var t,n;function i(){return e.call(this)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(Da.a);Object(i.a)(Ma,"UIntDictionary",Da.a,[]);var La=function(){};La.batchedOperation="BatchedOperation",La.replication="Replication",La.typingProcessEvent="25",La.replicationEvent="9_"+La.batchedOperation+"_"+La.replication,Object(i.a)(La,"CpuMeterConstants",null,[]);var Ra=n(110),Ua=n(423);function Ha(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ba(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ba(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Ba(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var xa=function(){function e(){this.Mode=0,this.srs=null}return e.addRequestToGroup=function(e,t){var n=[];n[0]=t.getClassId(),n[1]=t,Array.add(e,n)},e.serialization=function(t,n){var i=new e;return i.Mode=n,i.srs=t,L.c(i)},e.construct=function(t,n){for(var i,r=[],a=Ha(t);!(i=a()).done;){var o=i.value.get_value();o&&e.addRequestToGroup(r,o.requestObject)}return e.serialization(r,n)},e.constructFromSingleRequest=function(t,n){var i=[];return e.addRequestToGroup(i,t),e.serialization(i,n)},e.constructFromArrayList=function(t,n){for(var i=[],r=0;r<t.length;++r)t[r]&&e.addRequestToGroup(i,t[r]);return e.serialization(i,n)},e}();Object(i.a)(xa,"CommonServerRequestGroup",null,[]);var Na=function(){function e(){this.Responses=null}return e.fixupArrayResponses=function(e){if(e)for(var t=e.length,n=0;n<t;n++){var i=e[n];e[n]=i[1],e[n].classId=i[0]}},e.fromServerResponseObject=function(t){try{var n=t;if(e.fixupArrayResponses(n.Responses),n.Responses&&n.Responses.length>0)return n}catch(e){}return null},e.tryDeserializeServerResponse=function(t,n){try{var i=L.a(t);n.val=e.fromServerResponseObject(i)}catch(e){n.val=null}return!!n.val},e}();function ja(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Wa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wa(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Wa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Va(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Na,"ServerResponseGroup",null,[]);var qa=function(){function e(e,t){this._operations=new Ma,this._operationsAdded=0,this._operationsRemoved=0,this._requestId=0,this._cancelled=!1,this._hasResponse=!1,this._responseTime=null,this.invokedCallback=null,this._priority=e,this._onServerResponse=t,this.operationName="generic"}var t,n,i,a=e.prototype;return a.addOperation=function(e){e.id=++this._operationsAdded,e.batchedOperation=this,this._operations.set_item(this._operationsAdded,e)},a.removeOperation=function(e){this._operations.remove(e.id),e.id=0,e.batchedOperation=null,this._operationsRemoved++},a.dispatchRequest=function(t){void 0===t&&(t=null);var n=xa.construct(this._operations,this.mode);if(n){var i=this.getRequestQueueTimeoutMs(),a=this.getRequestTimeoutMs(n.length),o=this.buildTargetUrl();0;var l={};this.addRequestHeaders(l);var c=(t||e.extraInfoScanner)(this._operations);this._requestId=s.AFrameworkApplication.theClientRequestManager.addRequestWithHeaderForwarding(o,2,n,l,this.getResponseHeadersToSet(),!1,this._priority,Object(r.d)(this,this.onSuccess,"onSuccess"),Object(r.d)(this,this.onFailure,"onFailure"),null,null,!1,i,a,La.batchedOperation+"_"+this.operationName,void 0,this.shouldProcessResponseSynchronously,void 0,void 0,c,this.invokedCallback);for(var u,d=ja(this._operations);!(u=d()).done;){u.value.get_value().roundtripId=this._requestId}this._requestId}},a.buildTargetUrl=function(){for(var e,t=this.webServiceBase+this.serviceName,n=new R.QueryStringBuilder(t),i=new Fe.a,r=function(){var t=e.value,r=t.get_value()&&t.get_value().perfTag&&""!==t.get_value().perfTag?t.get_value().perfTag:"Unknown",a=void 0;if(i.tryGetValue(r,Object(z.a)((function(){return a}),(function(e){return a=e})),0),i.set_item(r,a+1),t.get_value()&&t.get_value().queryParameters.get_count()>0)for(var o,s=ja(t.get_value().queryParameters);!(o=s()).done;){var l=o.value;n.addParam(l.get_key(),l.get_value())}},a=ja(this._operations);!(e=a()).done;)r();for(var o,s=new Sys.StringBuilder,l=!0,c=ja(i);!(o=c()).done;){var u=o.value;l||s.append(";"),l=!1,s.append(u.get_key()),s.append("_"),s.append(u.get_value())}var d=s.toString();return n.addParam("perfTag",d),n.toString()},a.dispatchShutdownRequest=function(){var e=xa.construct(this._operations,this.mode);if(e){var t=this.webServiceBase+this.serviceName;0;for(var n,i=ja(this._operations);!(n=i()).done;)n.value;s.AFrameworkApplication.theClientRequestManager.sendShuttingDownRequest(t,e)}},a.createBootstrapResponse=function(){var e=null;if(1!==this.operationCount||!this._operations.tryGetValue(this.operationCount,Object(z.a)((function(){return e}),(function(t){return e=t})))||!e||1!==e.requestObject.getClassId())return this.dispatchRequest(),null;var t=(new Date).getTime();Bt.a.instance.addMetric(Ht.a.parseResponseStart,t),xt.a.instance.addMark(Ht.a.parseResponseStart),this._requestId=s.AFrameworkApplication.theClientRequestManager.getNextRequestIdAndIncrement();var n=new Ua.a(this._requestId,0,null,null,!1,null,null,null);return n.status=2,this._hasResponse=!0,n},a.processBootstrapResponse=function(e){1===e.status&&h.ULS.sendTraceTag(42022656,306,15,"BootstrapRequest still executing"),this.parseServerResponse(e),this._onServerResponse&&this._onServerResponse(this)},a.prepareBootstrapResponse=function(){var e=this.createBootstrapResponse();e&&this.processBootstrapResponse(e)},a.cancel=function(){this._cancelled=!0,s.AFrameworkApplication.theClientRequestManager.abortRequest(this._requestId)},a.onSuccess=function(e){this.onSuccessOrFailure(e.data,!0)},a.onFailure=function(e){this.onSuccessOrFailure(e.data,!1)},a.onSuccessOrFailure=function(e,t){this._cancelled||(this._hasResponse=!0,this._responseTime=new Date,e&&1===e.status&&(t?h.ULS.sendTraceTag(42022658,306,15,"Successful request still executing"):h.ULS.sendTraceTag(42022659,306,15,"Failed request still executing")),this.parseServerResponse(e),this._onServerResponse&&this._onServerResponse(this))},a.getRequestTimeoutMs=function(e){return null},a.getRequestQueueTimeoutMs=function(){return null},a.parseServerResponse=function(e){var t=this;this.handleResponseHeaders(e.responseHeaders);var n,i,r=(e.responseHeaders?e.responseHeaders[Ra.a.correlationIdHeaderName]:"")||this.correlation;if(e.responseObject?n=Na.fromServerResponseObject(e.responseObject):Na.tryDeserializeServerResponse(e.responseData,Object(z.a)((function(){return n}),(function(e){return n=e}))),n)for(var a=function(i){var a=n.Responses[i];a.requestInvokedTime=e.invokedTime,a.requestInvokedTimeTicks=e.invokedTimeTicks,a.requestCompletedTimeTicks=e.completedTimeTicks,a.correlation=r;var o=null;t._operations.tryGetValue(a.OperationId,Object(z.a)((function(){return o}),(function(e){return o=e}))),null!=o&&o.addResponse(a)},o=0;o<n.Responses.length;o++)a(o);else h.ULS.sendTraceTag(42022663,306,15,"Couldn't deserialize server response {0}",((i={}).Correlation=r,i.HttpStatus=e.httpStatus,i.Id=e.id,i.RequestEnqueueTime=e.enqueueTime?e.enqueueTime.getTime().toString():"NULL",i.RequestInvokedTime=e.invokedTime?e.invokedTime.getTime().toString():"NULL",i.RequestCompletedTime=e.completedTime?e.completedTime.getTime().toString():"NULL",i));for(var s,l=ja(this._operations);!(s=l()).done;){var c=s.value.get_value();c.status=2,c.statusCode=e.status,c.corrrelation=r,c.httpStatusCode=e.httpStatus,c.requestEnqueueTime=e.enqueueTime,c.invokedTime=e.invokedTime,c.invokedTimeTicks=e.invokedTimeTicks,c.completedTime=e.completedTime,c.completedTimeTicks=e.completedTimeTicks}},a.addRequestHeaders=function(e){e["Content-Type"]="application/json; charset=utf-8";for(var t,n=ja(this._operations);!(t=n()).done;){var i=t.value.get_value();if(i.httpHeaders)for(var r,a=ja(i.httpHeaders);!(r=a()).done;){var o=r.value;e[o.get_key()]=o.get_value()}}},a.handleResponseHeaders=function(e){},a.getResponseHeadersToSet=function(){return[]},e.extraInfoScanner=function(e){return{}},t=e,(n=[{key:"operations",get:function(){return this._operations}},{key:"operationCount",get:function(){return this._operationsAdded-this._operationsRemoved}},{key:"shouldProcessResponseSynchronously",get:function(){return!1}},{key:"hasResponse",get:function(){return this._hasResponse}},{key:"responseTime",get:function(){return this._responseTime},set:function(e){this._responseTime=e}},{key:"correlation",get:function(){return""}}])&&Va(t.prototype,n),i&&Va(t,i),e}();function Ga(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ka(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ka(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Ka(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function za(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(qa,"ABatchedServerOperation",null,[120]);var Ja=function(e){var t,n;function i(t,n,i,r,a,o,s,l,c,u,d){var p;return void 0===o&&(o=!1),void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===d&&(d=!1),(p=e.call(this,t,n)||this)._serviceName=i,p._responseTimeFetcher=c,p._requestItemProcessor=u,p._appMode=r,p._webServiceBase=a,p._amIAlone=l,p._bachedServerOperationTimeoutIsEnabled=d,p}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r,a,o,s=i.prototype;return s.prepareBootstrapResponse=function(){var e=this.createBootstrapResponse();e&&(this._requestItemProcessor&&this._requestItemProcessor(e),this._responseTimeFetcher&&(this._responseTime=this._responseTimeFetcher()),this.processBootstrapResponse(e))},s.getRequestTimeoutMs=function(e){return this._bachedServerOperationTimeoutIsEnabled?6e4:null},s.getRequestQueueTimeoutMs=function(){return this._bachedServerOperationTimeoutIsEnabled?6e4:null},r=i,(a=[{key:"serviceName",get:function(){return this._serviceName}},{key:"mode",get:function(){return this._appMode}},{key:"webServiceBase",get:function(){return this._webServiceBase}},{key:"shouldProcessResponseSynchronously",get:function(){if(!this._amIAlone||this._amIAlone())return!1;for(var e,t=Ga(this.operations);!(e=t()).done;){var n=e.value.get_value();if(n){var i=n.requestObject;if(i&&(2===i.getClassId()||3===i.getClassId()))return!0}}return!1}}])&&za(r.prototype,a),o&&za(r,o),i}(qa);Object(i.a)(Ja,"BatchedServerOperation",qa,[120]);var Xa=function(){function e(){}return e.prototype.getBatchedServerOperation=function(e,t){return new Ja(e,t,"Comments.ashx",zi.App.mode,zi.App.webServiceBase)},e}();Object(i.a)(Xa,"BatchedServerOperationFactory",null,[153]);var Qa=function(){this.OperationId=0,this.DependentOn=0};Object(i.a)(Qa,"AServerRequest",null,[]);var Za=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.DocNormal=!1,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.getClassId=function(){return 15},i.construct=function(e,t){var n=new i;return n.FileId=e,n.SharedLock=!1,n.DocNormal=t,n},i}(Qa);Object(i.a)(Za,"BeginCommentingRequest",Qa,[]);var Ya=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.getClassId=function(){return 20},i.construct=function(e,t){var n=new i;return n.FileId=e,n.SharedLock=t,n},i}(Qa);Object(i.a)(Ya,"EndCommentingRequest",Qa,[]);var $a=n(303),eo=n(159),to=n(304),no=n(148);function io(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ro=function(){function e(t,n,i,a,o){void 0===o&&(o=!0),this._commentIds=[],this._zoomControl=null,this._pageNumber=n,this._top=i,Array.add(this._commentIds,a),this._hintElement=document.createElement("span"),this._hintElement.className="CommentHint",this._hintElement.setAttribute(e.COUNT_ATTRIBUTE,"1");var s=sr.createClusteredImage(16,16,"CommentHint_16x16x32","",!0,CommonUIStrings.l_CommentHintTooltip);this._hintElement.appendChild(s),t.appendChild(this._hintElement),this._imageElement=s.firstChild,this.positionHint(o),zi.App.get_activeAppFrame().theClickInputManager.registerHandler(f.EventNames.click,this._hintElement,Object(r.d)(this,this.onHintClick,"onHintClick"));var l=zi.App.get_activeAppFrame().theMouseInputManager;l.registerHandler(f.EventNames.mouseOver,this._imageElement,Object(r.d)(this,this.onMouseOver,"onMouseOver"),null),l.registerHandler(f.EventNames.mouseOut,this._imageElement,Object(r.d)(this,this.onMouseExit,"onMouseExit"),null)}var t,n,i,a=e.prototype;return a.repurposeFor=function(t,n,i,r){void 0===r&&(r=!0),this._pageNumber=t,this._top=n,Array.clear(this._commentIds),Array.add(this._commentIds,i),this._hintElement.setAttribute(e.COUNT_ATTRIBUTE,"1"),this.positionHint(r)},a.dispose=function(){zi.App.get_activeAppFrame().theClickInputManager.unregisterHandler(f.EventNames.click,this._hintElement,Object(r.d)(this,this.onHintClick,"onHintClick")),this._hintElement=null;var e=zi.App.get_activeAppFrame().theMouseInputManager;e.unregisterHandler(f.EventNames.mouseOver,this._imageElement,Object(r.d)(this,this.onMouseOver,"onMouseOver")),e.unregisterHandler(f.EventNames.mouseOut,this._imageElement,Object(r.d)(this,this.onMouseExit,"onMouseExit")),this._imageElement=null},a.registerForComment=function(t){Array.add(this._commentIds,t),this._hintElement.setAttribute(e.COUNT_ATTRIBUTE,String.format("{0}",this._commentIds.length)),this._commentIds.sort()},a.unregisterCommentAndCheckValidity=function(t){return Array.remove(this._commentIds,t),this._hintElement.setAttribute(e.COUNT_ATTRIBUTE,String.format("{0}",this._commentIds.length)),!!this._commentIds.length||(this.removeFromView(),!1)},a.removeFromView=function(){this._hintElement.parentNode.removeChild(this._hintElement)},a.positionHint=function(t){void 0===t&&(t=!0);var n=this.zoomControl.currentZoom,i=Hr.a.instance.getPageTopAtZoom(this._pageNumber,n)+Math.round(this._top*n),r=0;r=s.AFrameworkApplication.isRtl?e.HINT_OVERLAP-e.HINT_WIDTH+Hr.a.instance.getPageLeftAtZoom(this._pageNumber,n,!1):Hr.a.instance.getPageWidthAtZoom(this._pageNumber,n)-e.HINT_OVERLAP+Hr.a.instance.getPageLeftAtZoom(this._pageNumber,n,!1),t?no.a.animateCommentHintPosition(this._hintElement,i,r):(Xi.DomUtils.setElementStyleLeftInPixels(this._hintElement,r),Xi.DomUtils.setElementStyleTopInPixels(this._hintElement,i))},a.onHintClick=function(e){var t=new to.a(null,e.inputSource);return s.AFrameworkApplication.theActionManager.processActionWithData(p.a.showCommentPane,2,t),Fa.a.instance.selectComment(this._commentIds[0]),s.AFrameworkApplication.theActionManager.processAction(p.a.commentHintClick,2),!0},a.onMouseOver=function(e){return this._imageElement.className=sr.getImageClass("CommentHintHover_16x16x32"),!0},a.onMouseExit=function(e){return this._imageElement.className=sr.getImageClass("CommentHint_16x16x32"),!0},t=e,(n=[{key:"top",get:function(){return this._top}},{key:"pageNumber",get:function(){return this._pageNumber}},{key:"commentIds",get:function(){return this._commentIds}},{key:"zoomControl",get:function(){return this._zoomControl||(this._zoomControl=x.a.instance.resolve("WordViewer.Controls.IZoomControl"))}}])&&io(t.prototype,n),i&&io(t,i),e}();ro.HINT_OVERLAP=22,ro.HINT_WIDTH=16,ro.HINT_HEIGHT=16,ro.COUNT_ATTRIBUTE="count",Object(i.a)(ro,"CommentHint",null,[4]);var ao=n(536),oo=n(36);function so(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var lo=function(){function e(t,n){this._startKnown=!1,this._isEmpty=!1,this._currentFoundStartPage=0,this._currentFoundStartTextrunId=e.ID_UNKNOWN,this._currentFoundEndTextrunId=e.ID_UNKNOWN,this._anchorBoxes=[],this._anchorPageNumbers=[],this._commentId=t,this._pageNumber=n}var t,n,i,r=e.prototype;return r.trySetSingleBoxAnchorFromNode=function(t,n){var i;return!!e.tryCreateBox(t,Object(z.a)((function(){return i}),(function(e){return i=e})))&&(Array.add(this._anchorBoxes,i),Array.add(this._anchorPageNumbers,n),!0)},r.insertBoxRange=function(e,t){if(!(t.length<1)){for(var n=t[0],i=[],r=[],a=0;a<this._anchorPageNumbers.length&&!(n<this._anchorPageNumbers[a]);)Array.add(i,this._anchorBoxes[a]),Array.add(r,this._anchorPageNumbers[a]),a++;for(Array.addRange(i,e),Array.addRange(r,t);a<this._anchorPageNumbers.length;a++)Array.add(i,this._anchorBoxes[a]),Array.add(r,this._anchorPageNumbers[a]);this._anchorBoxes=i,this._anchorPageNumbers=r}},r.cloneFor=function(t){var n=new e(t,this._pageNumber);return n._anchorBoxes=Array.clone(this._anchorBoxes),n._anchorPageNumbers=Array.clone(this._anchorPageNumbers),n._startKnown=this._startKnown,n._isEmpty=this._isEmpty,n},e.tryCreateBox=function(t,n){n.val=null;var i=parseFloat(oo.a.parseXmlAttribute(t,"l")),r=parseFloat(oo.a.parseXmlAttribute(t,"t")),a=parseFloat(oo.a.parseXmlAttribute(t,"w")),o=parseFloat(oo.a.parseXmlAttribute(t,"h"));return!(isNaN(i)||isNaN(r)||isNaN(a)||isNaN(o))&&(a<8&&(a=8),o<e.MINIMUM_BOX_HEIGHT&&(o=e.MINIMUM_BOX_HEIGHT),n.val=new ao.a(i,r,a,o),!0)},e.compare=function(e,t){var n=e,i=t;if(!n.isStartKnown||!i.isStartKnown)return 0;var r=n.anchorPageNumbers[0],a=i.anchorPageNumbers[0];if(r!==a)return r-a;var o=n.anchorBoxes[0],s=i.anchorBoxes[0];return o.top===s.top?0:o.top<s.top?-1:1},t=e,(n=[{key:"commentId",get:function(){return this._commentId}},{key:"firstPageNumber",get:function(){return this._pageNumber}},{key:"isStartKnown",get:function(){return this._startKnown},set:function(e){this._startKnown=e}},{key:"isEmpty",get:function(){return this._isEmpty},set:function(e){this._isEmpty=e}},{key:"needsProcessing",get:function(){return this.currentFoundStartTextrunId!==e.ID_UNKNOWN||this.currentFoundEndTextrunId!==e.ID_UNKNOWN}},{key:"currentFoundStartPage",get:function(){return this._currentFoundStartPage},set:function(e){this._currentFoundStartPage=e}},{key:"currentFoundStartTextrunId",get:function(){return this._currentFoundStartTextrunId},set:function(e){this._currentFoundStartTextrunId=e}},{key:"currentFoundEndTextrunId",get:function(){return this._currentFoundEndTextrunId},set:function(e){this._currentFoundEndTextrunId=e}},{key:"anchorBoxes",get:function(){return this._anchorBoxes}},{key:"anchorPageNumbers",get:function(){return this._anchorPageNumbers}}])&&so(t.prototype,n),i&&so(t,i),e}();lo.ID_UNKNOWN=-1,lo.MINIMUM_BOX_HEIGHT=10,Object(i.a)(lo,"ViewerAnchorInfo",null,[143]);var co=n(532),uo=n(542),po=n(354);function ho(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var go=function(){function e(){this._scrollerElement=null,this._commentToViewerAnchorInfo={},this._commentToHint={},this._unhintedComments=[],this._hints=[],this._activeHighlights=[],this._pagesAlreadyParsed={},this._anchorWaitingToHighlight=null,this._commentCurrentlyHighlighted=null,this._waitingToScrollToComment=!1,this._zoomControl=null,this._scrollControl=null,zi.App.instance.isSmallView||s.AFrameworkApplication.isNoChrome||(this._highlightWhenPageLoadedTask=new u.a(3,1,zi.App.instance.theConfig.highlightTaskDelay,Object(r.d)(this,this.delayedHighlightTimer,"delayedHighlightTimer")),s.AFrameworkApplication.theActionManager.addActionWithFlags(er.a.xmlPageDownloaded2,Lr.a.application,Object(r.d)(this,this.onXmlPageDownloaded2,"onXmlPageDownloaded2"),64),s.AFrameworkApplication.theActionManager.addActionWithFlags(er.a.rebuildCommentHints,Lr.a.application,Object(r.d)(this,this.onRebuildCommentHints,"onRebuildCommentHints"),96),s.AFrameworkApplication.theActionManager.addActionWithFlags(er.a.rebuildCommentHintsWithoutAnimation,Lr.a.application,Object(r.d)(this,this.onRebuildCommentHintsWithoutAnimation,"onRebuildCommentHintsWithoutAnimation"),96),s.AFrameworkApplication.theActionManager.addActionWithFlags(er.a.updateCommentHighlight,Lr.a.application,Object(r.d)(this,this.onUpdateCommentHighlight,"onUpdateCommentHighlight"),64),zi.App.get_activeAppFrame().add_onResize(Object(r.d)(this,this.onWindowResize,"onWindowResize")),this._initialCommentDataTask=new u.a(3,1,1e3,Object(r.d)(this,this.loadInitialSelectionXml,"loadInitialSelectionXml")),s.AFrameworkApplication.theTaskManager.addTask(this._initialCommentDataTask))}var t,n,i,a=e.prototype;return a.initialize=function(e){this._scrollerElement=e},a.dispose=function(){this.removeCurrentHighlights();for(var e=0;e<this._hints.length;e++)this._hints[e].dispose();this._hints=[],this._commentToHint={},this._commentToViewerAnchorInfo={},this._unhintedComments=[],this._activeHighlights=[],this._commentCurrentlyHighlighted=null,zi.App.get_activeAppFrame().remove_onResize(Object(r.d)(this,this.onWindowResize,"onWindowResize"))},a.highlightComment=function(e,t){this._commentCurrentlyHighlighted!==e&&(this._commentCurrentlyHighlighted=e,this._waitingToScrollToComment=!1,this._anchorWaitingToHighlight&&(s.AFrameworkApplication.theTaskManager.deleteTask(this._highlightWhenPageLoadedTask),this._anchorWaitingToHighlight=null));var n=this._commentToViewerAnchorInfo[e.id];n&&n.isStartKnown?(this._waitingToScrollToComment=!1,this.highlightAndScrollToAnchor(n,t)):t&&(this.scrollControl.scrollToPage(e.groupNumber),this._waitingToScrollToComment=!0,this.removeCurrentHighlights())},a.clearHighlighting=function(){this.removeCurrentHighlights(),this._commentCurrentlyHighlighted=null,this._anchorWaitingToHighlight=null,this._waitingToScrollToComment=!1},a.removeCurrentHighlights=function(){for(var e=0;e<this._activeHighlights.length;e++){var t=this._activeHighlights[e];co.a.instance.removeFromParent(t)}this._activeHighlights=[]},a.createAnchorForSelectedParagraphs=function(t,n){n.val=null;var i=null,r=Aa.a.instance.selectionStart,a=Aa.a.instance.selectionEnd;if(r&&a||(r=Aa.a.instance.previousSelectionStart,a=Aa.a.instance.previousSelectionEnd),!r||!a){var o=wa.SearchManager.instance,s=o?o.currentSelectedResult:null;if(s&&s.result){var l=s.result.page,c=s.result.paragraphTextrunId,u=zi.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(l);if(!u)return 1;var d=u.selectSingleNode(e.getXPathForTextrun(l,c));if(!d)return 1;r=new uo.a(null,d),a=new uo.a(null,d)}}if(!r||!a)return 1;var p=zi.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(r.page).selectSingleNode(e.getXPathForTextrun(r.page,r.id));var h=p.selectSingleNode("preceding-sibling::T[last()]")||p,g=p.selectSingleNode("ancestor::P");var m=zi.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(a.page).selectSingleNode(e.getXPathForTextrun(a.page,a.id));var f=m.selectSingleNode("following-sibling::T[last()]")||m,v=m.selectSingleNode("ancestor::P");if(!e.isCommentablePara(g)||!e.isCommentablePara(v))return 2;(i=new lo(t.id,r.page)).currentFoundStartTextrunId=parseInt(oo.a.parseXmlAttribute(h,"id")),i.currentFoundEndTextrunId=parseInt(oo.a.parseXmlAttribute(f,"id")),i.currentFoundStartPage=r.page,i.isStartKnown=!0,t.anchorStartId=oo.a.parseXmlAttribute(g,"id"),t.anchorEndId=oo.a.parseXmlAttribute(v,"id");var S=[];return Array.add(S,i),this.parseAnchorLocations(S),this._commentToViewerAnchorInfo[t.id]=i,Array.add(this._unhintedComments,t.id),this.createHints(),n.val=i,0},a.createAnchorForReply=function(e){var t=this._commentToViewerAnchorInfo[e.replyToId];if(t){var n=t.cloneFor(e.id);this._commentToViewerAnchorInfo[e.id]=n}},a.commentsDeleted=function(e){for(var t=0;t<e.length;t++){var n=e[t];this._commentToViewerAnchorInfo[n.id]=null;var i=this._commentToHint[n.id];i?i.unregisterCommentAndCheckValidity(n.id)||(Array.remove(this._hints,i),i.dispose(),this._commentToHint[n.id]=null):Array.contains(this._unhintedComments,n.id)&&Array.remove(this._unhintedComments,n.id)}},a.getAnchorForComment=function(e){return this._commentToViewerAnchorInfo[e.id]},a.parseSelectionXmlForCommentData=function(t){for(var n=[],i=t.firstPage;i<=t.lastPage;i++)if(!this._pagesAlreadyParsed[i.toString()]){0;var r=zi.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(i);if(r){if(i===t.firstPage){var a=r.selectNodes(e.getXPathForCommentContinueNodes(i));0,this.parseCommentContinues(i,r,a,n)}var o=r.selectNodes(e.getXPathForCommentBeginNodes(i));0,this.parseCommentMarkers(i,o,!0,n);var s=r.selectNodes(e.getXPathForCommentEndNodes(i));if(this.parseCommentMarkers(i,s,!1,n),this._pagesAlreadyParsed[i.toString()]=!0,i===t.lastPage)for(var l=lo.ID_UNKNOWN,c=0;c<n.length;c++){var u=n[c];if(!u.isEmpty&&u.currentFoundEndTextrunId===lo.ID_UNKNOWN){if(l===lo.ID_UNKNOWN){var d=r.selectSingleNode(e.getXPathForLastTextrun(i));l=parseInt(oo.a.parseXmlAttribute(d,"id"))}u.currentFoundEndTextrunId=l}}}}if(this.parseAnchorLocations(n),this._commentCurrentlyHighlighted)for(var p=0;p<n.length;p++)if(this._commentCurrentlyHighlighted.id===n[p].commentId){0,this.highlightComment(this._commentCurrentlyHighlighted,this._waitingToScrollToComment);break}},a.parseCommentMarkers=function(e,t,n,i){for(var r=t.length,a=0;a<r;a++){var o=t[a],s=this.createViewerAnchorInfo(o,e,n);Array.add(i,s)}},a.parseCommentContinues=function(t,n,i,r){if(i.length){var a=n.selectSingleNode(e.getXPathForFirstTextrun(t)),o=parseInt(oo.a.parseXmlAttribute(a,"id"));0;for(var s=i.length,l=0;l<s;l++){var c=i[l],u=oo.a.parseXmlAttribute(c,"id");0;var d=this.ensureAnchorForComment(t,u);d.currentFoundStartTextrunId=o,d.currentFoundStartPage=t,Array.add(r,d)}}},a.createViewerAnchorInfo=function(t,n,i){var r=oo.a.parseXmlAttribute(t,"id");var a=this.ensureAnchorForComment(n,r);if(a.isEmpty)return a;for(var o=!1,s=t;s=i?s.nextSibling:s.previousSibling;){if("T"===s.nodeName){o=!0;var l=parseInt(oo.a.parseXmlAttribute(s,"id"));if(i){if(a.currentFoundStartTextrunId!==lo.ID_UNKNOWN)return a;a.currentFoundStartTextrunId=l,a.currentFoundStartPage=n,a.isStartKnown=!0}else{if(a.currentFoundEndTextrunId!==lo.ID_UNKNOWN)return a;a.currentFoundEndTextrunId=l}break}if(i&&"CE"===s.nodeName){if(r!==oo.a.parseXmlAttribute(s,"id"))continue;a.trySetSingleBoxAnchorFromNode(s,n)&&(o=!0,a.isEmpty=!0,a.isStartKnown=!0,a.currentFoundStartPage=n);break}i||s.nodeName!==e.COMMENT_BEGIN_NODENAME||oo.a.parseXmlAttribute(s,"id")}if(!o)if(i);else{for(s=t;s=s.nextSibling;)if("T"===s.nodeName){o=!0;var c=parseInt(oo.a.parseXmlAttribute(s,"id"));0,a.currentFoundEndTextrunId=c-1;break}0}return a},a.ensureAnchorForComment=function(e,t){var n=this._commentToViewerAnchorInfo[t];return n||(n=new lo(t,e),this._commentToViewerAnchorInfo[t]=n,Array.add(this._unhintedComments,t)),n},a.parseAnchorLocations=function(t){for(var n=0;n<t.length;n++){var i=t[n];if(i.needsProcessing&&!i.isEmpty)if(i.currentFoundStartTextrunId!==lo.ID_UNKNOWN)if(i.currentFoundEndTextrunId!==lo.ID_UNKNOWN){if(!(i.currentFoundStartPage<=0)){var r=i.currentFoundStartPage,a=zi.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(r);0;for(var o=[],s=[],l=function(t){var n=null;do{if(n=a.selectSingleNode(e.getXPathForTextrun(r,t)))break;if(r++,!(a=zi.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(r))){0;break}}while(!n);if(!n)return"break";if("P"!==n.parentNode.nodeName)return"continue";if(!e.isMainDocumentContent(n.parentNode))return"continue";var i=void 0;lo.tryCreateBox(n,Object(z.a)((function(){return i}),(function(e){return i=e})))&&(Array.add(o,i),Array.add(s,r))},c=i.currentFoundStartTextrunId;c<=i.currentFoundEndTextrunId;c++){var u=l(c);if("break"===u)break}o.length&&i.insertBoxRange(o,s),i.currentFoundStartPage=0,i.currentFoundEndTextrunId=lo.ID_UNKNOWN,i.currentFoundStartTextrunId=lo.ID_UNKNOWN}}else h.ULS.shipAssertTag(4468766,301,!1,"If we're trying to process a comment, we should always know where it ends.");else h.ULS.shipAssertTag(4468765,301,!1,"If we're trying to process a comment, we should always know where it starts.")}},a.createHints=function(){for(var e=this.zoomControl.currentZoom,t=0;t<this._unhintedComments.length;){var n=this._unhintedComments[t],i=this._commentToViewerAnchorInfo[n];if(i.isStartKnown)if(i.anchorBoxes.length){0;for(var r=i.anchorBoxes[0].top,a=i.anchorPageNumbers[0],o=null,s=0;s<this._hints.length;s++){var l=this._hints[s];if(!(a>l.pageNumber)){if(a<l.pageNumber){o=new ro(this._scrollerElement,a,r,i.commentId),Array.insert(this._hints,s,o);break}var c=(r-l.top)*e;if(!(c>=ro.HINT_HEIGHT)){if(Math.abs(c)<ro.HINT_HEIGHT){(o=l).registerForComment(n);break}if(c<0){o=new ro(this._scrollerElement,a,r,i.commentId),Array.insert(this._hints,s,o);break}0}}}o||(o=new ro(this._scrollerElement,a,r,i.commentId),Array.add(this._hints,o)),this._commentToHint[i.commentId]=o,Array.removeAt(this._unhintedComments,t)}else Array.removeAt(this._unhintedComments,t);else t++}},a.ensureAnchorIsVisible=function(t,n){var i=this.zoomControl.currentZoom,r=this.scrollControl.getScrollTop(),a=r+this.scrollControl.getClientHeight(),o=this.scrollControl.getScrollLeft(),l=o+this.scrollControl.getWidth(),c=Hr.a.instance.getPageTopAtZoom(n,i),u=Hr.a.instance.getPageLeftAtZoom(n,i,!1),d=Math.round(c+t.top*i),p=d+Math.round(t.height*i),h=Math.round(u+t.left*i),g=Number.NaN,m=Number.NaN;if((r>d||a<p)&&(g=d-40),(o>h||l<h)&&(m=h-e.ANCHOR_SCROLL_SIDE_MARGIN),!isNaN(g)||!isNaN(m)){var f=new eo.a(g,m);s.AFrameworkApplication.theActionManager.processActionWithData(er.a.repositionScroller,2,f),zi.App.instance.isBroadcastMode&&s.AFrameworkApplication.theActionManager.processActionWithData(er.a.broadcastOnScroll,2,new $a.a(n,f,2))}},a.repositionHints=function(e){void 0===e&&(e=!0);for(var t=[],n=0;n<this._hints.length;n++){var i=this._hints[n];Array.addRange(t,i.commentIds)}for(var r=[],a=new Array(t.length),o=0;o<t.length;o++)a[o]=this._commentToViewerAnchorInfo[t[o]];a.sort(lo.compare);for(var s=this.zoomControl.currentZoom,l=0,c=null,u=0;u<a.length;u++){var d=a[u],p=d.anchorBoxes[0];if(!c||c.pageNumber!==d.firstPageNumber||l<p.top*s){var h=void 0;this._hints.length>0?(h=this._hints[0],Array.removeAt(this._hints,0),h.repurposeFor(d.anchorPageNumbers[0],p.top,d.commentId,e)):h=new ro(this._scrollerElement,d.anchorPageNumbers[0],p.top,d.commentId,e),Array.add(r,h),c=h,l=p.top*s+ro.HINT_HEIGHT,this._commentToHint[d.commentId]=h}else c.registerForComment(d.commentId),this._commentToHint[d.commentId]=c}for(var g=0;g<this._hints.length;g++){var m=this._hints[g];m.removeFromView(),m.dispose()}this._hints=r},a.highlightAndScrollToAnchor=function(t,n){this.removeCurrentHighlights();var i=this.zoomControl.currentZoom;for(var r=0;r<t.anchorBoxes.length;r++){var a=t.anchorBoxes[r],o=t.anchorPageNumbers[r];if(co.a.instance.isPageLoaded(o)){var l=co.a.instance.drawRectangle(a,3,e.makeHighlightId(r),o);l.setPosition(l.box,l.page,i),Array.add(this._activeHighlights,l)}else if(!r&&n)return this._anchorWaitingToHighlight=t,this._highlightWhenPageLoadedTask.customData=n,s.AFrameworkApplication.theTaskManager.addTask(this._highlightWhenPageLoadedTask),void this.ensureAnchorIsVisible(a,o)}this._anchorWaitingToHighlight=null,n&&this._activeHighlights.length>0&&this.ensureAnchorIsVisible(this._activeHighlights[0].box,t.anchorPageNumbers[0])},a.delayedHighlightTimer=function(e){this._anchorWaitingToHighlight&&this.highlightAndScrollToAnchor(this._anchorWaitingToHighlight,e.customData)},a.onWindowResize=function(){this.repositionHints(),this._commentCurrentlyHighlighted&&co.a.instance.needsManualRepositioning&&this.highlightComment(this._commentCurrentlyHighlighted,!1)},a.onRebuildCommentHints=function(e,t,n,i,r){return this.rebuildCommentHints(n,!0)},a.onRebuildCommentHintsWithoutAnimation=function(e,t,n,i,r){return this.rebuildCommentHints(n,!1)},a.rebuildCommentHints=function(e,t){return void 0===t&&(t=!0),1===e||this.repositionHints(t),32},a.onUpdateCommentHighlight=function(e,t,n,i,r){return 1===n||this._commentCurrentlyHighlighted&&this.highlightComment(this._commentCurrentlyHighlighted,!1),32},a.onXmlPageDownloaded2=function(e,t,n,i,r){if(1===n)return 32;this._initialCommentDataTask&&(s.AFrameworkApplication.theTaskManager.deleteTask(this._initialCommentDataTask),this._initialCommentDataTask=null);var a=r;return this.parseSelectionXmlForCommentData(a),this.createHints(),32},a.loadInitialSelectionXml=function(e){this._initialCommentDataTask=null;var t=zi.App.get_activeAppFrame().workspace.getCurrentPage();if(zi.App.get_activeAppFrame().thePageInfoCache.isPageCached(t)){var n=oo.a.getPageSetFromPage(t),i=new po.a(oo.a.getStartPageFromPageSetXml(n),oo.a.getEndPageFromPageSetXml(n));this.parseSelectionXmlForCommentData(i),this.createHints()}},e.getInstance=function(){return e.getInstanceWithResolvedDependencies()},e.getInstanceWithResolvedDependencies=function(){return new e},e.makeHighlightId=function(e){return"hi_"+e},e.getXPathForCommentBeginNodes=function(t){return String.format("/Pages/Page[@id='{0}']/descendant::P/"+e.COMMENT_BEGIN_NODENAME,t)},e.getXPathForCommentEndNodes=function(e){return String.format("/Pages/Page[@id='{0}']/descendant::P/CE",e)},e.getXPathForCommentContinueNodes=function(e){return String.format("/Pages/Page[@id='{0}']/CC",e)},e.getXPathForTextrun=function(e,t){return String.format("/Pages/Page[@id='{0}']//T[@id='{1}']",e,t)},e.getXPathForFirstTextrun=function(e){return String.format("/Pages/Page[@id='{0}']/descendant::T[1]",e)},e.getXPathForLastTextrun=function(e){return String.format("/Pages/Page[@id='{0}']/descendant::T[last()]",e)},e.isMainDocumentContent=function(e){return 1===parseInt(oo.a.parseXmlAttribute(e,"storyId"))},e.isCommentablePara=function(t){return!!e.isMainDocumentContent(t)&&(!t.firstChild||"CN"!==t.firstChild.nodeName)},t=e,(n=[{key:"zoomControl",get:function(){return this._zoomControl||(this._zoomControl=x.a.instance.resolve("WordViewer.Controls.IZoomControl"))}},{key:"scrollControl",get:function(){return this._scrollControl||(this._scrollControl=x.a.instance.resolve("WordViewer.Controls.IScrollControl"))}}])&&ho(t.prototype,n),i&&ho(t,i),e}();go.ANCHOR_SCROLL_SIDE_MARGIN=40,go.COMMENT_BEGIN_NODENAME="CB",Object(i.a)(go,"ViewerCommentHintManager",null,[121,4]);var mo=n(537),fo=n(534);function vo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var So=function(){function e(e,t){this._retriesLeft=5,this._comment=e,this._changeType=t,this._status=0}var t,n,i;return e.prototype.toString=function(){return String.format("Type:{0} State:{1} Com:[{2}] R:[{3}]",this._changeType,this._status,this._comment.toString(),this._retriesLeft)},t=e,(n=[{key:"comment",get:function(){return this._comment}},{key:"changeType",get:function(){return this._changeType},set:function(e){this._changeType=e}},{key:"status",get:function(){return this._status},set:function(e){this._status=e,this._comment.saveState=e}},{key:"retriesLeft",get:function(){return this._retriesLeft},set:function(e){this._retriesLeft=e}}])&&vo(t.prototype,n),i&&vo(t,i),e}();Object(i.a)(So,"CommentSaveRecord",null,[]);var _o=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.CommId=null,t.Time=0,t.Text=null,t.GuardParaId=null,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.getClassId=function(){return 18},i.construct=function(e,t,n,r,a,o){var s=new i;return s.FileId=e,s.GuardParaId=n,s.Time=r,s.Text=t,s.SharedLock=a,s.CommId=o,s},i}(Qa);Object(i.a)(_o,"AddCommentReplyRequest",Qa,[]);var yo=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.CommId=null,t.Time=0,t.Text=null,t.StartParaId=null,t.EndParaId=null,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.getClassId=function(){return 17},i.construct=function(e,t,n,r,a,o,s){var l=new i;return l.FileId=e,l.StartParaId=n,l.EndParaId=r,l.Time=a,l.Text=t,l.SharedLock=o,l.CommId=s,l},i}(Qa);Object(i.a)(yo,"AddCommentRequest",Qa,[]);var bo=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.GuardParaId=null,t.Done=!1,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.getClassId=function(){return 19},i.construct=function(e,t,n,r){var a=new i;return a.FileId=e,a.GuardParaId=t,a.Done=n,a.SharedLock=r,a},i}(Qa);Object(i.a)(bo,"ChangeCommentDoneStatusRequest",Qa,[]);var Ao=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.GuardParaId=null,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.getClassId=function(){return 16},i.construct=function(e,t,n){var r=new i;return r.FileId=e,r.GuardParaId=t,r.SharedLock=n,r},i}(Qa);Object(i.a)(Ao,"DeleteCommentRequest",Qa,[]);var Co=n(37);function To(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var wo=function(e){var t,n;function i(){var t;return(t=e.call(this)||this)._pendingSaves=[],t._serverOpToSaveRecord={},t._autosaveTask=null,t._onBeforeNavigateWebkitString=null,t._retryingBadCanary=!1,t._maxCommentsPerBatch=20,t._batchedOperationFactory=new Xa,s.AFrameworkApplication.theActionManager.addAction(er.a.preventWarningsOnAppClose,Lr.a.application,i.preventWarningsOnAppClose),s.AFrameworkApplication.activeFrame.thePageManager.getOnBeforeNavigateWebkitString=Object(r.d)(To(t),t.onBeforeNavigateWebkitString,"onBeforeNavigateWebkitString"),s.AFrameworkApplication.activeFrame.thePageManager.registerHandler(1,Object(r.d)(To(t),t.onBeforeAppClose,"onBeforeAppClose"),null),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=i.prototype;return a.updateContent=function(e){if(e){var t,n,i,r,a,o,s,l=e.selectNodes("/comments/comment"),c=l.length;this._comments=[];for(var u=0;u<c;u++){var d=l[u];t=oo.a.parseXmlAttribute(d,"id"),n=oo.a.parseXmlAttribute(d,"author"),i=oo.a.parseXmlAttribute(d,"date"),r=oo.a.parseXmlAttribute(d,"replyId"),a=oo.a.parseXmlAttribute(d,"done"),o=oo.a.parseXmlAttribute(d,"guardId"),s=oo.a.parseXmlAttribute(d,"page"),n||(n=CommonUIStrings.l_CommentAuthorUnknown);var p=d.selectNodes("p");0;for(var h=new Array(p.length),g=0;g<p.length;g++)h[g]=p[g].text;var m=null;i&&(m=new Date(parseInt(i))).setMinutes(m.getMinutes()+m.getTimezoneOffset());var f=!1;a&&"true"===a.toLowerCase()&&(f=!0);var v=-1;s&&(v=parseInt(s));var S=new fo.Comment(t,o,n,m,r,f,h,v);Array.add(this._comments,S)}}},a.addCommentToModel=function(e,t){this._commentManager.mode=2,this._inProgress=e,e.groupNumber=t.firstPageNumber;for(var n=-1,i=0;i<this._comments.length;i++){var r=this._comments[i];if(!(r.groupNumber<e.groupNumber)){if(r.groupNumber===e.groupNumber){var a=this._commentManager.hintManager.getAnchorForComment(r);if(a&&a.isStartKnown){if(lo.compare(a,t)<=0)continue}else 0}n=i;break}}-1===n&&(n=this._comments.length),Array.insert(this._comments,n,e)},a.recordChanges=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if((1!==i.commentType||3!==t)&&3!==i.saveState){var r=new So(i,t);r.status=0,Array.add(this._changes,r)}}this.saveSoonerOrLater()},a.recordTaskChanges=function(e,t){0},a.saveSoonerOrLater=function(){this.okToReplicate()?(this._autosaveTask=null,this.replicateChanges()):this.startAutosaveTimer()},a.startAutosaveTimer=function(){this._autosaveTask?s.AFrameworkApplication.theTaskManager.resetInterval(this._autosaveTask,15e3):(this._autosaveTask=new u.a(4,1,15e3,Object(r.d)(this,this.delayedSaveTimer,"delayedSaveTimer")),s.AFrameworkApplication.theTaskManager.addTask(this._autosaveTask))},a.okToReplicate=function(){return!this._pendingSaves.length},a.delayedSaveTimer=function(e){this._autosaveTask=null,this.saveSoonerOrLater()},a.replicateChanges=function(){this._changes.sort(i.sortCommentsById);for(var e=[],t=this._batchedOperationFactory.getBatchedServerOperation(2,Object(r.d)(this,this.saveCommentOperationResponseHandler,"saveCommentOperationResponseHandler")),n=0;n<this._changes.length&&e.length<this._maxCommentsPerBatch-i.maxOperationsFromOneSaveRecord;){for(var a=this._changes[n].comment,o=0,s=new Array(7),l=0;l<7;l++)s[l]=[];for(;n<this._changes.length;){var c=this._changes[n];if(c.comment.id!==a.id)break;c.status||(Array.add(s[c.changeType],c),o++),n++}if(o>0){var u=this.createServerOpsForChanges(s,t,e);Array.addRange(e,u)}}e.length>0&&(this._pendingSaves=e,t.dispatchRequest())},a.createServerOpsForChanges=function(e,t,n){var i=[],r=this._commentManager.hasSharedLock;if(1===e[3].length){this.updateStatesTo(4,e[2]),this.updateStatesTo(4,e[0]),this.updateStatesTo(4,e[1]);var a=e[3][0];if(1===e[2].length)return this.updateStatesTo(4,e[3]),i;var o=this.createAndAddServerOp(t,3,a,r,n);return a.status=1,Array.add(i,o),i}if(1===e[2].length){var s=e[2][0],l=this.createAndAddServerOp(t,2,s,r,n);l?(s.status=1,Array.add(i,l)):s.status=0}var c=e[0].length,u=e[1].length;if(this.updateStatesTo(4,e[0]),this.updateStatesTo(4,e[1]),c!==u){var d=c>u?0:1,p=e[d][0],h=this.createAndAddServerOp(t,d,p,r,n);h?(p.status=1,Array.add(i,h)):p.status=0}return i},a.updateStatesTo=function(e,t){for(var n=0;n<t.length;n++)t[n].status=e},a.createAndAddServerOp=function(e,t,n,i,a){var o=n.comment,s=new Pa;if(3===t)s.requestObject=Ao.construct(zi.App.instance.baseDocQueryParam,o.guardId,i);else if(t&&1!==t)if(2===t&&o.replyToId){var l=this.getComment(o.replyToId);if(!l.guardId)return 3===l.saveState?(n.status=3,null):null;for(var c=0;c<a.length;c++){var u=a[c];if(Object(r.c)(_o,u.requestObject)&&u.requestObject.GuardParaId===l.guardId)return null}var d=o.text[0];s.requestObject=_o.construct(zi.App.instance.baseDocQueryParam,d,l.guardId,mo.a.dateToLocalTime(o.date),i,o.id)}else{if(2!==t)return null;var p=o.text[0];s.requestObject=yo.construct(zi.App.instance.baseDocQueryParam,p,o.anchorStartId,o.anchorEndId,mo.a.dateToLocalTime(o.date),i,o.id)}else{if(!o.guardId)return null;s.requestObject=bo.construct(zi.App.instance.baseDocQueryParam,o.guardId||o.id,o.done,i)}return s.status=1,e.addOperation(s),this._serverOpToSaveRecord[s.id.toString()]=n,s},a.saveCommentOperationResponseHandler=function(e){var t=this;for(var n=!1,r=!1,a=0;a<this._changes.length;){3!==this._changes[a].status?a++:Array.removeAt(this._changes,a)}for(var o=0;o<this._pendingSaves.length;o++){var l=this._pendingSaves[o];0;var c=this._serverOpToSaveRecord[l.id.toString()];if(5===l.statusCode){if(this._retryingBadCanary){0,c.status=3,i.showSaveFailureDialog(WordViewerIntl.WordViewerStrings.l_GenericErrorSave,Co.a.commentSaveCanaryFailure),oo.a.propagateError(!1,"CommentSaveCanaryFailure",Co.a.commentSaveCanaryFailure,WordViewerIntl.WordViewerStrings.l_GenericErrorSave);continue}return this._retryingBadCanary=!0,void e.dispatchRequest()}if(2===l.statusCode&&l.responseObjects){0;var u=l.responseObjects[l.responseObjects.length-1];if(33!==u.StatusCode)if(46!==u.StatusCode&&59!==u.StatusCode){if(u.StatusCode)if("continue"===function(){c.status=3;var e=void 0,n=i.getErrorInfoForSaveFailure(u.StatusCode,Object(z.a)((function(){return e}),(function(t){return e=t})));return i.showSaveFailureDialog(n,e),oo.a.propagateError(!1,"CommentSaveFailed",e,n),61===u.StatusCode&&(t._commentManager.mode=0),"continue"}())continue;if(s.AFrameworkApplication.theActionManager.processAction(p.a.commentSaveSucceeded,2),x.a.instance.resolveFuture("Common.Interface.IEditNotificationManager").execute((function(e){e.editHappened()})),c.status=2,18===u.classId){var d=u,h=this.getComment(d.CommId);h&&(h.guardId=d.ParaId)}else if(17===u.classId){var g=u,m=this.getComment(g.CommId);m&&(m.guardId=g.ParaId)}}else c.status=0,r=i.markForRetry(c)||r;else{if(this._maxCommentsPerBatch<=i.maxOperationsFromOneSaveRecord){0,c.status=3,i.showSaveFailureDialog(WordViewerIntl.WordViewerStrings.l_GenericErrorSave,Co.a.commentSaveRequestCountTooLarge),oo.a.propagateError(!1,"CommentSaveRequestCountTooLarge",Co.a.commentSaveRequestCountTooLarge,WordViewerIntl.WordViewerStrings.l_GenericErrorSave);continue}n||(n=!0,this._maxCommentsPerBatch=parseInt(String(Math.max(Math.floor(this._maxCommentsPerBatch/2),1)))),c.status=0,r=i.markForRetry(c)||r}}else s.AFrameworkApplication.theActionManager.processAction(p.a.commentSaveNetworkError,2),r=i.markForRetry(c)||r}for(this._pendingSaves=[],this._serverOpToSaveRecord={},this._retryingBadCanary=!1,a=0;a<this._changes.length;){var f=this._changes[a];2!==f.status&&4!==f.status?a++:Array.removeAt(this._changes,a)}(r||this.hasUnsavedChanges())&&this.startAutosaveTimer()},a.onBeforeAppClose=function(e){if(this._onBeforeNavigateWebkitString=null,this.hasUnsavedChanges()&&!zi.App.allowUnsafeAppClose)return this.okToReplicate()&&(s.AFrameworkApplication.isShuttingDown=!0,this.replicateChanges(),s.AFrameworkApplication.isShuttingDown=!1),this.hasUnsavedChanges()||this.lastSaveHadFailures()?(this._onBeforeNavigateWebkitString=CommonUIStrings.l_NavigateAway,void(e.eventObject.rawEvent.returnValue=CommonUIStrings.l_NavigateAway)):void 0},a.onBeforeNavigateWebkitString=function(){return this._onBeforeNavigateWebkitString},a.hasUnsavedChanges=function(){for(var e=0;e<this._changes.length;e++){var t=this._changes[e];if(!t.status||1===t.status)return!0}return!1},a.lastSaveHadFailures=function(){for(var e=0;e<this._changes.length;e++){if(3===this._changes[e].status)return!0}return!1},i.getInstance=function(){return i.getInstanceWithResolvedDependencies()},i.getInstanceWithResolvedDependencies=function(){return new i},i.sortCommentsById=function(e,t){var n=e,i=t;return n.comment.id===i.comment.id?0:n.comment.id.toLowerCase().localeCompare(i.comment.id.toLowerCase())},i.markForRetry=function(e){return e.retriesLeft<=0?(e.status=3,i.showSaveFailureDialog(WordViewerIntl.WordViewerStrings.l_GenericErrorSave,Co.a.commentSaveRetryCountExceeded),oo.a.propagateError(!1,"CommentSaveRetryCountExceeded",Co.a.commentSaveRetryCountExceeded,WordViewerIntl.WordViewerStrings.l_GenericErrorSave),!1):(e.retriesLeft=e.retriesLeft-1,e.status=0,s.AFrameworkApplication.theActionManager.processAction(p.a.commentSaveRetry,2),!0)},i.showSaveFailureDialog=function(e,t){if(1!==s.AFrameworkApplication.activeFrame.state){var n=new Pn.StandardDialog;n.buttonsOption=0,n.showError(t,CommonUIStrings.l_DefaultDialogTitle,e,null)}},i.getErrorInfoForSaveFailure=function(e,t){switch(e){case 1:return t.val=Co.a.commentSaveInvalidPropertyData,WordViewerIntl.WordViewerStrings.l_GenericErrorSave;case 14:return t.val=Co.a.commentSaveUnspecifiedFailure,WordViewerIntl.WordViewerStrings.l_GenericErrorSave;case 7:return t.val=Co.a.commentSavePermissionDenied,WordViewerIntl.WordViewerStrings.l_AccessDeniedSave;case 36:return t.val=Co.a.commentSaveOldProductDigitalSignature,WordViewerIntl.WordViewerStrings.l_OldProductDigitalSignatureSave;case 9:return t.val=Co.a.commentSaveDocumentProtectionSettings,WordViewerIntl.WordViewerStrings.l_DocumentProtectionSettingsCommentSave;case 30:return t.val=Co.a.commentSaveDocumentPasswordEncrypted,WordViewerIntl.WordViewerStrings.l_DocumentPasswordEncryptedSave;case 31:return t.val=Co.a.commentSaveFileCheckedOut,WordViewerIntl.WordViewerStrings.l_CheckedOutSave;case 17:return t.val=Co.a.commentSaveFileRequiresCheckout,WordViewerIntl.WordViewerStrings.l_RequiresCheckoutSave;case 16:return t.val=Co.a.commentSaveFileLockedForOfflineCheckout,WordViewerIntl.WordViewerStrings.l_LockedForOfflineCheckoutSave;case 11:return t.val=Co.a.commentSaveFileLockedByOtherInterface,WordViewerIntl.WordViewerStrings.l_LockedByOtherInterfaceSave;case 57:return t.val=Co.a.commentSaveNumberOfCoauthorsReachedMax,WordViewerIntl.WordViewerStrings.l_NumberOfCoauthorsReachedMaxSave;case 47:return t.val=Co.a.commentSaveWordFileVersionMismatch,WordViewerIntl.WordViewerStrings.l_DocumentChangedErrorSave;case 59:return t.val=Co.a.commentSaveDocxCoherencyFailure,WordViewerIntl.WordViewerStrings.l_DocxCoherencyErrorSave;case 12:return t.val=Co.a.commentSaveCorruptedFile,WordViewerIntl.WordViewerStrings.l_CorruptFileSave;case 61:return t.val=Co.a.commentSaveDocumentMarkedFinal,WordViewerIntl.WordViewerStrings.l_DocumentMarkedFinalSave;case 38:return t.val=Co.a.commentSavePreReleaseFile,WordViewerIntl.WordViewerStrings.l_PreReleaseFile;case 35:return t.val=Co.a.commentSaveLockExpired,WordViewerIntl.WordViewerStrings.l_GenericErrorSave;case 39:return t.val=Co.a.commentSaveFileEditedInRichClient,WordViewerIntl.WordViewerStrings.l_GenericErrorSave;case 33:return t.val=Co.a.commentSaveRequestCountTooLarge,WordViewerIntl.WordViewerStrings.l_GenericErrorSave;default:return t.val=Co.a.commentSaveUnspecifiedFailure,WordViewerIntl.WordViewerStrings.l_GenericErrorSave}},i.preventWarningsOnAppClose=function(e,t,n,i,r){return zi.App.allowUnsafeAppClose=!0,32},i}(mo.a);wo.maxOperationsFromOneSaveRecord=2,Object(i.a)(wo,"ViewerCommentModel",mo.a,[]);var Io=n(538),ko=n(530),Fo=n(535),Eo=n(151),Oo=n(107),Po=n(136),Do=n(29),Mo=n(52);function Lo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ro=function(){function e(e,t,n,i,r){this._commentManager=null,this._headerControlsRow=null,this._closeButton=null,this._newCommentButton=null,this._addedDivider=!1,this._contentLoaded=!1,this._waitingToScrollTo=null,this._addCommentOnRender=!1,this._newCommentKeyEventHandler=null,this._closeCommentPaneKeyEventHandler=null,this.editCommentOnRender=!1,this._isVisible=!1,this._paneSurface=null,this._paneParent=null,this._pane=null,this._actionManager=e,this._clickInputManager=t,this._keyInputManager=n,this._focusManager=i,this._f6Manager=r,this._escapeKeyHash=Ki.KeyInputManager.hashKey(Gi.a.vK_Escape,0)}var t,n,i,a=e.prototype;return a.initialize=function(e,t){this._commentManager=e,this._paneParent=t;var n=this.createPane();this.paneParent.appendChild(n),this.registerActions(),this.resizeCommentPane()},a.dispose=function(){this.shouldCreateHeader&&this._closeButton&&(this._clickInputManager.unregisterHandler(f.EventNames.click,this._closeButton,Object(r.d)(this,this.onClosePaneClick,"onClosePaneClick")),this._keyInputManager.unregisterHandlerForAllKeyEvents(this._closeButton,this._closeCommentPaneKeyEventHandler)),this.shouldCreateHeaderControls&&this._newCommentButton&&(this._clickInputManager.unregisterHandler(f.EventNames.click,this._newCommentButton,Object(r.d)(this,this.onNewCommentClick,"onNewCommentClick")),this._keyInputManager.unregisterHandlerForAllKeyEvents(this._newCommentButton,this._newCommentKeyEventHandler)),this.pane&&this._clickInputManager.unregisterHandler(f.EventNames.click,this.pane,Object(r.d)(this,this.clearSelection,"clearSelection"));var e=this._focusManager.getScope(Tt.AFrame.commentPaneFocusId);e.unBindAction(this._escapeKeyHash),e.unBindAction(It.FocusManager.instance()._tabInput),e.unBindAction(It.FocusManager.instance()._tabShiftInput),this._pane=null,this._closeButton=null,this._paneSurface=null,this._newCommentButton=null},a.showEmptyUI=function(){this.paneSurface.innerText="";var e=ko.a("div","","CommentPaneEmpty1");if(e.innerText=this.emptyUIStringPart1,this.paneSurface.appendChild(e),this._commentManager.mode){var t=ko.a("div","","CommentPaneEmpty2");t.innerText=this.emptyUIStringPart2,this.paneSurface.appendChild(t)}},a.showErrorUI=function(){this.paneSurface.innerText="";var e=ko.a("div","","CommentPaneEmpty1");e.innerText=CommonUIStrings.l_CommentPaneError,this.paneSurface.appendChild(e)},a.showLoadingUI=function(){this.paneSurface.innerText="";var e=ko.a("div","","");e.style.textAlign="center";var t=document.createElement("img");t.className="CommentPaneLoading",t.src=st.a.commonImage("progress.gif"),e.appendChild(t);var n=ko.a("div","","CommentPaneLoadingText");n.innerText=CommonUIStrings.l_CommentLoading,e.appendChild(n),this.paneSurface.appendChild(e)},a.showComments=function(e){if(Xi.DomUtils.clearElementHtml(this.paneSurface),e.length)for(var t=0;t<e.length;t++){var n=e[t],i=t?e[t-1]:null;(!t||i.groupNumber<n.groupNumber)&&this.paneSurface.appendChild(this.createGroupDivider(n)),this.paneSurface.appendChild(n.render())}else this.showEmptyUI();this._contentLoaded=!0,this.updateRenderedState(),this._waitingToScrollTo&&(this._waitingToScrollTo.focus(),this._waitingToScrollTo=null)},a.selectComment=function(e,t){void 0===t&&(t=1),this._contentLoaded?e.focus():this._waitingToScrollTo=e},a.isDifferentGroup=function(e,t){return!e||!t||e.groupNumber!==t.groupNumber},a.getPaneSurfaceOffsetTop=function(){var e=document.getElementById("CommentPaneHeader").offsetHeight;return this._headerControlsRow&&(e+=this._headerControlsRow.offsetHeight),e},a.renderNewComment=function(e){var t=this._commentManager.model.getCommentBefore(e,!1),n=this._commentManager.model.getCommentAfter(e,!1);t||n||Xi.DomUtils.clearElementHtml(this.paneSurface);var i=this.isDifferentGroup(t,e),r=this.isDifferentGroup(n,e),a=null;n&&(a=n.containerElement,r&&(a=a.previousSibling)),this.renderNewOrEditingComment(e,a,i&&r)},a.renderEditingComment=function(e){var t=e.containerElement.nextSibling;this.paneSurface.removeChild(e.containerElement),this.renderNewOrEditingComment(e,t,!1)},a.onAfterFadeIn=function(t){e.clearOpacity(t.element),e.removeAllAnimationClasses(t.element)},a.onAfterMove=function(t){t.element.style.marginTop="",e.removeAllAnimationClasses(t.element)},a.removeCommentsFromPane=function(t){for(var n=[],i=null,a=null,o=0;o<t.length;o++){var s=t[o];if(o||(a=s.containerElement.previousSibling),o===t.length-1){var l=s.containerElement.nextSibling;a&&Sys.UI.DomElement.containsCssClass(a,"CommentGroupDivider")&&(!l||Sys.UI.DomElement.containsCssClass(l,"CommentGroupDivider"))&&Array.add(n,a)}i=s.containerElement,Array.add(n,i)}var c=0,u=i.nextSibling;if(u){for(var d=u.offsetTop,p=0;p<n.length;p++)n[p].style.display="none";c=u.offsetTop-d;for(var h=0;h<n.length;h++)n[h].style.display=""}e.animateDeleteComments(n,u,c,Object(r.d)(this,this.onAfterFadeOut,"onAfterFadeOut"),Object(r.d)(this,this.onAfterMove,"onAfterMove"))},a.registerActions=function(){this._actionManager.addAction(p.a.hideCommentPane,de.a.frame,Object(r.d)(this,this.hideCommentPane,"hideCommentPane")),this._actionManager.addAction(p.a.editComment,de.a.frame,Object(r.d)(this,this.editComment,"editComment")),this._actionManager.addAction(p.a.selectNextComment,de.a.frame,Object(r.d)(this,this.selectNextComment,"selectNextComment")),this._actionManager.addAction(p.a.selectPrevComment,de.a.frame,Object(r.d)(this,this.selectPrevComment,"selectPrevComment")),this._actionManager.addActionWithFlags(p.a.queryToggleCommentPane,de.a.frame,Object(r.d)(this,this.queryToggleCommentPane,"queryToggleCommentPane"),96),this._actionManager.addAction(p.a.commentTabForward,de.a.frame,Object(r.d)(this,this.commentMoveFocusForTabsHandler,"commentMoveFocusForTabsHandler")),this._actionManager.addAction(p.a.commentTabBackward,de.a.frame,Object(r.d)(this,this.commentMoveFocusForTabsHandler,"commentMoveFocusForTabsHandler"))},a.onAfterFadeOut=function(e){e.element.parentNode&&e.element.parentNode.removeChild(e.element),this.paneSurface.childNodes.length||this.showEmptyUI()},a.modeChanged=function(){this.updateRenderedState()},a.createPane=function(){var e=ko.a("div",this.commentPaneBodyId,"CommentPane"),t=ko.a("label",Io.a.commentTabHelp,Io.a.commentTabHelp);if(t.innerText=CommonUIStrings.l_CommentTabHelp,e.appendChild(t),this.shouldCreateHeader){var n=this.createHeaderDom();e.appendChild(n)}if(this.shouldCreateHeaderControls){var i=this.createHeaderControlsDom();e.appendChild(i)}var a=ko.a("div","CommentPaneSurface","CommentPaneSurface");return this._commentManager.copyingEnabled||(Sys.UI.DomElement.addCssClass(e,"DisableSelection"),e.setAttribute("Unselectable","on")),e.appendChild(a),this._pane=e,this._paneSurface=a,this.updateRenderedState(),this.setupFocus(),this._clickInputManager.registerHandler(f.EventNames.click,e,Object(r.d)(this,this.clearSelection,"clearSelection")),this.showLoadingUI(),e},a.createHeaderDom=function(){var e=ko.b("div","CommentPaneHeader","CommentPaneHeader"),t=ko.b("span","CommentPaneTitle","PaneTitle CommentPaneTitle UIFontLight");t.innerText=CommonUIStrings.L_OpenCommentPane;var n=Fo.a.createButton("CloseCommentPane","CommentPaneCloseButton",CommonUIStrings.l_Close,"ClosePaneGlyph_16x16x32",!1);return Sys.UI.DomElement.addCssClass(n,s.AFrameworkApplication.isRtl?"FloatLeft":"FloatRight"),this._clickInputManager.registerHandler(f.EventNames.click,n,Object(r.d)(this,this.onClosePaneClick,"onClosePaneClick")),this._closeCommentPaneKeyEventHandler=this._keyInputManager.registerHandlerForAllKeyEvents(n,Object(r.d)(this,this.onClosePaneClick,"onClosePaneClick"),Gi.a.vK_Enter),e.appendChild(t),e.appendChild(n),this._closeButton=n,e},a.createHeaderControlsDom=function(){this._headerControlsRow=ko.b("div","CommentPaneControls","CommentPaneControls");var e=Fo.a.createButton("CommentPaneNewComment","CommentPaneNewComment",CommonUIStrings.l_CommentNewCommentButton,"CommentNew_16x16x32");return this._headerControlsRow.appendChild(e),this._clickInputManager.registerHandler(f.EventNames.click,e,Object(r.d)(this,this.onNewCommentClick,"onNewCommentClick")),this._newCommentKeyEventHandler=this._keyInputManager.registerHandlerForAllKeyEvents(e,Object(r.d)(this,this.onNewCommentClick,"onNewCommentClick"),Gi.a.vK_Enter),this._newCommentButton=e,this._headerControlsRow},a.createGroupDivider=function(e){var t=ko.a("div","","CommentGroupDivider");return this._addedDivider||Sys.UI.DomElement.addCssClass(t,"CommentGroupDividerFirst"),this._addedDivider=!0,t.innerText=this.getDividerLabel(e),t},a.updateRenderedState=function(){this._commentManager.mode&&-1!==this._commentManager.mode?(Sys.UI.DomElement.removeCssClass(this.paneSurface,"ReadOnly"),this._headerControlsRow&&(this._headerControlsRow.style.display="inline-block"),this.isCurrentlyEditing||4===this._commentManager.mode?(Sys.UI.DomElement.addCssClass(this.paneSurface,"CommentInProgress"),Sys.UI.DomElement.removeCssClass(this.paneSurface,"Interactive"),this._newCommentButton&&this.setNewCommentButtonState(!1)):(Sys.UI.DomElement.addCssClass(this.paneSurface,"Interactive"),Sys.UI.DomElement.removeCssClass(this.paneSurface,"CommentInProgress"),this._newCommentButton&&this.setNewCommentButtonState(this._contentLoaded))):(this._headerControlsRow&&(this._headerControlsRow.style.display="none"),Sys.UI.DomElement.addCssClass(this.paneSurface,"ReadOnly"))},a.setNewCommentButtonState=function(e){Fo.a.setButtonEnabledState(this._newCommentButton,e)},a.setupFocus=function(){var e=this,t=this._focusManager.getScope(Tt.AFrame.commentPaneFocusId);t.parent=Tt.AFrame.appFocusId,this._clickInputManager.addFocusEvent(Tt.AFrame.commentPaneFocusId,this.pane),t.addSetFocus((function(){var t=null;(t=e._newCommentButton.disabled&&e._closeButton?e._closeButton:e._newCommentButton).focus(),e._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t),e._commentManager.getCommentPaneFocusRegion().listing.addValidTag(5)})),t.addOnBlur((function(){2!==e._commentManager.mode&&3!==e._commentManager.mode&&e._commentManager.clearSelection()})),this._f6Manager.addF6KeyBindings(Tt.AFrame.commentPaneFocusId),t.bindAction(Ki.KeyInputManager.hashKey(Gi.a.vK_UpArrow,0),p.a.selectPrevComment),t.bindAction(Ki.KeyInputManager.hashKey(Gi.a.vK_DownArrow,0),p.a.selectNextComment),t.bindAction(this._escapeKeyHash,p.a.hideCommentPane)},a.rebindTabNavigationHandlers=function(e){e.unBindAction(this._focusManager._tabInput),e.unBindAction(this._focusManager._tabShiftInput),e.bindAction(this._focusManager._tabInput,p.a.commentTabForward),e.bindAction(this._focusManager._tabShiftInput,p.a.commentTabBackward)},a.commentMoveFocusForTabsHandler=function(e,t,n,i,r){var a=this._commentManager.getCommentPaneFocusRegion().listing.currentElement,o=this._commentManager.model.selectedComment;if(!a){if(a=document.activeElement,this.pane.contains(a)||(a=o?o.containerElement:this._commentManager.pane.newCommentButton),!a)return 4;this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(a)}return e===p.a.commentTabForward?this.moveForward(a,o):e===p.a.commentTabBackward?this.moveBackward(a,o):2},a.moveForward=function(e,t){var n=this.isCurrentlyEditing;if(e===this._newCommentButton&&this._commentManager.model.hasComments()&&!this.isCurrentlyEditing)return this._commentManager.selectNextComment(),32;if(t&&e===t.containerElement)this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(e.firstChild);else if(-1!==e.className.indexOf(Io.a.commentDeleteButtonClassName)){if(t){if(this._commentManager.model.getCommentAfter(t,!1))return this._commentManager.selectNextComment(),32;n||this._commentManager.model.clearSelection(),this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t.containerElement)}}else{if(-1!==e.className.indexOf(Io.a.commentTextEntryClassName))return this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t.commentViewObject.saveButtonElement),32;-1!==e.className.indexOf(Io.a.commentSaveButtonClassName)&&this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t.containerElement)}return this._commentManager.getCommentPaneFocusRegion().moveForward(),32},a.moveBackward=function(e,t){if(e===this._newCommentButton)return this._commentManager.getCommentPaneFocusRegion().moveBackward(),32;if(t){if(e===t.containerElement){var n=this.isCurrentlyEditing;if(this._commentManager.model.getCommentBefore(t,!1)){if(!n){this._commentManager.selectPrevComment();var i=this._commentManager.model.selectedComment.commentViewObject.deleteButtonElement;return i&&this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(i),32}}else n||this._commentManager.clearSelection()}else if(-1!==e.className.indexOf(Io.a.commentReplyButtonClassName)||-1!==e.className.indexOf(Io.a.commentCancelButtonClassName))return this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t.containerElement),32}else if((-1!==e.className.indexOf(Io.a.commentTaskPaneCloseClassName)||-1!==e.className.indexOf(Io.a.commentPaneCloseButtonClassName))&&this._commentManager.model.hasComments())return this._commentManager.selectPrevComment(),32;return this._commentManager.getCommentPaneFocusRegion().moveBackward(),32},a.onClosePaneClick=function(e){return this._actionManager.processAction(p.a.hideCommentPane,2),!0},a.clearSelection=function(e){return this._focusManager.scopeChanged(Tt.AFrame.commentPaneFocusId),this._commentManager&&2!==this._commentManager.mode&&3!==this._commentManager.mode&&this._commentManager.clearSelection(),!0},a.onNewCommentClick=function(e){return this._newCommentButton.disabled||this.addNewCommentInternal(),!0},a.addNewCommentInternal=function(){this._focusManager.scopeChanged(Tt.AFrame.commentPaneFocusId),this._commentManager.addNewComment(null)},a.addNewComment=function(e,t,n,i,a){if(1===n)return this._commentManager&&1!==this._commentManager.mode?8:32;if(this.isVisible)this.addNewCommentInternal();else{var o=0;if(Object(r.c)(to.a,a))o=a.inputMethod;var s=new to.a(a,o);this.addCommentOnRender=!0,this._actionManager.processActionWithData(p.a.showCommentPane,2,s)}return 32},a.editComment=function(e,t,n,i,r){if(1===n)return 1===this._commentManager.mode?32:8;if(this.isVisible){var a=this._commentManager.model.getComment(r);if(!a)return 8;a.onEdit()}else this.editCommentOnRender=!0,this._actionManager.processActionWithData(p.a.showCommentPane,2,r);return 32},a.selectNextComment=function(e,t,n,i,r){return 1===n||this._commentManager.selectNextComment(),32},a.selectPrevComment=function(e,t,n,i,r){return 1===n||this._commentManager.selectPrevComment(),32},a.renderNewOrEditingComment=function(t,n,i){var a=t.render(),o=[],s=0,l=0;if(n?(l=n.offsetTop,this.paneSurface.insertBefore(a,n)):this.paneSurface.appendChild(a),Array.add(o,a),i){var c=this.createGroupDivider(t);this.paneSurface.insertBefore(c,a),Array.add(o,c)}n&&(s=n.offsetTop-l),e.animateNewComment(o,n,s,Object(r.d)(this,this.onAfterFadeIn,"onAfterFadeIn"),Object(r.d)(this,this.onAfterMove,"onAfterMove")),t.commentType&&t.focus()},a.showWithoutFocus=function(){},e.animateNewComment=function(t,n,i,r,a){for(var o=0;o<t.length;o++){var s=t[o];n?Do.WacAirSpace.setAnimationClass(s,"WAC_DelayShowClass"):Do.WacAirSpace.setAnimationClass(s,"Shared_BasicClass");var l=new Po.a(s);l.animateOpacity(0,1),Do.WacAirSpace.animate(l,null,r)}if(n){var c=e.getExistingMarginTopOnElement(n);n.style.position="relative",Do.WacAirSpace.setAnimationClass(n,"Shared_BasicClass");var u=new Oo.a(n);u.animateY(c-i,c),Do.WacAirSpace.animate(u,null,a)}},e.animateDeleteComments=function(t,n,i,r,a){for(var o=0;o<t.length;o++){var s=t[o];Do.WacAirSpace.setAnimationClass(s,"Shared_BasicClass");var l=new Eo.a(s);l.animateOpacity(1,0),Do.WacAirSpace.animate(l,null,r)}if(n){var c=e.getExistingMarginTopOnElement(n);n.style.position="relative",Do.WacAirSpace.setAnimationClass(n,"WAC_DelayMoveClass");var u=new Oo.a(n);u.animateY(c,i+c),Do.WacAirSpace.animate(u,null,a)}},e.removeAllAnimationClasses=function(e){var t=e.className;if(t)for(var n=t.split(" "),i=0;i<n.length;i++){var r=n[i];r.startsWith(Do.WacAirSpace.animationClassPrefix)&&Sys.UI.DomElement.removeCssClass(e,r)}},e.getExistingMarginTopOnElement=function(e){var t=Mo.CssUtils.getCurrentStyle(e),n=0;return t&&t.marginTop&&(n=parseInt(t.marginTop),n=isNaN(n)?0:n),n},e.clearOpacity=function(e){U.a.isNonStandardsCompliantIE?e.style.filter="":e.style.opacity=""},t=e,(n=[{key:"addCommentOnRender",get:function(){return this._addCommentOnRender},set:function(e){this._addCommentOnRender=e,e||this.addNewCommentInternal()}},{key:"commentPaneBodyId",get:function(){return"CommentPane"}},{key:"isVisible",get:function(){return this._isVisible},set:function(e){this._isVisible=e}},{key:"paneSurface",get:function(){return this._paneSurface}},{key:"newCommentButton",get:function(){return this._newCommentButton}},{key:"f6Manager",get:function(){return this._f6Manager}},{key:"paneParent",get:function(){return this._paneParent}},{key:"pane",get:function(){return this._pane}},{key:"shouldCreateHeader",get:function(){return!0}},{key:"shouldCreateHeaderControls",get:function(){return!0}},{key:"emptyUIStringPart1",get:function(){return CommonUIStrings.l_CommentPaneEmpty1}},{key:"emptyUIStringPart2",get:function(){return CommonUIStrings.l_CommentPaneEmpty2}},{key:"isCurrentlyEditing",get:function(){return 2===this._commentManager.mode||3===this._commentManager.mode}}])&&Lo(t.prototype,n),i&&Lo(t,i),e}();Object(i.a)(Ro,"CommentPane",null,[4,154]);var Uo=function(e){var t,n;function i(t,n,i,a,o,s,l){var c;return c=e.call(this,n,a,o,s,l)||this,t.add_onResize(Object(r.d)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(c),c.resizeCommentPane,"resizeCommentPane")),c}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=i.prototype;return a.resizeCommentPane=function(){var e=zi.App.instance.theConfig.commentPaneWidth-zi.App.instance.theConfig.commentPaneHorizontalBorderWidth;this.pane.style.width=e+"px",zi.App.get_activeAppFrame().isCommentPaneVisible&&(this.pane.style.visibility="visible"),this.pane.style.top="0",zi.App.get_activeAppFrame().isCommentPaneVisible?(zi.App.get_activeAppFrame().isCommentPaneTouchMode?Sys.UI.DomElement.addCssClass(this.pane,Tt.AFrame.dynamicTouchModeCssClass):Sys.UI.DomElement.removeCssClass(this.pane,Tt.AFrame.dynamicTouchModeCssClass),no.a.animateCommentPane(this.pane,!0,Object(r.d)(this,this.onAfterCommentPaneShow,"onAfterCommentPaneShow"))):no.a.animateCommentPane(this.pane,!1,Object(r.d)(this,this.onAfterCommentPaneHide,"onAfterCommentPaneHide"));var t=zi.App.get_activeAppFrame().workspace.getHeight(),n=this.paneSurface.offsetTop;this.paneSurface.style.height=t>n?t-n+"px":"0px"},a.onAfterCommentPaneShow=function(e){this.pane.style.visibility="visible",Aa.a.instance.calculateOffset()},a.onAfterCommentPaneHide=function(e){this.pane.style.visibility="hidden",Aa.a.instance.calculateOffset()},a.showCommentPane=function(e,t,n,i,r){if(1===n)return zi.App.isReadyForRibbon()?32:8;if(!zi.App.get_activeAppFrame().isCommentPaneVisible){Aa.a.instance.hideSelection();var a=0;if(r)a=r.inputMethod;zi.App.get_activeAppFrame().showCommentPane(a)}return this.isVisible=!0,s.AFrameworkApplication.activeFrame.theF6Manager.activateFocus(Tt.AFrame.commentPaneFocusId),this._commentManager.initiateCommentingSession(),zi.App.get_activeAppFrame().ribbonUser.poll(),32},a.addNewComment=function(t,n,i,r,a){return zi.App.isReadyForRibbon()?e.prototype.addNewComment.call(this,t,n,i,r,a):8},a.hideCommentPane=function(e,t,n,i,r){if(1===n)return 32;var a=zi.App.get_activeAppFrame();a.isCommentPaneVisible&&(Aa.a.instance.hideSelection(),a.hideCommentPane(),this._commentManager.paneClosing());var o=It.FocusManager.instance();return o.currentScope&&o.currentScope.name===Tt.AFrame.commentPaneFocusId&&o.setScope(o.defaultScopeName),s.AFrameworkApplication.activeFrame.theF6Manager.deactivateFocus(Tt.AFrame.commentPaneFocusId),this.isVisible=!1,zi.App.get_activeAppFrame().ribbonUser.poll(),32},a.toggleCommentPane=function(e,t,n,i,r){return this.isVisible?this.hideCommentPane(e,t,n,i,r):this.showCommentPane(e,t,n,i,r)},a.queryToggleCommentPane=function(e,t,n,i,r){return 1===n||(r[Dr.a.On]=zi.App.get_activeAppFrame().isCommentPaneVisible),32},a.getDividerLabel=function(e){return String.format(WordViewerIntl.WordViewerStrings.l_CommentPanePageLabel,e.groupNumber)},i.getInstance=function(){return i.getInstanceWithResolvedDependencies()},i.getInstanceWithResolvedDependencies=function(){return new i(s.AFrameworkApplication.activeFrame,s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.activeFrame.thePageManager,s.AFrameworkApplication.activeFrame.theClickInputManager,s.AFrameworkApplication.activeFrame.theKeyInputManager,s.AFrameworkApplication.activeFrame.theFocusManager,s.AFrameworkApplication.activeFrame.theF6Manager)},i}(Ro);Object(i.a)(Uo,"ViewerCommentPane",Ro,[]);var Ho=n(313);function Bo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function xo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var No=function(e){var t,n;function i(t,n,i,r,a){var o;return(o=e.call(this,i)||this)._fetchCommentsDataRetried=!1,o._fetchCommentsDataFailed=!1,o._hasSharedLock=!1,o._inCommentingSession=!1,o._beginCommentingServerOp=null,o._refreshLockTask=null,o._refreshLockServerOp=null,o._networkStatusToast=null,o._retryingBadCanary=!1,o._sessionReady=!1,o._retryCountBeginCommentingBusy=0,o._commentsDataReady=!1,o.copyingEnabled=zi.App.instance.copyingEnabled,o._currentMode=zi.App.instance.userCanComment&&!zi.App.instance.accessibleModeEnabled?1:0,i.addActionWithFlags(er.a.commentDownloadCorrupt,Lr.a.application,vt.ActionManager.doNothingButReportHandler,64),i.addAction(p.a.commentHintClick,de.a.frame,vt.ActionManager.doNothingButReportHandler),o._commentPane=Uo.getInstance(),o._commentModel=wo.getInstance(),o._hintManager=go.getInstance(),o._hostPostmessengerLazy=r,o._commentPane.initialize(xo(o),t),o._commentModel.initialize(xo(o)),o._hintManager.initialize(n),o._focusManager=a,o._batchedServerOperationFactory=new Xa,o.fetchCommentData(),zi.App.get_activeAppFrame().workspace.setCommentManagerDisposable(xo(o)),o}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a,o,l,c=i.prototype;return c.dispose=function(){e.prototype.dispose.call(this),this._networkStatusToast&&(this._networkStatusToast.dispose(),this._networkStatusToast=null)},c.addNewComment=function(t){void 0===t&&(t=null),e.prototype.addNewComment.call(this,t),Aa.a.instance.clearSelection()},c.selectComment=function(t,n){void 0===n&&(n=1),this.commentsDataReady&&!this._fetchCommentsDataFailed&&e.prototype.selectComment.call(this,t,n)},c.initiateCommentingSession=function(){if(this._inCommentingSession)this.pane.addCommentOnRender&&(this.pane.addCommentOnRender=!1);else{if(e.prototype.initiateCommentingSession.call(this),s.AFrameworkApplication.useRedeemForCommentingPostMessage){var t,n="wdcomments=1",i=zi.App.get_activeAppFrame().getTopParagraphId();i&&(n+="&wdparaid="+i),h.ULS.shipAssertTag(4994851,327,!!this._hostPostmessengerLazy.value),this._hostPostmessengerLazy.value.sendMessage(d.a.redeemForCommenting,((t={}).targetWacAction="View",t.wdparams=n,t))||zi.App.get_activeAppFrame().navigateToHostUrl(!0,s.AFrameworkApplication.copyAndEditUrl),s.AFrameworkApplication.useRedeemForCommentingPostMessage=!1}if(this._currentMode){if(!this._beginCommentingServerOp){this._retryCountBeginCommentingBusy=0;var a=this._batchedServerOperationFactory.getBatchedServerOperation(0,Object(r.d)(this,this.beginCommentingResponseHandler,"beginCommentingResponseHandler"));this._beginCommentingServerOp=new Pa,this._beginCommentingServerOp.requestObject=Za.construct(zi.App.instance.baseDocQueryParam,Hr.a.instance.isNormalized),this._beginCommentingServerOp.status=1,a.addOperation(this._beginCommentingServerOp),a.dispatchRequest()}}else this._sessionReady||(this._sessionReady=!0,this.populateCommentPane())}},c.endCommentingSession=function(){if(this._inCommentingSession){var e=this._batchedServerOperationFactory.getBatchedServerOperation(0,null),t=new Pa;t.requestObject=Ya.construct(zi.App.instance.baseDocQueryParam,this._hasSharedLock),t.status=1,e.addOperation(t),e.dispatchRequest(),this._inCommentingSession=!1,this._refreshLockTask&&!s.AFrameworkApplication.isShuttingDown&&(s.AFrameworkApplication.theTaskManager.deleteTask(this._refreshLockTask),this._refreshLockTask=null)}},c.beginCommentingResponseHandler=function(e){if(!s.AFrameworkApplication.isShuttingDown){if(5===this._beginCommentingServerOp.statusCode){if(this._retryingBadCanary){0,this.mode=0,this._sessionReady=!0,this.populateCommentPane();var t=new Pn.StandardDialog;return t.buttonsOption=0,t.showError(Co.a.commentBeginCanaryFailure,CommonUIStrings.l_DefaultDialogTitle,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen,null),void oo.a.propagateError(!1,"CommentBeginCanaryFailed",Co.a.commentBeginCanaryFailure,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen)}return this._retryingBadCanary=!0,void e.dispatchRequest()}if(this._retryingBadCanary=!1,this._sessionReady=!0,2!==this._beginCommentingServerOp.statusCode||!this._beginCommentingServerOp.responseObjects){0,this.mode=0,this.populateCommentPane();var n=new Pn.StandardDialog;return n.buttonsOption=0,n.showError(Co.a.commentBeginNetworkError,CommonUIStrings.l_DefaultDialogTitle,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen,null),void oo.a.propagateError(!1,"CommentBeginNetworkError",Co.a.commentBeginNetworkError,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen)}0;var a=this._beginCommentingServerOp.responseObjects[this._beginCommentingServerOp.responseObjects.length-1];if(46===a.StatusCode&&this._retryCountBeginCommentingBusy++<i.maxRetryCountForBeginCommentingBusy)e.dispatchRequest();else if(a.StatusCode){var o,l;this.mode=0,this.populateCommentPane();var c=i.getErrorInfoForBeginCommentFailure(a.StatusCode,Object(z.a)((function(){return o}),(function(e){return o=e})),Object(z.a)((function(){return l}),(function(e){return l=e})));if(c){var d=new Pn.StandardDialog;d.buttonsOption=0,o&&d.addHelpLink(WordViewerIntl.WordViewerStrings.l_LearnMore,o),d.showError(l,CommonUIStrings.l_DefaultDialogTitle,c,null),oo.a.propagateError(!1,"CommentFailed",l,c)}else s.AFrameworkApplication.reportError(l)}else{if(a.Refresh){var h;switch(this.mode=0,this.populateCommentPane(),a.Refresh){case 1:case 2:h=WordViewerIntl.WordViewerStrings.l_CommentingNeedsRefresh;break;default:0,h=WordViewerIntl.WordViewerStrings.l_GenericErrorOpen}var g=new Pn.StandardDialog;return g.buttonsOption=1,g.setButtonText(1,WordViewerIntl.WordViewerStrings.l_Reload),void g.showInformation(CommonUIStrings.l_DefaultDialogTitle,h,Object(r.d)(this,this.reloadDialogHandler,"reloadDialogHandler"))}0,this._hasSharedLock=a.SharedLock,this._inCommentingSession=!0,s.AFrameworkApplication.theActionManager.processAction(p.a.commentBeginSucceeded,2),this.populateCommentPane(),this._refreshLockTask||(this._refreshLockTask=new u.a(3,2,6e5,Object(r.d)(this,this.refreshLockTimer,"refreshLockTimer")),s.AFrameworkApplication.theTaskManager.addTask(this._refreshLockTask))}}},c.reloadDialogHandler=function(e,t){1===e?(s.AFrameworkApplication.theActionManager.processAction(p.a.commentBeginRefresh,2),tt.a.openWindow(1,window.location.href)):(s.AFrameworkApplication.theActionManager.processAction(p.a.commentBeginRefreshRefused,2),this.mode=0)},c.fetchCommentData=function(){if(Hr.a.instance.hasComments){var e=Ea.a.urlForNamedObject("comments.xml");s.AFrameworkApplication.theClientRequestManager.addRequest(e,1,null,null,!0,2,Object(r.d)(this,this.onCommentRequestSucceeded,"onCommentRequestSucceeded"),Object(r.d)(this,this.onCommentRequestFail,"onCommentRequestFail"),null)}else this._commentsDataReady=!0},c.onCommentRequestSucceeded=function(e){this._commentsDataReady=!0,e.data.responseXml?(this._commentModel.updateContent(e.data.responseXml),this.populateCommentPane()):(s.AFrameworkApplication.theActionManager.processAction(er.a.commentDownloadCorrupt,2),this.mode=0,this._commentPane.showErrorUI()),s.AFrameworkApplication.theActionManager.processAction(p.a.commentDownloadSucceeded,2)},c.onCommentRequestFail=function(e){if(this._fetchCommentsDataRetried)this.onFetchCommentsDataFail();else{this._fetchCommentsDataRetried=!0;var t=Ea.a.urlForNamedObject("comments.xml"),n=new Ho.a(Object(r.d)(this,this.onStatusRequestSuccess,"onStatusRequestSuccess"),t);n.failureCallback=Object(r.d)(this,this.onStatusRequestFail,"onStatusRequestFail"),n.send()}},c.onStatusRequestSuccess=function(e){this.fetchCommentData()},c.onStatusRequestFail=function(){this.onFetchCommentsDataFail()},c.onFetchCommentsDataFail=function(){this.mode=0,this._commentsDataReady=!0,this._fetchCommentsDataFailed=!0,this._commentPane.showErrorUI(),s.AFrameworkApplication.theActionManager.processAction(p.a.commentDownloadFailed,2)},c.refreshLockTimer=function(e){var t=this._batchedServerOperationFactory.getBatchedServerOperation(3,Object(r.d)(this,this.refreshLockResponseHandler,"refreshLockResponseHandler"));this._refreshLockServerOp=new Pa,this._refreshLockServerOp.requestObject=Za.construct(zi.App.instance.baseDocQueryParam,Hr.a.instance.isNormalized),this._refreshLockServerOp.status=1,t.addOperation(this._refreshLockServerOp),t.dispatchRequest()},c.refreshLockResponseHandler=function(e){if(!s.AFrameworkApplication.isShuttingDown){if(5===this._refreshLockServerOp.statusCode)return this._retryingBadCanary?void this.showNetworkLostToast():(this._retryingBadCanary=!0,void e.dispatchRequest());if(this._retryingBadCanary=!1,2===this._refreshLockServerOp.statusCode&&this._refreshLockServerOp.responseObjects)0,this._refreshLockServerOp.responseObjects[0].StatusCode?this.showNetworkLostToast():this.hideNetworkLostToast();else this.showNetworkLostToast()}},c.showNetworkLostToast=function(){this._networkStatusToast||(this._networkStatusToast=zi.App.get_activeAppFrame().notificationBar.createEntry(CommonUIStrings.l_NetworkProblemToast,!0),zi.App.get_activeAppFrame().notificationBar.addEntry(this._networkStatusToast))},c.hideNetworkLostToast=function(){this._networkStatusToast&&(zi.App.get_activeAppFrame().notificationBar.removeEntry(this._networkStatusToast),this._networkStatusToast.dispose(),this._networkStatusToast=null)},c.populateCommentPane=function(){this.commentsDataReady&&this._sessionReady&&!this._fetchCommentsDataFailed&&(this._commentPane.showComments(this._commentModel.getAllComments()),this.pane.addCommentOnRender&&(this.pane.addCommentOnRender=!1))},i.getInstance=function(){return i.getInstanceWithResolvedDependencies()},i.getInstanceWithResolvedDependencies=function(){return zi.App.instance.fileTypeSupportsCommenting&&!s.AFrameworkApplication.isEmbedded&&!s.AFrameworkApplication.isNoChrome&&zi.App.get_activeAppFrame().workspace&&zi.App.get_activeAppFrame().workspace.appBaseDom&&zi.App.get_activeAppFrame().workspace.initialized?new i(zi.App.get_activeAppFrame().workspace.appBaseDom,x.a.instance.resolve("WordViewer.Controls.IScrollControl").scroller,s.AFrameworkApplication.theActionManager,x.a.instance.resolveLazy("Postmessage.IHostPostmessenger"),It.FocusManager.instance()):null},i.getErrorInfoForBeginCommentFailure=function(e,t,n){switch(t.val=null,e){case 1:return n.val=Co.a.commentBeginInvalidPropertyData,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen;case 7:return n.val=Co.a.commentBeginPermissionDenied,null;case 14:return n.val=Co.a.commentBeginUnspecifiedFailure,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen;case 36:return n.val=Co.a.commentBeginOldProductDigitalSignature,WordViewerIntl.WordViewerStrings.l_OldProductDigitalSignatureOpen;case 9:return n.val=Co.a.commentBeginDocumentProtectionSettings,WordViewerIntl.WordViewerStrings.l_DocumentProtectionSettingsCommentOpen;case 30:return n.val=Co.a.commentBeginDocumentPasswordEncrypted,WordViewerIntl.WordViewerStrings.l_DocumentPasswordEncryptedOpen;case 31:return n.val=Co.a.commentBeginFileCheckedOut,WordViewerIntl.WordViewerStrings.l_CheckedOutOpen;case 17:return n.val=Co.a.commentBeginFileRequiresCheckout,WordViewerIntl.WordViewerStrings.l_RequiresCheckoutOpen;case 16:return n.val=Co.a.commentBeginFileLockedForOfflineCheckout,WordViewerIntl.WordViewerStrings.l_LockedForOfflineCheckoutOpen;case 11:return n.val=Co.a.commentBeginFileLockedByOtherInterface,t.val=WordViewerIntl.WordViewerStrings.l_CoauthHelpContextId,WordViewerIntl.WordViewerStrings.l_LockedByOtherInterfaceOpen;case 12:return n.val=Co.a.commentBeginCorruptedFile,WordViewerIntl.WordViewerStrings.l_CorruptFileOpen;case 57:return n.val=Co.a.commentBeginNumberOfCoauthorsReachedMax,WordViewerIntl.WordViewerStrings.l_NumberOfCoauthorsReachedMaxOpen;case 61:return n.val=Co.a.commentBeginDocumentMarkedFinal,WordViewerIntl.WordViewerStrings.l_DocumentMarkedFinalOpen;case 38:return n.val=Co.a.commentBeginPreReleaseFile,WordViewerIntl.WordViewerStrings.l_PreReleaseFile;case 69:return n.val=Co.a.commentBeginClientServerNormalizationConflict,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen;case 35:return n.val=Co.a.commentBeginLockExpired,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen;case 47:return n.val=Co.a.commentBeginWordFileVersionMismatch,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen;case 39:return n.val=Co.a.commentBeginFileEditedInRichClient,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen;case 33:return n.val=Co.a.commentBeginRequestCountTooLarge,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen;default:return n.val=Co.a.commentBeginUnspecifiedFailure,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen}},a=i,(o=[{key:"hasSharedLock",get:function(){return this._hasSharedLock}},{key:"commentsDataReady",get:function(){return this._commentsDataReady}}])&&Bo(a.prototype,o),l&&Bo(a,l),i}(Fa.a);function jo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}No.maxRetryCountForBeginCommentingBusy=2,Object(i.a)(No,"ViewerCommentManager",Fa.a,[]);var Wo=function(){function e(){}var t,n,i,a=e.prototype;return a.configure=function(e){},a.init=function(){s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(Object(r.d)(this,this.onFullAppSettingsReady,"onFullAppSettingsReady"))},a.onFullAppSettingsReady=function(){Fa.a.factory=No.getInstance,Z.a.registerDispatchHandler(e.dispatcher);Fa.a.instance;(s.AFrameworkApplication.appSettingsManager.appSettings.BootActivityNavigationId?s.AFrameworkApplication.appSettingsManager.appSettings.BootActivityNavigationId.toString():null)&&h.ULS.sendTraceTag(37291602,327,15,"Deep linking for word viewer."),zi.App.get_activeAppFrame()&&zi.App.get_activeAppFrame().ribbonUser&&zi.App.get_activeAppFrame().ribbonUser.poll()},a.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},e.dispatcher=function(e,t,n,i,r){return e===p.a.showCommentPane?Fa.a.instance.showCommentPane(e,t,n,i,r):e===er.a.toggleCommentPane?Fa.a.instance.toggleCommentPane(e,t,n,i,r):2},t=e,(n=[{key:"name",get:function(){return"WordViewer.Comments"}}])&&jo(t.prototype,n),i&&jo(t,i),e}();function Vo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Wo,"Program",null,[14,15]);var qo=function(){function e(){}var t,n,i;return e.prototype.clickHandler=function(e){return h.ULS.sendTraceTag(37034014,342,50,"User clicked on the Privacy statement."),tt.a.safelyOpenWindow(this.privacyLink,"_blank",void 0,void 0,"SendUsYourFileDialog.PrivacyLink"),!0},t=e,(n=[{key:"privacyLink",get:function(){return s.AFrameworkApplication.privacyUrl}}])&&Vo(t.prototype,n),i&&Vo(t,i),e}();Object(i.a)(qo,"PrivacyLinkHandler",null,[131]);var Go=function(){function e(e,t){this._onDone=null,this._sendUsYourFileManager=e,this._sendUsYourFileDialogFactory=t}var t=e.prototype;return t.showDialog=function(e){this._onDone=e,this._sendUsYourFileDialogFactory.create().initializeAndShow(Object(r.d)(this,this.handleDialog,"handleDialog"))},t.handleDialog=function(e,t){1===e&&this._sendUsYourFileManager.sendRequestToAcquireFile(),this._onDone()},e}();Object(i.a)(Go,"SendUsYourFileController",null,[118]);var Ko=function(e){var t,n;function i(t,n,i){var r;return(r=e.call(this)||this)._privacyLink=null,r._clickInputManager=t,r._privacyLinkHandler=n,r._dialogStrings=i,r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=i.prototype;return a.initializeAndShow=function(e){this.buttonsOption=1,this.setButtonText(1,this._dialogStrings.send),this.setButtonText(0,this._dialogStrings.noThanks),h.ULS.shipAssertTag(37034013,342,!this._privacyLink,"privacy anchor should be null before initializing it.");var t=this.dialogContent();this.messageBoxImpl(this._dialogStrings.appTitle,null,"CancelRequest_32x32x32",null,e,t),this.setDescribedByForDialog(this.myId(i.sendUsYourFileId))},a.dialogContent=function(){var e=document.createElement("span");e.innerText=this._dialogStrings.problemOpeningDocument;var t=document.createElement("span");t.innerText=this._dialogStrings.tellMicrosoftAboutThis,t.style.fontWeight=this._dialogStrings.userInterfaceFontWeightBold;var n=document.createElement("span");n.innerText=this._dialogStrings.sendUsYourFileDialogText;var r=this.constructPrivacyLinkSpan(),a=document.createElement("span");return a.id=this.myId(i.sendUsYourFileId),a.appendChild(e),a.appendChild(document.createElement("br")),a.appendChild(document.createElement("br")),a.appendChild(t),a.appendChild(document.createElement("br")),a.appendChild(n),a.appendChild(document.createElement("br")),a.appendChild(document.createElement("br")),a.appendChild(document.createElement("br")),a.appendChild(r),a},a.constructPrivacyLinkSpan=function(){var e=document.createElement("span"),t=document.createElement("a");return t.innerText=this._dialogStrings.privacyStatement,t.href=this._privacyLinkHandler.privacyLink,e.appendChild(t),this._privacyLink=t,this._clickInputManager.registerHandler(f.EventNames.click,this._privacyLink,Object(r.d)(this._privacyLinkHandler,this._privacyLinkHandler.clickHandler,"clickHandler")),e},a.dispose=function(){this._privacyLink&&(this._clickInputManager.unregisterHandler(f.EventNames.click,this._privacyLink,Object(r.d)(this._privacyLinkHandler,this._privacyLinkHandler.clickHandler,"clickHandler")),this._privacyLink=null),e.prototype.dispose.call(this)},i}(Pn.StandardDialog);Ko.sendUsYourFileId="sendUsYourFileId",Object(i.a)(Ko,"SendUsYourFileDialog",Pn.StandardDialog,[116]);var zo=function(){function e(){}return e.prototype.create=function(){return x.a.instance.resolve("Wac.Common.SendUsYourFile.ISendUsYourFileDialog")},e}();Object(i.a)(zo,"Factory",null,[130]);var Jo=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.getClassId=function(){return 38},i.construct=function(e){var t=new i;return t.FileId=e,t},i}(Qa);Object(i.a)(Jo,"CreateSendUsYourFileRequest",Qa,[]);var Xo=function(){function e(e,t,n){this._batchedServerOperationFactory=e,this._getRootQuerySignature=t,this._logSendingRequest=n}var t=e.prototype;return t.sendRequestToAcquireFile=function(e){var t=this;if(void 0===e&&(e=!1),this._getRootQuerySignature){var n,i=Jo.construct(this._getRootQuerySignature()),r=new Pa;if(r.requestObject=i,r.status=1,r.perfTag="BootErrorReport",e)n=this._batchedServerOperationFactory(null);else{n=this._batchedServerOperationFactory((function(e){t.responseHandler(r,e)}))}n.addOperation(r),n.dispatchRequest(),this._logSendingRequest()}},t.responseHandler=function(e,t){5===e.statusCode&&this.sendRequestToAcquireFile(!0)},e}();Object(i.a)(Xo,"SendUsYourFileManager",null,[117]);var Qo=function(){function e(e,t){this._container=null,this._dialogStrings=e,this._getRootQuerySignature=t}var t=e.prototype;return t.configure=function(e){var t=this;this._container=e,this._container.register(106,"Wac.Common.SendUsYourFile.ISendUsYourFileDialogStrings").singleInstance().usingFactory((function(){return t._dialogStrings})),this._container.register(116,"Wac.Common.SendUsYourFile.ISendUsYourFileDialog").usingFactory((function(){return new Ko(lr.a.instance,new qo,t._container.resolve("Wac.Common.SendUsYourFile.ISendUsYourFileDialogStrings"))})),this._container.register(117,"Wac.Common.SendUsYourFile.ISendUsYourFileManager").usingFactory((function(){return new Xo((function(e){return t.getBatchedServerOperation(0,e)}),t._getRootQuerySignature,(function(){h.ULS.sendTraceTag(42022664,342,50,"send us your file request is now sent.")}))})),this._container.register(118,"Wac.Common.SendUsYourFile.ISendUsYourFileController").singleInstance().usingFactory((function(){var e=new zo;return new Go(t._container.resolve("Wac.Common.SendUsYourFile.ISendUsYourFileManager"),e)}))},t.init=function(){this._container.resolve("Wac.Common.SendUsYourFile.ISendUsYourFileController")},t.dispose=function(){},e}();Object(i.a)(Qo,"SendUsYourFilePackageManager",null,[]);function Zo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Yo=function(){function e(){}var t,n,i;return t=e,(n=[{key:"appTitle",get:function(){return CommonUIStrings.l_AppTitle}},{key:"send",get:function(){return CommonUIStrings.l_Send}},{key:"noThanks",get:function(){return CommonUIStrings.l_NoThanks}},{key:"problemOpeningDocument",get:function(){return WordViewerIntl.WordViewerStrings.L_ProblemOpeningDocument}},{key:"tellMicrosoftAboutThis",get:function(){return WordViewerIntl.WordViewerStrings.L_TellMicrosoftAboutThis}},{key:"userInterfaceFontWeightBold",get:function(){return CommonUIStrings.l_UserInterfaceFontWeightBold}},{key:"sendUsYourFileDialogText",get:function(){return WordViewerIntl.WordViewerStrings.L_SendUsYourFileDialogText}},{key:"privacyStatement",get:function(){return CommonUIStrings.l_PrivacyStatement}}])&&Zo(t.prototype,n),i&&Zo(t,i),e}();function $o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Yo,"WordViewerSendUsYourFileDialogStrings",null,[106]);var es=function(e){var t,n,i,r,a;function o(){return e.call(this,new Yo,(function(){return zi.App.instance.baseDocQueryParam}))||this}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,o.prototype.getBatchedServerOperation=function(e,t){return new Ja(e,t,"SendUsYourFile.ashx",zi.App.mode,zi.App.webServiceBase)},o.main=function(){y.a.instance.registerPackage(new o)},i=o,(r=[{key:"name",get:function(){return"WordViewer.SendUsYourFile"}}])&&$o(i.prototype,r),a&&$o(i,a),o}(Qo);Object(i.a)(es,"PackageManager",Qo,[14,15]);var ts=function(){function e(){this._isAppFullyLoaded=!1}var t=e.prototype;return t.markAppAsFullyLoaded=function(){this._isAppFullyLoaded=!0},t.isAppFullyLoaded=function(){return this._isAppFullyLoaded},e.getAnInstanceWithResolvedDependencies=function(){return new on.a((function(){return new e}))},e.get_instance=function(){return e._instance.value},e}();function ns(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ts._instance=ts.getAnInstanceWithResolvedDependencies(),Object(i.a)(ts,"AppLoadStateTracker",null,[]);var is=function(){function e(){}var t,n,i,r=e.prototype;return r.configure=function(e){},r.init=function(){ts.get_instance().markAppAsFullyLoaded()},r.dispose=function(){},t=e,(n=[{key:"name",get:function(){return"AppLoadStateTracker"}}])&&ns(t.prototype,n),i&&ns(t,i),e}();Object(i.a)(is,"AppLoadStateTrackerPackage",null,[14,15]);var rs=n(160);function as(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var os=function(){function e(){}var t,n,i;return e.getAppStoreURL=function(t,n){switch(t){case 3:return e.getWordURLForPlatform(n);case 2:return e.getPPTURLForPlatform(n);case 1:return e.getExcelURLForPlatform(n)}return""},e.getWordURLForPlatform=function(e){switch(e){case 1:case 2:return s.AFrameworkApplication.appSettingsManager.appSettings.WildFireAdjustLinkWordWac.toString()}return""},e.getPPTURLForPlatform=function(e){switch(e){case 1:case 2:return s.AFrameworkApplication.appSettingsManager.appSettings.WildFireAdjustLinkPptWac.toString()}return""},e.getExcelURLForPlatform=function(e){switch(e){case 1:case 2:return s.AFrameworkApplication.appSettingsManager.appSettings.WildFireAdjustLinkExcelWac.toString()}return""},e.openInClient=function(t,n,i){(U.a.isIPad||U.a.isAndroid)&&(window.setTimeout((function(){e.redirectToStore(i,e.getWildFirePlatform())}),500),MSOJS.ClientUtils.OpenDocumentWithProtocolHandlerNoCallBack(e.appTypeToApplication(i),t,0,!1))},e.clientRedirect=function(t,n,i,r){n&&r&&r(),e.openInClient(t,n,i)},e.getWildFirePlatform=function(){return U.a.isIPad?1:U.a.isAndroid?2:U.a.isWindows?3:U.a.isMac?4:0},e.getWildFireConfigSettingName=function(e){switch(e){case 3:return"WildFireWordBizBar";case 2:return"WildFirePowerPointBizBar";case 1:return"WildFireExcelBizBar";default:return""}},e.getWildFireFlightSettingName=function(e){switch(e){case 3:return"WildFireWordBizBarFlight";case 2:return"WildFirePowerPointBizBarFlight";case 1:return"WildFireExcelBizBarFlight";default:return""}},e.redirectToStore=function(t,n){if(1===n){h.ULS.sendTraceTag(17151569,306,50,"User Directed to App Store");var i=e.getAppStoreURL(t,n);U.a.iPadOsVersion>8?tt.a.safelyOpenWindow(i,void 0,void 0,void 0,"RedirectToAppStore"):tt.a.followHyperlinkWithNoReferrer(i)}else{if(document.hidden)return;if(e.isLocaleChina){var r=s.AFrameworkApplication.appSettingsManager.appSettings.WildFireUrlChinaStoreAndroid.toString();r?(h.ULS.sendTraceTag(18088018,306,50,"User Directed to China Proxy Page"),tt.a.followHyperlinkWithNoReferrer(r)):h.ULS.sendTraceTag(18088019,306,50,"Empty Url in China Proxy Page BRS Setting")}else h.ULS.sendTraceTag(18088020,306,50,"User Directed to Play Store"),MSOJS.ClientUtils.NavigateToUrlUsingClickingOnATag(e.getAppStoreURL(t,n),null,null)}},e.appTypeToApplication=function(e){switch(e){case 3:return 5;case 2:return 3;case 1:return 1;default:return 0}},e.getBizBarDismissKeyForApplication=function(e){switch(e){case 3:return"WordBizBarDismiss";case 2:return"PptBizBarDismiss";case 1:return"ExcelBizBarDismiss";default:return""}},e.isLocalStorageValueTrue=function(t){var n=e.getItemFromLocalStore(t);return!(!n||""===n)&&Boolean.parse(n)},e.setTrueInLocalStore=function(t){e.setItemInLocalStore(t,"true")},e.getItemFromLocalStore=function(e){try{return localStorage.getItem(e)}catch(e){return h.ULS.sendTraceTag(18416668,306,50,"WildFire LocalStorage GetItem Failed with NullReferenceException : "+e.message),null}},e.setItemInLocalStore=function(e,t){try{localStorage.setItem(e,t)}catch(e){h.ULS.sendTraceTag(18416669,306,50,"WildFire LocalStorage SetItem Failed with exception : "+e.message)}},t=e,i=[{key:"isLocaleChina",get:function(){return"zh-CN"===window.navigator.language}},{key:"shouldUseChromeBar",get:function(){return(U.a.isWindows||U.a.isMac)&&U.a.isChrome}},{key:"shouldShowWildFireUI",get:function(){return U.a.isIPad||U.a.isAndroid}}],(n=null)&&as(t.prototype,n),i&&as(t,i),e}();os.chomeExtensionBarDismissKey="ChromeExtensionBarDismiss",Object(i.a)(os,"WildFireUtilities",null,[]);var ss=function(){function e(){}var t=e.prototype;return t.add=function(e,t){this.set_item(e,t)},t.get=function(e){return this.get_item(e)},t.getOrElse=function(e,t){var n;return this.tryGetValue(e,Object(z.a)((function(){return n}),(function(e){return n=e})))?n:t},t.logString=function(e,t){void 0===e&&(e=" "),void 0===t&&(t=":");var n=!0,i=new Sys.StringBuilder;return this.forEach((function(r,a){return n?n=!1:i.append(e),i.append(r?r.toString():""),i.append(t),i.append(a?a.toString():""),!0})),i.toString()},e}();Object(i.a)(ss,"AXDictionary",null,[152]);var ls=function(e,t){this.key=e,this.value=t};Object(i.a)(ls,"XDictionaryEntry",null,[]);var cs=function(){function e(){}var t=e.prototype;return t.any=function(e){void 0===e&&(e=null);for(var t=0;t<this.length;t++)if(!e||e(this.get_item(t)))return!0;return!1},t.contains=function(e,t){var n=!1;return this.forEach((function(i){return!t(e,i)||(n=!0,!1)})),n},t.getItemAt=function(e){return this.get_item(e)},t.last=function(){return this.get_item(this.length-1)},t.forEach=function(e){for(var t=0;t<this.length&&e(this.get_item(t));t++);},t.areEqual=function(e,t){if(!e)return!1;if(e.length!==this.length)return!1;for(var n=0;n<this.length;n++)if(!t(this.get_item(n),e.get_item(n)))return!1;return!0},t.isInsertionIndexInvalid=function(e){return e<0||e>this.length},t.fillHashSet=function(e){this.forEach((function(t){return e.add(t),!0}))},t.logString=function(e){void 0===e&&(e=" ");var t=!0,n=new Sys.StringBuilder;return this.forEach((function(i){return t?t=!1:n.append(e),n.append(i?i.toString():""),!0})),n.toString()},e}();Object(i.a)(cs,"AXList",null,[172]);var us=function(){function e(){}return e.prototype.containsAll=function(e){var t=this;if(!e)return!0;var n=!0;return e.forEach((function(e){return n=t.contains(e)})),n},e}();function ds(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(us,"AXHashSet",null,[194]);var ps=function(e){var t,n;function i(){var t;return(t=e.call(this)||this)._collection={},t._count=0,t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r,a,o,s=i.prototype;return s.set_count=function(e){return this._count=e,e},s.add=function(e){e.toString()in this._collection||(this.set_count(this.count+1),this._collection[e.toString()]=!0)},s.remove=function(e){var t=e.toString();t in this._collection&&(this.set_count(this.count-1),delete this._collection[t])},s.contains=function(e){return e.toString()in this._collection},r=i,(a=[{key:"count",get:function(){return this._count}}])&&ds(r.prototype,a),o&&ds(r,o),i}(us);function hs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ps,"XHashSet",us,[]);var gs=function(e){var t,n;function i(t){var n;return void 0===t&&(t=null),(n=e.call(this)||this)._list=t||[],n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r,a,o,s=i.prototype;return s.get_item=function(e){return this._list[e]},s.shallowClone=function(){return new i(Array.clone(this._list))},s.add=function(e){Array.add(this._list,e)},s.insert=function(e,t){if(this.isInsertionIndexInvalid(e))throw Error.argument(String.format("ArgumentException: [index: {0}] [length: {1}] [item: {2}]",e,this.length,t));Array.insert(this._list,e,t)},s.insertRange=function(e,t){if(this.isInsertionIndexInvalid(e))throw Error.argument(String.format("ArgumentException: [index: {0}] [length: {1}]",e,this.length));for(var n=t.length-1;n>=0;n--)Array.insert(this._list,e,t.getItemAt(n))},s.deleteAt=function(e){if(e<0||e>=this.length)throw Error.argument(String.format("ArgumentException: [index: {0}] [length: {1}]",e,this.length));Array.removeAt(this._list,e)},s.toHashSet=function(){var e=new ps;return this.fillHashSet(e),e},s.toArray=function(){return this._list},s.reverse=function(){this._list.reverse()},s.clear=function(){Array.clear(this._list)},s.toArrayList=function(){return this._list},r=i,(a=[{key:"length",get:function(){return this._list.length}}])&&hs(r.prototype,a),o&&hs(r,o),i}(cs);function ms(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(gs,"XList",cs,[]);var fs=function(e){var t,n;function i(t){var n;return void 0===t&&(t=null),(n=e.call(this)||this)._count=0,n._defaultValue=t,n._dictionary={},n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r,a,o,s=i.prototype;return s.get_item=function(e){var t=this._dictionary[e.toString()];return t?t.value:this._defaultValue},s.set_item=function(e,t){return this.containsKey(e)||this.set_count(this.count+1),this._dictionary[e.toString()]=new ls(e,t),t},s.set_count=function(e){return this._count=e,e},s.remove=function(e){this.containsKey(e)&&(this.set_count(this.count-1),delete this._dictionary[e.toString()])},s.containsKey=function(e){return e.toString()in this._dictionary},s.tryGetValue=function(e,t){return e.toString()in this._dictionary?(t.val=this.get(e),!0):(t.val=this._defaultValue,!1)},s.forEach=function(e){var t=this._dictionary;for(var n in t){var i={key:n,value:t[n]}.value;if(!e(i.key,i.value))break}},s.toList=function(e){var t=new gs,n=this._dictionary;for(var i in n){var r={key:i,value:n[i]}.value;t.add(e(r))}return t},s.toSerializableDictionary=function(){var e={},t=this._dictionary;for(var n in t){var i={key:n,value:t[n]},r=i.value;e[i.key]=r.value}return e},i.createFromSerializableDictionary=function(e,t,n,r){void 0===r&&(r=null);var a=new i(r);for(var o in e){var s={key:o,value:e[o]};a.add(t(s.key),n(s.value))}return a},r=i,(a=[{key:"count",get:function(){return this._count}},{key:"keys",get:function(){return this.toList((function(e){return e.key}))}},{key:"values",get:function(){return this.toList((function(e){return e.value}))}}])&&ms(r.prototype,a),o&&ms(r,o),i}(ss);function vs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(fs,"XDictionary",ss,[]);var Ss=function(){function e(){this._androidWordStrings=new fs,this._androidPowerPointStrings=new fs,this._androidExcelStrings=new fs,this.buildAndroidWordDictionary(this._androidWordStrings),this.buildAndroidPowerPointDictionary(this._androidPowerPointStrings),this.buildAndroidExcelDictionary(this._androidExcelStrings),this._iPadWordStrings=new fs,this._iPadPowerPointStrings=new fs,this._iPadExcelStrings=new fs,this.buildiOSWordDictionary(this._iPadWordStrings),this.buildiOSPowerPointDictionary(this._iPadPowerPointStrings),this.buildiOSExcelDictionary(this._iPadExcelStrings),this._chromeExtensionStrings=new fs,this.buildChromeExtensionDictionary(this._chromeExtensionStrings),this.addCommonStrings(this._chromeExtensionStrings),this.addCommonStrings(this._androidExcelStrings),this.addCommonStrings(this._androidPowerPointStrings),this.addCommonStrings(this._androidWordStrings),this.addCommonStrings(this._iPadPowerPointStrings),this.addCommonStrings(this._iPadWordStrings),this.addCommonStrings(this._iPadExcelStrings)}var t,n,i,r=e.prototype;return r.getStrings=function(e,t){switch(e){case 1:return this.getiPadStringsForApp(t);case 2:return this.getAndroidStringsForApp(t)}return os.shouldUseChromeBar?this._chromeExtensionStrings:null},r.buildAndroidWordDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFireWordBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFireWordBizBarAndroidCallToAction)},r.buildAndroidPowerPointDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFirePPTBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFirePPTBizBarAndroidCallToAction)},r.buildAndroidExcelDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFireExcelBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFireExcelBizBarAndroidCallToAction)},r.buildiOSWordDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFireWordBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("InstallButton",CommonUIStrings.l_WildFireBizBarInstallButtonText),e.add("OpenAppButton",CommonUIStrings.l_WildFireBizBarOpenAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFireWordBizBarIPadCallToAction),e.add("OverlayBig","Get the Word app"),e.add("OverlaySmall","Built for the iPad\u2014for when you're working on the go, even offline."),e.add("OverlaySmallSplit1","Discover Word"),e.add("OverlaySmallSplit2","designed for the iPad."),e.add("SkipButton","Skip for now")},r.buildChromeExtensionDictionary=function(e){e.add("Headline","Get the Office Online extension for Chrome"),e.add("UseAppButton","Get the extension"),e.add("CallToAction","The quickest way to view, edit, and share Office files in Chrome.")},r.buildiOSPowerPointDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFirePPTBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("InstallButton",CommonUIStrings.l_WildFireBizBarInstallButtonText),e.add("OpenAppButton",CommonUIStrings.l_WildFireBizBarOpenAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFirePPTBizBarIPadCallToAction),e.add("OverlayBig","Get the PowerPoint app"),e.add("OverlaySmall","Built for the iPad\u2014for when you're working on the go, even offline."),e.add("OverlaySmallSplit1","Discover PowerPoint"),e.add("OverlaySmallSplit2","designed for the iPad."),e.add("SkipButton","Skip for now")},r.buildiOSExcelDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFireExcelBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("InstallButton",CommonUIStrings.l_WildFireBizBarInstallButtonText),e.add("OpenAppButton",CommonUIStrings.l_WildFireBizBarOpenAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFireExcelBizBarIPadCallToAction)},r.addCommonStrings=function(e){e.add("Corporation","Microsoft Corporation")},r.getiPadStringsForApp=function(e){switch(e){case 3:return this._iPadWordStrings;case 2:return this._iPadPowerPointStrings;case 1:return this._iPadExcelStrings}return null},r.getAndroidStringsForApp=function(e){switch(e){case 3:return this._androidWordStrings;case 2:return this._androidPowerPointStrings;case 1:return this._androidExcelStrings}return null},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}],(n=null)&&vs(t.prototype,n),i&&vs(t,i),e}();function _s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Ss._instance=null,Object(i.a)(Ss,"WildFireStringFactory",null,[]);var ys=function(){function e(e,t,n,i,r,a){void 0===r&&(r=null),void 0===a&&(a=null),this._openURL=null,this._id=e,this._platform=t,this._getURL=r,this._isEdit=i,this._saveAction=a,this._appLinkBar=null,this._useTwoButton=n,this._stringsDict=Ss.instance.getStrings(t,e)}var t,n,i,a=e.prototype;return a.createBusinessBarEntry=function(){this._appLinkBar=new rs.a(this.title,this.message,null),this._appLinkBar.addButton(this.buttonOneText,Object(r.d)(this,this.onButtonOneClick,"onButtonOneClick"),""),this._useTwoButton&&this._appLinkBar.addSecondButton(this.buttonTwoText,Object(r.d)(this,this.onButtonTwoClick,"onButtonTwoClick"),""),this._appLinkBar.closeHandler=Object(r.d)(this,this.dismissBar,"dismissBar"),this._appLinkBar.image=3,this._appLinkBar.id=16,this._appLinkBar.closeable=!0},a.onButtonOneClick=function(e){this._useTwoButton?this.installAppButtonClick(e):this.useAppButtonClick(e)},a.onButtonTwoClick=function(e){this._useTwoButton&&this.openAppButtonClick(e)},a.installAppButtonClick=function(e){h.ULS.sendTraceTag(17932829,306,50,"Install App Button of BusinessBar Clicked"),this._isEdit&&this._saveAction&&this._saveAction(),os.redirectToStore(this._id,this._platform)},a.openAppButtonClick=function(e){this.openUrl&&(h.ULS.sendTraceTag(17932830,306,50,"Open App Button of BusinessBar Clicked"),this._isEdit&&this._saveAction&&this._saveAction(),MSOJS.ClientUtils.OpenDocumentWithProtocolHandlerNoCallBack(os.appTypeToApplication(this._id),this.openUrl,0,!1))},a.useAppButtonClick=function(e){os.shouldUseChromeBar?this.buttonClickChromeExtension(e):(h.ULS.sendTraceTag(17109255,306,50,"AppBusinessBarNav"),os.setTrueInLocalStore("BizBarClicked"),1!==this._platform&&2!==this._platform||os.clientRedirect(this.openUrl,this._isEdit,this._id,this._saveAction))},a.buttonClickChromeExtension=function(e){this._isEdit?h.ULS.sendTraceTag(17571974,323,50,"ChromeExtBannerClicked"):h.ULS.sendTraceTag(17571975,301,50,"ChromeExtBannerClicked"),tt.a.followHyperlinkWithNoReferrer(s.AFrameworkApplication.appSettingsManager.appSettings.WildFireChromeExtensionUrl.toString())},a.dismissBarChromeExtension=function(e){this._isEdit?h.ULS.sendTraceTag(17571976,323,50,"ChromeExtBannerDismissed"):h.ULS.sendTraceTag(17571977,301,50,"ChromeExtBannerDismissed"),os.setTrueInLocalStore(os.chomeExtensionBarDismissKey)},a.dismissBar=function(e){os.shouldUseChromeBar?this.dismissBarChromeExtension(e):(os.setTrueInLocalStore(os.getBizBarDismissKeyForApplication(this._id)),h.ULS.sendTraceTag(17109256,306,50,"AppBusinessBarDismissed"))},e.createWildFireBusinessBar=function(){var t=s.AFrameworkApplication.activeFrame.applicationInstance,n=(s.AFrameworkApplication.appSettingsManager,t.officeAppType),i=1===t.officeAppMode,r=os.getWildFirePlatform(),a=t.saveAction(),o=new e(n,r,U.a.iPadOsVersion>8,i,(function(){return t.clientUrl}),a);return h.ULS.sendTraceTag(9208407,306,50,"AppBusinessBarDisplayed"),o},t=e,(n=[{key:"title",get:function(){return this._stringsDict.get_item("Headline")}},{key:"message",get:function(){return this._stringsDict.get_item("CallToAction")}},{key:"useTwoButton",get:function(){return this._useTwoButton}},{key:"buttonOneText",get:function(){return this._useTwoButton?this._stringsDict.get_item("InstallButton"):this._stringsDict.get_item("UseAppButton")}},{key:"buttonTwoText",get:function(){return this._useTwoButton?this._stringsDict.get_item("OpenAppButton"):""}},{key:"businessBarEntry",get:function(){return this._appLinkBar}},{key:"openUrl",get:function(){return this._openURL||(this._openURL=this._getURL()),this._openURL}}])&&_s(t.prototype,n),i&&_s(t,i),e}();function bs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ys,"WildFireBusinessBar",null,[]);var As=function(){function e(){}var t,n,i,a=e.prototype;return a.addBusinessBarEntry=function(e){var t=s.AFrameworkApplication.activeFrame.applicationInstance,n=!1;return e&&(e.createBusinessBarEntry(),e.businessBarEntry&&(n=t.addEntryToBusinessBar(e.businessBarEntry,!0))),n},a.createChromeExtensionBizBar=function(){var e=s.AFrameworkApplication.activeFrame.applicationInstance,t=(e.officeAppType,1===e.officeAppMode),n=new ys(e.officeAppType,os.getWildFirePlatform(),!1,t);this.addBusinessBarEntry(n)&&h.ULS.sendTraceTag(17571982,306,50,"ChromeExtBannerDisplayed")},a.createWildFireBusinessBar=function(e,t,n,i,r,a,o){var s=new ys(t,i,r,n,a,o);this.addBusinessBarEntry(s)&&h.ULS.sendTraceTag(9208407,306,50,"AppBusinessBarDisplayed")},a.createWildFireWacUI=function(){var e=s.AFrameworkApplication.activeFrame.applicationInstance,t=s.AFrameworkApplication.appSettingsManager,n=e.officeAppType,i=1===e.officeAppMode;if(t.getBooleanAppSetting(os.getWildFireConfigSettingName(n))){var r=os.getWildFirePlatform(),a=U.a.iPadOsVersion>8;if(2!==n||2!==r||!i){document.body;var o=t.getBooleanAppSetting(os.getWildFireFlightSettingName(n)),l=e.saveAction();o&&!os.isLocalStorageValueTrue(os.getBizBarDismissKeyForApplication(n))&&this.createWildFireBusinessBar(e,n,i,r,a,(function(){return e.clientUrl}),l)}}},a.init=function(){var e=s.AFrameworkApplication.appSettingsManager,t=e.getBooleanAppSetting("WildFireChromeExtensionEnabled"),n=e.getBooleanAppSetting("WildFireChromeExtensionBar")&&t;os.shouldUseChromeBar&&n&&!os.isLocalStorageValueTrue(os.chomeExtensionBarDismissKey)?this.createChromeExtensionBizBar():(document.body&&os.shouldShowWildFireUI&&this.createWildFireWacUI(),s.AFrameworkApplication.theActionManager.addAction(p.a.launchWildFireBusinessBar,de.a.frame,Object(r.d)(this,this.launchWildFireBusinessBar,"launchWildFireBusinessBar")))},a.launchWildFireBusinessBar=function(e,t,n,i,r){if(1===n)return 32;if(!r)return 8;var a=r;return this.createWildFireBusinessBar(s.AFrameworkApplication.activeFrame.applicationInstance,a.app,a.mode,a.platform,a.useTwoButton,null,null),32},a.dispose=function(){},a.configure=function(e){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.WildFire"}}])&&bs(t.prototype,n),i&&bs(t,i),e}();Object(i.a)(As,"PackageManager",null,[14,15]);var Cs=function(e,t,n){void 0===n&&(n=null),this.id=e.Id,n||(n=""),this.isRecommendation=t,this.recommendationText=n,this.sensitivityLabel=e};Object(i.a)(Cs,"AutoPolicyLabelData",null,[]);var Ts=function(e,t){this.applyLabelFlag=e,this.displayName=t};function ws(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Ts,"PolicyLabelRequestState",null,[]);var Is=function(){function e(){}var t,n,i;return t=e,i=[{key:"justificationDialogHtmlTemplate",get:function(){return e.justificationDialogHtmlTemplateFormat}}],(n=null)&&ws(t.prototype,n),i&&ws(t,i),e}();function ks(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Is.justificationDialogHtmlTemplateFormat="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>",Object(i.a)(Is,"JustificationDialogHtml",null,[]);var Fs=function(e){var t,n;function i(t,n){var r;return(r=e.call(this,!1,!1,i.useReactDialog)||this)._justificationList=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther],r._reactJustification=null,r._reactActionButtonEnabled=!1,r._selectedPolicyId=t,r._callback=n,r.dialogHtml=r.buildDialogHtml(),r.buttonsOption=1,r.dialogId=i.id,r.setButtonText(1,CommonUIStrings.l_DialogChange),r.setButtonState(1,!1),r.setDefaultButton(0),r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a,o,l,c=i.prototype;return c.showJustificationDialog=function(){if(i.useReactDialog)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(r.d)(this,this.reactJustificationDialogHandler,"reactJustificationDialogHandler"),this.getReactDialogProps(this._reactActionButtonEnabled));else{for(var e={},t=0;t<this._justificationList.length;t++)e[i.radioBox+t]=!1;e[i.textJustification]="",this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(r.d)(this,this.justificationDialogHandler,"justificationDialogHandler"),e),this.registerFocusForRadioButtons(),Ee.a.addHandler($get(i.textJustification),f.EventNames.input,Object(r.d)(this,this.textAreaHandler,"textAreaHandler"))}},c.validate=function(){if(i.useReactDialog)return this.validateJustificationString(this._reactJustification);var e=$get(i.textJustification);return!!e.disabled||this.validateJustificationString(e.value)},c.validateJustificationString=function(e){var t=e.length<2,n=e.length>500,i=new RegExp("[{|}|;|\\\\]").test(e),r=""===We.a.removeAllWhitespace(e);return!(t||n||i||r)},c.justificationDialogHandler=function(e,t){var n="";if(1===e)for(var r=0;r<this._justificationList.length;r++)if(t[i.radioBox+r]){n=r===this._justificationList.length-1?t[i.textJustification]:this._justificationList[r];break}this._callback(e,this._selectedPolicyId,n)},c.reactJustificationDialogHandler=function(e,t){var n="";1===e&&this._reactJustification&&(n=this._reactJustification),this._callback(e,this._selectedPolicyId,n)},c.onJustificationUpdated=function(e){this._reactJustification=e;var t=this.validate();this._reactActionButtonEnabled!==t&&(this._reactActionButtonEnabled=t,this.updateDialog(CommonUIStrings.l_SensitivityJustificationTitle,Object(r.d)(this,this.reactJustificationDialogHandler,"reactJustificationDialogHandler"),this.getReactDialogProps(this._reactActionButtonEnabled)))},c.getReactDialogProps=function(e){var t,n,i,a;return(a={}).id=this.dialogId,a.bodyControls=((n={}).choiceGroupProps={},n.textAreaProps=((t={}).placeholder=CommonUIStrings.l_SensitivityJustificationPlaceholder,t),n),a.actionButtonProps=((i={}).label=CommonUIStrings.l_DialogChange,i.disabled=!e,i),a.infoMessage=CommonUIStrings.l_SensitivityJustificationMessage,a.justificationIrrelevantLabel=CommonUIStrings.l_SensitivityJustificationNoLongerApplies,a.justificationIncorrectLabel=CommonUIStrings.l_SensitivityJustificationIncorrect,a.justificationOtherLabel=CommonUIStrings.l_SensitivityJustificationOther,a.onJustificationUpdated=Object(r.d)(this,this.onJustificationUpdated,"onJustificationUpdated"),a},c.textAreaHandler=function(e){e.target&&this.setButtonState(1,this.validate())},c.buildDialogHtml=function(){return hi.a.formatHtml(i.justificationDialogHtmlTemplate,s.AFrameworkApplication.imageClusterPath,sr.getImageClass(i.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this._justificationList[0],this._justificationList[1],this._justificationList[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)},c.registerFocusForRadioButtons=function(){for(var e=document.getElementsByName(i.listRadioBox),t=0;t<e.length;t++)Ee.a.addHandler(e[t],f.EventNames.focus,Object(r.d)(this,this.radioButtonFocusHandler,"radioButtonFocusHandler")),Ee.a.addHandler(e[t],f.EventNames.click,Object(r.d)(this,this.radioButtonFocusHandler,"radioButtonFocusHandler"))},c.radioButtonFocusHandler=function(e){var t=e.target;if(t){t.checked=!0;var n=$get(i.textJustification);t.id===i.radioBox+(this._justificationList.length-1)?(n.disabled=!1,Sys.UI.DomElement.setVisible(n,!0),n.focus()):(n.disabled=!0,t.focus()),this.setButtonState(1,this.validate())}},a=i,l=[{key:"useReactDialog",get:function(){return s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactJustificationDialogEnabled}}],(o=null)&&ks(a.prototype,o),l&&ks(a,l),i}(hi.a);Fs.justificationDialogHtmlTemplate=Is.justificationDialogHtmlTemplate,Fs.listRadioBox="ListRadioBox",Fs.radioBox="radiobox",Fs.textJustification="txtJustification",Fs.iconName="Info_32x32x32",Fs.id="JustificationDialog",Object(i.a)(Fs,"JustificationDialog",hi.a,[]);var Es=function(){};Es.statusBarProtectedImageClass="sbProtectForm14",Es.statusBarUnprotectedImageClass="SBStatusBarMarkAsReadOnly14",Es.learnMoreImageClass="Info_16x16x32",Es.checkMarkImageClass="QuickSearchCompletedToday_16x16x32",Es.reactCheckMarkImageClass="CommonControlCheckboxCheck_16",Es.toggleButtonOn="On",Es.visible="Visible",Es.flyoutAnchorImageIsVisible="ImageIsVisible",Es.sourceControlId="SourceControlId",Es.menuItemId="MenuItemId",Es.menu="Menu",Es.appLockId="AppLockId",Es.value="Value",Es.labelText="LabelText",Es.alt="Alt",Es.image16by16="Image16by16",Es.image16by16Class="Image16by16Class",Es.statusBarProtectedIconName="SBProtectForm_16",Es.statusBarUnprotectedIconName="SBStatusBarMarkAsReadOnly_16",Es.icon="Icon",Es.customTooltip="CustomTooltip",Object(i.a)(Es,"PolicyConstants",null,[]);var Os=n(310),Ps=n(118),Ds=n(80),Ms=n(241),Ls=n(306),Rs=n(221),Us=n(153);function Hs(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Bs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Bs(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Bs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function xs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ns,js=function(){function e(e,t,n,i){this._labelTitle=null,this._labelDescription=null,this._defaultLabelSetAttempted=!1,this._isStandardLabelApplied=!1,this._isWaitingForFileExistsOnHost=!1,this._labelsData=null,this._parentToChild=null,this._idToSensitivityLabel=null,this._justification=null,this._autoPolicyLabelData=null,this._recommendedPolicyLabelData=null,this._currentRecommendedPolicyLabelId=null,this._currentAutoPolicyLabelId=null,this._awaitFileExistsOnHostRetryCount=0,this._blockSetSensitivityCall=null,this._isThisANewFile=null,this._fileExistsOnHost=null,this._actionManager=e,this._activeFrame=t,this._appSettingsManager=n,this._policyManager=i,this._menuItemToPolicyId={},this._policyIdToMenuItem={},this.isApplyManualPolicyLabelEnabled=n.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled"),this._clpKpiIsEnabled=n.getBooleanAppSetting("ClpKpiIsEnabled"),this._menuUniqueIdIsEnabled=n.getBooleanAppSetting("ClpMenuUniqueIdIsEnabled"),this._policyManager.value.add_setPolicyLabelHandler(Object(r.d)(this,this.processAutoSensitivityLabel,"processAutoSensitivityLabel")),this._policyManager.value.add_setPolicyLabelFailureHandler(Object(r.d)(this,this.processAutoSensitivityLabel,"processAutoSensitivityLabel")),this._policyManager.value.add_labelInfoUpdateHandler(Object(r.d)(this,this.onUpdateLabelInfo,"onUpdateLabelInfo")),n.getBooleanAppSetting("SupportsPolicies")&&n.getStringAppSetting("AppliedPolicyId")&&(this._labelTitle=n.getStringAppSetting("IrmPolicyTitle"),this._labelDescription=n.getStringAppSetting("IrmPolicyDescription")),this._protectedFile=n.getBooleanAppSetting("ProtectedFile"),this._awaitFileExistsOnHostMaxRetryCount=this._appSettingsManager.getIntAppSetting("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6),this._awaitFileExistsOnHostRetryDelayMs=this._appSettingsManager.getIntAppSetting("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5e3)}var t,n,i,a=e.prototype;return a.registerActions=function(){this._actionManager.addAction(p.a.openDocumentLabelPane,de.a.frame,Object(r.d)(this,this.documentLabelPaneHandler,"documentLabelPaneHandler")),this._actionManager.addAction(p.a.queryPolicyLabel,de.a.frame,Object(r.d)(this,this.queryPolicyLabel,"queryPolicyLabel")),this._actionManager.addAction(p.a.toggleSensitivity,de.a.frame,Object(r.d)(this,this.toggleSensitivity,"toggleSensitivity")),this._actionManager.addAction(p.a.populateSensitivityFlyout,de.a.frame,Object(r.d)(this,this.populateSensitivityFlyout,"populateSensitivityFlyout")),this._actionManager.addAction(p.a.setSensitivity,de.a.frame,Object(r.d)(this,this.setSensitivity,"setSensitivity")),this._actionManager.addAction(p.a.querySensitivity,de.a.frame,Object(r.d)(this,this.querySensitivity,"querySensitivity")),this._actionManager.addAction(p.a.querySensitivityToggleButton,de.a.frame,Object(r.d)(this,this.querySensitivityToggleButton,"querySensitivityToggleButton")),this._actionManager.addAction(p.a.querySensitivitySubFlyout,de.a.frame,Object(r.d)(this,this.querySensitivitySubFlyout,"querySensitivitySubFlyout")),this.actionHasFlags(p.a.toggleSensitivity)||this._actionManager.setActionFlags(p.a.toggleSensitivity,4),this.actionHasFlags(p.a.populateSensitivityFlyout)||this._actionManager.setActionFlags(p.a.populateSensitivityFlyout,4),this.actionHasFlags(p.a.setSensitivity)||this._actionManager.setActionFlags(p.a.setSensitivity,4),this.actionHasFlags(p.a.querySensitivity)||this._actionManager.setActionFlags(p.a.querySensitivity,4),this.actionHasFlags(p.a.querySensitivityToggleButton)||this._actionManager.setActionFlags(p.a.querySensitivityToggleButton,4),this.actionHasFlags(p.a.querySensitivitySubFlyout)||this._actionManager.setActionFlags(p.a.querySensitivitySubFlyout,4),this._activeFrame.updateCommandUI()},a.unregisterActions=function(){this._actionManager.removeAction(p.a.openDocumentLabelPane,de.a.frame,Object(r.d)(this,this.documentLabelPaneHandler,"documentLabelPaneHandler")),this._actionManager.removeAction(p.a.queryPolicyLabel,de.a.frame,Object(r.d)(this,this.queryPolicyLabel,"queryPolicyLabel")),this._actionManager.removeAction(p.a.toggleSensitivity,de.a.frame,Object(r.d)(this,this.toggleSensitivity,"toggleSensitivity")),this._actionManager.removeAction(p.a.populateSensitivityFlyout,de.a.frame,Object(r.d)(this,this.populateSensitivityFlyout,"populateSensitivityFlyout")),this._actionManager.removeAction(p.a.setSensitivity,de.a.frame,Object(r.d)(this,this.setSensitivity,"setSensitivity")),this._actionManager.removeAction(p.a.querySensitivity,de.a.frame,Object(r.d)(this,this.querySensitivity,"querySensitivity")),this._actionManager.removeAction(p.a.querySensitivityToggleButton,de.a.frame,Object(r.d)(this,this.querySensitivityToggleButton,"querySensitivityToggleButton")),this._actionManager.removeAction(p.a.querySensitivitySubFlyout,de.a.frame,Object(r.d)(this,this.querySensitivitySubFlyout,"querySensitivitySubFlyout"))},a.toggleSensitivity=function(e,t,n,i,r){return 32},a.populateSensitivityFlyout=function(e,t,n,i,r){if(1===n||!this._policyManager.value.areLabelsAvailableForDisplay())return 32;var a=r;return a.MenuItems=Object.assign(new Ls.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0}),Array.add(a.MenuItems.MenuSectionList,this.createMenuSection(!this.isReactRibbonEnabled())),this._labelsData.CustomUrl&&Array.add(a.MenuItems.MenuSectionList,this.createLearnMoreButton(this.isReactRibbonEnabled()?this._labelsData.CustomUrl:We.a.xmlEncode(this._labelsData.CustomUrl))),this.isReactRibbonEnabled()||(a.PopulationXML=Ds.k(a.MenuItems)),32},a.querySensitivity=function(e,t,n,i,r){if(1===n||!r||!this.isApplyManualPolicyLabelEnabled)return 32;(this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._policyManager.value.areLabelsAvailableForDisplay())&&(r[Es.visible]=!0,c.a("MipLabelsAvailable"));return 32},a.querySensitivityToggleButton=function(e,t,n,i,r){if(1===n||!r)return 32;var a,o,s=r;return s[Es.toggleButtonOn]=!!(a=s[Es.menuItemId])&&!!(o=this._menuItemToPolicyId[a])&&o===this._labelsData.AppliedPolicyId,32},a.querySensitivitySubFlyout=function(e,t,n,i,r){if(1===n||!r)return 32;var a,o,s,l=r,c=!!(a=l[Es.sourceControlId])&&!!(o=this._menuItemToPolicyId[a])&&!!(s=this._parentToChild[o])&&s.contains(this._labelsData.AppliedPolicyId);return l[Es.flyoutAnchorImageIsVisible]=c,l[Es.toggleButtonOn]=c,32},a.setSensitivity=function(e,t,n,i,r){if(1===n||!r)return 32;var a=r,o=a[Es.sourceControlId],s=this._menuItemToPolicyId[o];return this.setSensitivityByPolicyId(s,a,2)},a.awaitFileExistsOnHostEnabled=function(){return this._appSettingsManager.getBooleanAppSetting("CoAuthForProtectedFilesEnabled")&&this._appSettingsManager.getBooleanAppSetting("SupportsOfficeClientCoauthoring")&&this._appSettingsManager.getBooleanAppSetting("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this._fileExistsOnHost&&this.isNewFile},a.setSensitivityByPolicyId=function(e,t,n){var i=this;this._clpKpiIsEnabled&&this._policyManager.value.raiseSetPolicyLabelTriggeredEvent(n);var r=2===n||8===n;if(this._blockSetSensitivityCall&&this._blockSetSensitivityCall(e,r))h.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",n),this._activeFrame.updateCommandUI();else if(t&&Es.appLockId in t&&this._policyManager.value.setLockId(t[Es.appLockId]),e)if(this._policyManager.value.isSetPolicyLabelRequestInProgress()||this.awaitFileExistsOnHostEnabled()&&this._isWaitingForFileExistsOnHost)h.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",n),this._activeFrame.updateCommandUI(),r&&this.alertSetPolicyLabelFailed(n,e,!0,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this._policyManager.value.canSetPolicyLabelInCoauthSession(e))if(r&&this._appSettingsManager.getBooleanAppSetting("WacLabelingJustificationDialogIsEnabled")&&this._labelsData.RequiredDowngradeJustification&&(e===this._labelsData.AppliedPolicyId||this._idToSensitivityLabel[e].RequiredDowngradeJustification)&&!this._justification)this.showJustificationDialog(e);else{if(!this.awaitFileExistsOnHostEnabled()||this._fileExistsOnHost())return this.setPolicyLabel(e===this._labelsData.AppliedPolicyId?"":e,this._justification,n),32;this._awaitFileExistsOnHostRetryCount<this._awaitFileExistsOnHostMaxRetryCount?(h.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this._awaitFileExistsOnHostRetryCount,n),this._isWaitingForFileExistsOnHost=!0,this._awaitFileExistsOnHostRetryCount++,dt.Task.delay(this._awaitFileExistsOnHostRetryDelayMs).CW((function(r){i._isWaitingForFileExistsOnHost=!1,i.setSensitivityByPolicyId(e,t,n)}))):(h.ULS.sendTraceTag(577356771,306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",n),1!==n&&this.alertSetPolicyLabelFailed(n))}else h.ULS.sendTraceTag(42796169,306,15,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",n),this._activeFrame.updateCommandUI(),r&&this.alertSetPolicyLabelFailed(n,e,!0,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else h.ULS.sendTraceTag(42796167,306,50,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",n),this._activeFrame.updateCommandUI(),r&&this.alertSetPolicyLabelFailed(n);return this._policyManager.value.raiseSetPolicyLabelFailureEvent(0,n,!1),32},a.applyAutoPolicyLabel=function(t,n,i,r){void 0===i&&(i=null),void 0===r&&(r=!1),this._clpKpiIsEnabled||l.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null),this._appSettingsManager.getBooleanAppSetting("SupportsOfficeClientCoauthoring")&&this._appSettingsManager.getBooleanAppSetting("CoAuthForProtectedFilesIsEnabled")?(this._isStandardLabelApplied=!1,this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._labelsData&&!this._labelsData.AppliedPolicyId?this._isStandardLabelApplied=!0:this._labelsData&&this._labelsData.PolicyLabelAssignmentMethod&&(this._isStandardLabelApplied=Us.c(this._labelsData.PolicyLabelAssignmentMethod)===Us.c("standard"))):this._isStandardLabelApplied=r;var a=e.isNullOrEmpty(t)?null:this._idToSensitivityLabel[t],o=e.isNullOrEmpty(n)?null:this._idToSensitivityLabel[n];return o?this._recommendedPolicyLabelData=new Cs(o,!0,i):(this._policyManager.value.removeAutoPolicyBusinessBarEntry(29),this._currentRecommendedPolicyLabelId=null),a?this._autoPolicyLabelData=new Cs(a,!1):this._currentAutoPolicyLabelId=null,this.processAutoSensitivityLabel(null,null),32},a.setIdToSensitivityDictionary=function(){if(this._idToSensitivityLabel={},this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._labelsData)for(var e,t=Hs(this._labelsData.SensitivityLabels);!(e=t()).done;){var n=e.value;this._idToSensitivityLabel[n.Id]=n}},a.setParentToChildSensitivityLabelsDictionary=function(){if(this._parentToChild={},this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._labelsData){for(var e,t=Hs(this._labelsData.SensitivityLabels);!(e=t()).done;){var n=e.value;n.ParentId||(this._parentToChild[n.Id]=new te.a)}for(var i,r=Hs(this._labelsData.SensitivityLabels);!(i=r()).done;){var a=i.value;if(a.ParentId&&a.ParentId in this._parentToChild)this._parentToChild[a.ParentId].add(a.Id)}}},a.querySensitivityControl=function(){this.isApplyManualPolicyLabelEnabled&&this.isReactRibbonEnabled()&&(this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._policyManager.value.areLabelsAvailableForDisplay()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1)))},a.registerBlockSetSensitivityCall=function(e){this._blockSetSensitivityCall=e},a.registerIsANewFile=function(e){this._isThisANewFile=e},a.registerFileExistsOnHost=function(e){this._fileExistsOnHost=e},a.setDefaultLabelIfNeeded=function(){this._appSettingsManager.getBooleanAppSetting("WacApplyDefaultPolicyLabelIsEnabled")&&(this._defaultLabelSetAttempted||(this._defaultLabelSetAttempted=!0,this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._labelsData&&this._labelsData.DefaultLabelId&&!this._labelsData.AppliedPolicyId&&(h.ULS.sendTraceTag(593774211,306,50,"Default label configured, checking if this is a new file"),this.isNewFile&&(h.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this._labelsData.DefaultLabelId),this.setSensitivityByPolicyId(this._labelsData.DefaultLabelId,null,1)))))},a.processAutoSensitivityLabel=function(e,t){var n=this;if(!this._policyManager.value.isSetPolicyLabelRequestInProgress()){var i=this._idToSensitivityLabel[this._policyManager.value.getPolicyLabelsData().AppliedPolicyId];if(this._isStandardLabelApplied&&this._autoPolicyLabelData&&this._currentAutoPolicyLabelId!==this._autoPolicyLabelData.id&&(!i||i.Order<this._autoPolicyLabelData.sensitivityLabel.Order)){var r=this.setSensitivityByPolicyId(this._autoPolicyLabelData.id,{},4);if(32!==r)h.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+r);else if(this._currentAutoPolicyLabelId=this._autoPolicyLabelData.id,this._currentRecommendedPolicyLabelId){var a=this._idToSensitivityLabel[this._currentRecommendedPolicyLabelId];a&&a.Order<=this._autoPolicyLabelData.sensitivityLabel.Order&&(this._policyManager.value.removeAutoPolicyBusinessBarEntry(29),this._currentRecommendedPolicyLabelId=null)}}if(i=this._idToSensitivityLabel[this._policyManager.value.getPolicyLabelsData().AppliedPolicyId],this._recommendedPolicyLabelData&&this._currentRecommendedPolicyLabelId!==this._recommendedPolicyLabelData.id&&(!i||i.Order<this._recommendedPolicyLabelData.sensitivityLabel.Order)){var o=this._recommendedPolicyLabelData.id;this._policyManager.value.removeAutoPolicyBusinessBarEntry(29),this._policyManager.value.addAutoPolicyBusinessBarEntry(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.getParentChildSensitivityLabelText(this._recommendedPolicyLabelData.sensitivityLabel))+" "+this._recommendedPolicyLabelData.recommendationText,CommonUIStrings.l_PolicyLabelRecommendationButton,(function(e){n.setSensitivityByPolicyId(o,{},8)})),this._currentRecommendedPolicyLabelId=this._recommendedPolicyLabelData.id}this._autoPolicyLabelData=null,this._recommendedPolicyLabelData=null}},a.createAutoPolicyBusinessBarEntry=function(e,t,n,i){var r=new rs.a(e,t,null);return r.id=28,r.closeable=!0,r.image=3,r.addButton(n,i,n,!0),r},a.setPolicyLabel=function(e,t,n){void 0===n&&(n=2),this._justification=t,this._policyManager.value.setPolicyLabel(e),this._activeFrame.updateCommandUI();var i=this._idToSensitivityLabel[e],r=new Ts(n,this.getParentChildSensitivityLabelText(i));this._policyManager.value.setPolicyLabelRequestAsync(e,this._justification,r)},a.continueToSetPolicyLabel=function(e,t,n){1===e?this.setPolicyLabel(t===this._labelsData.AppliedPolicyId?"":t,n):this._activeFrame.updateCommandUI()},a.showJustificationDialog=function(e){new Fs(e,Object(r.d)(this,this.continueToSetPolicyLabel,"continueToSetPolicyLabel")).showJustificationDialog()},a.alertSetPolicyLabelFailed=function(e,t,n,i){if(void 0===t&&(t=""),void 0===n&&(n=!1),void 0===i&&(i=""),n){var r=new Pn.StandardDialog;r.hasCloseGlyph=s.AFrameworkApplication.isCloseable,r.buttonsOption=0,r.setButtonText(1,CommonUIStrings.l_DialogClose),r.showWarning(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,i,null)}this._policyManager.value.raiseSetPolicyLabelFailureEvent(0,e,!n)},a.isReactRibbonEnabled=function(){return!!this._activeFrame&&!!this._activeFrame.applicationInstance&&this._activeFrame.applicationInstance.isReactRibbonEnvironmentEnabled},a.isReactStatusBarEnabled=function(){return!(!this._activeFrame||!this._activeFrame.applicationInstance)&&this._activeFrame.applicationInstance.isReactStatusBarEnabled},a.documentLabelPaneHandler=function(e,t,n,i,r){return 32},a.queryPolicyLabel=function(e,t,n,i,r){if(1===n)return 32;if(this._labelsData=this._policyManager.value.getPolicyLabelsData(),!this._labelsData||!r)return 32;var a=r;if(a[Es.value]=null,a[Es.labelText]=null,a[Es.alt]=null,a[Es.image16by16]=null,a[Es.image16by16Class]=null,a[Es.visible]=!1,this._labelsData.AreLabelsAvailable){if(this._labelsData.AppliedPolicyId){for(var o,l=null,c=Hs(this._labelsData.SensitivityLabels);!(o=c()).done;){var u=o.value;if(u.Id.toLowerCase()===this._labelsData.AppliedPolicyId.toLowerCase()){l=u;break}}l&&(a[Es.value]=a[Es.labelText]=this.getParentChildSensitivityLabelText(l),this.isReactStatusBarEnabled()?a[Es.customTooltip]=l.Tooltip:a[Es.alt]=l.Tooltip,this._protectedFile=s.AFrameworkApplication.protectedFile=l.IsEndpointProtectionEnabled)}}else{if(!this._labelTitle)return 32;a[Es.value]=a[Es.labelText]=this._labelTitle,this._labelDescription&&(this.isReactStatusBarEnabled()?a[Es.customTooltip]=this._labelDescription:a[Es.alt]=this._labelDescription)}return a[Es.value]&&this.setLabelImage(this._protectedFile,a),32},a.getParentChildSensitivityLabelText=function(e){return e?this._idToSensitivityLabel?e.ParentId&&this._idToSensitivityLabel[e.ParentId]?this._idToSensitivityLabel[e.ParentId].DisplayName+"\\"+e.DisplayName:e.DisplayName:(h.ULS.sendTraceTag(4282e4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),e.DisplayName):""},a.setLabelImage=function(e,t){t[Es.image16by16]=s.AFrameworkApplication.imageClusterPath,t[Es.image16by16Class]=e?sr.getImageClass(Es.statusBarProtectedImageClass):sr.getImageClass(Es.statusBarUnprotectedImageClass),this.isReactStatusBarEnabled()&&(t[Es.icon]=e?Es.statusBarProtectedIconName:Es.statusBarUnprotectedIconName),t[Es.visible]=!0},a.createLearnMoreButton=function(e){var t=this.createMenuSectionProps("LearnMoreSection",!0),n="SensitivityLearnMore",i=Object.assign(new Ps.a,{Id:n,ExternalId:n,MenuItemId:e,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:s.AFrameworkApplication.imageClusterPath,Image16by16Class:sr.getImageClass(Es.learnMoreImageClass),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});return Array.add(t.ControlList,i),t},a.createCheckMarkToggleButtonProps=function(e,t,n,i,r,a,o,l){void 0===o&&(o=""),void 0===l&&(l=!1);var c="Toggle_"+o+"_"+t;this._menuUniqueIdIsEnabled&&(c="Sensitivity_"+c);var u=l?We.a.xmlEncode(c):c,d=Object.assign(new Os.a,{Id:u,ExternalId:u,LabelText:l?We.a.xmlEncode(n):n,Command:"2935633379",MenuItemId:u,QueryCommand:"991261903",CheckedImage:s.AFrameworkApplication.imageClusterPath,Visible:!0,Alt:l?We.a.xmlEncode(i):i,IsChecked:r,AriaLabel:Ji.a.ariaMenuItemRadioRole,KeyTip:a});return this.isReactRibbonEnabled()?(d.CheckedImageClass=sr.getImageClass(Es.reactCheckMarkImageClass),d.ExternalImageId=Es.reactCheckMarkImageClass):d.CheckedImageClass=sr.getImageClass(Es.checkMarkImageClass),u=c,this._menuItemToPolicyId[u]=e,this._policyIdToMenuItem[e]=u,d},a.createMenuSectionProps=function(e,t){return void 0===t&&(t=!1),Object.assign(new Rs.a,{Title:"",Id:e,DisplayMode:Es.menu,ShowMenuSectionSeparator:t,ControlsId:"Ctrl_"+e,ControlList:[]})},a.createSubMenuSection=function(e,t,n){for(var i,r=this.createMenuSectionProps(e+"Sub"),a=1,o=Hs(t);!(i=o()).done;){var s=i.value,l=this._idToSensitivityLabel[s];l&&l.Enabled&&(Array.add(r.ControlList,this.createCheckMarkToggleButtonProps(l.Id,l.Name,l.DisplayName,l.Tooltip,l.Id===this._labelsData.AppliedPolicyId,a.toString(),e,n)),a++)}return r},a.createMenuSection=function(e){void 0===e&&(e=!1);var t=this.createMenuSectionProps("SensitivitySection"),n=1,i=this._parentToChild;for(var r in i){var a={key:r,value:i[r]},o=a.value,l=this._idToSensitivityLabel[a.key];if(l&&l.Enabled){if(o.get_count()){var c=this._menuUniqueIdIsEnabled?"Sensitivity_"+l.Name:l.Name,u=e?We.a.xmlEncode(c):c,d=Object.assign(new Ms.a,{Id:u,ExternalId:u,LabelText:e?We.a.xmlEncode(l.DisplayName):l.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new Ls.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:Ji.a.ariaMenuItemRadioRole,KeyTip:n.toString()});this.isReactRibbonEnabled()?d.ExternalImageId=Es.reactCheckMarkImageClass:(d.Image16by16=s.AFrameworkApplication.imageClusterPath,d.Image16by16Class=sr.getImageClass(Es.checkMarkImageClass)),Array.add(d.Menu.MenuSectionList,this.createSubMenuSection(c,o,e)),Array.add(t.ControlList,d),this._menuItemToPolicyId[d.Id]=l.Id,this._policyIdToMenuItem[l.Id]=d.Id}else Array.add(t.ControlList,this.createCheckMarkToggleButtonProps(l.Id,l.Name,l.DisplayName,l.Tooltip,l.Id===this._labelsData.AppliedPolicyId,n.toString(),void 0,e));n++}}return t},a.actionHasFlags=function(e){return!!this._actionManager.getActionMetadata(e)&&!!this._actionManager.getActionMetadata(e).flags&&!!this._actionManager.getActionMetadata(e).flags.length},a.onUpdateLabelInfo=function(e,t){if(t.onSuccess&&this._idToSensitivityLabel){var n=this._idToSensitivityLabel[this._policyManager.value.getPolicyLabelsData().AppliedPolicyId];if(n){if(this._currentRecommendedPolicyLabelId){var i=this._idToSensitivityLabel[this._currentRecommendedPolicyLabelId];i&&i.Order<=n.Order&&(this._policyManager.value.removeAutoPolicyBusinessBarEntry(29),this._currentRecommendedPolicyLabelId=null)}this._currentAutoPolicyLabelId&&this._currentAutoPolicyLabelId!==n.Id&&(this._policyManager.value.removeAutoPolicyBusinessBarEntry(28),this._currentAutoPolicyLabelId=null)}}},e.isNullOrEmpty=function(e){return!e||!e.length},t=e,(n=[{key:"isNewFile",get:function(){return s.AFrameworkApplication.isNewFile||!!this._isThisANewFile&&this._isThisANewFile()}}])&&xs(t.prototype,n),i&&xs(t,i),e}();Object(i.a)(js,"PolicyActor",null,[98]),function(e){e[e.unknown=0]="unknown",e[e.boot=1]="boot",e[e.refresh=2]="refresh",e[e.selfSetPolicyLabel=3]="selfSetPolicyLabel"}(Ns||(Ns={})),Object(i.b)("GetPolicyLabelsReason",Ns);var Ws,Vs=function(e){var t,n;function i(t,n,i,r,a,o){var s;return(s=e.call(this)||this).businessBarId=t,s.title=n,s.message=i,s.buttonText=r,s.businessBarEntryHandler=a,s.isRecommended=o,s}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(Sys.EventArgs);Object(i.a)(Vs,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]),function(e){e[e.none=0]="none",e[e.reasonDefaultLabel=1]="reasonDefaultLabel",e[e.reasonManual=2]="reasonManual",e[e.reasonAutomatic=4]="reasonAutomatic",e[e.reasonRecommended=8]="reasonRecommended",e[e.reasonMandatory=16]="reasonMandatory"}(Ws||(Ws={})),Object(i.b)("ApplyLabelFlags",Ws);var qs=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).getPolicyLabelsReason=t,n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(Sys.EventArgs);Object(i.a)(qs,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);var Gs=function(){this.AreLabelsAvailable=!1,this.AppliedPolicyId=null,this.RequiredDowngradeJustification=!1,this.MandatoryLabelingEnforced=!1,this.DefaultLabelId=null,this.CustomUrl=null,this.PolicyLabelAssignmentMethod=null,this.PolicyLabelVersionToken=null,this.SensitivityLabels=null,this.AreLabelsAvailable=!1,this.AppliedPolicyId="",this.RequiredDowngradeJustification=!1,this.DefaultLabelId="",this.PolicyLabelAssignmentMethod="",this.PolicyLabelVersionToken="",this.SensitivityLabels=new Array(0),this.MandatoryLabelingEnforced=!1};Object(i.a)(Gs,"GetPolicyLabelsData",null,[]);var Ks=function(e){var t,n;function i(t){var n;return void 0===t&&(t=!1),(n=e.call(this)||this).onSuccess=t,n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(Sys.EventArgs);Object(i.a)(Ks,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);var zs=function(e){var t,n;function i(t,n,i,r){var a;return(a=e.call(this)||this).title=t,a.policyText=n,a.buttonText=i,a.onButtonClickCallback=r,a}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(Sys.EventArgs);Object(i.a)(zs,"PolicyTipEventArgs",Sys.EventArgs,[]);var Js=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this).businessBarId=t,i.isRecommended=n,i}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(Sys.EventArgs);Object(i.a)(Js,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Xs=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this).policyLabelId=t,i.applyLabelFlag=n,i}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(Sys.EventArgs);Object(i.a)(Xs,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);var Qs=function(e){var t,n;function i(t,n,i){var r;return(r=e.call(this)||this).errorType=t,r.applyLabelFlags=n,r.showMessage=i,r}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(Sys.EventArgs);Object(i.a)(Qs,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);var Zs=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).applyLabelFlags=t,n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(Sys.EventArgs);Object(i.a)(Zs,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);var Ys=function(e,t,n,i,r,a,o,s,l,c,u,d,p,h,g,m,f,v,S,_){void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=!1),void 0===u&&(u=null),void 0===d&&(d=null),void 0===p&&(p=null),void 0===h&&(h=null),void 0===g&&(g=!1),void 0===m&&(m=null),void 0===f&&(f=null),void 0===v&&(v=null),void 0===S&&(S=null),void 0===_&&(_=null),this.url=e,this.verb=t,this.body=n,this.headers=i,this.shouldSetResponseXml=r,this.priority=a,this.state=o,this.watchName=s,this.requestorId=l,this.isSynchronous=c,this.queueTimeoutMs=u,this.sentTimeoutMs=d,this.name=p,this.overwriteSessionId=h,this.forceSynchronousNotify=g,this.overwriteVersion=m,this.extraInfo=f,this.invokedCallback=v,this.responseHeadersToSet=S,this.hostAttributionInfo=_};Object(i.a)(Ys,"ClientRequest",null,[]);var $s=n(242),el=n(184),tl=n(46);function nl(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return il(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return il(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function il(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function rl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var al=function(){function e(e,t,n,i,r,o){void 0===i&&(i=0),void 0===r&&(r=null),void 0===o&&(o=0),this._editorsTableManager=null,this._dataLossNavigateUrl=null,this._getPolicyCalls=0,this._getLabelPolicyCalls=0,this._setPolicyLabelCalls=0,this._appliedPolicyId="",this._lockId=null,this._amITheOnlyCoauthor=null,this._areAllCoauthorsInSessionClientMipTrusted=null,this._labelChangedByCoauthorCallback=null,this._policyCallTimeStopwatch=null,this._getLabelPolicyCallTimeStopwatch=null,this._setLabelPolicyCallTimeStopwatch=null,this._policyParseAndHandleResponseStopwatch=null,this._eventSource=new a.a,this._rtc=null,this._isAutoPolicyLabelHandlerEventRaised=!1,this._appSettingsManager=e,this._clientRequestManager=t,this._stopwatchBuilder=n,this._maxPolicyRetries=i,this._policyLabelsData=new Gs,this._policyHandlerEndpointName=this._appSettingsManager.getStringAppSetting("PolicyHandlerEndpointName")||"PolicyHandler.ashx",this._applicationFeatureHelperFuture=r,this._officeAppType=o?this.officeAppTypeToString(o):this.officeAppTypeToString(s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType),this.isApplyManualPolicyLabelEnabled=e.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled"),this.isCoAuthForProtectedFilesEnabled=e.getBooleanAppSetting("CoAuthForProtectedFilesIsEnabled"),this.supportsOfficeClientCoauthoring=e.getBooleanAppSetting("SupportsOfficeClientCoauthoring"),this._clpKpiIsEnabled=e.getBooleanAppSetting("ClpKpiIsEnabled"),this.isSetPolicyLabelZeroByteFailureRetryEnabled=!1,this.setPolicyLabelZeroByteFailureRetryIntervalMs=3e4,this._taskManager=b.a.instance,e.getBooleanAppSetting("SupportsPolicies")&&c.a("MipSupportsPolicies"),this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&c.a("MipSupportsOfficeClientCoauthoring")}var t,n,i,o=e.prototype;return o.add_policyTipHandler=function(e){this._eventSource.addHandler("PolicyTipEvent",e)},o.remove_policyTipHandler=function(e){this._eventSource.removeHandler("PolicyTipEvent",e)},o.add_labelInfoUpdateHandler=function(e){this._eventSource.addHandler("LabelInfoUpdateEvent",e)},o.remove_labelInfoUpdateHandler=function(e){this._eventSource.removeHandler("LabelInfoUpdateEvent",e)},o.add_setPolicyLabelTriggeredHandler=function(e){this._eventSource.addHandler("SetPolicyLabelTriggeredEventKey",e)},o.remove_setPolicyLabelTriggeredHandler=function(e){this._eventSource.removeHandler("SetPolicyLabelTriggeredEventKey",e)},o.add_setPolicyLabelHandler=function(e){this._eventSource.addHandler("SetPolicyLabelEventKey",e)},o.remove_setPolicyLabelHandler=function(e){this._eventSource.removeHandler("SetPolicyLabelEventKey",e)},o.add_setPolicyLabelFailureHandler=function(e){this._eventSource.addHandler("SetPolicyLabelFailureEventKey",e)},o.remove_setPolicyLabelFailureHandler=function(e){this._eventSource.removeHandler("SetPolicyLabelFailureEventKey",e)},o.add_getPolicyLabelHandler=function(e){this._eventSource.addHandler("GetPolicyLabelEventKey",e)},o.remove_getPolicyLabelHandler=function(e){this._eventSource.removeHandler("GetPolicyLabelEventKey",e)},o.add_getAutoPolicyLabelHandler=function(e){this._eventSource.addHandler("GetAutoPolicyLabelEventKey",e),this.isAutoPolicyLabelHandlerEventRaised&&(h.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.raiseGetAutoPolicyLabelHandlerEvent(new qs(0)))},o.remove_getAutoPolicyLabelHandler=function(e){this._eventSource.removeHandler("GetAutoPolicyLabelEventKey",e)},o.add_addAutoPolicyBusinessBarEntryHandler=function(e){this._eventSource.addHandler("AddAutoPolicyBusinessBarEntryEventKey",e)},o.remove_addAutoPolicyBusinessBarEntryHandler=function(e){this._eventSource.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",e)},o.add_removeAutoPolicyBusinessBarEntryHandler=function(e){this._eventSource.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",e)},o.remove_removeAutoPolicyBusinessBarEntryHandler=function(e){this._eventSource.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",e)},o.initRtcBasicProvider=function(e){e&&this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&e.execute(Object(r.d)(this,this.awaitRtc,"awaitRtc"))},o.initEditorsTableManager=function(e){var t=this;e&&this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&e.CW((function(n){t._editorsTableManager=e.get_result()}))},o.registerAreAllCoauthorsInSessionClientMipTrustedCheck=function(e){this._areAllCoauthorsInSessionClientMipTrusted=e},o.registerLabelChangedByCoauthorCallback=function(e){this._labelChangedByCoauthorCallback=e},o.awaitRtc=function(e){var t=this;if(!this.isRtcInitialized){var n=e.getInstanceAsRealtimeChannelBasicAsync();n.CW((function(e){t._rtc=n.get_result(),t._rtc.add_updateNotificationReceived(Object(r.d)(t,t.onLabelChangeUpdateOverRtc,"onLabelChangeUpdateOverRtc"))}))}},o.onLabelChangeUpdateOverRtc=function(e,t){12===t.type&&(this._labelChangedByCoauthorCallback?this._labelChangedByCoauthorCallback():this.getDocumentPolicyLabelsRequestAsync(this._appliedPolicyId,2,this._amITheOnlyCoauthor,!0))},o.getDocumentPolicyRequestAsync=function(){this._stopwatchBuilder&&(this._policyCallTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","Call Get Policy Endpoint On Server"));var e=el.a.createForCurrentApp(1,1);if(this._appSettingsManager.getBooleanAppSetting("SendHostAttributionInfoForPolicyLabelEnabled")){var t=new Ys(this.getPolicyRequestUrl("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);this._clientRequestManager.send(t).registerCallbacks(Object(r.d)(this,this.onDataLossPolicySuccessCallback,"onDataLossPolicySuccessCallback"),Object(r.d)(this,this.onDataLossPolicyFailureCallback,"onDataLossPolicyFailureCallback"))}else this._clientRequestManager.addRequest(this.getPolicyRequestUrl("datalosspolicy"),1,null,null,!0,2,Object(r.d)(this,this.onDataLossPolicySuccessCallback,"onDataLossPolicySuccessCallback"),Object(r.d)(this,this.onDataLossPolicyFailureCallback,"onDataLossPolicyFailureCallback"),null);this._getPolicyCalls++,h.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this._policyHandlerEndpointName,this._getPolicyCalls)},o.getDocumentPolicyLabelsRequestAsync=function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=null),void 0===i&&(i=!1),this._clpKpiIsEnabled&&l.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.getExtendedPropertiesForLogging(void 0,t));var r=this.createHostAttributionInfoFromGetPolicyLabelsReason(t);this.getDocumentPolicyLabelsRequestInternalAsync(e,r,n,i,t)},o.getPolicyLabelsData=function(){return this._policyLabelsData},o.onDataLossPolicySuccessCallback=function(e){this.policyCallWatchStop();var t="";this.tryGetResponseData(e,Object(z.a)((function(){return t}),(function(e){return t=e})))&&(h.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this._getPolicyCalls=0,this._stopwatchBuilder&&(this._policyParseAndHandleResponseStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("Task","Parse and Handle Get Policy Response")),this.parseAndHandlePolicyResponse(t),this._policyParseAndHandleResponseStopwatch&&(this._policyParseAndHandleResponseStopwatch.stop(),this._policyParseAndHandleResponseStopwatch=null))},o.onDataLossPolicyFailureCallback=function(e){this.policyCallWatchStop(),this._getPolicyCalls<=this._maxPolicyRetries?this.getDocumentPolicyRequestAsync():(h.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",e&&e.data?e.data.responseXml:null),this._getPolicyCalls=0)},o.isSetPolicyLabelRequestInProgress=function(){return this._setPolicyLabelCalls>0},o.setPolicyLabel=function(e){this._policyLabelsData.AppliedPolicyId=e},o.setPolicyLabelRequestAsync=function(e,t,n){void 0===n&&(n=null);var i=this.createHostAttributionInfoFromRequestState(n);this.setPolicyLabelRequestInternalAsync(e,t,i,n)},o.onSetPolicyLabelSuccessCallback=function(e){var t,n;this._setLabelPolicyCallTimeStopwatch&&(this._setLabelPolicyCallTimeStopwatch.stop(),this._setLabelPolicyCallTimeStopwatch=null),this.getSetPolicyLabelDataFromHeader(e,Object(z.a)((function(){return t}),(function(e){return t=e})),Object(z.a)((function(){return n}),(function(e){return n=e})));var i=e.data.state,r=i?i.applyLabelFlag:2,a="";this.tryGetResponseData(e,Object(z.a)((function(){return a}),(function(e){return a=e})))?(h.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",r),this._setPolicyLabelCalls=0,this.parseSetPolicyLabelDataResponse(a,t,n,i)):this.revertAppliedPolicyId(r)},o.raiseSetPolicyLabelTriggeredEvent=function(e){this._clpKpiIsEnabled&&l.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.getExtendedPropertiesForLogging(e)),h.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event."),this._eventSource.raiseEvent("SetPolicyLabelTriggeredEventKey",new Zs(e))},o.notifyCoauthorsOfLabelChangeOverRtc=function(){this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&this.isRtcInitialized&&this._rtc.sendUpdateNotification(12,null,!0)},o.onSetPolicyLabelFailureCallback=function(e){var t,n;if(this._setLabelPolicyCallTimeStopwatch&&(this._setLabelPolicyCallTimeStopwatch.stop(),this._setLabelPolicyCallTimeStopwatch=null),this.getSetPolicyLabelDataFromHeader(e,Object(z.a)((function(){return t}),(function(e){return t=e})),Object(z.a)((function(){return n}),(function(e){return n=e}))),this._setPolicyLabelCalls<=this._maxPolicyRetries)this.setPolicyLabelRequestAsync(t,n);else{var i=e.data.state,r=i?i.applyLabelFlag:2;h.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",e&&e.data?e.data.responseXml:null,r),this._setPolicyLabelCalls=0,this.revertAppliedPolicyId(r)}},o.canSetPolicyLabelInCoauthSession=function(e){if(!e)return!1;for(var t,n=null,i=null,r=nl(this._policyLabelsData.SensitivityLabels);!(t=r()).done;){var a=t.value;a.Id===e&&(n=a),a.Id===this._appliedPolicyId&&(i=a)}if(!n)return!1;if(this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring){if(this._areAllCoauthorsInSessionClientMipTrusted&&this._areAllCoauthorsInSessionClientMipTrusted()||this.isEveryCoauthorInSessionClientMipTrusted)return!0}else if(s.AFrameworkApplication.coauthManager&&s.AFrameworkApplication.coauthManager.getAmIAlone||this._amITheOnlyCoauthor&&this._amITheOnlyCoauthor())return!0;return n.IsEndpointProtectionEnabled===(!!i&&i.IsEndpointProtectionEnabled)},o.addAutoPolicyBusinessBarEntry=function(e,t,n,i,r){28===e?this.raiseAddAutoPolicyBusinessBarEntryHandlerEvent(new Vs(e,t,n,i,r,!1)):this.raiseAddAutoPolicyBusinessBarEntryHandlerEvent(new Vs(e,t,n,i,r,!0))},o.removeAutoPolicyBusinessBarEntry=function(e){28===e?this.raiseRemoveAutoPolicyBusinessBarEntryHandlerEvent(new Js(e,!1)):this.raiseRemoveAutoPolicyBusinessBarEntryHandlerEvent(new Js(e,!0))},o.areLabelsAvailableForDisplay=function(){return!!this._policyLabelsData&&this._policyLabelsData.AreLabelsAvailable&&!!this._policyLabelsData.SensitivityLabels&&this._policyLabelsData.SensitivityLabels.length>0&&$s.a(this._policyLabelsData.SensitivityLabels,(function(e){return!!e&&e.Enabled}))},o.onGetPolicyLabelsSuccessCallback=function(e){this._getLabelPolicyCallTimeStopwatch&&(this._getLabelPolicyCallTimeStopwatch.stop(),this._getLabelPolicyCallTimeStopwatch=null);var t="";if(this.tryGetResponseData(e,Object(z.a)((function(){return t}),(function(e){return t=e})))){h.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this._getLabelPolicyCalls=0;var n=this.parseGetPolicyLabelDataResponse(t),i=this.getPolicyLabelsReasonFromRequestItem(e.data);this._clpKpiIsEnabled&&l.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.getAdditionalValuesForLogging(void 0,i));var r=new qs(i);this.raiseGetPolicyLabelHandlerEvent(r),!this.isAutoPolicyLabelHandlerEventRaised&&n&&this._appSettingsManager.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled")&&this.areAutoLabelingSensitiveTypesAvailable()&&(this.raiseGetAutoPolicyLabelHandlerEvent(r),this._isAutoPolicyLabelHandlerEventRaised=!0)}},o.onGetPolicyLabelsFailureCallback=function(e){var t=this.getPolicyLabelsReasonFromRequestItem(e.data);if(this._clpKpiIsEnabled&&l.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.getAdditionalValuesForLogging(void 0,t)),this._getLabelPolicyCallTimeStopwatch&&(this._getLabelPolicyCallTimeStopwatch.stop(),this._getLabelPolicyCallTimeStopwatch=null),this._getLabelPolicyCalls<=this._maxPolicyRetries){if(this._appSettingsManager.getBooleanAppSetting("SendHostAttributionInfoForPolicyLabelEnabled")){var n=e.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in n&&n[el.a.scenarioParamName]&&"HostAttributionInfo.ScenarioTypeParamName"in n&&n[el.a.scenarioTypeParamName]){e.data.request.get_headers()[el.a.scenarioParamName],e.data.request.get_headers()[el.a.scenarioTypeParamName];var i=this.createHostAttributionInfoFromGetPolicyLabelsReason(t);return void this.getDocumentPolicyLabelsRequestInternalAsync(this._appliedPolicyId,i,this._amITheOnlyCoauthor,void 0,t)}}this.getDocumentPolicyLabelsRequestAsync(this._appliedPolicyId,t,this._amITheOnlyCoauthor)}else h.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",e&&e.data?e.data.responseXml:null),this._getLabelPolicyCalls=0},o.getPolicyLabelsReasonFromRequestItem=function(e){return e.state?e.state:0},o.getPolicyRequestUrl=function(e,t){void 0===t&&(t=!1);var n=this._appSettingsManager.getStringAppSetting("PolicyHandlerWebServiceBase")||s.AFrameworkApplication.activeFrame.applicationInstance.newAndOpenHandlerUrlPrefix,i=String.format("{0}{1}?action={2}&{3}",n,this._policyHandlerEndpointName,e,s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion);return"setpolicylabel"===e&&s.AFrameworkApplication.coauthManager&&s.AFrameworkApplication.coauthManager.isFileCoauthorable&&(i=Dt.a.addOrReplaceParameterValue(i,"sl","1")),t&&(i=Dt.a.addOrReplaceParameterValue(i,"cbd","1")),i},o.getSetPolicyLabelDataFromHeader=function(e,t,n){t.val=n.val=null,e&&e.data&&e.data.request&&e.data.request.get_headers()&&(t.val=e.data.request.get_headers()[Ra.a.selectedPolicyLabelIdHeaderName],n.val=e.data.request.get_headers()[Ra.a.setPolicyLabelJustificationHeaderName])},o.tryGetResponseData=function(e,t){return t.val=e&&e.data?e.data.responseData:null,!(!t.val||!t.val.length||this.isServiceUnavailableResponse(t.val))||(h.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),!1)},o.parseAndHandlePolicyResponse=function(e){var t;try{t=L.b(e)}catch(e){return void h.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.")}if(t)if(t.IsPolicyTipAvailable)switch(t.IsPolicyTipAvailable.toLowerCase()){case"false":return void h.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");case"true":h.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document."),this._dataLossNavigateUrl=t.NavigateUrl,this.showPolicyTip(t.GeneralText,Object(r.d)(this,this.onDataLossPolicyOverrideButtonClick,"onDataLossPolicyOverrideButtonClick"));break;default:h.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",t.IsPolicyTipAvailable)}else h.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else h.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")},o.parseSetPolicyLabelDataResponse=function(e,t,n,i){var r,a=this,o=i?i.applyLabelFlag:2,d=0,p="",g="";if(L.d(e,Object(z.a)((function(){return r}),(function(e){return r=e}))))if(r){g="Success";var m=this.createHostAttributionInfoFromGetPolicyLabelsReason(3);if(r.IsSuccessful)return this._clpKpiIsEnabled&&l.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.getAdditionalValuesForLogging(o)),h.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",o),2===o&&this.removeAutoPolicyBusinessBarEntry(29),this.setSelectedPolicyId(t,o),this.notifyCoauthorsOfLabelChangeOverRtc(),this.removeAutoPolicyBusinessBarEntry(28),i&&4===o&&this.addAutoPolicyBusinessBarEntry(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,i.displayName),CommonUIStrings.l_DialogOk,(function(e){})),c.a("MipAppliedLabels",void 0,void 0,[Object.assign(new tl.a,{name:"SetPolicyLabelApplyFlag",string:Ws[o]})]),void this.getDocumentPolicyLabelsRequestInternalAsync(t,m,this._amITheOnlyCoauthor,void 0,3);if(h.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",o,r.FailureReason),(p=r.FailureReason).indexOf("FileTooLarge")>=0&&(r.FailureReason.indexOf("FileTooLarge")>=0?d=1:s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WacClpLabelNotSupportedBusBar")&&r.FailureReason.indexOf("LabelNotSupported")>=0&&(d=2)),this.isSetPolicyLabelZeroByteFailureRetryEnabled&&r.FailureReason.indexOf("InvalidOperationOnZeroByteFile")>=0){var f=new u.a(2,1,this.setPolicyLabelZeroByteFailureRetryIntervalMs,(function(e){h.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",a._setPolicyLabelCalls),a._setPolicyLabelCalls<=a._maxPolicyRetries&&a.setPolicyLabelRequestAsync(t,n)}));this._taskManager.addTask(f)}this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&this.getDocumentPolicyLabelsRequestInternalAsync(this._policyLabelsData.AppliedPolicyId,m,this._amITheOnlyCoauthor,!0,3)}else g="setPolicyLabelData null.",h.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",o);else g="TryDeserialize failed.",h.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",o);if(this.revertAppliedPolicyId(o,d),this._clpKpiIsEnabled){var v=this.getAdditionalValuesForLogging(o);v.extendedProperties.set("SetPolicyLabelDataFailureReason",p.toString()),v.extendedProperties.set("SetPolicyLabelDataParseStatus",g.toString()),l.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,v)}},o.revertAppliedPolicyId=function(e,t){void 0===t&&(t=0),this.setPolicyLabel(this._appliedPolicyId),this.raiseLabelInfoUpdateEvent(new Ks);var n=2===e||8===e;this.raiseSetPolicyLabelFailureEvent(t,e,n)},o.setSelectedPolicyId=function(e,t){if(this.setPolicyLabel(this._appliedPolicyId=e),""===e)s.AFrameworkApplication.protectFile=!1,s.AFrameworkApplication.protectedFile=!1,s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("AddInsInSupportedIrmDocsIsEnabled")&&(s.AFrameworkApplication.enableMacrosForProtectedFile=!1);else for(var n,i=nl(this._policyLabelsData.SensitivityLabels);!(n=i()).done;){var r=n.value;if(r.Id===e){s.AFrameworkApplication.protectFile=r.IsEndpointProtectionEnabled,s.AFrameworkApplication.protectedFile=r.IsEndpointProtectionEnabled;break}}this.raiseSetPolicyLabelEvent(new Xs(e,t))},o.parseGetPolicyLabelDataResponse=function(e){var t;return L.d(e,Object(z.a)((function(){return t}),(function(e){return t=e})))?t?!!t.AreLabelsAvailable&&(this._policyLabelsData=t,this.areLabelsAvailableForDisplay()&&h.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call."),this.raiseLabelInfoUpdateEvent(new Ks(!0)),!0):(h.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1):(h.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1)},o.areAutoLabelingSensitiveTypesAvailable=function(){if(!this.areLabelsAvailableForDisplay())return!1;for(var e,t=nl(this._policyLabelsData.SensitivityLabels);!(e=t()).done;){var n=e.value;if(n&&n.AutoLabelingSensitiveTypeIds&&n.AutoLabelingSensitiveTypeIds.length>0)return!0}return!1},o.raiseLabelInfoUpdateEvent=function(e){h.ULS.sendTraceTag(35393610,306,50,"Raising label info update event."),this._eventSource.raiseEvent("LabelInfoUpdateEvent",e)},o.raiseGetPolicyLabelHandlerEvent=function(e){h.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event."),this._eventSource.raiseEvent("GetPolicyLabelEventKey",e)},o.raiseGetAutoPolicyLabelHandlerEvent=function(e){var t=this;this._applicationFeatureHelperFuture&&this._applicationFeatureHelperFuture.execute((function(n){var i=[n.isFeatureEnabled("MsoClpSpTwo",!0),n.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(i).then((function(n){return $s.a(n,(function(e){return e}))&&(h.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),t._eventSource.raiseEvent("GetAutoPolicyLabelEventKey",e),c.a("MipAutoClassificationEnabled")),null}))}))},o.getExtendedPropertiesForLogging=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var n=new Map;return n.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString()),null!=e&&n.set("ApplyLabelFlags",Ws[e]),null!=t&&n.set("GetPolicyLabelsReason",Ns[t]),n},o.getAdditionalValuesForLogging=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var n=new N.a;return n.extendedProperties=this.getExtendedPropertiesForLogging(e,t),n},o.raiseSetPolicyLabelEvent=function(e){h.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event."),this._eventSource.raiseEvent("SetPolicyLabelEventKey",e)},o.raiseAddAutoPolicyBusinessBarEntryHandlerEvent=function(e){h.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event."),e&&e.isRecommended&&c.a("MipRecommendations"),this._eventSource.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",e)},o.raiseRemoveAutoPolicyBusinessBarEntryHandlerEvent=function(e){h.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event."),this._eventSource.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",e)},o.showPolicyTip=function(e,t){void 0===t&&(t=null),h.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user."),this._eventSource.raiseEvent("PolicyTipEvent",new zs(CommonUIStrings.l_PolicyBusinessBarTitle,e,CommonUIStrings.l_PolicyOverrideButton,t))},o.raiseSetPolicyLabelFailureEvent=function(e,t,n){h.ULS.sendTraceTag(42074656,306,50,"Raising set policy label failure event."),this._eventSource.raiseEvent("SetPolicyLabelFailureEventKey",new Qs(e,t,n))},o.setLockId=function(e){this._lockId=e},o.onDataLossPolicyOverrideButtonClick=function(e){this._dataLossNavigateUrl?(h.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),tt.a.followHyperlinkWithNoReferrer(this._dataLossNavigateUrl)):h.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")},o.isServiceUnavailableResponse=function(e){return!(!e.startsWith("<")||-1===e.indexOf("Error")&&-1===e.indexOf("Unavailable"))&&(h.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint."),!0)},o.policyCallWatchStop=function(){this._policyCallTimeStopwatch&&(this._policyCallTimeStopwatch.stop(),this._policyCallTimeStopwatch=null)},o.getActionSourceStringFromPolicyLabelRequestState=function(e){if(!e)return"manual";switch(e.applyLabelFlag){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";default:return"manual"}},o.getAssignmentMethodStringFromPolicyLabelRequestState=function(e){if(!e)return"privileged";var t=e.applyLabelFlag,n="privileged";return 4!==t&&1!==t||(n="standard"),n},o.officeAppTypeToString=function(e){switch(e){case 1:return"Excel";case 4:return"OneNote";case 2:return"PowerPoint";case 5:return"Visio";case 3:return"Word";case 0:default:return"Unknown"}},o.getDocumentPolicyLabelsRequestInternalAsync=function(e,t,n,i,a){if(void 0===n&&(n=null),void 0===i&&(i=!1),void 0===a&&(a=0),this._appSettingsManager.getBooleanAppSetting("WacLabelingGetPolicyLabelsIsEnabled")){this._appliedPolicyId=e,this._amITheOnlyCoauthor=n,this._stopwatchBuilder&&(this._getLabelPolicyCallTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","Call Get Policy Endpoint On Server"));var o={};if(o[Ra.a.appliedPolicyIdHeaderName]=e,this._appSettingsManager.getBooleanAppSetting("SendHostAttributionInfoForPolicyLabelEnabled")){var s=new Ys(this.getPolicyRequestUrl("getpolicylabels",i),1,null,o,!0,2,a,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,t);this._clientRequestManager.send(s).registerCallbacks(Object(r.d)(this,this.onGetPolicyLabelsSuccessCallback,"onGetPolicyLabelsSuccessCallback"),Object(r.d)(this,this.onGetPolicyLabelsFailureCallback,"onGetPolicyLabelsFailureCallback"))}else this._clientRequestManager.addRequest(this.getPolicyRequestUrl("getpolicylabels",i),1,null,o,!0,2,Object(r.d)(this,this.onGetPolicyLabelsSuccessCallback,"onGetPolicyLabelsSuccessCallback"),Object(r.d)(this,this.onGetPolicyLabelsFailureCallback,"onGetPolicyLabelsFailureCallback"),a,void 0,void 0,void 0,void 0,"22");this._getLabelPolicyCalls++,h.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this._getLabelPolicyCalls)}},o.setPolicyLabelRequestInternalAsync=function(e,t,n,i){if(void 0===i&&(i=null),this.isApplyManualPolicyLabelEnabled){this._stopwatchBuilder&&(this._setLabelPolicyCallTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","Call Set Policy Endpoint On Server"));var a={};if(a[Ra.a.selectedPolicyLabelIdHeaderName]=e,t&&(a[Ra.a.setPolicyLabelJustificationHeaderName]=encodeURIComponent(t)),this._lockId&&(a[Ra.a.appLockIdHeaderName]=this._lockId),i?(a[Ra.a.setPolicyLabelActionSourceHeaderName]=this.getActionSourceStringFromPolicyLabelRequestState(i),a[Ra.a.setPolicyLabelAssignmentMethodHeaderName]=this.getAssignmentMethodStringFromPolicyLabelRequestState(i)):(a[Ra.a.setPolicyLabelActionSourceHeaderName]="manual",a[Ra.a.setPolicyLabelAssignmentMethodHeaderName]="privileged"),this.supportsOfficeClientCoauthoring&&this._policyLabelsData&&(a[Ra.a.policyLabelVersionTokenHeaderName]=this._policyLabelsData.PolicyLabelVersionToken),this._appSettingsManager.getBooleanAppSetting("SendHostAttributionInfoForPolicyLabelEnabled")){var o=new Ys(this.getPolicyRequestUrl("setpolicylabel",!0),1,null,a,!0,2,i,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,n);this._clientRequestManager.send(o).registerCallbacks(Object(r.d)(this,this.onSetPolicyLabelSuccessCallback,"onSetPolicyLabelSuccessCallback"),Object(r.d)(this,this.onSetPolicyLabelFailureCallback,"onSetPolicyLabelFailureCallback"))}else this._clientRequestManager.addRequest(this.getPolicyRequestUrl("setpolicylabel",!0),1,null,a,!0,2,Object(r.d)(this,this.onSetPolicyLabelSuccessCallback,"onSetPolicyLabelSuccessCallback"),Object(r.d)(this,this.onSetPolicyLabelFailureCallback,"onSetPolicyLabelFailureCallback"),i,void 0,void 0,void 0,void 0,"32");this._setPolicyLabelCalls++,h.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this._setPolicyLabelCalls)}},o.createHostAttributionInfoFromGetPolicyLabelsReason=function(e){switch(e){case 1:return el.a.createForCurrentApp(1,1);case 2:return el.a.createForCurrentApp(7,1);case 3:return el.a.createForCurrentApp(8,1);case 0:default:return el.a.createForCurrentApp(7,0)}},o.createHostAttributionInfoFromRequestState=function(e){switch(e.applyLabelFlag){case 1:case 16:return el.a.createForCurrentApp(1,1);case 4:case 2:case 8:return el.a.createForCurrentApp(8,1);case 0:default:return el.a.createForCurrentApp(8,0)}},t=e,(n=[{key:"isAutoPolicyLabelHandlerEventRaised",get:function(){return this._isAutoPolicyLabelHandlerEventRaised}},{key:"isEveryCoauthorInSessionClientMipTrusted",get:function(){if(!this._editorsTableManager)return!1;for(var e,t=nl(this._editorsTableManager.getAllAuthors());!(e=t()).done;){var n=e.value;if(!n.Capabilities||!n.Capabilities.SupportsClientIsMipTrusted)return!1}return!0}},{key:"isRtcInitialized",get:function(){return!!this._rtc}}])&&rl(t.prototype,n),i&&rl(t,i),e}();function ol(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(al,"PolicyManager",null,[81]);var sl=function(){function e(){this._policyManager=null,this._container=null,this._policyActor=null,this._businessBar=null,this._autoLabellingBusinessBarEntry=null,this._recommendedLabellingBusinessBarEntry=null}var t,n,i,a=e.prototype;return a.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ShouldInitCommonPolicyPackage")&&(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsDataLossPreventionEnabledForUser")&&s.AFrameworkApplication.activeFrame&&(this._policyManager=this._container.resolve("Common.App.Policy.Contracts.IPolicyManager"),this._policyManager.add_policyTipHandler(Object(r.d)(this,this.showPolicyBusinessBar,"showPolicyBusinessBar")),h.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),Et.a.get_instance().executeWhen(6,(function(){e._policyManager.getDocumentPolicyRequestAsync()}))),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WacLabelingPoliciesIsEnabled")&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SupportsPolicies")&&Et.a.get_instance().executeWhen(6,Object(r.d)(this,this.onAfterRibbonBehaviorAttached,"onAfterRibbonBehaviorAttached")))},a.dispose=function(){},a.configure=function(e){e.register(81,"Common.App.Policy.Contracts.IPolicyManager").singleInstance().usingFactory((function(){return new al(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager,s.AFrameworkApplication.activeFrame.theStopwatchBuilder,s.AFrameworkApplication.appSettingsManager.getIntAppSetting("MaxGetPolicyRetries",1),e.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType)})),e.register(js,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").singleInstance().usingFactory((function(){return new js(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.activeFrame,s.AFrameworkApplication.appSettingsManager,e.resolveLazy("Common.App.Policy.Contracts.IPolicyManager"))})),this._container=e},a.onAfterRibbonBehaviorAttached=function(){this._policyActor=this._container.resolve("Common.App.Policy.PolicyActor"),this._policyActor.registerActions(),this._businessBar=this._container.tryResolve("CommonUI.BusinessBar"),this._policyManager||(this._policyManager=this._container.resolve("Common.App.Policy.Contracts.IPolicyManager")),this._policyManager.add_labelInfoUpdateHandler(Object(r.d)(this,this.updateLabelInfo,"updateLabelInfo")),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled")&&(this._policyManager.add_setPolicyLabelFailureHandler(Object(r.d)(this,this.handleSetPolicyLabelFailure,"handleSetPolicyLabelFailure")),this._policyManager.add_addAutoPolicyBusinessBarEntryHandler(Object(r.d)(this,this.addAutoPolicyBusinessBarEntry,"addAutoPolicyBusinessBarEntry")),this._policyManager.add_removeAutoPolicyBusinessBarEntryHandler(Object(r.d)(this,this.removeAutoPolicyBusinessBarEntry,"removeAutoPolicyBusinessBarEntry")))},a.updateLabelInfo=function(e,t){this._policyActor.setParentToChildSensitivityLabelsDictionary(),this._policyActor.setIdToSensitivityDictionary(),this._policyActor.querySensitivityControl(),this._policyActor.setDefaultLabelIfNeeded(),s.AFrameworkApplication.activeFrame.updateCommandUI()},a.showPolicyBusinessBar=function(e,t){var n=this.getPolicyBusinessBarEntry(t.title,t.policyText,null,t.onButtonClickCallback,t.buttonText);s.AFrameworkApplication.activeFrame.applicationInstance.addEntryToBusinessBar(n,!0)?h.ULS.sendTraceTag(34174785,306,50,"Add entry to BusinessBar succeeded. Policy message is shown to user."):h.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")},a.handleSetPolicyLabelFailure=function(e,t){if(t.showMessage){var n=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle,i=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage;1===t.errorType&&(n=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle,i=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage),2===t.errorType&&(n=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle,i=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage);var r=this.getPolicyBusinessBarEntry(n,i);s.AFrameworkApplication.activeFrame.applicationInstance.addEntryToBusinessBar(r,!0)?h.ULS.sendTraceTag(42074655,306,50,"Add entry to BusinessBar succeeded. CLP policy message is shown to user."):h.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user.")}},a.removeAutoPolicyBusinessBarEntry=function(e,t){var n;(n=t.isRecommended?this._recommendedLabellingBusinessBarEntry:this._autoLabellingBusinessBarEntry)&&this._businessBar&&this._businessBar.isEntryExistent(t.businessBarId)&&this._businessBar.removeEntry(n)},a.addAutoPolicyBusinessBarEntry=function(e,t){if(this._businessBar){this._policyManager.removeAutoPolicyBusinessBarEntry(t.businessBarId);var n=new rs.a(t.title,t.message,null);n.id=t.businessBarId,n.closeable=!0,n.image=3,n.addButton(t.buttonText,t.businessBarEntryHandler,t.buttonText,!0),this._businessBar.addEntry(n,!1),t.isRecommended?this._recommendedLabellingBusinessBarEntry=n:this._autoLabellingBusinessBarEntry=n}},a.getPolicyBusinessBarEntry=function(e,t,n,i,r){void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=null);var a=new rs.a(e,t,n);return a.id=21,a.closeable=!0,i&&a.addLinkWithHandler(r,i),a},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.Policy"}}])&&ol(t.prototype,n),i&&ol(t,i),e}();Object(i.a)(sl,"PackageManager",null,[14,15]);Type.registerNamespace("WELT"),Type.registerNamespace("WVAc"),Type.registerNamespace("WVCo"),Type.registerNamespace("WVHi"),Type.registerNamespace("WVSea"),Type.registerNamespace("WVSel"),Type.registerNamespace("Wac.Common"),Type.registerNamespace("Wac.Common.Actors"),Type.registerNamespace("Wac.Common.SendUsYourFile"),Type.registerNamespace("WordViewer.Embed"),Type.registerNamespace("WordViewer.SendUsYourFile"),Type.registerNamespace("Common.Comments"),Type.registerNamespace("Common.App.CommandUIActors"),Type.registerNamespace("Common.App.HostNotification"),w.main(),Type.registerNamespace("Common"),Type.registerNamespace("Common.App.ApplicationFeatureHelper"),ue.main(),Type.registerNamespace("Common.App.DisplayEnvironmentName"),fe.main(),Type.registerNamespace("Common.App.GestureInput"),Ie.main(),Type.registerNamespace("Common.App.GestureManager"),Qe.main(),Type.registerNamespace("Common.App.SafeLinks"),Type.registerNamespace("Common.App.SafeLinks"),ot.main(),Type.registerNamespace("Common.App.Embed"),Type.registerNamespace("Common.App.InProductMessaging"),Pt.main(),Type.registerNamespace("CNT"),Xt.main(),Type.registerNamespace("Common.App.NewAndOpen.Core"),y.a.instance.registerPackage(new Tn),Type.registerNamespace("Common.App.O365Shell"),On.main(),Type.registerNamespace("Common.App.OneDriveFilePickerApi"),Xn.main(),Type.registerNamespace("Common.App.OpenInClient"),Type.registerNamespace("Common.App.SaveToCloudStorage"),ci.main(),Type.registerNamespace("Common.Search"),Type.registerNamespace("Common.App.SessionExpiration"),Type.registerNamespace("Common.App.SessionExpiration"),xi.main(),Vr.main(),y.a.instance.registerPackage(new da),ba.main(),y.a.instance.registerPackage(new Ta),y.a.instance.registerPackage(new ka),Wo.main(),es.main(),Type.registerNamespace("Common.App.AppLoadStateTracker"),window.Common.App.AppLoadStateTracker.AppLoadStateTracker=ts,y.a.instance.registerPackage(new is,7),Type.registerNamespace("Common.App.WildFire"),As.main(),Type.registerNamespace("Common.App.Policy"),sl.main()},543:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(0),r=n(544),a=n(1),o=n(43),s=n(21);n(3);function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(e,t,n,i,r,a){this._onDialogDismissed=e,this._onLaunchDownload=t,this._iHaveOfficeHandler=n,this._callbackData=i,this._dialogCause=r,this._application=a}var t,n,i,c=e.prototype;return c.reactOICErrorDialogWithTrialHandler=function(e,t){this.oicErrorDialogWithTrialHandler(e)},c.legacyOICErrorDialogWithTrialHandler=function(e,t){this.oicErrorDialogWithTrialHandler(e)},c.oicErrorDialogWithTrialHandler=function(e){var t=10;1===e?(s.a.instance.resolve("Common.IOfficeTrialExperience").launchOffer(this._application),t=3):2===e&&(this._iHaveOfficeHandler&&!this._iHaveOfficeHandler(this._callbackData)||this._onLaunchDownload&&r.a.instance.createOICErrorDialogWithDownload(this._onLaunchDownload,this._onDialogDismissed,this._callbackData),t=5);e&&1!==e||this._onDialogDismissed&&this._onDialogDismissed(this._callbackData),a.AFrameworkApplication.reportErrorWithCauseAndResolution(o.a.openInClientWithC2RFailed,this._dialogCause,t),this.dispose()},c.dispose=function(){this._onDialogDismissed=null,this._onLaunchDownload=null,this._callbackData=null},t=e,(n=[{key:"showHelpLink",get:function(){return!this._onLaunchDownload&&!this._iHaveOfficeHandler}},{key:"offerString",get:function(){return 2===this._application?CommonUIStrings.l_OICErrorC2ROneNoteOffer:CommonUIStrings.l_OICErrorC2ROffer}},{key:"id",get:function(){return"OICErrorDialogWithTrial"}},{key:"errorMessageNoOffice",get:function(){return CommonUIStrings.l_OICErrorMessageNoOffice}},{key:"iHaveOfficeButtonText",get:function(){return CommonUIStrings.l_OICErrorIHaveOfficeButton}},{key:"helpLinkText",get:function(){return CommonUIStrings.l_OICErrorHelpLink}},{key:"helpLinkContentId",get:function(){return"OICFailure"}},{key:"icon",get:function(){return 3}},{key:"actionButtonText",get:function(){return 2===this._application?CommonUIStrings.l_OICErrorC2RInstallOneNoteButton:CommonUIStrings.l_OICErrorC2RInstallButton}},{key:"dialogTitle",get:function(){return CommonUIStrings.l_DefaultDialogTitle}}])&&l(t.prototype,n),i&&l(t,i),e}();Object(i.a)(c,"AOICErrorDialogWithTrial",null,[4])},544:function(e,t,n){"use strict";var i=n(0),r=n(2),a=n(1),o=n(43),s=n(94),l=n(21),c=n(3);function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(e,t,n,i){this._macOfficeOffer=null,this._dialogCause=i,this._onDialogDismissed=e,this._onLaunchDownload=t,this._callbackData=n,this._shouldOfferMacOfficeTrial=this.macOfficeOffer.shouldOfferMacOfficeTrialInErrorDialog;var r=CommonUIStrings.l_OICErrorMacOfficeOffer.split("{0}");this._macOfficePreLinkText=r[0],this._macOfficePostLinkText=r[1]}var t,n,i,r=e.prototype;return r.reactOICErrorDialogHandler=function(e,t){this.oicErrorDialogHandler(e)},r.legacyOICErrorDialogHandler=function(e,t){this.oicErrorDialogHandler(e)},r.oicErrorDialogHandler=function(e){var t=10;this._onLaunchDownload&&1===e&&(this._onLaunchDownload(this._callbackData),t=1),this._onDialogDismissed&&this._onDialogDismissed(this._callbackData),this.reportError(t)},r.oicErrorHelpLinkHandler=function(e){s.Redirect.showHelp("OICFailure"),this.reportError(2)},r.oicErrorMacOfferLinkHandler=function(e){this.macOfficeOffer.launchMacOfficeTrialWindow(),this.reportError(4)},r.reportError=function(e){c.ULS.sendTraceTag(18715410,211,10,"Report OICErrorDialog. Dialog cause: {0}, solution: {1}",this._dialogCause,e),a.AFrameworkApplication.reportErrorWithCauseAndResolution(o.a.openInClientFailed,this._dialogCause,e)},r.dispose=function(){this._onLaunchDownload=null,this._onDialogDismissed=null,this._callbackData=null},t=e,(n=[{key:"macOfficeOffer",get:function(){return this._macOfficeOffer||(this._macOfficeOffer=l.a.instance.resolve("Common.IMacOfficeOffer"))}},{key:"id",get:function(){return"OICErrorDialog"}},{key:"errorMessage",get:function(){return CommonUIStrings.l_OICErrorMessage}},{key:"helpLinkText",get:function(){return CommonUIStrings.l_OICErrorHelpLink}},{key:"shouldOfferMacOfficeTrial",get:function(){return this._shouldOfferMacOfficeTrial}},{key:"macOfficePreLinkText",get:function(){return this._macOfficePreLinkText}},{key:"macOfficePostLinkText",get:function(){return this._macOfficePostLinkText}},{key:"macOfficeLinkText",get:function(){return CommonUIStrings.l_OICErrorMacOFficeLink}},{key:"icon",get:function(){return this._shouldOfferMacOfficeTrial?3:2}},{key:"errorFileDownloadOffer",get:function(){return CommonUIStrings.l_OICErrorFileDownloadOffer}},{key:"containsOnLaunchDownload",get:function(){return!!this._onLaunchDownload}},{key:"errorNoOfficeDownloadButtonText",get:function(){return CommonUIStrings.l_OICErrorNoOfficeDownloadButton}},{key:"dialogTitle",get:function(){return CommonUIStrings.l_DefaultDialogTitle}}])&&u(t.prototype,n),i&&u(t,i),e}();Object(i.a)(d,"AOICErrorDialog",null,[4]);var p=n(17),h=n(58);function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var m=function(e){var t,n;function i(t,n,i,a){var o;(o=e.call(this,t,n,i,a)||this)._helpLink=null,o._macOfferLink=null;var l=document.createElement("span");l.id="errorMessageText",l.innerText=o.errorMessage,s.Redirect.isHelpAvailable()&&(l.appendChild(document.createElement("br")),l.appendChild(document.createElement("br")),o._helpLink=document.createElement("a"),o._helpLink.href="#",o._helpLink.innerText=o.helpLinkText,l.appendChild(o._helpLink),p.a.addHandler(o._helpLink,"click",Object(r.d)(g(o),o.oicErrorHelpLinkHandler,"oicErrorHelpLinkHandler")));var c=new h.StandardDialog;if(c.dialogId=o.id,o.shouldOfferMacOfficeTrial){var u=document.createElement("span"),d=document.createElement("span");u.innerText=o.macOfficePreLinkText,d.innerText=o.macOfficePostLinkText,o._macOfferLink=document.createElement("a"),o._macOfferLink.href="#",o._macOfferLink.innerText=o.macOfficeLinkText,l.appendChild(document.createElement("br")),l.appendChild(u),l.appendChild(o._macOfferLink),l.appendChild(d),p.a.addHandler(o._macOfferLink,"click",Object(r.d)(g(o),o.oicErrorMacOfferLinkHandler,"oicErrorMacOfferLinkHandler"))}else if(o.containsOnLaunchDownload){l.appendChild(document.createElement("br")),l.appendChild(document.createElement("br"));var m=document.createElement("span");m.innerText=o.errorFileDownloadOffer,l.appendChild(m)}return o.containsOnLaunchDownload?(c.buttonsOption=1,c.setButtonText(1,o.errorNoOfficeDownloadButtonText)):c.buttonsOption=0,c.messageBox(o.dialogTitle,null,o.icon,Object(r.d)(g(o),o.legacyOICErrorDialogHandler,"legacyOICErrorDialogHandler"),l),c.setDescribedByForDialog("errorMessageText"),o}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.dispose=function(){this._helpLink&&(p.a.removeHandler(this._helpLink,"click",Object(r.d)(this,this.oicErrorHelpLinkHandler,"oicErrorHelpLinkHandler")),this._helpLink=null),this._macOfferLink&&(p.a.removeHandler(this._macOfferLink,"click",Object(r.d)(this,this.oicErrorMacOfferLinkHandler,"oicErrorMacOfferLinkHandler")),this._macOfferLink=null),e.prototype.dispose.call(this)},i}(d);Object(i.a)(m,"OICErrorDialog",d,[]);n(9);function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v=function(){function e(e,t,n){this._onDialogDismissed=t,this._onLaunchDownload=e,this._callbackData=n}var t,n,i,r=e.prototype;return r.reactOICErrorDialogHandler=function(e,t){this.oicErrorDialogHandler(e)},r.legacyOICErrorDialogHandler=function(e,t){this.oicErrorDialogHandler(e)},r.oicErrorDialogHandler=function(e){var t=10;1===e&&(this._onLaunchDownload(this._callbackData),t=1),this._onDialogDismissed&&this._onDialogDismissed(this._callbackData),this.reportError(t)},r.oicErrorHelpLinkHandler=function(e){s.Redirect.showHelp("OICFailure"),this.reportError(2)},r.reportError=function(e){a.AFrameworkApplication.reportErrorWithCauseAndResolution(o.a.openInClientSecondaryFailed,3,e)},r.dispose=function(){this._onDialogDismissed=null,this._onLaunchDownload=null,this._callbackData=null},t=e,(n=[{key:"id",get:function(){return"OICErrorDialogWithDownload"}},{key:"errorMessageNoOfficeDetected",get:function(){return CommonUIStrings.l_OICErrorNoOfficeDetected}},{key:"helpLinkText",get:function(){return CommonUIStrings.l_OICErrorHelpLink}},{key:"errorFileDownloadOffer",get:function(){return CommonUIStrings.l_OICErrorFileDownloadOffer}},{key:"errorNoOfficeDownloadButtonText",get:function(){return CommonUIStrings.l_OICErrorNoOfficeDownloadButton}},{key:"icon",get:function(){return 2}},{key:"dialogTitle",get:function(){return CommonUIStrings.l_DefaultDialogTitle}}])&&f(t.prototype,n),i&&f(t,i),e}();function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object(i.a)(v,"AOICErrorDialogWithDownload",null,[4]);var _=function(e){var t,n;function i(t,n,i){var a;(a=e.call(this,t,n,i)||this)._helpLink=null;var o=document.createElement("span");o.id="errorMessageText",o.innerText=a.errorMessageNoOfficeDetected,s.Redirect.isHelpAvailable()&&(o.appendChild(document.createElement("br")),o.appendChild(document.createElement("br")),a._helpLink=document.createElement("a"),a._helpLink.href="#",a._helpLink.innerText=a.helpLinkText,o.appendChild(a._helpLink),p.a.addHandler(a._helpLink,"click",Object(r.d)(S(a),a.oicErrorHelpLinkHandler,"oicErrorHelpLinkHandler"))),o.appendChild(document.createElement("br")),o.appendChild(document.createElement("br"));var l=document.createElement("span");l.innerText=a.errorFileDownloadOffer,o.appendChild(l);var c=new h.StandardDialog;return c.dialogId=a.id,c.buttonsOption=1,c.setButtonText(1,a.errorNoOfficeDownloadButtonText),c.messageBox(a.dialogTitle,null,a.icon,Object(r.d)(S(a),a.legacyOICErrorDialogHandler,"legacyOICErrorDialogHandler"),o),c.setDescribedByForDialog("errorMessageText"),a}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.dispose=function(){this._helpLink&&(p.a.removeHandler(this._helpLink,"click",Object(r.d)(this,this.oicErrorHelpLinkHandler,"oicErrorHelpLinkHandler")),this._helpLink=null),e.prototype.dispose.call(this)},i}(v);Object(i.a)(_,"OICErrorDialogWithDownload",v,[]);var y=n(75);var b=function(e){var t,n;function i(t,n,i,a){var o,l,c;c=e.call(this,t,n,i,a)||this;var u=((o={}).errorMessage=c.errorMessage,o);if(s.Redirect.isHelpAvailable()){var d;u.helpLink=((d={}).type="AppLinkProps",d.id="helpLink",d.text=c.helpLinkText,d.handler=function(e){c.oicErrorHelpLinkHandler(e)},d)}if(c.shouldOfferMacOfficeTrial){var p;u.macOfficePreLinkText=c.macOfficePreLinkText;u.macOfficeLink=((p={}).type="AppLinkProps",p.id="macOfficeLink",p.text=c.macOfficeLinkText,p.handler=function(e){c.oicErrorMacOfferLinkHandler(e)},p),u.macOfficePostText=c.macOfficePostLinkText}else c.containsOnLaunchDownload&&(u.errorFileDownloadOffer=c.errorFileDownloadOffer);var h=new y.a(!1,!1,!0);c.containsOnLaunchDownload?(h.buttonsOption=1,h.setButtonText(1,c.errorNoOfficeDownloadButtonText)):h.buttonsOption=0,h.dialogId=c.id;var g=((l={}).id=c.id,l.dialogIcon=c.icon,l.bodyControls=u,l);return h.initializeAndShow(c.dialogTitle,Object(r.d)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(c),c.reactOICErrorDialogHandler,"reactOICErrorDialogHandler"),g),c}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(d);Object(i.a)(b,"ReactOICErrorDialog",d,[]);var A=function(e){var t,n;function i(t,n,i){var a,o,l;l=e.call(this,t,n,i)||this;var c=((a={}).errorMessage=l.errorMessageNoOfficeDetected,a.errorFileDownloadOffer=l.errorFileDownloadOffer,a);if(s.Redirect.isHelpAvailable()){var u;c.helpLink=((u={}).type="AppLinkProps",u.id="helpLink",u.text=l.helpLinkText,u.handler=function(e){l.oicErrorHelpLinkHandler(e)},u)}var d=new y.a(!1,!1,!0);d.buttonsOption=1,d.setButtonText(1,l.errorNoOfficeDownloadButtonText),d.dialogId=l.id;var p=((o={}).id=l.id,o.dialogIcon=l.icon,o.bodyControls=c,o);return d.initializeAndShow(l.dialogTitle,Object(r.d)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(l),l.reactOICErrorDialogHandler,"reactOICErrorDialogHandler"),p),l}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(v);function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(A,"ReactOICErrorDialogWithDownload",v,[]),n.d(t,"a",(function(){return T}));var T=function(){function e(){this._isReactDialogEnabled=!!a.AFrameworkApplication.activeFrame&&a.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled}var t,i,r,o=e.prototype;return o.createOICErrorDialog=function(e,t,n,i){return this._isReactDialogEnabled?new b(e,t,n,i):new m(e,t,n,i)},o.createOICErrorDialogWithDownload=function(e,t,n){return this._isReactDialogEnabled?new A(e,t,n):new _(e,t,n)},o.createOICErrorDialogWithTrial=function(e,t,i,r,a,o){var s=n(547).ReactOICErrorDialogWithTrial,l=n(548).OICErrorDialogWithTrial;return this._isReactDialogEnabled?new s(e,t,i,r,a,o):new l(e,t,i,r,a,o)},t=e,r=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(i=null)&&C(t.prototype,i),r&&C(t,r),e}();T._instance=null,Object(i.a)(T,"OICErrorDialogFactory",null,[213])},547:function(e,t,n){"use strict";n.r(t),n.d(t,"ReactOICErrorDialogWithTrial",(function(){return l}));var i=n(0),r=n(2),a=n(543),o=n(94),s=n(75);var l=function(e){var t,n;function i(t,n,i,a,l,c){var u,d,p;p=e.call(this,t,n,i,a,l,c)||this;var h=((u={}).errorMessage=p.errorMessageNoOffice,u.offerString=p.offerString,u),g=new s.a(!1,!1,!0);if(p.showHelpLink){var m;g.buttonsOption=1;h.helpLink=((m={}).type="AppLinkProps",m.id="helpLink",m.text=p.helpLinkText,m.handler=function(e){o.Redirect.showHelp(p.helpLinkContentId)},m)}else g.buttonsOption=4,g.setButtonText(2,p.iHaveOfficeButtonText);g.setButtonText(1,p.actionButtonText),g.dialogId=p.id;var f=((d={}).id=p.id,d.dialogIcon=p.icon,d.bodyControls=h,d);return g.initializeAndShow(p.dialogTitle,Object(r.d)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(p),p.reactOICErrorDialogWithTrialHandler,"reactOICErrorDialogWithTrialHandler"),f),p}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(a.a);Object(i.a)(l,"ReactOICErrorDialogWithTrial",a.a,[])},548:function(e,t,n){"use strict";n.r(t),n.d(t,"OICErrorDialogWithTrial",(function(){return s}));var i=n(0),r=n(2),a=n(543),o=n(58);var s=function(e){var t,n;function i(t,n,i,a,s,l){var c;c=e.call(this,t,n,i,a,s,l)||this;var u=document.createElement("span");u.innerText=c.errorMessageNoOffice,u.appendChild(document.createElement("br")),u.appendChild(document.createElement("br"));var d=document.createElement("span");d.innerText=c.offerString,u.appendChild(d);var p=new o.StandardDialog;return c.showHelpLink?(p.buttonsOption=1,p.addHelpLink(c.helpLinkText,c.helpLinkContentId)):(p.buttonsOption=4,p.setButtonText(2,c.iHaveOfficeButtonText)),p.setButtonText(1,c.actionButtonText),p.dialogId=c.id,p.messageBox(c.dialogTitle,null,c.icon,Object(r.d)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(c),c.legacyOICErrorDialogWithTrialHandler,"legacyOICErrorDialogWithTrialHandler"),u),c}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(a.a);Object(i.a)(s,"OICErrorDialogWithTrial",a.a,[])}}]);
//# sourceMappingURL=https://wordwebclientbuilds.blob.core.windows.net/ooui/1bdb878eb2c9f6e4858feb8dab64d388d1ebe749/WordViewerDS.dll1.js.map